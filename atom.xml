<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Kernel]]></title>
  <subtitle><![CDATA[Code First！Code Review！]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://molloc.me/"/>
  <updated>2015-10-26T13:44:11.331Z</updated>
  <id>http://molloc.me/</id>
  
  <author>
    <name><![CDATA[Kernel]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[ZY-DAY-24]]></title>
    <link href="http://molloc.me/2015/10/25/ZY-DAY-24/"/>
    <id>http://molloc.me/2015/10/25/ZY-DAY-24/</id>
    <published>2015-10-25T05:12:22.000Z</published>
    <updated>2015-10-26T13:44:11.331Z</updated>
    <content type="html"><![CDATA[<h2 id="文件共享服务"><a class="header-anchor" href="#文件共享服务"></a>文件共享服务</h2>
<p>工作在应用层的ftp, 工作在内核的nfs(Sun), 扩平台的文件共享服务, samba(在Linux上实现CIFS(SMB)协议)</p>
<a id="more"></a>
<h2 id="das-直接连接存储"><a class="header-anchor" href="#das-直接连接存储"></a>DAS 直接连接存储</h2>
<p><em>Direct Attached Storage</em>，是通常放置在服务器机箱内部的驱动器，通常是SCSI连接。DAS驱动器也可以放置在外部机箱内，但是通过有限长度的SCSI电缆进行连接的。</p>
<h2 id="nas-网络连接存储-文件级别共享"><a class="header-anchor" href="#nas-网络连接存储-文件级别共享"></a>NAS 网络连接存储 文件级别共享</h2>
<p><em>Network Attached Storage</em> 是单独连接到局域网上的设备，但是仅仅提供基于文件的存储。简单地说，NAS机器是专用的文件服务器，但是它没有运行应用程序的能力，而是分配它们所有的资源，用来文件共享。有时也称为“Filers”。</p>
<h2 id="san-存储区域网络-块级别共享"><a class="header-anchor" href="#san-存储区域网络-块级别共享"></a>SAN 存储区域网络 块级别共享</h2>
<p><em>Storage Area Network</em>, 通常用来指专用的硬盘存储阵列，通过光纤通道链路连接到不少主机上，这个光纤通道来自一个光纤通道交换机，该交换机可为所有的设备提供高速“Hub”功能。</p>
<h2 id="ftp"><a class="header-anchor" href="#ftp"></a>FTP</h2>
<p>File Transfer Protocal, 基于tcp协议工作的, 21/tcp, 在文件传输过程中,需要传输两类数据. 服务器默认监听在命令连接端口上. 当客户端请求一个获取文件命令时, 服务器会另起一个连接到客户端进行文件数据的传输. 其中命令连接是一直存在的直到用户退出, 数据传输连接是按需建立及及时关闭.</p>
<ul>
<li>命令连接: 文件管理类命令</li>
<li>数据连接: 数据传输</li>
</ul>
<p>其中命令连接是由客户端发起建立的, 当用户去请求下载一个文件时,数据传输连接分为</p>
<ul>
<li>主动: 由服务器创建连接
<ul>
<li>命令连接: <code>Clinet:50000 --&gt; Server:21</code></li>
<li>数据连接: <code>Server:20/tcp --&gt; Client:50000 + 1</code></li>
</ul>
</li>
<li>被动: 由客户端创建连接
<ul>
<li>命令连接: <code>Clinet:50000 --&gt; Server:21</code></li>
<li>数据连接: <code>Clinet:50000 + 1 --&gt; Server:随机端口</code>, 随机端口,服务端会通过命令连接响应告诉客户端(121,23: 121*256+23)</li>
</ul>
</li>
</ul>
<h2 id="数据传输格式"><a class="header-anchor" href="#数据传输格式"></a>数据传输格式</h2>
<p>要根据文件类型来选择, 既支持文本传输又支持二进制格式.</p>
<h2 id="ftp-c-s架构"><a class="header-anchor" href="#ftp-c-s架构"></a>FTP C/S架构</h2>
<ul>
<li>Server: wu-ftpd, proftpd, pureftp, vsftpd(Very Secure), ServU(window)</li>
<li>Client: ftp, lftp, wget, curl, lftpget, filezilla, gftp(Linux GUI), flashfxp(window), cuteftp(window)</li>
</ul>
<h2 id="ftp-响应码"><a class="header-anchor" href="#ftp-响应码"></a>FTP 响应码</h2>
<ul>
<li>1xx: 信息</li>
<li>2xx: 成功类的状态码</li>
<li>3xx: 提示需进一步提供补充类信息的状态码</li>
<li>4xx: 客户端错误</li>
<li>5xx: 服务端错误</li>
</ul>
<h2 id="ftp-用户认证"><a class="header-anchor" href="#ftp-用户认证"></a>FTP 用户认证</h2>
<ul>
<li>系统用户</li>
<li>虚拟用户, 虚拟用户仅用于访问某特定服务中的资源</li>
<li>匿名用户</li>
</ul>
<h2 id="nsswitch-name-service-switch-configuration-名称解析框架"><a class="header-anchor" href="#nsswitch-name-service-switch-configuration-名称解析框架"></a>nsswitch(name service switch configuration): 名称解析框架</h2>
<ul>
<li>配置文件 <code>/etc/nsswitch.conf</code></li>
<li>模块  <code>/lib64/libnss*, /usr/lib64/libnss*</code></li>
</ul>
<h2 id="pam-pluggable-authentication-module-用户认证框架"><a class="header-anchor" href="#pam-pluggable-authentication-module-用户认证框架"></a>pam(pluggable authentication module): 用户认证框架</h2>
<ul>
<li>配置文件 <code>/etc/pam.d/*, /etc/pam.conf</code></li>
<li>模块 <code>ls /lib64/security</code></li>
</ul>
<h2 id="centos-6-7-安装-vsftpd"><a class="header-anchor" href="#centos-6-7-安装-vsftpd"></a>CentOS 6.7 安装 vsftpd</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ yum install vsftpd</span><br><span class="line">$ rpm -ql vsftpd</span><br><span class="line">&gt; /etc/logrotate.d/vsftpd <span class="comment"># 日志滚动</span></span><br><span class="line">&gt; /etc/pam.d/vsftpd <span class="comment"># 用户认证配置文件</span></span><br><span class="line">&gt; /etc/vsftpd <span class="comment"># 配置文件目录</span></span><br><span class="line">&gt; /etc/vsftpd/ftpusers</span><br><span class="line">&gt; /etc/vsftpd/user_list</span><br><span class="line">&gt; /usr/sbin/vsftpd <span class="comment"># 主应用程序</span></span><br><span class="line">&gt; /etc/vsftpd/vsftpd.conf <span class="comment"># 主配置文件</span></span><br><span class="line">&gt; /etc/rc.d/init.d/vsftpd <span class="comment"># 服务脚本</span></span><br><span class="line">&gt; /var/ftp</span><br><span class="line">&gt; /var/ftp/pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动vsftpd</span></span><br><span class="line">$ service vsftpd start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试连接, 注意状态码的变化</span></span><br><span class="line">$ ftp <span class="number">192.168</span>.<span class="number">1.166</span></span><br><span class="line"></span><br><span class="line">Connected to <span class="number">192.168</span>.<span class="number">1.166</span> (<span class="number">192.168</span>.<span class="number">1.166</span>).</span><br><span class="line"><span class="number">220</span> (vsFTPd <span class="number">2.2</span>.<span class="number">2</span>)</span><br><span class="line">Name (<span class="number">192.168</span>.<span class="number">1.166</span>:root): ftp</span><br><span class="line"><span class="number">331</span> Please specify the password.</span><br><span class="line">Password:</span><br><span class="line"><span class="number">230</span> Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line"><span class="number">227</span> Entering Passive Mode (<span class="number">192</span>,<span class="number">168</span>,<span class="number">1</span>,<span class="number">166</span>,<span class="number">159</span>,<span class="number">64</span>).</span><br><span class="line"><span class="number">150</span> Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> <span class="number">0</span>        <span class="number">0</span>            <span class="number">4096</span> Jul <span class="number">24</span> <span class="number">00</span>:<span class="number">49</span> pub</span><br><span class="line"><span class="number">226</span> Directory send OK.</span><br><span class="line">ftp&gt; <span class="built_in">help</span> <span class="comment"># 获取帮助</span></span><br></pre></td></tr></table></figure>
<h2 id="配置vsftpd-conf"><a class="header-anchor" href="#配置vsftpd-conf"></a>配置vsftpd.conf</h2>
<p>网络上共享文件权限的控制方式遵循两个法则</p>
<ol>
<li>共享权限有没有开放.</li>
<li>文件系统的权限有没有开放.</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/vsftpd.conf <span class="comment"># 文件中的配置项目必须顶格,不能有任何空格</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 匿名用户的配置</span></span><br><span class="line">&gt; anonymous_<span class="built_in">enable</span>=YES</span><br><span class="line">&gt; anon_upload_<span class="built_in">enable</span>=YES <span class="comment"># 允许匿名用户上传</span></span><br><span class="line">&gt; anon_mkdir_write_<span class="built_in">enable</span>=YES <span class="comment"># 允许匿名用户创建目录</span></span><br><span class="line">&gt; anon_other_write_<span class="built_in">enable</span>=YES <span class="comment"># 允许匿名用户删除文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统用户的配置</span></span><br><span class="line">&gt; <span class="built_in">local</span>_<span class="built_in">enable</span>=YES</span><br><span class="line">&gt; write_<span class="built_in">enable</span>=YES <span class="comment"># 系统用户是否有写权限</span></span><br><span class="line">&gt; <span class="built_in">local</span>_<span class="built_in">umask</span> <span class="comment"># 上传文件默认权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁锢所有ftp本地用户于其家目录.</span></span><br><span class="line">&gt; chroot_<span class="built_in">local</span>_user=YES</span><br><span class="line"><span class="comment"># 禁锢文件中指定ftp本地用户于其家目录.</span></span><br><span class="line">&gt; chroot_list_<span class="built_in">enable</span>=YES</span><br><span class="line">&gt; chroot_list_file=/etc/vsftpd/chroot_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志</span></span><br><span class="line">&gt; xferlog_<span class="built_in">enable</span>=YES <span class="comment"># 是否开启日志文件</span></span><br><span class="line">&gt; xferlog_std_format=YES <span class="comment"># 日志是否启用标准格式</span></span><br><span class="line">&gt; xferlog_file=/var/<span class="built_in">log</span>/xferlog <span class="comment"># 日志文件的位置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vsftpd使用pam完成用户认证</span></span><br><span class="line">&gt; pam_service_name=vsftpd <span class="comment"># 指明在/etc/pam.d下用哪一个文件进行用户认证</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件相关</span></span><br><span class="line">&gt; chown_uploads=YES <span class="comment"># 改变上传文件的属主</span></span><br><span class="line">&gt; chown_username=whoever</span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制那些用户能不能登录</span></span><br><span class="line">&gt; userlist_<span class="built_in">enable</span> <span class="comment"># 是否启用控制用户登录的列表文件</span></span><br><span class="line">&gt; userlist_deny=YES|NO <span class="comment"># 是否拒绝user_list中的用户</span></span><br><span class="line"><span class="comment"># YES-黑名单, 出现在user_list中的用户不允许登录</span></span><br><span class="line"><span class="comment"># NO-白名单, 只有出现在user_list中的用户才可以登录.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 虚拟用户相关</span></span><br><span class="line">&gt; guest_<span class="built_in">enable</span>=YES <span class="comment"># 是否允许来宾账号</span></span><br><span class="line">&gt; guest_username=vuser <span class="comment"># 来宾账号映射为本地系统的那个用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接限制</span></span><br><span class="line">&gt; max_clients <span class="comment"># 最大并发连接数</span></span><br><span class="line">&gt; max_per_ip  <span class="comment"># 每个IP可同时发起的并发请求数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传输速率</span></span><br><span class="line">&gt; anon_max_rate <span class="comment"># 匿名用户的最大传输速率,单位是'字节/秒'</span></span><br><span class="line">&gt; <span class="built_in">local</span>_max_rate <span class="comment"># 本地用户的最大传输速率,单位是'字节/秒'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vsftpd 严禁修改根目录的权限`/var/ftp`, 可以修改子目录的权限`/var/ftp/pub`</span></span><br><span class="line">$ <span class="built_in">cd</span> /var/ftp</span><br><span class="line">$ mkdir upload</span><br><span class="line">$ setfacl -m u:ftp:rwx upload/</span><br></pre></td></tr></table></figure>
<h2 id="资源访问位置"><a class="header-anchor" href="#资源访问位置"></a>资源访问位置</h2>
<ul>
<li>匿名用户(映射为ftp用户)共享资源访问位置, ftp用户的家目录<code>/var/ftp</code></li>
<li>系统用户通过ftp访问的资源的位置, 用户自己的家目录.</li>
<li>虚拟用户通过ftp访问的资源的位置, 给虚拟用户指定的映射成为的系统用户的家目录</li>
</ul>
<h2 id="虚拟用户"><a class="header-anchor" href="#虚拟用户"></a>虚拟用户</h2>
<p>所有的虚拟用户会被统一映射为一个指定的系统账号,访问的共享目录为此系统的家目录.</p>
<p>各虚拟用户可被赋予不同的访问权限, 通过匿名用户的权限控制参数进行指定.</p>
<h2 id="虚拟用户账号的存储方式"><a class="header-anchor" href="#虚拟用户账号的存储方式"></a>虚拟用户账号的存储方式</h2>
<ul>
<li>文件: 编辑文件(奇数行为用户名,奇数行 + 1 的为对应用户的密码),此文件需要被编码为hash格式.</li>
<li>关系型数据库中的表中,即时查询数据库完成用户认证. 基于mysql, 此时pam要依赖于pam_mysql模块.</li>
</ul>
<h2 id="基于mysql完成用户认证"><a class="header-anchor" href="#基于mysql完成用户认证"></a>基于mysql完成用户认证</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ yum install pam_mysql</span><br><span class="line">$ rpm -ql pam_mysql</span><br><span class="line"></span><br><span class="line">&gt; /lib64/security/pam_mysql.so</span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span></span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span>/COPYING</span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span>/CREDITS</span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span>/ChangeLog</span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span>/NEWS</span><br><span class="line">&gt; /usr/share/doc/pam_mysql-<span class="number">0.7</span>/README <span class="comment"># 参考此文件进行配置</span></span><br></pre></td></tr></table></figure>
<h2 id="vsftpd-pam-mysql认证"><a class="header-anchor" href="#vsftpd-pam-mysql认证"></a>vsftpd+pam+mysql认证</h2>
<ul>
<li>vsftpd:  192.168.1.166</li>
<li>MariaDB: 192.168.1.160</li>
</ul>
<p>一、安装所需要程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install vsftpd mysql-server mysql-devel pam_mysql <span class="comment"># pam_mysql由epel源提供</span></span><br></pre></td></tr></table></figure>
<p>二、创建虚拟用户账号</p>
<p>1、准备数据库及相关表</p>
<p>首先请确保mysql服务已经正常启动。而后，按需要建立存储虚拟用户的数据库即可，这里将其创建为vsftpd数据库。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; create database vsftpd;</span><br><span class="line">MariaDB [(none)]&gt; grant select on vsftpd.* to vsftpd@192.168.1.166 identified by 'molloc';</span><br><span class="line">MariaDB [(none)]&gt; flush privileges;</span><br><span class="line">MariaDB [(none)]&gt; use vsftpd;</span><br><span class="line">MariaDB [(vsftpd)]&gt; CREATE TABLE users (</span><br><span class="line">                  &gt;   id INT UNSIGNED auto_increment NOT NULL,</span><br><span class="line">                  &gt;   NAME VARCHAR(20) BINARY NOT NULL,</span><br><span class="line">                  &gt;   PASSWORD CHAR(48) BINARY NOT NULL,</span><br><span class="line">                  &gt;   PRIMARY KEY(id),</span><br><span class="line">                  &gt;   unique key(name)</span><br><span class="line">                  &gt; );</span><br><span class="line"></span><br><span class="line">MariaDB [(vsftpd)]&gt;  desc users;</span><br><span class="line">+----------+------------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type             | Null | Key | Default | Extra          |</span><br><span class="line">+----------+------------------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(50)      | NO   | UNI | NULL    |                |</span><br><span class="line">| password | char(48)         | NO   |     | NULL    |                |</span><br><span class="line">+----------+------------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure>
<p>2、添加测试的虚拟用户</p>
<p>根据需要添加所需要的用户，需要说明的是，这里将其密码为了安全起见应该使用PASSWORD函数加密后存储。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(vsftpd)]&gt; insert into users(name, password) values('tom', password('molloc'));</span><br><span class="line">MariaDB [(vsftpd)]&gt; insert into users(name, password) values('jerry', password('molloc'));</span><br><span class="line"></span><br><span class="line">MariaDB [(vsftpd)]&gt; select * from users;</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">| id | NAME  | PASSWORD                                  |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">|  1 | tom   | *B6B5363BB55E144C10183B5B0787FBAE61E25E37 |</span><br><span class="line">|  2 | jerry | *B6B5363BB55E144C10183B5B0787FBAE61E25E37 |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>三、配置vsftpd</p>
<p>1.建立pam认证所需文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/pam.d/vsftpd.mysql</span><br><span class="line"><span class="comment"># 添加以下两行, auth --&gt; 检查账号密码是否正确, account --&gt; 检查账号是否有效(审计), crypt=0 加密方式</span></span><br><span class="line">&gt; auth required /lib64/security/pam_mysql.so user=vsftpd passwd=molloc host=<span class="number">192.168</span>.<span class="number">1.160</span> db=vsftpd table=users usercolumn=name passwdcolumn=password crypt=<span class="number">2</span></span><br><span class="line">&gt; account required /lib64/security/pam_mysql.so user=vsftpd passwd=molloc host=<span class="number">192.168</span>.<span class="number">1.160</span> db=vsftpd table=users usercolumn=name passwdcolumn=password crypt=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：由于mysql的安装方式不同，pam_mysql.so基于unix sock连接mysql服务器时可能会出问题，此时，建议授权一个可远程连接的mysql并访问vsftpd数据库的用户。</span></span><br></pre></td></tr></table></figure>
<p>2.修改vsftpd的配置文件，使其适应mysql认证</p>
<p>建立虚拟用户映射的系统用户及对应的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ useradd <span class="operator">-s</span> /sbin/nologin <span class="operator">-d</span> /var/ftproot vuser</span><br><span class="line"></span><br><span class="line">$ ll <span class="operator">-d</span> /var/ftproot</span><br><span class="line">&gt; drwx------ <span class="number">4</span> vuser vuser <span class="number">4096</span> Oct <span class="number">23</span> <span class="number">08</span>:<span class="number">16</span> /var/ftproot/</span><br><span class="line"></span><br><span class="line">$ chmod go+rx /var/ftproot</span><br><span class="line">&gt; drwxr-xr-x <span class="number">4</span> vuser vuser <span class="number">4096</span> Oct <span class="number">23</span> <span class="number">08</span>:<span class="number">16</span> /var/ftproot/</span><br></pre></td></tr></table></figure>
<p>请确保<code>/etc/vsftpd.conf</code>中已经启用了以下选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">anonymous_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="built_in">local</span>_<span class="built_in">enable</span>=YES</span><br><span class="line">write_<span class="built_in">enable</span>=YES</span><br><span class="line">anon_upload_<span class="built_in">enable</span>=NO</span><br><span class="line">anon_mkdir_write_<span class="built_in">enable</span>=NO</span><br><span class="line">chroot_<span class="built_in">local</span>_user=YES</span><br></pre></td></tr></table></figure>
<p>而后添加以下选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">guest_<span class="built_in">enable</span>=YES</span><br><span class="line">guest_username=vuser</span><br></pre></td></tr></table></figure>
<p>并确保<code>pam_service_name</code>选项的值如下所示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pam_service_name=vsftpd.mysql</span><br></pre></td></tr></table></figure>
<p>四、启动vsftpd服务</p>
<p>重启<code>vsftpd</code>服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service vsftpd restart</span><br></pre></td></tr></table></figure>
<p>五、配置虚拟用户具有不同的访问权限</p>
<p><code>vsftpd</code>可以在配置文件目录中为每个用户提供单独的配置文件以定义其ftp服务访问权限，每个虚拟用户的配置文件名同虚拟用户的用户名。配置文件目录可以是任意未使用目录，只需要在<code>vsftpd.conf</code>指定其路径及名称即可。</p>
<p>1、配置<code>vsftpd</code>为虚拟用户使用配置文件目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim vsftpd.conf</span><br><span class="line"><span class="comment">#添加如下选项</span></span><br><span class="line">user_config_dir=/etc/vsftpd/vusers_config</span><br></pre></td></tr></table></figure>
<p>2、创建所需要目录，并为虚拟用户提供配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir /etc/vsftpd/vusers_config/</span><br><span class="line">$ <span class="built_in">cd</span> /etc/vsftpd/vusers_config/</span><br><span class="line">$ touch tom jerry</span><br></pre></td></tr></table></figure>
<p>3、配置虚拟用户的访问权限</p>
<p>虚拟用户对<code>vsftpd</code>服务的访问权限是通过匿名用户的相关指令进行的。比如，如果需要让<code>tom</code>用户具有上传文件的权限，可以修改<code>/etc/vsftpd/vusers_config/tom</code>文件，在里面添加如下选项即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">anon_upload_<span class="built_in">enable</span>=&#123;YES|NO&#125;</span><br><span class="line">anon_mkdir_write_<span class="built_in">enable</span>=&#123;YES|NO&#125;</span><br><span class="line">anon_other_write_<span class="built_in">enable</span>=&#123;YES|NO&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lftp命令"><a class="header-anchor" href="#lftp命令"></a>lftp命令</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 待补充...</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="文件共享服务"><a class="header-anchor" href="#文件共享服务"></a>文件共享服务</h2>
<p>工作在应用层的ftp, 工作在内核的nfs(Sun), 扩平台的文件共享服务, samba(在Linux上实现CIFS(SMB)协议)</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-DAY-21]]></title>
    <link href="http://molloc.me/2015/10/15/ZY-DAY-21/"/>
    <id>http://molloc.me/2015/10/15/ZY-DAY-21/</id>
    <published>2015-10-15T13:57:53.000Z</published>
    <updated>2015-10-15T13:57:53.937Z</updated>
    <content type="html"></content>
    <summary type="html">
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-DAY-22]]></title>
    <link href="http://molloc.me/2015/10/15/ZY-DAY-22/"/>
    <id>http://molloc.me/2015/10/15/ZY-DAY-22/</id>
    <published>2015-10-15T13:57:53.000Z</published>
    <updated>2015-10-25T04:31:51.851Z</updated>
    <content type="html"><![CDATA[<h2 id="mariadb基础"><a class="header-anchor" href="#mariadb基础"></a>MariaDB基础</h2>
<h2 id="命令"><a class="header-anchor" href="#命令"></a>命令</h2>
<ul>
<li>desc TABLE_NAME 可以描述表结构</li>
<li>help show 查看show命令的帮助手册</li>
<li>For server side help, type 'help contents'</li>
<li>show global variables like '%skip%'</li>
<li>set password for 'root'@'127.0.0.1' = password('molloc')</li>
</ul>
<a id="more"></a>
<h2 id="安装通用二进制版mariadb"><a class="header-anchor" href="#安装通用二进制版mariadb"></a>安装通用二进制版MariaDB</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS release 6.7 (Final)</span></span><br><span class="line">$ useradd -M <span class="operator">-s</span> /sbin/nologin mysql</span><br><span class="line">$ tar xf mariadb-<span class="number">5.5</span>.<span class="number">46</span>-linux-x86_64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line">$ ln <span class="operator">-s</span> mariadb-<span class="number">5.5</span>.<span class="number">46</span>-linux-x86_64 mysql</span><br><span class="line">$ chown mysql.mysql -R mysql</span><br><span class="line">$ <span class="built_in">cd</span> mysql</span><br><span class="line">$ <span class="built_in">cd</span> support-files/</span><br><span class="line">$ cp <span class="operator">-a</span> my-small.cnf /etc/my.cnf <span class="comment"># 配置文件读取顺序, /etc/my.cnf --&gt; /etc/mysql/my.cnf --&gt; ~/.my.cnf</span></span><br><span class="line">$ mkdir -pv /data/mydata</span><br><span class="line">$ chown --reference /usr/<span class="built_in">local</span>/mysql/data/ /data/mydata/</span><br><span class="line">$ vim /etc/my.cnf <span class="comment"># 添加以下行</span></span><br><span class="line">&gt; default-character-set = utf8 <span class="comment"># 在[client]下面</span></span><br><span class="line">&gt; character-set-server = utf8 <span class="comment"># 在[mysqld]</span></span><br><span class="line">&gt; datadir=/data/mydata</span><br><span class="line">&gt; skip-name-resolve</span><br><span class="line">&gt; innodb_file_per_table = on</span><br><span class="line"></span><br><span class="line">$ scripts/mysql_install_db --user=mysql --datadir=/data/mydata <span class="comment"># 初始化</span></span><br><span class="line">$ cp <span class="operator">-a</span> /usr/<span class="built_in">local</span>/mysql/support-files/mysql.server /etc/rc.d/init.d/mysqld</span><br><span class="line">$ chkconfig --add mysqld</span><br><span class="line">$ chkconfig --list mysqld</span><br><span class="line">$ chkconfig mysqld on</span><br><span class="line"></span><br><span class="line">$ vim /etc/profile.d/mysql.sh <span class="comment"># 添加以下内容</span></span><br><span class="line">&gt; <span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/mysql/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ service mysqld restart</span><br><span class="line"></span><br><span class="line">$ mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is <span class="number">3</span></span><br><span class="line">Server version: <span class="number">5.5</span>.<span class="number">46</span>-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2015</span>, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> help. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; select version();</span><br><span class="line"></span><br><span class="line">+----------------+</span><br><span class="line">| version()      |</span><br><span class="line">+----------------+</span><br><span class="line">| <span class="number">5.5</span>.<span class="number">46</span>-MariaDB |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure>
<p>为了使用mysql的安装符合系统使用规范，并将其开发组件导出给系统使用，这里还需要进行如下步骤：</p>
<h2 id="输出mysql的man手册至man命令的查找路径"><a class="header-anchor" href="#输出mysql的man手册至man命令的查找路径"></a>输出mysql的man手册至man命令的查找路径</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/man.config，添加如下行即可</span></span><br><span class="line">MANPATH  /usr/<span class="built_in">local</span>/mysql/man</span><br></pre></td></tr></table></figure>
<h2 id="输出mysql的头文件至系统头文件路径-usr-include"><a class="header-anchor" href="#输出mysql的头文件至系统头文件路径-usr-include"></a>输出mysql的头文件至系统头文件路径/usr/include</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这可以通过简单的创建链接实现</span></span><br><span class="line">$ ln -sv /usr/<span class="built_in">local</span>/mysql/include  /usr/include/mysql</span><br></pre></td></tr></table></figure>
<h2 id="输出mysql的库文件给系统库查找路径"><a class="header-anchor" href="#输出mysql的库文件给系统库查找路径"></a>输出mysql的库文件给系统库查找路径</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">'/usr/local/mysql/lib'</span> &gt; /etc/ld.so.conf.d/mysql.conf</span><br></pre></td></tr></table></figure>
<h2 id="而后让系统重新载入系统库"><a class="header-anchor" href="#而后让系统重新载入系统库"></a>而后让系统重新载入系统库</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ldconfig</span><br></pre></td></tr></table></figure>
<h2 id="create-table-创建表的同时-可创建索引"><a class="header-anchor" href="#create-table-创建表的同时-可创建索引"></a><code>CREATE TABLE</code> 创建表的同时,可创建索引</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> (<span class="keyword">create</span> defination)</span><br><span class="line">	col_name col_defination | <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (coll, ...)</span><br><span class="line"></span><br><span class="line"><span class="comment">--eg</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mydb.ac_teacher (</span><br><span class="line">	t_id <span class="built_in">INT</span> UNSIGNED <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> auto_increment,</span><br><span class="line">	NAME <span class="built_in">VARCHAR</span> (<span class="number">50</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	age TINYINT UNSIGNED,</span><br><span class="line">	gender enum (<span class="string">'F'</span>, <span class="string">'M'</span>) <span class="keyword">DEFAULT</span> <span class="string">'M'</span>,</span><br><span class="line">	dz <span class="built_in">VARCHAR</span> (<span class="number">100</span>),</span><br><span class="line">	<span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (NAME, dz)</span><br><span class="line">);</span></span><br></pre></td></tr></table></figure>
<h2 id="查看表上的索引"><a class="header-anchor" href="#查看表上的索引"></a>查看表上的索引</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">SHOW</span> &#123;<span class="keyword">INDEX</span> | INDEXES | KEYS&#125;</span><br><span class="line">    &#123;<span class="keyword">FROM</span> | <span class="keyword">IN</span>&#125; tbl_name</span><br><span class="line">    [&#123;<span class="keyword">FROM</span> | <span class="keyword">IN</span>&#125; db_name]</span><br><span class="line">    [<span class="keyword">WHERE</span> expr]</span></span><br></pre></td></tr></table></figure>
<h2 id="修改表-alter-table"><a class="header-anchor" href="#修改表-alter-table"></a>修改表 ALTER TABLE</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Name: '<span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span><span class="string">'</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">ALTER [ONLINE | OFFLINE] [IGNORE] TABLE tbl_name</span><br><span class="line">    [alter_specification [, alter_specification] ...]</span><br><span class="line">    [partition_options]</span><br><span class="line"></span><br><span class="line">alter_specification:</span><br><span class="line">    table_options</span><br><span class="line">  | ADD [COLUMN] col_name column_definition</span><br><span class="line">        [FIRST | AFTER col_name ]</span><br><span class="line">  | ADD [COLUMN] (col_name column_definition,...)</span><br><span class="line">  | ADD &#123;INDEX|KEY&#125; [index_name]</span><br><span class="line">        [index_type] (index_col_name,...) [index_option] ...</span><br><span class="line">  | ADD [CONSTRAINT [symbol]] PRIMARY KEY</span><br><span class="line">        [index_type] (index_col_name,...) [index_option] ...</span><br><span class="line">  | ADD [CONSTRAINT [symbol]]</span><br><span class="line">        UNIQUE [INDEX|KEY] [index_name]</span><br><span class="line">        [index_type] (index_col_name,...) [index_option] ...</span><br><span class="line">  | ADD FULLTEXT [INDEX|KEY] [index_name]    --添加全文索引</span><br><span class="line">        (index_col_name,...) [index_option] ...</span><br><span class="line">  | ADD SPATIAL [INDEX|KEY] [index_name]</span><br><span class="line">        (index_col_name,...) [index_option] ...</span><br><span class="line">  | ADD [CONSTRAINT [symbol]]</span><br><span class="line">        FOREIGN KEY [index_name] (index_col_name,...)</span><br><span class="line">        reference_definition</span><br><span class="line">  | ALTER [COLUMN] col_name &#123;SET DEFAULT literal | DROP DEFAULT&#125; --修改字段的某些特殊定义</span><br><span class="line">  | CHANGE [COLUMN] old_col_name new_col_name column_definition -- 可以修改字段名</span><br><span class="line">        [FIRST|AFTER col_name]</span><br><span class="line">  | MODIFY [COLUMN] col_name column_definition -- 只能改变指定字段的字段定义, 不可以修改字段名</span><br><span class="line">        [FIRST | AFTER col_name]</span><br><span class="line">  | DROP [COLUMN] col_name</span><br><span class="line">  | DROP PRIMARY KEY</span><br><span class="line">  | DROP &#123;INDEX|KEY&#125; index_name</span><br><span class="line">  | DROP FOREIGN KEY fk_symbol</span><br><span class="line">  | MAX_ROWS = rows</span><br><span class="line">  | DISABLE KEYS</span><br><span class="line">  | ENABLE KEYS</span><br><span class="line">  | RENAME [TO|AS] new_tbl_name</span><br><span class="line">  | ORDER BY col_name [, col_name] ...</span><br><span class="line">  | CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]</span><br><span class="line">  | [DEFAULT] CHARACTER SET [=] charset_name [COLLATE [=] collation_name]</span><br><span class="line">  | DISCARD TABLESPACE</span><br><span class="line">  | IMPORT TABLESPACE</span><br><span class="line">  | FORCE</span><br><span class="line">  | ADD PARTITION (partition_definition)</span><br><span class="line">  | DROP PARTITION partition_names</span><br><span class="line">  | TRUNCATE PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | COALESCE PARTITION number</span><br><span class="line">  | REORGANIZE PARTITION [partition_names INTO (partition_definitions)]</span><br><span class="line">  | ANALYZE PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | CHECK PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | OPTIMIZE PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | REBUILD PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | REPAIR PARTITION &#123;partition_names | ALL&#125;</span><br><span class="line">  | PARTITION BY partitioning_expression</span><br><span class="line">  | REMOVE PARTITIONING</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(length)] [ASC | DESC]</span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    USING &#123;BTREE | HASH&#125;</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] value</span><br><span class="line">  | index_type</span><br><span class="line">  | WITH PARSER parser_name</span><br><span class="line">  | COMMENT '</span><span class="keyword">string</span><span class="string">'</span><br><span class="line"></span><br><span class="line">table_options:</span><br><span class="line">    table_option [[,] table_option] ...  (see CREATE TABLE options)</span><br><span class="line"></span><br><span class="line">--eg</span><br><span class="line">alter table ac_teacher add class_no smallint unsigned not null after name</span><br><span class="line">alter table ac_teacher modify class_no tinyint unsigned not null after age</span><br><span class="line"></span><br><span class="line">&gt; desc ac_teacher;</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type                | Null | Key | Default | Extra          |</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span><br><span class="line">| t_id     | int(10) unsigned    | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(50)         | NO   | MUL | NULL    |                |</span><br><span class="line">| age      | tinyint(3) unsigned | YES  |     | NULL    |                |</span><br><span class="line">| class_no | tinyint(3) unsigned | NO   |     | NULL    |                |</span><br><span class="line">| gender   | enum('</span>F<span class="string">','</span>M<span class="string">')       | YES  |     | M       |                |</span><br><span class="line">| dz       | varchar(100)        | YES  |     | NULL    |                |</span><br><span class="line">+----------+---------------------+------+-----+---------+----------------+</span></span></span><br></pre></td></tr></table></figure>
<h2 id="查看当前所有支持的引擎"><a class="header-anchor" href="#查看当前所有支持的引擎"></a>查看当前所有支持的引擎</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mydb]&gt; show engines; --Support --&gt; Default 是当前默认的引擎, XA-分布式事物</span><br><span class="line"></span><br><span class="line">+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| Engine             | Support | Comment                                                                    | Transactions | XA   | Savepoints |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span><br><span class="line">| CSV                | YES     | CSV storage engine                                                         | NO           | NO   | NO         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                                      | NO           | NO   | NO         |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables                  | NO           | NO   | NO         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears)             | NO           | NO   | NO         |</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                                      | NO           | NO   | NO         |</span><br><span class="line">| InnoDB             | DEFAULT | Percona-XtraDB, Supports transactions, row-level locking, and foreign keys | YES          | YES  | YES        |</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                                     | NO           | NO   | NO         |</span><br><span class="line">| FEDERATED          | YES     | FederatedX pluggable storage engine                                        | YES          | NO   | YES        |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                                         | NO           | NO   | NO         |</span><br><span class="line">| Aria               | YES     | Crash-safe tables with MyISAM heritage                                     | NO           | NO   | NO         |</span><br><span class="line">+--------------------+---------+----------------------------------------------------------------------------+--------------+------+------------+</span><br></pre></td></tr></table></figure>
<h2 id="查看表状态"><a class="header-anchor" href="#查看表状态"></a>查看表状态</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; help show table status</span><br><span class="line">Name: 'SHOW TABLE STATUS'</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">SHOW TABLE STATUS [&#123;FROM | IN&#125; db_name]</span><br><span class="line">    [LIKE 'pattern' | WHERE expr]</span><br><span class="line"></span><br><span class="line">--LIKE用作模糊匹配,支持通配符</span><br><span class="line">--'_: 匹配任意单个字符'</span><br><span class="line">--'%: 匹配任意长度字符'</span><br><span class="line"></span><br><span class="line">--eg</span><br><span class="line">MariaDB [mydb]&gt; show table status like 'ac_teacher' \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: ac_teacher</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Compact</span><br><span class="line">           Rows: 0</span><br><span class="line"> Avg_row_length: 0</span><br><span class="line">    Data_length: 16384</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 16384</span><br><span class="line">      Data_free: 0</span><br><span class="line"> Auto_increment: 1</span><br><span class="line">    Create_time: 2015-10-21 07:52:40</span><br><span class="line">    Update_time: NULL</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: utf8_general_ci</span><br><span class="line">       Checksum: NULL</span><br><span class="line"> Create_options:</span><br><span class="line">        Comment:</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h2 id="修改某张表的引擎"><a class="header-anchor" href="#修改某张表的引擎"></a>修改某张表的引擎</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mydb]&gt; alter table ac_teacher engine=Aria</span><br></pre></td></tr></table></figure>
<h2 id="索引管理"><a class="header-anchor" href="#索引管理"></a>索引管理</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [mydb]&gt; help create index</span><br><span class="line"></span><br><span class="line">Name: 'CREATE INDEX'</span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line">CREATE [ONLINE|OFFLINE] [UNIQUE|FULLTEXT|SPATIAL] INDEX index_name</span><br><span class="line">    [index_type]</span><br><span class="line">    ON tbl_name (index_col_name,...)</span><br><span class="line">    [index_option] ...</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(length)] [ASC | DESC]</span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    USING &#123;BTREE | HASH&#125;</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] value</span><br><span class="line">  | index_type</span><br><span class="line">  | WITH PARSER parser_name</span><br><span class="line">  | COMMENT 'string'</span><br></pre></td></tr></table></figure>
<h2 id="dml-insert-delete-select-update"><a class="header-anchor" href="#dml-insert-delete-select-update"></a>DML: INSERT, DELETE, SELECT, UPDATE</h2>
<h2 id="用户及权限管理"><a class="header-anchor" href="#用户及权限管理"></a>用户及权限管理</h2>
<p>用户账号: 'username'@'host', 其中<code>host</code>可使用IP,网络地址,可使用通配符(_和%)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">--创建一个用户</span><br><span class="line">create user 'wpuser'@'172.16.%.%' identified by 'wppass';</span><br><span class="line"></span><br><span class="line">--删除用户</span><br><span class="line">drop user 'username'@'host';</span><br><span class="line"></span><br><span class="line">--授权, 如果用户事先不存在,则创建此账号并授权, ALL PRIVILEGES 表示所有权限.</span><br><span class="line">GRANT priv1,... on db_name.tb_name to 'wpuser'@'%' [identified by 'passwod'];</span><br><span class="line"></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">--收回权限</span><br><span class="line">REVOKE priv1,... on db_name.tb_name FROM 'username'@'host'</span><br><span class="line"></span><br><span class="line">revoke insert, update on mydb.* from 'wpuser'@'%';</span><br><span class="line"></span><br><span class="line">--查看某用户获得的授权</span><br><span class="line">MariaDB [mydb]&gt; show grants for wpuser;</span><br><span class="line">+-------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants for wpuser@%                                                                                   |</span><br><span class="line">+-------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO 'wpuser'@'%' IDENTIFIED BY PASSWORD '*C9B2DB1CA193280B971CA3602D5174A5D637D2BF' |</span><br><span class="line">| GRANT ALL PRIVILEGES ON `mydb`.* TO 'wpuser'@'%'                                                      |</span><br><span class="line">+-------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="关闭skip-name-resolve"><a class="header-anchor" href="#关闭skip-name-resolve"></a>关闭<code>skip_name_resolve</code></h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global variables like '%skip%';</span><br><span class="line"></span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| Variable_name                    | Value     |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| replicate_events_marked_for_skip | replicate |</span><br><span class="line">| skip_external_locking            | ON        |</span><br><span class="line">| skip_name_resolve                | OFF       |</span><br><span class="line">| skip_networking                  | OFF       |</span><br><span class="line">| skip_show_database               | OFF       |</span><br><span class="line">| slave_skip_errors                | OFF       |</span><br><span class="line">| sql_slave_skip_counter           | 0         |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">$ vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">--找到[mysqld]添加以下行</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">$ service mysql restart</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global variables like '%skip%';</span><br><span class="line"></span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| Variable_name                    | Value     |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| replicate_events_marked_for_skip | replicate |</span><br><span class="line">| skip_external_locking            | ON        |</span><br><span class="line">| skip_name_resolve                | ON        |</span><br><span class="line">| skip_networking                  | OFF       |</span><br><span class="line">| skip_replication                 | OFF       |</span><br><span class="line">| skip_show_database               | OFF       |</span><br><span class="line">| slave_skip_errors                | OFF       |</span><br><span class="line">| sql_slave_skip_counter           | 0         |</span><br><span class="line">+----------------------------------+-----------+</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="mariadb基础"><a class="header-anchor" href="#mariadb基础"></a>MariaDB基础</h2>
<h2 id="命令"><a class="header-anchor" href="#命令"></a>命令</h2>
<ul>
<li>desc TABLE_NAME 可以描述表结构</li>
<li>help show 查看show命令的帮助手册</li>
<li>For server side help, type 'help contents'</li>
<li>show global variables like '%skip%'</li>
<li>set password for 'root'@'127.0.0.1' = password('molloc')</li>
</ul>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-DAY-23]]></title>
    <link href="http://molloc.me/2015/10/15/ZY-DAY-23/"/>
    <id>http://molloc.me/2015/10/15/ZY-DAY-23/</id>
    <published>2015-10-15T13:57:53.000Z</published>
    <updated>2015-10-25T08:16:20.965Z</updated>
    <content type="html"><![CDATA[<h2 id="lamp-php-httpd的三种方式"><a class="header-anchor" href="#lamp-php-httpd的三种方式"></a>LAMP PHP+HTTPD的三种方式</h2>
<ol>
<li>modules: 把php编译成为httpd模块, 其中<code>prefork --&gt; libphp5.so, worker, event --&gt; zts</code>;</li>
<li>cgi: 常用于<code>perl + httpd</code></li>
<li>fastcgi: php5.3.3自带了fpm组件, 提供守护进程, 前端httpd, httpd-proxy-fcgi反向代理用户对动态内容请求至后端的fastcgi server.</li>
</ol>
<a id="more"></a>
<h2 id="httpd对fastcgi协议的支持"><a class="header-anchor" href="#httpd对fastcgi协议的支持"></a>httpd对fastcgi协议的支持</h2>
<ul>
<li>http-2.2 需要安装额外模块fcgi.</li>
<li>http-2.4 自带fcgi模块.</li>
</ul>
<h2 id="mariadb的监听方式"><a class="header-anchor" href="#mariadb的监听方式"></a>MariaDB的监听方式</h2>
<ul>
<li>Unix Sock</li>
<li>tcp/ip</li>
</ul>
<h2 id="安装次序"><a class="header-anchor" href="#安装次序"></a>安装次序</h2>
<p>httpd, mariadb, php, 编译php依赖于httpd和mariadb.</p>
<h2 id="场景一-php编译为httpd模块"><a class="header-anchor" href="#场景一-php编译为httpd模块"></a>场景一, php编译为Httpd模块</h2>
<p><a href="http://www.molloc.com/archives/1151" target="_blank" rel="external">点我编译安装httpd-2.4</a></p>
<p><a href="http://www.molloc.com/archives/1162" target="_blank" rel="external">点我安装通用二进制MariaDB-5.5.42及MariaDB基础</a></p>
<p>安装php, (额外安装libxml2-devel, libmcrypt, libmcrypt-devel, bzip2-devel), 如果httpd使用的mpm是worker,event, 还应额外使用<code>--enable-maintainer-zts</code>选项.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ yum install libxml2-devel libmcrypt libmcrypt-devel bzip2-devel</span><br><span class="line">$ axel http://cn2.php.net/distributions/php-<span class="number">5.4</span>.<span class="number">45</span>.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> /<span class="built_in">source</span>/php</span><br><span class="line">$ tar xvf php-<span class="number">5.4</span>.<span class="number">45</span>.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> php-<span class="number">5.4</span>.<span class="number">45</span>/</span><br><span class="line">$ ./configure \</span><br><span class="line">  &gt; --prefix=/usr/<span class="built_in">local</span>/php \ <span class="comment"># 指明默认安装目录</span></span><br><span class="line">  &gt; --with-mysql=mysqlnd \</span><br><span class="line">  &gt; --with-mysqli=mysqlnd \</span><br><span class="line">  &gt; --with-pdo-mysql=mysqlnd \</span><br><span class="line">  &gt; --with-apxs2=/usr/<span class="built_in">local</span>/apache/bin/apxs \ <span class="comment"># 指明apache的apxs的位置</span></span><br><span class="line">  &gt; --enable-mbstring \ <span class="comment"># 支持多字节</span></span><br><span class="line">  &gt; --with-freetype-dir  \ <span class="comment"># 字体, 不指定去系统上自动搜索</span></span><br><span class="line">  &gt; --with-jpeg-dir  \ <span class="comment"># 支持jpeg图片生成</span></span><br><span class="line">  &gt; --with-png-dir \ <span class="comment"># 支持png图片生成</span></span><br><span class="line">  &gt; --with-zlib \ <span class="comment"># 通信时实现压缩</span></span><br><span class="line">  &gt; --with-libxml-dir=/usr \ <span class="comment"># 依赖于libxml2-devel</span></span><br><span class="line">  &gt; --enable-xml \ <span class="comment"># 支持xml的处理</span></span><br><span class="line">  &gt; --enable-sockets \ <span class="comment"># 启用sockets功能</span></span><br><span class="line">  &gt; --with-mcrypt \ <span class="comment"># Include mcrypt support</span></span><br><span class="line">  &gt; --with-bz2 \ <span class="comment"># Include BZip2 support</span></span><br><span class="line">  &gt; --enable-maintainer-zts \<span class="comment"># apache event, worker</span></span><br><span class="line">  &gt; --with-config-file-path=/etc/php/ \ <span class="comment">#</span></span><br><span class="line">  &gt; --with-config-file-scan-dir=/etc/php.d/ <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>为php提供配置文件, <code>cp php.ini-production /etc/php.ini</code></p>
<p>编辑apache配置文件<code>httpd.conf</code>,让apche支持php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加如下两行</span></span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line">AddType application/x-httpd-php-source .phps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改DirectoryIndex</span></span><br><span class="line">DirectoryIndex index.php index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">LoadModule php5_module        modules/libphp5.so</span><br><span class="line">PHPIniDir /etc/php/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重载httpd配置文件</span></span><br><span class="line">service httpd reload</span><br></pre></td></tr></table></figure>
<h2 id="安装phpmyadmin-wordpress"><a class="header-anchor" href="#安装phpmyadmin-wordpress"></a>安装phpmyadmin, wordpress</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ mv phpMyAdmin-<span class="number">4.5</span>.<span class="number">1</span>-all-languages /usr/<span class="built_in">local</span>/apache/htdocs/padmin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置vhost --&gt; phpmyadmin, wordpress</span></span><br><span class="line"></span><br><span class="line">$ vim httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注释主服务配置</span></span><br><span class="line"><span class="comment">#DocumentRoot "/usr/local/apache/htdocs"</span></span><br><span class="line"><span class="comment">#&lt;Directory "/usr/local/apache/htdocs"&gt;</span></span><br><span class="line"><span class="comment">#   Options Indexes FollowSymLinks</span></span><br><span class="line"><span class="comment">#   AllowOverride None</span></span><br><span class="line"><span class="comment">#   Require all granted</span></span><br><span class="line"><span class="comment">#&lt;/Directory&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开Virtual hosts的配置</span></span><br><span class="line"><span class="comment"># Virtual hosts</span></span><br><span class="line">Include conf/extra/httpd-vhosts.conf</span><br><span class="line"></span><br><span class="line">vim conf/extra/httpd-vhosts.conf</span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerAdmin padmin@molloc.com</span><br><span class="line">    DocumentRoot <span class="string">"/usr/local/apache/htdocs/vhost/padmin"</span></span><br><span class="line">    ServerName padmin.molloc.com</span><br><span class="line">    ServerAlias padmin.molloc.me</span><br><span class="line">    ErrorLog <span class="string">"logs/padmin.molloc.com-error_log"</span></span><br><span class="line">    CustomLog <span class="string">"logs/padmin.molloccom-access_log"</span> combined</span><br><span class="line">    &lt;Directory <span class="string">"/usr/local/apache/htdocs/vhost/padmin"</span>&gt;</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Options None</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerAdmin wordpress@molloc.com</span><br><span class="line">    DocumentRoot <span class="string">"/usr/local/apache/htdocs/vhost/wordpress"</span></span><br><span class="line">    ServerName wordpress.molloc.com</span><br><span class="line">    ErrorLog <span class="string">"logs/wordpress.molloc.com-error_log"</span></span><br><span class="line">    CustomLog <span class="string">"logs/wordpress.molloc.com-access_log"</span> combined</span><br><span class="line">    &lt;Directory <span class="string">"/usr/local/apache/htdocs/vhost/wordpress"</span>&gt;</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Options None</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">$ vim /etc/hosts <span class="comment"># 添加以下行</span></span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.166</span> padmin.molloc.com</span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.166</span> wordpress.molloc.com</span><br></pre></td></tr></table></figure>
<h2 id="附成功截图"><a class="header-anchor" href="#附成功截图"></a>附成功截图</h2>
<p><img src="http://static.molloc.com/linux/imgs/ZY-DAY-23padmin.jpg" alt="padmin">
<img src="http://static.molloc.com/linux/imgs/ZY-DAY-23wordpress.jpg" alt="wordpress"></p>
<h2 id="ab测试"><a class="header-anchor" href="#ab测试"></a>ab测试</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">$ ab -n <span class="number">1000</span> -c <span class="number">50</span> http://wordpress.molloc.com/index.php</span><br><span class="line"><span class="comment"># 没有缓存的情况下</span></span><br><span class="line">Server Software:        Apache/<span class="number">2.4</span>.<span class="number">17</span></span><br><span class="line">Server Hostname:        wordpress.molloc.com</span><br><span class="line">Server Port:            <span class="number">80</span></span><br><span class="line"></span><br><span class="line">Document Path:          /index.php</span><br><span class="line">Document Length:        <span class="number">0</span> bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      <span class="number">50</span></span><br><span class="line">Time taken <span class="keyword">for</span> tests:   <span class="number">186.866</span> seconds</span><br><span class="line">Complete requests:      <span class="number">1000</span></span><br><span class="line">Failed requests:        <span class="number">0</span></span><br><span class="line">Write errors:           <span class="number">0</span></span><br><span class="line">Non-<span class="number">2</span>xx responses:      <span class="number">1000</span></span><br><span class="line">Total transferred:      <span class="number">308000</span> bytes</span><br><span class="line">HTML transferred:       <span class="number">0</span> bytes</span><br><span class="line">Requests per second:    <span class="number">5.35</span> [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       <span class="number">9343.281</span> [ms] (mean)</span><br><span class="line">Time per request:       <span class="number">186.866</span> [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          <span class="number">1.61</span> [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        <span class="number">0</span>    <span class="number">1</span>   <span class="number">1.3</span>      <span class="number">0</span>       <span class="number">9</span></span><br><span class="line">Processing:   <span class="number">374</span> <span class="number">9115</span> <span class="number">7600.6</span>   <span class="number">5930</span>   <span class="number">34116</span></span><br><span class="line">Waiting:      <span class="number">373</span> <span class="number">9114</span> <span class="number">7600.8</span>   <span class="number">5924</span>   <span class="number">34116</span></span><br><span class="line">Total:        <span class="number">374</span> <span class="number">9115</span> <span class="number">7600.3</span>   <span class="number">5930</span>   <span class="number">34117</span></span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  <span class="number">50</span>%   <span class="number">5930</span></span><br><span class="line">  <span class="number">66</span>%  <span class="number">10544</span></span><br><span class="line">  <span class="number">75</span>%  <span class="number">13656</span></span><br><span class="line">  <span class="number">80</span>%  <span class="number">15791</span></span><br><span class="line">  <span class="number">90</span>%  <span class="number">22174</span></span><br><span class="line">  <span class="number">95</span>%  <span class="number">24870</span></span><br><span class="line">  <span class="number">98</span>%  <span class="number">27014</span></span><br><span class="line">  <span class="number">99</span>%  <span class="number">28494</span></span><br><span class="line"> <span class="number">100</span>%  <span class="number">34117</span> (longest request)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装xcache</span></span><br><span class="line">$ axel http://xcache.lighttpd.net/pub/Releases/<span class="number">3.2</span>.<span class="number">0</span>/xcache-<span class="number">3.2</span>.<span class="number">0</span>.tar.bz2</span><br><span class="line">$ tar xvf xcache-<span class="number">3.2</span>.<span class="number">0</span>.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> xcache-<span class="number">3.2</span>.<span class="number">0</span></span><br><span class="line">$ phpize</span><br><span class="line">$ ./configure --enable-xcache --with-php-config=/usr/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line">$ ls /usr/<span class="built_in">local</span>/php/lib/php/extensions/no-debug-zts-<span class="number">20100525</span>/</span><br><span class="line">&gt; xcache.so</span><br><span class="line">$ cp xcache.ini /etc/php.d/</span><br><span class="line">$ vim /etc/php.d/xcache.ini</span><br><span class="line">&gt; extension = /usr/<span class="built_in">local</span>/php/lib/php/extensions/no-debug-zts-<span class="number">20100525</span>/xcache.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置xcache再次执行ab</span></span><br><span class="line">Server Software:        Apache/<span class="number">2.4</span>.<span class="number">17</span></span><br><span class="line">Server Hostname:        wordpress.molloc.com</span><br><span class="line">Server Port:            <span class="number">80</span></span><br><span class="line"></span><br><span class="line">Document Path:          /index.php</span><br><span class="line">Document Length:        <span class="number">0</span> bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      <span class="number">50</span></span><br><span class="line">Time taken <span class="keyword">for</span> tests:   <span class="number">15.657</span> seconds</span><br><span class="line">Complete requests:      <span class="number">1000</span></span><br><span class="line">Failed requests:        <span class="number">0</span></span><br><span class="line">Write errors:           <span class="number">0</span></span><br><span class="line">Non-<span class="number">2</span>xx responses:      <span class="number">1000</span></span><br><span class="line">Total transferred:      <span class="number">308000</span> bytes</span><br><span class="line">HTML transferred:       <span class="number">0</span> bytes</span><br><span class="line">Requests per second:    <span class="number">63.87</span> [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       <span class="number">782.857</span> [ms] (mean)</span><br><span class="line">Time per request:       <span class="number">15.657</span> [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          <span class="number">19.21</span> [Kbytes/sec] received</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        <span class="number">0</span>    <span class="number">0</span>   <span class="number">0.3</span>      <span class="number">0</span>       <span class="number">5</span></span><br><span class="line">Processing:    <span class="number">82</span>  <span class="number">776</span> <span class="number">464.3</span>    <span class="number">785</span>    <span class="number">4153</span></span><br><span class="line">Waiting:       <span class="number">82</span>  <span class="number">776</span> <span class="number">464.4</span>    <span class="number">785</span>    <span class="number">4153</span></span><br><span class="line">Total:         <span class="number">82</span>  <span class="number">776</span> <span class="number">464.3</span>    <span class="number">785</span>    <span class="number">4153</span></span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  <span class="number">50</span>%    <span class="number">785</span></span><br><span class="line">  <span class="number">66</span>%    <span class="number">905</span></span><br><span class="line">  <span class="number">75</span>%    <span class="number">971</span></span><br><span class="line">  <span class="number">80</span>%   <span class="number">1020</span></span><br><span class="line">  <span class="number">90</span>%   <span class="number">1192</span></span><br><span class="line">  <span class="number">95</span>%   <span class="number">1319</span></span><br><span class="line">  <span class="number">98</span>%   <span class="number">1599</span></span><br><span class="line">  <span class="number">99</span>%   <span class="number">3161</span></span><br><span class="line"> <span class="number">100</span>%   <span class="number">4153</span> (longest request)</span><br></pre></td></tr></table></figure>
<h2 id="场景二-php以fpm工作为独立守护进程"><a class="header-anchor" href="#场景二-php以fpm工作为独立守护进程"></a>场景二, php以fpm工作为独立守护进程</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ service httpd stop</span><br><span class="line">$ vim /usr/<span class="built_in">local</span>/apache/conf/httpd.conf</span><br><span class="line"><span class="comment">#LoadModule php5_module        modules/libphp5.so</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新编译安装php</span></span><br><span class="line">$ rm -rf php /etc/php /etc/php.d</span><br><span class="line"></span><br><span class="line">$ ./configure   --prefix=/usr/<span class="built_in">local</span>/php \</span><br><span class="line">  --with-mysql=/usr/<span class="built_in">local</span>/mysql \</span><br><span class="line">  --with-mysqli=/usr/<span class="built_in">local</span>/mysql/bin/mysql_config \</span><br><span class="line">  --enable-fpm \</span><br><span class="line">  --enable-mbstring \</span><br><span class="line">  --enable-sockets \</span><br><span class="line">  --enable-maintainer-zts \</span><br><span class="line">  --enable-ftp \</span><br><span class="line">  --with-freetype-dir \</span><br><span class="line">  --with-jpeg-dir \</span><br><span class="line">  --with-png-dir \</span><br><span class="line">  --with-zlib \</span><br><span class="line">  --with-mysql=mysqlnd \</span><br><span class="line">  --with-mysqli=mysqlnd \</span><br><span class="line">  --with-pdo-mysql=mysqlnd \</span><br><span class="line">  --with-openssl \</span><br><span class="line">  --with-libxml-dir=/usr \</span><br><span class="line">  --enable-xml \</span><br><span class="line">  --enable-sockets \</span><br><span class="line">  --with-mcrypt \</span><br><span class="line">  --with-bz2 \</span><br><span class="line">  --with-config-file-path=/usr/<span class="built_in">local</span>/php/etc/ \</span><br><span class="line">  --with-config-file-scan-dir=/usr/<span class="built_in">local</span>/php/etc/php.d/</span><br><span class="line"></span><br><span class="line">$ mkdir /usr/<span class="built_in">local</span>/php/etc/php.d</span><br></pre></td></tr></table></figure>
<h2 id="为php提供配置文件"><a class="header-anchor" href="#为php提供配置文件"></a>为php提供配置文件</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cp /sources/php/php-<span class="number">5.4</span>.<span class="number">45</span>/php.ini-production /usr/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line">$ <span class="built_in">cd</span> /sources/xcache/xcache-<span class="number">3.2</span>.<span class="number">0</span></span><br><span class="line">$ cp xcache.ini /usr/<span class="built_in">local</span>/php/etc/php.d/</span><br></pre></td></tr></table></figure>
<h2 id="配置php-fpm"><a class="header-anchor" href="#配置php-fpm"></a>配置php-fpm</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cp sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm</span><br><span class="line">$ chmod +x /etc/rc.d/init.d/php-fpm</span><br><span class="line">$ chkconfig --add php-fpm</span><br><span class="line">$ chkconfig php-fpm on</span><br></pre></td></tr></table></figure>
<h2 id="为php-fpm提供配置文件"><a class="header-anchor" href="#为php-fpm提供配置文件"></a>为php-fpm提供配置文件</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line">$ vim /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line">&gt; pm.max_children = <span class="number">50</span></span><br><span class="line">&gt; pm.start_servers = <span class="number">5</span></span><br><span class="line">&gt; pm.min_spare_servers = <span class="number">2</span></span><br><span class="line">&gt; pm.max_spare_servers = <span class="number">8</span></span><br><span class="line">&gt; pid = /usr/<span class="built_in">local</span>/php/var/run/php-fpm.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动php-fpm, 默认监听在127.0.0.1的9090端口</span></span><br><span class="line">$ service php-fpm start</span><br><span class="line">&gt; service php-fpm start</span><br><span class="line">&gt; Starting php-fpm  <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否启动成功</span></span><br><span class="line">$ ps aux | grep php-fpm</span><br></pre></td></tr></table></figure>
<h2 id="配置httpd"><a class="header-anchor" href="#配置httpd"></a>配置httpd</h2>
<p>在Apache httpd 2.4以后已经专门由一个模块针对FastCGI的实现,此模块为mod_proxy_fcgi.so,它其实是作为mod_proxy.so的扩充模块,因此这两个模块都要加载.</p>
<h2 id="配置需要加载的模块"><a class="header-anchor" href="#配置需要加载的模块"></a>配置需要加载的模块</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim httpd.conf</span><br><span class="line">LoadModule proxy_module modules/mod_proxy.so</span><br><span class="line">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br></pre></td></tr></table></figure>
<h2 id="配置虚拟主机支持使用fcgi"><a class="header-anchor" href="#配置虚拟主机支持使用fcgi"></a>配置虚拟主机支持使用fcgi</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ProxyRequests Off</span><br><span class="line">ProxyPassMatch ^/(.*\.php)$ fcgi://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>/PATH/TO/DOCUMENT_ROOT/<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># eg</span></span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerAdmin padmin@molloc.com</span><br><span class="line">    DocumentRoot <span class="string">"/data/webroot/vhosts/padmin"</span></span><br><span class="line">    ProxyRequests Off</span><br><span class="line">    ProxyPassMatch ^(.*\.php)$ fcgi://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>/data/webroot/vhosts/padmin/<span class="variable">$1</span></span><br><span class="line">    ServerName padmin.molloc.com</span><br><span class="line">    ServerAlias padmin.molloc.me</span><br><span class="line">    ErrorLog <span class="string">"logs/padmin.molloc.com-error_log"</span></span><br><span class="line">    CustomLog <span class="string">"logs/padmin.molloccom-access_log"</span> combined</span><br><span class="line">    &lt;Directory <span class="string">"/data/webroot/vhosts/padmin"</span>&gt;</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Options None</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerAdmin wordpress@molloc.com</span><br><span class="line">    DocumentRoot <span class="string">"/data/webroot/vhosts/wordpress"</span></span><br><span class="line">    ProxyRequests Off <span class="comment"># 关闭正向代理</span></span><br><span class="line">    ProxyPassMatch ^(.*\.php)$ fcgi://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>/data/webroot/vhosts/wordpress/<span class="variable">$1</span></span><br><span class="line">    ServerName wordpress.molloc.com</span><br><span class="line">    ErrorLog <span class="string">"logs/wordpress.molloc.com-error_log"</span></span><br><span class="line">    CustomLog <span class="string">"logs/wordpress.molloc.com-access_log"</span> combined</span><br><span class="line">    &lt;Directory <span class="string">"/data/webroot/vhosts/wordpress"</span>&gt;</span><br><span class="line">        AllowOverride None</span><br><span class="line">        Options None</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<h2 id="系统扩展方式"><a class="header-anchor" href="#系统扩展方式"></a>系统扩展方式</h2>
<ul>
<li>scale up 向上扩展, 垂直扩展, (属于硬件升级的方案)</li>
<li>scale out 向外扩展 (集群)</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="lamp-php-httpd的三种方式"><a class="header-anchor" href="#lamp-php-httpd的三种方式"></a>LAMP PHP+HTTPD的三种方式</h2>
<ol>
<li>modules: 把php编译成为httpd模块, 其中<code>prefork --&gt; libphp5.so, worker, event --&gt; zts</code>;</li>
<li>cgi: 常用于<code>perl + httpd</code></li>
<li>fastcgi: php5.3.3自带了fpm组件, 提供守护进程, 前端httpd, httpd-proxy-fcgi反向代理用户对动态内容请求至后端的fastcgi server.</li>
</ol>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-DAY-20]]></title>
    <link href="http://molloc.me/2015/10/13/ZY-DAY-20/"/>
    <id>http://molloc.me/2015/10/13/ZY-DAY-20/</id>
    <published>2015-10-13T14:01:38.000Z</published>
    <updated>2015-10-15T13:11:45.768Z</updated>
    <content type="html"><![CDATA[<p>httpd-2.4编译安装</p>
<a id="more"></a>
<h2 id="http-2-4新特性"><a class="header-anchor" href="#http-2-4新特性"></a>http-2.4新特性</h2>
<ul>
<li>MPM支持运行DOS机制.</li>
<li>支持<code>event</code> MPM.</li>
<li>支持异步读写.</li>
<li>支持每模块及每个目录分别使用各自的日志基本.</li>
<li>每请求配置 <code>&lt;If&gt;</code></li>
<li>增强版的表达式分析器.</li>
<li>支持毫米级的<code>keepalive timeout</code>.</li>
<li>基于FQDN的虚拟知己不再需要<code>NameVirtualHost</code>指令.</li>
<li>支持用户自定义变量</li>
</ul>
<h2 id="httpd-2-4新模块"><a class="header-anchor" href="#httpd-2-4新模块"></a>httpd-2.4新模块</h2>
<ul>
<li><code>mod_proxy_fcgi</code></li>
<li><code>mod_ratelimit</code> 限制速率</li>
<li><code>mod_remoteip</code></li>
</ul>
<h2 id="http-2-4修改了一些配置机制"><a class="header-anchor" href="#http-2-4修改了一些配置机制"></a>http-2.4修改了一些配置机制</h2>
<ul>
<li>不再支持使用<code>Order, Deny, Allow</code>来做基于IP的访问控制.</li>
</ul>
<h2 id="httpd依赖的包"><a class="header-anchor" href="#httpd依赖的包"></a><code>httpd</code>依赖的包</h2>
<ul>
<li><code>apr</code> apache portable runtime apache的可移植运行时环境.(1.4+)</li>
<li>apr-util</li>
<li>apr-iconv</li>
<li>pcre</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 1. 安装编译环境</span></span><br><span class="line">$ yum groupinstall <span class="string">"Development tools"</span> <span class="string">"Server Platform Development"</span> -y</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. 下载相关包</span></span><br><span class="line">$ ls /sources/httpd</span><br><span class="line">apr-<span class="number">1.5</span>.<span class="number">2</span>.tar.bz2  apr-util-<span class="number">1.5</span>.<span class="number">4</span>.tar.bz2  httpd-<span class="number">2.4</span>.<span class="number">17</span>.tar.bz2  pcre-<span class="number">8.37</span>.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 pcre</span></span><br><span class="line">$ tar xf pcre-<span class="number">8.37</span>.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> pcre-<span class="number">8.37</span>/</span><br><span class="line">$ ./configure</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 httpd</span></span><br><span class="line">$ tar xf httpd-<span class="number">2.4</span>.<span class="number">17</span>.tar.bz2</span><br><span class="line">$ tar xf apr-<span class="number">1.5</span>.<span class="number">2</span>.tar.bz2</span><br><span class="line">$ tar xf apr-util-<span class="number">1.5</span>.<span class="number">4</span>.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> httpd-<span class="number">2.4</span>.<span class="number">17</span>/</span><br><span class="line">$ cp -R ../apr-<span class="number">1.5</span>.<span class="number">2</span> ./srclib/apr</span><br><span class="line">$ cp -R ../apr-util-<span class="number">1.5</span>.<span class="number">4</span> ./srclib/apr-util</span><br><span class="line">$ ./configure --prefix=/usr/<span class="built_in">local</span>/apache \</span><br><span class="line">	--enable-so \</span><br><span class="line">	--enable-headers \</span><br><span class="line">	--enable-deflate \</span><br><span class="line">	--enable-mime-magic \</span><br><span class="line">	--enable-static-support \</span><br><span class="line">	--enable-ssl \</span><br><span class="line">	--enable-cgi \</span><br><span class="line">	--enable-rewrite \</span><br><span class="line">	--enable-expires \</span><br><span class="line">	--enable-suexec \</span><br><span class="line">	--with-ssl \</span><br><span class="line">	--with-included-apr \</span><br><span class="line">	--enable-modules=most \</span><br><span class="line">	--enable-mpms-shared=all \</span><br><span class="line">	--with-mpm=event \</span><br><span class="line">	--disable-userdir</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加环境变量</span></span><br><span class="line">$ vim /etc/profile <span class="comment"># 添加下面的内容</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/apache/bin:<span class="variable">$PATH</span></span><br><span class="line">$ . /etc/profile <span class="comment"># 使配置生效</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置启动脚本</span></span><br><span class="line">$ cp /usr/<span class="built_in">local</span>/apache/bin/apachectl /etc/init.d/httpd</span><br><span class="line">$ sed -i <span class="string">'2a # chkconfig: - 85 15'</span> /etc/init.d/httpd</span><br><span class="line">$ sed -i <span class="string">'3a # description: Apache is a World Wide Web server. It is used to serve'</span> /etc/init.d/httpd</span><br><span class="line">$ chmod +x /etc/init.d/httpd</span><br><span class="line">$ chkconfig --add httpd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改运行httpd的用户与组</span></span><br><span class="line">$ useradd -M <span class="operator">-s</span> /sbin/nologin</span><br><span class="line">$ sed -i <span class="string">'s/^User daemon/User apache/'</span> /usr/<span class="built_in">local</span>/apache/conf/httpd.conf</span><br><span class="line">$ sed -i <span class="string">'s/^Group daemon/Group apache/'</span> /usr/<span class="built_in">local</span>/apache/conf/httpd.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试是否安装成功</span></span><br><span class="line">$ service httpd start</span><br><span class="line"><span class="comment"># 浏览器访问正常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># apache路径下的文件说明</span></span><br><span class="line">$ ls <span class="operator">-l</span> /usr/<span class="built_in">local</span>/apache</span><br><span class="line">bin 	<span class="comment"># 各种二进制程序</span></span><br><span class="line">build   <span class="comment"># 编译安装过程中的目录</span></span><br><span class="line">cgi-bin <span class="comment"># 跟cgi相关的</span></span><br><span class="line">error	<span class="comment"># 错误页面文件相关</span></span><br><span class="line">htdocs	<span class="comment"># 网页文件的存放位置</span></span><br><span class="line">icons	<span class="comment"># 图标</span></span><br><span class="line"><span class="comment"># 头文件要保存为系统所用的话,</span></span><br><span class="line"><span class="comment"># 需要ln -sv /usr/local/apache/include/ /usr/include/httpd/</span></span><br><span class="line">include <span class="comment"># 头文件,</span></span><br><span class="line">logs	<span class="comment"># 日志文件</span></span><br><span class="line">man		<span class="comment"># 帮助手册 vim /etc/man.config添加MANPATH</span></span><br><span class="line">manual	<span class="comment"># httpd自带的手册,修改主配置文件,Include /etc/httpd/extra/httpd-maual.conf</span></span><br><span class="line">modules <span class="comment"># 模块目录</span></span><br></pre></td></tr></table></figure>
<h2 id="2-4中配置项的变化"><a class="header-anchor" href="#2-4中配置项的变化"></a>2.4中配置项的变化</h2>
<ul>
<li>允许所有主机访问 <code>Require all granted</code></li>
<li>拒绝所有主机访问 <code>Require all deny</code></li>
<li>控制特定IP访问 <code>Require ip IPADDR</code></li>
<li>拒绝特定IP访问 <code>Require not all IPADDR</code></li>
<li>控制特定的主机访问 (HOSTNAME) <code>Require host HOSTNAME</code></li>
<li>拒绝特定的主机访问 (HOSTNAME) <code>Require not host HOSTNAME</code></li>
<li>基于FDQN的虚拟主机配置,不在需要<code>NameVirtualHost</code></li>
</ul>
<p>注: <code>HOSTNAME</code>的取值<code>{FQDN|DOMAIN}</code></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>httpd-2.4编译安装</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-24]]></title>
    <link href="http://molloc.me/2015/09/27/ZY-2015-09-24/"/>
    <id>http://molloc.me/2015/09/27/ZY-2015-09-24/</id>
    <published>2015-09-27T15:43:59.000Z</published>
    <updated>2015-10-12T16:02:28.077Z</updated>
    <content type="html"><![CDATA[<p>网络模型大概有两种,一种是OSI的参考模型,它把协议栈大体上分为七层,上三层叫资源子网,下四层叫通讯子网,TCP协议将协议栈分成四层,TCP协议栈的应用层对用OSI的上三层,用来表示应用的,底下的三层,首先TCP,UDP这一层也叫传输层,对应OSI的传输层,其次互联网层(IPV4,IPV6)层对用OSI的网络层,最后身边驱动程序和硬件则对应OSI的数据链路层和物理层.传输层及传输层以下的叫通讯子网,而上面的叫资源子网.</p>
<p>IP地址用于标记主机到主机的,数据链路层的MAC地址是用来标记设备到设备的.</p>
<a id="more"></a>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-24/TCP-IP.jpg" alt="tcp-ip"></p>
<h2 id="web-server"><a class="header-anchor" href="#web-server"></a>Web Server</h2>
<h2 id="传输层"><a class="header-anchor" href="#传输层"></a>传输层</h2>
<p>提供进程地址, <code>Port number</code></p>
<p><code>tcp</code> 传输控制协议,面向连接的协议,通信前需要建立虚拟链路,结束后拆除链路.端口范围<code>0-65535</code></p>
<p><code>udp</code> User Datagram Protocal, 无连接的协议.端口范围<code>0-65535</code></p>
<p><code>IANA</code>(The Internet Assigned Numbers Authority，互联网数字分配机构)</p>
<p><code>0-1023</code>; 众所周知, 被永久的分配给固定的应用使用,特权端口,只有管理员可使用. <code>22/tcp(ssh), 80/tcp(http), 443/tcp(https)</code></p>
<p><code>1024-41951</code> 亦为注册端口, 但要求并不是特别的严格, 能够分配给程序注册为某应用使用<code>11211/tcp, 11211/udp(memcached), 3306/tcp(mysql)</code></p>
<p><code>41952+</code> 客户端程序随机使用的端口. 被称作动态端口或私有端口.其范围的定义<code>/proc/sys/net/ipv4/ip_local_port_range</code></p>
<p><code>dns</code> 实现主机名称解析时用的是<code>udp</code>, 区域传输时用的是<code>tcp</code>, 因为<code>tcp</code>有校验功能, 数据可靠传输, 为了保证主服务器到从服务器之间的数据不会产生任何错误.</p>
<h2 id="套接字"><a class="header-anchor" href="#套接字"></a>套接字</h2>
<p>Socket, IPC(Inter-Process Communication,进程间通信)的一种实现, 运行位于不用主机(甚至是同一主机)上的不同进程之间进行通讯, 数据交换.</p>
<p>Socket API, 1983年, 最早出现在 BSD, 后来被广泛移植到各种各样的Uinux系统上.</p>
<h2 id="socket-domain-根据其所使用的地址"><a class="header-anchor" href="#socket-domain-根据其所使用的地址"></a>Socket Domain (根据其所使用的地址)</h2>
<ul>
<li>AF_INET:  Adress Family, IPV4</li>
<li>AF_INET6: Adress Family, IPV6</li>
<li>AF_UNIX:  同一主机上不同进程之间通信</li>
</ul>
<p>上述的每类套接字都至少提供了两种<code>socket</code>: 流(TCP), 数据报(UDP), 流能够保证可靠的传递,面向连接,无边界. 数据报提供的是不可靠的传递,有边界, 无连接.</p>
<h2 id="套接字相关的系统调用"><a class="header-anchor" href="#套接字相关的系统调用"></a>套接字相关的系统调用</h2>
<ul>
<li><code>socket()</code>    创建socket</li>
<li><code>bind()</code>      绑定</li>
<li><code>listen()</code>    监听</li>
<li><code>accept()</code>    接受请求</li>
<li><code>connect()</code>   请求连接建立</li>
<li><code>write()</code>     发送数据</li>
<li><code>read()</code>      接收数据</li>
</ul>
<h2 id="套接字的类型"><a class="header-anchor" href="#套接字的类型"></a>套接字的类型</h2>
<ul>
<li>SOCK_STREAM tcp套接字</li>
<li>SOCK_DGRAM udp套接字</li>
<li>SOCK_RAW 裸套接字</li>
</ul>
<h2 id="ipv4分类"><a class="header-anchor" href="#ipv4分类"></a>IPV4分类</h2>
<ul>
<li>A 1-127,          私有地址(10,0,0.0/8)</li>
<li>B 128-191         私有地址(172.16.0.0/16-172.31.0.0/16)</li>
<li>C 192-223         私有地址(192.168.0.0/24-192.168.255.0/24)</li>
<li>D (组播)224-239</li>
<li>E 240-254</li>
</ul>
<h2 id="tcp协议的特性"><a class="header-anchor" href="#tcp协议的特性"></a>TCP协议的特性</h2>
<ul>
<li>建立连接, 三次握手.</li>
<li>将数据打包成段, 每段都有一个校验和(CRC-32).</li>
<li>确认,重传以及超时.</li>
<li>排序, 逻辑序号.</li>
<li>流量控制(防止一个快发, 一个慢收), 滑动窗口算法</li>
<li>拥塞控制, 慢启动和拥塞避免算法.</li>
</ul>
<h2 id="http-hyper-text-transfer-protocal-tcp-80"><a class="header-anchor" href="#http-hyper-text-transfer-protocal-tcp-80"></a>(HTTP Hyper Text Transfer Protocal) tcp/80</h2>
<p><code>html</code>: 编程语言, 超文本标记语言.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="http协议的版本"><a class="header-anchor" href="#http协议的版本"></a>http协议的版本</h2>
<ul>
<li><code>HTTP/0.9</code> 原型版本, 功能简陋</li>
<li><code>HTTP/1.0</code> 第一个广泛使用的版本, 支持MIME</li>
<li><code>HTTP/1.1</code> 增强了缓存功能</li>
<li><code>SPDY</code></li>
<li><code>HTTP/2.0</code></li>
</ul>
<p>MIME(Multipurpose Internet Mail Extension): 可以实现基于文本协议发送非文本数据.</p>
<h2 id="mime类型-major-minor"><a class="header-anchor" href="#mime类型-major-minor"></a>MIME类型(major/minor)</h2>
<ul>
<li>text/html</li>
<li>text/plain</li>
<li>image/jepg</li>
<li>image/git ...</li>
</ul>
<p>URI(Uniform Resource Identifier)</p>
<p>URL(Uniform Resource Locator) 用于描述某服务器某特定资源的位置.</p>
<p>URN(Uniform Resource Naming)</p>
<p>Web服务器, 即存放了web资源的服务器,负责想请求者提供对方请求的静态资源, 或动态运行后生成的资源, 这些资源放置于本地文件系统某路径下,此路径通常称为<code>DocRoot</code>, 以<code>httpd</code>为例, <code>var/www/html/</code></p>
<h2 id="一次完整的http请求过程"><a class="header-anchor" href="#一次完整的http请求过程"></a>一次完整的HTTP请求过程</h2>
<ol>
<li>建立连接</li>
<li>接收请求: 接收来自于网络的请求报文中对某一资源的一次请求.</li>
<li>处理请求: 对请求报文进行解析,并获取请求的资源及请求方法等相关信息.</li>
<li>访问资源: 获取请求报文中请求的资源</li>
<li>构建响应报文</li>
<li>发送响应报文</li>
<li>记录日志</li>
</ol>
<h2 id="并发访问响应模型-web-i-o"><a class="header-anchor" href="#并发访问响应模型-web-i-o"></a>并发访问响应模型(WEB I/O)</h2>
<ul>
<li>单进程I/O结构: 只启动一个进程处理用户请求, 而且一次只处理一个,多个请求被串行响应.</li>
<li>多进程I/O结构: 并行启动多个进程,每个进程响应一个请求.</li>
<li>复用I/O结构: 一个进程响应n个请求.
<ul>
<li>多线程模型: 一个进程生成N个线程, 每个线程响应一个用户请求.</li>
<li>事件驱动机制</li>
</ul>
</li>
<li>复用的多进程I/O结构: 启动多个进程, 每个进程响应N个请求</li>
</ul>
<h2 id="请求报文的格式"><a class="header-anchor" href="#请求报文的格式"></a>请求报文的格式</h2>
<ul>
<li><method> <url> <version></version></url></method></li>
<li>Host: www.molloc.com 请求的主机名称</li>
<li>Connection: keep-alive 连接的方式</li>
</ul>
<h2 id="web服务器资源路径映射方式"><a class="header-anchor" href="#web服务器资源路径映射方式"></a>web服务器资源路径映射方式</h2>
<ul>
<li>docroot</li>
<li>alias</li>
<li>虚拟主机docroot</li>
<li>用户家目录docroot</li>
</ul>
<h2 id="mime类型"><a class="header-anchor" href="#mime类型"></a>MIME类型</h2>
<ul>
<li>显式分类</li>
<li>魔法分类</li>
<li>协商分类</li>
</ul>
<h2 id="url的重定向"><a class="header-anchor" href="#url的重定向"></a>URL的重定向</h2>
<p>web服务器构建的响应并非客户端请求的资源, 而是资源另外一个访问路径.</p>
<ul>
<li>永久重定向</li>
<li>临时重定向</li>
</ul>
<h2 id="常见的http服务器"><a class="header-anchor" href="#常见的http服务器"></a>常见的http服务器</h2>
<ul>
<li>httpd (apache)</li>
<li>nginx</li>
<li>lighttpd</li>
</ul>
<h2 id="应用程序服务器-netcraft-com"><a class="header-anchor" href="#应用程序服务器-netcraft-com"></a>应用程序服务器(netcraft.com)</h2>
<ul>
<li>IIS</li>
<li>tomcat, jetty, jboss, resin, weblogic, WebSphere, OC4J, GlassFish</li>
</ul>
<h2 id="httpd的特性"><a class="header-anchor" href="#httpd的特性"></a>httpd的特性</h2>
<ul>
<li>高度模块化设计, core + modules</li>
<li>DSO(Dynamic Shared Object)机制</li>
<li>MPM(Multi-Processing Module)</li>
</ul>
<h2 id="httpd的功能特性"><a class="header-anchor" href="#httpd的功能特性"></a>httpd的功能特性</h2>
<ul>
<li>支持虚拟主机,基于(IP, PORT, FQDN)</li>
<li>支持CGI(Common Gateway Interface) 通用网关接口</li>
<li>支持反向代理</li>
<li>支持负载均衡</li>
<li>支持路径别名</li>
<li>支持丰富的认证机制(basic, digest)</li>
<li>支持第三方模块</li>
</ul>
<h2 id="mpm-multi-processing-module"><a class="header-anchor" href="#mpm-multi-processing-module"></a>MPM(Multi-Processing Module)</h2>
<ul>
<li>prefork</li>
<li>worker</li>
<li>event</li>
</ul>
<h2 id="prefork"><a class="header-anchor" href="#prefork"></a>prefork</h2>
<p>多进程模型, 每个进程响应一个请求</p>
<p>基本工作机制为一个主进程,负责生成N个子进程, 子进程也称为工作进程, 每个进程处理一个用户请求, 即便没有用户请求,也会预先生成多个空闲进程, 随时等待请求到达. 最大不会超过1024个.</p>
<p>web服务启动以后, 主进程用来监听<code>socket</code>请求, 主进程只负责接收(通过子进程接收), 并不负责请求处理及响应. 由主进程创建的子进程来处理.</p>
<h2 id="worker"><a class="header-anchor" href="#worker"></a>worker</h2>
<p>多线程模型, 每个线程响应一个请求</p>
<p>基本工作机制为一个主进程, 生成多个子进程, 每个子进程负责生成多个线程, 每个线程响应一个请求.</p>
<p>此时, 如果有<code>M</code>个进程, <code>N</code>个线程, 最大的并发为<code>M*N</code></p>
<p>在linux上线程并不比进程轻量级多少, <code>worker</code> 比起 <code>prefork</code> 而言, 性能并没有显著的提升.</p>
<p>预先生成<code>N</code>个线程, 以便快速响应. 有最大, 最小空闲线程的上限.</p>
<h2 id="event"><a class="header-anchor" href="#event"></a>event</h2>
<p>事件驱动机制, 每个线程响应n个请求</p>
<p>基本工作机制为一个主进程, 生成多个子进程,  每个子进程直接响应n个请求.</p>
<p>事件驱动机制是突破c10k的重要技术</p>
<p>httpd-2.2: event为测试使用</p>
<p>httpd-2.4: event可生产使用</p>
<h2 id="httpd的安装配置和使用"><a class="header-anchor" href="#httpd的安装配置和使用"></a>httpd的安装配置和使用</h2>
<p>httpd apache</p>
<p>ASF: apache software foundation</p>
<p>rpm安装:</p>
<p>rpm包安装的httpd的默认工作目录(根目录): <code>/etc/httpd</code></p>
<h2 id="程序环境"><a class="header-anchor" href="#程序环境"></a>程序环境</h2>
<h3 id="配置文件"><a class="header-anchor" href="#配置文件"></a>配置文件</h3>
<p>主配置文件: <code>/etc/httpd/conf/httpd.conf</code></p>
<p>分段配置文件: <code>/etc/httpd/conf.d/*.conf</code></p>
<h3 id="服务脚本"><a class="header-anchor" href="#服务脚本"></a>服务脚本</h3>
<p>centos6 <code>/etc/rc.d/init.d/httpd</code></p>
<p>脚本的配置文件: <code>/etc/sysconfig/httpd</code></p>
<h3 id="模块文件目录"><a class="header-anchor" href="#模块文件目录"></a>模块文件目录</h3>
<p><code>etc/httpd/modules</code> --&gt; <code>usr/lib64/httpd/modules</code></p>
<h3 id="主程序文件"><a class="header-anchor" href="#主程序文件"></a>主程序文件</h3>
<p><strong>2.4 之前</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/httpd (prefork)</span><br><span class="line">/usr/sbin/httpd.worker (workder)</span><br><span class="line">/user/sbin/httpd.event (event)</span><br></pre></td></tr></table></figure>
<h3 id="日志文件目录"><a class="header-anchor" href="#日志文件目录"></a>日志文件目录</h3>
<p><code>var/log/httd</code>下, <code>access_log</code> 访问日志文件, <code>error_log</code>: 错误日志</p>
<h3 id="站点文档目录"><a class="header-anchor" href="#站点文档目录"></a>站点文档目录</h3>
<p>默认在<code>var/www/html</code></p>
<h3 id="配置文件-v2"><a class="header-anchor" href="#配置文件-v2"></a>配置文件</h3>
<p>Directive Value(不区分大小写)
指令      值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'Section'</span> httpd.conf</span><br><span class="line"><span class="comment">### Section 1: Global Environment</span></span><br><span class="line"><span class="comment">### Section 2: 'Main' server configuration</span></span><br><span class="line"><span class="comment">### Section 3: Virtual Hosts</span></span><br></pre></td></tr></table></figure>
<p><code>Main server</code>和<code>Virtual Hosts</code>不能同时启用,默认启用的是<code>Main server</code></p>
<p>修改配置文件后检查语法是否正确<code>httpd -t</code></p>
<h2 id="指定监听地址和端口"><a class="header-anchor" href="#指定监听地址和端口"></a>指定监听地址和端口</h2>
<p><code>Listen [IP:]80</code></p>
<ul>
<li><code>IP</code>省略时表示监听本机上所有可用的<code>IP</code>地址.</li>
<li><code>Listen</code>指令可以出现多次,用于指明多个不同监听端口或套接字.</li>
</ul>
<h2 id="持久连接相关"><a class="header-anchor" href="#持久连接相关"></a>持久连接相关</h2>
<p>持久连接: 连接建立后,灭个资源获取结束不会断开连接,而继续等待其他资源请求并完成传输.</p>
<p>如何断开?</p>
<ul>
<li>数量限制, 如100个.</li>
<li>时间显示, 如60秒.</li>
</ul>
<p>劣势: 对并发访问量较大的服务器,开持久连接会导致有些请求得不到服务.
改进: 减短, <code>http-2.4</code>支持毫秒级.</p>
<p>非持久连接: 每个资源都是单独通过专用的连接进行获取.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">KeepAlive Off|On <span class="comment"># 开启持久连接</span></span><br><span class="line">MaxKeepAliveRequests <span class="number">100</span> <span class="comment"># 最大保活连接请求数</span></span><br><span class="line">KeepAliveTimeout <span class="number">15</span> <span class="comment"># 保活连接的超时时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 测试</span></span><br><span class="line">$ telnet <span class="number">192.168</span>.<span class="number">1.166</span> <span class="number">80</span></span><br><span class="line">Trying <span class="number">192.168</span>.<span class="number">1.166</span>...</span><br><span class="line">Connected to <span class="number">192.168</span>.<span class="number">1.166</span>.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">GET / HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">192.168</span>.<span class="number">1.166</span></span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Fri, <span class="number">09</span> Oct <span class="number">2015</span> <span class="number">15</span>:<span class="number">16</span>:<span class="number">43</span> GMT</span><br><span class="line">Server: Apache/<span class="number">2.2</span>.<span class="number">15</span> (CentOS)</span><br><span class="line">Last-Modified: Fri, <span class="number">09</span> Oct <span class="number">2015</span> <span class="number">14</span>:<span class="number">55</span>:<span class="number">42</span> GMT</span><br><span class="line">ETag: <span class="string">"fa2-1e-521ad2c70024e"</span></span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: <span class="number">30</span></span><br><span class="line">Content-Type: text/html; charset=UTF-<span class="number">8</span></span><br><span class="line"></span><br><span class="line">&lt;h2&gt;Hello Apache httpd !&lt;/h2&gt;</span><br><span class="line">Connection closed by foreign host.</span><br></pre></td></tr></table></figure>
<h2 id="mpm相关"><a class="header-anchor" href="#mpm相关"></a>MPM相关</h2>
<p>多路处理模块, 并发请求响应的不同实现.(prefork, workder, event)</p>
<p>httpd-2.2不支持同事编译多个不同的MPM, rpm安装的httpd-2.2提供了三个文件分别用于实现提供对不同的MPM的支持.</p>
<p>默认为<code>/user/sbin/httpd</code>其为<code>prefork</code></p>
<p><code>httpd -l</code>: 查看静态编译的模块列表</p>
<p><code>httpd -M</code>: 查看所有模块, 包括静态编译和DSO模块</p>
<p>确认方法<code>ps aux | grep httpd</code></p>
<p>更换支持不同的MPM的主程序, <code>vim /etc/sysconfig/httpd</code>修改<code>HTTPD=/usr/sbin/httpd.worker</code>为自己想要的MPM.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># prefork MPM</span></span><br><span class="line"><span class="comment"># StartServers: number of server processes to start</span></span><br><span class="line"><span class="comment"># MinSpareServers: minimum number of server processes which are kept spare</span></span><br><span class="line"><span class="comment"># MaxSpareServers: maximum number of server processes which are kept spare</span></span><br><span class="line"><span class="comment"># ServerLimit: maximum value for MaxClients for the lifetime of the server</span></span><br><span class="line"><span class="comment"># MaxClients: maximum number of server processes allowed to start</span></span><br><span class="line"><span class="comment"># MaxRequestsPerChild: maximum number of requests a server process serves</span></span><br><span class="line">&lt;IfModule prefork.c&gt;</span><br><span class="line">StartServers       <span class="number">8</span></span><br><span class="line">M<span class="keyword">in</span>SpareServers    <span class="number">5</span></span><br><span class="line">MaxSpareServers   <span class="number">20</span></span><br><span class="line">ServerLimit      <span class="number">256</span></span><br><span class="line">MaxClients       <span class="number">256</span></span><br><span class="line">MaxRequestsPerChild  <span class="number">4000</span></span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># worker MPM</span></span><br><span class="line"><span class="comment"># StartServers: initial number of server processes to start</span></span><br><span class="line"><span class="comment"># MaxClients: maximum number of simultaneous client connections</span></span><br><span class="line"><span class="comment"># MinSpareThreads: minimum number of worker threads which are kept spare</span></span><br><span class="line"><span class="comment"># MaxSpareThreads: maximum number of worker threads which are kept spare</span></span><br><span class="line"><span class="comment"># ThreadsPerChild: constant number of worker threads in each server process</span></span><br><span class="line"><span class="comment"># MaxRequestsPerChild: maximum number of requests a server process serves</span></span><br><span class="line">&lt;IfModule worker.c&gt;</span><br><span class="line">StartServers         <span class="number">4</span></span><br><span class="line">MaxClients         <span class="number">300</span></span><br><span class="line">M<span class="keyword">in</span>SpareThreads     <span class="number">25</span></span><br><span class="line">MaxSpareThreads     <span class="number">75</span></span><br><span class="line">ThreadsPerChild     <span class="number">25</span></span><br><span class="line">MaxRequestsPerChild  <span class="number">0</span></span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<h2 id="dso机制"><a class="header-anchor" href="#dso机制"></a>DSO机制</h2>
<p>配置指令模块加载: <code>LoadModule &lt;module_name&gt; &lt;module_path&gt;</code>, <code>&lt;module_path&gt;</code>可使用相对路径,相对于<code>ServerRoot</code>指令指向的位置而言.</p>
<p>注意: 建议使用<code>service httpd reload</code>重新装载配置文件.</p>
<h2 id="定义main-server的文档页面路径"><a class="header-anchor" href="#定义main-server的文档页面路径"></a>定义<code>Main server</code>的文档页面路径</h2>
<p><code>DocumentRoot</code> 指令, 文档路径映射, <code>DocumentRoot</code>指向的路径为URL起始的位置.</p>
<h2 id="站点路径访问控制"><a class="header-anchor" href="#站点路径访问控制"></a>站点路径访问控制</h2>
<ul>
<li>基于来源地址</li>
<li>基于账号</li>
</ul>
<h3 id="基于来源地址"><a class="header-anchor" href="#基于来源地址"></a>基于来源地址</h3>
<ul>
<li>文件系统路径来定义 <code>&lt;Directory &quot;/PATH/TO/SOMEDIR&quot;&gt;...&lt;/Directory&gt;</code></li>
<li>URL路径来定义 <code>&lt;Location &quot;/URL&quot;&gt;...&lt;/Location&gt;</code></li>
</ul>
<h3 id="directory中的访问控制定义"><a class="header-anchor" href="#directory中的访问控制定义"></a>Directory中的访问控制定义</h3>
<p>(1) Options</p>
<ul>
<li>Indexes: 当访问的路径下无默认主页面文件存在, 且没有指定具体要访问的资源时, 会将此路径下的所有资源以列表呈现给用户;非常危险.</li>
<li>FollowSymLinks: 如果某页面文件是为指向<code>DocumentRoot</code>之外路径上的其他文件时, 将直接显示目标文件的内容.不建议使用.</li>
<li>None: 什么特性都不启用</li>
<li>All: 所有都启用</li>
</ul>
<p>(2) 基于来源地址访问控制</p>
<p>Order 检查次序</p>
<ul>
<li><code>Order Allow Deny</code> 只能明确<code>Allow</code>的来源地址, 才允许访问, 其他的均为<code>Deny</code></li>
<li><code>Order Deny Allow</code> 只能明确<code>Deny</code>的来源地址, 不允许访问, 其他的均为<code>Allow</code></li>
</ul>
<p><code>Allow from</code> 允许访问的来源地址
<code>Deny from</code> 拒绝访问的来源地址</p>
<p><code>from</code>后可跟上的地址格式: IP地址, 网络地址</p>
<ul>
<li><code>172.16</code></li>
<li><code>172.16.0.0</code></li>
<li><code>172.16.0.0/16</code></li>
<li><code>172.16.0.0/255.255.0.0</code></li>
</ul>
<p>配置示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Order Allow Deny</span><br><span class="line">Deny from <span class="number">172.16</span>.<span class="number">100.2</span></span><br><span class="line">Allow from <span class="number">172.16</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br></pre></td></tr></table></figure>
<h2 id="定义默认主页面"><a class="header-anchor" href="#定义默认主页面"></a>定义默认主页面</h2>
<p><code>DirectoryIndex index.html index.html.var</code>, 自作而右, 找到首次匹配到的文件, 就将其作为默认主页面返回.</p>
<h2 id="日志配置"><a class="header-anchor" href="#日志配置"></a>日志配置</h2>
<ul>
<li>错误日志 <code>ErrorLog logs/error_log, LogLevel warn</code></li>
<li>访问日志, <code>CustomLog logs/access_log combined</code> 不仅要定义日志文件, 还要定义日志格式.</li>
</ul>
<p><code>LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined</code></p>
<ul>
<li><code>%h</code> Remote host 客户端主机</li>
<li><code>%l</code> Remote logname (from identd, if supplied) 客户用户通过<code>identd</code>登录时使用的名称,一般为<code>-</code></li>
<li><code>%u</code> Remote user (from auth; may be bogus if return status (%s) is 401) 认证登录的名字, 无登录机制一般为<code>-</code></li>
<li><code>%t</code> Time the request was received (standard english format) 收到客户端请求时的时间.</li>
<li><code>%r</code> First line of request 请求报文的首行 eg: <code>&lt;method&gt; &lt;url&gt; &lt;version&gt;</code></li>
<li><code>%s</code> Status. For requests that got internally redirected. 响应的状态码</li>
<li><code>%b</code> Size of response in bytes, excluding HTTP headers. 响应报文的大小,单位为字节, 不包含首部信息.仅为响应内容自身的大小.</li>
<li><code>%{Referer}i</code> 记录http首部Referer对应的值. 即访问来源, 从那到此页面.</li>
<li><code>%{User-Agent}i</code> 记录http首部User-Agent对应的值, 即浏览器类型.</li>
</ul>
<p><a href="http://httpd.apache.org/docs/2.2/mod/mod_log_config.html#formats" target="_blank" rel="external">See More</a></p>
<h2 id="路径别名"><a class="header-anchor" href="#路径别名"></a>路径别名</h2>
<p><code>Alias /URL/ &quot;path/to/some_directory&quot;</code></p>
<h2 id="设定默认字符集"><a class="header-anchor" href="#设定默认字符集"></a>设定默认字符集</h2>
<p><code>AddDefaultCharset UTF-8</code>, 常用字符集, <code>GBK, GB2312, GB18030</code></p>
<h2 id="基于用户的访问控制"><a class="header-anchor" href="#基于用户的访问控制"></a>基于用户的访问控制</h2>
<p>质询: <code>www-Authenticate</code>, 服务器用401状态拒绝客户端请求,说明需要用户提供用户名密码, 弹出对话框.</p>
<p>认证: <code>Authorization</code>, 客户端用户填入账号密码后再次发请求至服务器, 认证通过, 则请求授权.</p>
<p>安全域: 需要用户认证后方能访问的路径. 应该有其名称, 用于向用户通知此认证的原因等.</p>
<p>http协议支持的认证方式</p>
<ul>
<li>basic 基本认证, (BASE64编码)</li>
<li>digest 摘要</li>
</ul>
<p><code>basic</code>认证机制的实现.</p>
<p>(1) 修改配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory <span class="string">"/data/web/html/employee"</span>&gt;</span><br><span class="line">    Options None</span><br><span class="line">    AllowOverride None</span><br><span class="line">    AuthType Basic</span><br><span class="line">    AuthName <span class="string">"Employee Information, only for employee"</span></span><br><span class="line">    AuthUserFile /etc/httpd/users/.htpasswd</span><br><span class="line">    Require user tom,jerry</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 说明</span></span><br><span class="line">Require valid-user <span class="comment"># 所有位于AuthUserFile文件中定义的用于都允许访问.</span></span><br><span class="line">Require user user1 user2... <span class="comment">#仅允许user1,user2等出现在AuthUserFile文件中定义的特定几个用户登陆.</span></span><br></pre></td></tr></table></figure>
<p>(2) 提供用户的账号文件,要求密码加密存放, <code>htpasswd</code>命令用户维护此文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">htpasswd [ -c ] [ -m ] [ -D ] passwdfile username</span><br><span class="line"></span><br><span class="line">-c <span class="comment"># 添加第一个用户时创建此文件. 第二个不需要加此参数.</span></span><br><span class="line">-m <span class="comment"># 以md5格式加密用户密码存放.</span></span><br><span class="line"><span class="operator">-s</span> <span class="comment"># 以sha格式加密用户密码存放.</span></span><br><span class="line">-D <span class="comment"># 删除指定用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加第一个用户tom</span></span><br><span class="line">$ htpasswd -c -m /etc/httpd/users/.htpasswd tom</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加第二个用户jerry</span></span><br><span class="line">$ htpasswd -m /etc/httpd/users/.htpasswd jerry</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password <span class="keyword">for</span> user jerry</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看创建的密码文件</span></span><br><span class="line">$ ll /etc/httpd/users/.htpasswd</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">86</span> Oct <span class="number">10</span> <span class="number">21</span>:<span class="number">55</span> /etc/httpd/users/.htpasswd</span><br><span class="line"></span><br><span class="line">$ cat /etc/httpd/users/.htpasswd</span><br><span class="line">tom:<span class="variable">$apr1</span><span class="variable">$QuG35pFo</span><span class="variable">$Q77vs83bik</span>.h.<span class="number">53</span>cUlmK30</span><br><span class="line">jerry:<span class="variable">$apr1</span><span class="variable">$vkFx</span>.WeG<span class="variable">$yUH</span>.MP8.QxSMk33S9Vuzc.</span><br></pre></td></tr></table></figure>
<p>(3) 组认证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory <span class="string">"/data/web/html/employee"</span>&gt;</span><br><span class="line">    Options None</span><br><span class="line">    AllowOverride None</span><br><span class="line">    AuthType Basic</span><br><span class="line">    AuthName <span class="string">"Employee Information, only for employee"</span></span><br><span class="line">    AuthUserFile /etc/httpd/users/.htpasswd</span><br><span class="line">    AuthGroupFile /etc/httpd/users/.htgroup</span><br><span class="line">    Require group group1 group2...</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组文件的定义方法,每行定义一个组</span></span><br><span class="line"><span class="comment"># Example</span></span><br><span class="line">mygroup: bob joe anne</span><br></pre></td></tr></table></figure>
<h2 id="虚拟主机"><a class="header-anchor" href="#虚拟主机"></a>虚拟主机</h2>
<p>一个物理机器可以服务于多个站点, 每个站点可通过一个或多个虚拟主机来实现.</p>
<p><code>httpd</code>支持三种类型的虚拟主机</p>
<ul>
<li>基于IP来实现</li>
<li>基于port来实现</li>
<li>基于FQDN来实现, 需要开启<code>NameVirtualHost *:80</code>指令.</li>
</ul>
<p>注意: 定义虚拟主机, 得首先关闭<code>Main Server</code>, 方法, 注释<code>DocumentRoot</code> 指令即可.</p>
<p>定义虚拟主机的方法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost <span class="string">"IP:PORT"</span>&gt;</span><br><span class="line">	ServerName</span><br><span class="line">	ServerAlias</span><br><span class="line">	DocumentRoot</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">注意: 大多数可用户全局或<span class="string">'mainserver'</span>中的指令,都可以定义在`VirtualHost`中.</span><br><span class="line"></span><br><span class="line"><span class="comment"># example 基于IP</span></span><br><span class="line"><span class="comment"># 注意, 本机要配置上这里配置的所有IP地址并能够用于通信.</span></span><br><span class="line">&lt;VirtualHost <span class="number">192.168</span>.<span class="number">1.166</span>:<span class="number">80</span>&gt;</span><br><span class="line">    ServerName www.a.com</span><br><span class="line">    DocumentRoot /vhosts/a.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">192.168</span>.<span class="number">1.168</span>:<span class="number">80</span>&gt;</span><br><span class="line">    ServerName www.b.com</span><br><span class="line">    DocumentRoot /vhosts/b.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># example 基于Port</span></span><br><span class="line"><span class="comment"># 注意,http要监听这里指明的所有端口`Listen`指令</span></span><br><span class="line">&lt;VirtualHost <span class="number">192.168</span>.<span class="number">1.166</span>:<span class="number">80</span>&gt;</span><br><span class="line">    ServerName www.a.com</span><br><span class="line">    DocumentRoot /vhosts/a.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">192.168</span>.<span class="number">1.166</span>:<span class="number">8080</span>&gt;</span><br><span class="line">    ServerName www.b.com</span><br><span class="line">    DocumentRoot /vhosts/b.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># example 基于FQDN</span></span><br><span class="line"><span class="comment"># http-2.2中要启用NameVirtualHost指令, 2.4不需要</span></span><br><span class="line">NameVirtualHost *:<span class="number">80</span></span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerName www.a.com</span><br><span class="line">    DocumentRoot /vhosts/a.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    ServerName www.b.com</span><br><span class="line">    DocumentRoot /vhosts/b.com/</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>
<p>注意: 额外经常用于每个虚拟主机的配置有<code>ErrorLog, CustomLog, Directory, Location, ServerAlias</code></p>
<h2 id="为centos6增加一个ip地址"><a class="header-anchor" href="#为centos6增加一个ip地址"></a>为centos6增加一个Ip地址</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0:<span class="number">0</span> <span class="number">192.168</span>.<span class="number">1.168</span>/<span class="number">24</span> up</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:<span class="number">53</span>:E8:<span class="number">20</span></span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">1.166</span>  Bcast:<span class="number">192.168</span>.<span class="number">1.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">20</span>c:<span class="number">29</span>ff:fe53:e820/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">14310</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">5054</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span></span><br><span class="line">          RX bytes:<span class="number">1292767</span> (<span class="number">1.2</span> MiB)  TX bytes:<span class="number">814645</span> (<span class="number">795.5</span> KiB)</span><br><span class="line"></span><br><span class="line">eth0:<span class="number">0</span>    Link encap:Ethernet  HWaddr <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:<span class="number">53</span>:E8:<span class="number">20</span></span><br><span class="line">          inet addr:<span class="number">192.168</span>.<span class="number">1.168</span>  Bcast:<span class="number">192.168</span>.<span class="number">1.255</span>  Mask:<span class="number">255.255</span>.<span class="number">255.0</span></span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line">          inet addr:<span class="number">127.0</span>.<span class="number">0.1</span>  Mask:<span class="number">255.0</span>.<span class="number">0.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">65536</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">82</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">82</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span></span><br><span class="line">          RX bytes:<span class="number">8933</span> (<span class="number">8.7</span> KiB)  TX bytes:<span class="number">8933</span> (<span class="number">8.7</span> KiB)</span><br></pre></td></tr></table></figure>
<h2 id="内置的status页面"><a class="header-anchor" href="#内置的status页面"></a>内置的status页面</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Location /server-status&gt;</span><br><span class="line">    SetHandler server-status</span><br><span class="line">    Order deny,allow</span><br><span class="line">    Deny from all</span><br><span class="line">    Allow from .example.com</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure>
<h2 id="使用mod-deflate模块压缩页面优化传输速度"><a class="header-anchor" href="#使用mod-deflate模块压缩页面优化传输速度"></a>使用<code>mod_deflate</code>模块压缩页面优化传输速度</h2>
<p>适用场景</p>
<ul>
<li>节约带宽, 额外消耗CPU, 同时, 可能有些较老的浏览器不支持.</li>
<li>压缩适于压缩比较大的资源, 例如文本文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SetOutputFilter DEFLATE <span class="comment"># 启用输出过滤器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mod_deflate configuration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Restrict compression to these MIME types</span></span><br><span class="line">AddOutputFilterByType DEFLATE text/plain</span><br><span class="line">AddOutputFilterByType DEFLATE text/html</span><br><span class="line">AddOutputFilterByType DEFLATE application/xhtml+xml</span><br><span class="line">AddOutputFilterByType DEFLATE text/xml</span><br><span class="line">AddOutputFilterByType DEFLATE application/xml</span><br><span class="line">AddOutputFilterByType DEFLATE application/x-javascript</span><br><span class="line">AddOutputFilterByType DEFLATE text/javascript</span><br><span class="line">AddOutputFilterByType DEFLATE text/css</span><br><span class="line"></span><br><span class="line"><span class="comment"># Level of compression (Highest 9 - lowest 1)</span></span><br><span class="line">DeflateCompressionLevel <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Netscape 4.x has some problems.</span></span><br><span class="line">BrowserMatch ^Mozilla/<span class="number">4</span> gzip-only-text/html</span><br><span class="line"></span><br><span class="line"><span class="comment"># Netscape 4.06-4.0.8 has some more problems.</span></span><br><span class="line">BrowserMatch ^Mozilla4\.<span class="number">0</span>[<span class="number">478</span>] no-gzip</span><br><span class="line"></span><br><span class="line"><span class="comment"># MSIE masquerades as Netscape but it is fine</span></span><br><span class="line">BrowerMatch \bMSI[E] !no-gzip !gzip-only-text/html</span><br></pre></td></tr></table></figure>
<h2 id="https-http-over-ssl-443-tcp"><a class="header-anchor" href="#https-http-over-ssl-443-tcp"></a>https http over ssl 443/tcp</h2>
<p>ssl : v3</p>
<p>tls : v1</p>
<p>SS会话的简化过程</p>
<ol>
<li>客户端要发送可供选择的加密方式, 并向服务器请求证书.</li>
<li>服务器端发送证书以及选定的加密方式给客户端.</li>
<li>证书验证
<ul>
<li>如果信任给其发证书的CA</li>
<li>验证证书来源的合法性: 用CA的公钥解密证书上的数字签名.</li>
<li>验证证书内容的合法性: 完整性验证</li>
<li>检查证书的有效期限:</li>
<li>检查证书是否被吊销:</li>
<li>证书中拥有者的名字, 与访问目标主机要一致.</li>
</ul>
</li>
<li>客户端将会生成临时会话密码(对称加密的秘钥), 并使用服务器端的公钥加密此数据并发送给服务器, 完成秘钥交换.</li>
<li>服务器用此对称秘钥加密用户请求的资源, 响应给客户端.</li>
</ol>
<p>注意: SSL会话是基于IP地址创建: 所有单IP主机上仅可以使用一个https虚拟主机.</p>
<p><code>PKI, CA, CRL, X.509 (v1, v2, v3)</code></p>
<h2 id="配置httpd支持https"><a class="header-anchor" href="#配置httpd支持https"></a>配置httpd支持https</h2>
<ol>
<li>为服务器申请数字证书
<ol>
<li>建立私有CA发证书(测试使用)</li>
<li>在服务器创建证书签署请求</li>
<li>CA签证</li>
</ol>
</li>
<li>配置httpd支持使用ssl,及使用证书</li>
<li>测试基于https访问响应的主机</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 192.168.1.160 CA证书服务器</span></span><br><span class="line"><span class="comment"># 192.168.1.166 httpd服务器</span></span><br><span class="line"><span class="comment"># 1. 建立私有CA</span></span><br><span class="line">$ <span class="built_in">cd</span> /etc/pki/CA</span><br><span class="line">$ (<span class="built_in">umask</span> <span class="number">077</span>; openssl genrsa -out private/cakey.pem <span class="number">2048</span>)</span><br><span class="line">$ ll private/</span><br><span class="line">-rw------- <span class="number">1</span> root root <span class="number">1679</span> Oct <span class="number">11</span> <span class="number">20</span>:<span class="number">37</span> cakey.pem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 生成自签证书</span></span><br><span class="line">$ openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days <span class="number">365</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (<span class="number">2</span> letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:HA</span><br><span class="line">Locality Name (eg, city) [Default City]:ZZ</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:molloc</span><br><span class="line">Organizational Unit Name (eg, section) []:Ops</span><br><span class="line">Common Name (eg, your name or your server\<span class="string">'s hostname) []:ca.molloc.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">$ ll</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r--  1 root root 1294 Oct 11 20:41 cacert.pem</span><br><span class="line">drwxr-xr-x. 2 root root    6 Jun 29 20:48 certs</span><br><span class="line">drwxr-xr-x. 2 root root    6 Jun 29 20:48 crl</span><br><span class="line">drwxr-xr-x. 2 root root    6 Jun 29 20:48 newcerts</span><br><span class="line">drwx------. 2 root root   22 Oct 11 20:37 private</span><br><span class="line"></span><br><span class="line"># 3 给CA创建2个文件, 一个是数据库索引文件index.txt, 一个是serial序列号</span><br><span class="line">$ touch index.txt</span><br><span class="line">$ echo 01 &gt; serial</span><br><span class="line"></span><br><span class="line"># 4 服务器做一个自签CA请求</span><br><span class="line">$ cd /etc/httpd</span><br><span class="line">$ mkdir ssl</span><br><span class="line">$ cd ssl</span><br><span class="line">$ (umask 077; openssl genrsa -out httpd.key 1024) # 创建私钥</span><br><span class="line">$ ll</span><br><span class="line">-rw------- 1 root root 887 Oct 11 20:46 httpd.key</span><br><span class="line">$ openssl req -new -key httpd.key -out httpd.csr # 创建一个证书签署请求</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter '</span>.<span class="string">', the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:HA</span><br><span class="line">Locality Name (eg, city) [Default City]:ZZ</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:molloc</span><br><span class="line">Organizational Unit Name (eg, section) []:Ops</span><br><span class="line">Common Name (eg, your name or your server\'</span>s hostname) []:www.a.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following <span class="string">'extra'</span> attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5 把CA签署请求发给CA</span></span><br><span class="line">$ scp httpd.csr root@<span class="number">192.168</span>.<span class="number">1.160</span>:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回到160主机上来, 对CA请求做签署</span></span><br><span class="line">$ ll /tmp</span><br><span class="line">-rw-r--r--  <span class="number">1</span> root root    <span class="number">631</span> Oct <span class="number">11</span> <span class="number">21</span>:<span class="number">01</span> httpd.csr</span><br><span class="line">$ openssl ca -in httpd.csr -out httpd.crt -days <span class="number">365</span></span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: <span class="number">1</span> (<span class="number">0</span>x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Oct <span class="number">11</span> <span class="number">13</span>:<span class="number">04</span>:<span class="number">10</span> <span class="number">2015</span> GMT</span><br><span class="line">            Not After : Oct <span class="number">10</span> <span class="number">13</span>:<span class="number">04</span>:<span class="number">10</span> <span class="number">2016</span> GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = HA</span><br><span class="line">            organizationName          = molloc</span><br><span class="line">            organizationalUnitName    = Ops</span><br><span class="line">            commonName                = www.a.com</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment:</span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                <span class="number">6</span>C:<span class="number">5</span>A:<span class="number">10</span>:F9:<span class="number">65</span>:<span class="number">78</span>:<span class="number">40</span>:<span class="number">40</span>:<span class="number">17</span>:<span class="number">77</span>:EB:<span class="number">28</span>:<span class="number">9</span>C:<span class="number">58</span>:<span class="number">4</span>B:<span class="number">00</span>:<span class="number">1</span>A:<span class="number">97</span>:<span class="number">6</span>E:<span class="number">10</span></span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                keyid:<span class="number">28</span>:A4:<span class="number">86</span>:<span class="number">13</span>:<span class="number">1</span>D:<span class="number">3</span>A:<span class="number">90</span>:AF:<span class="number">8</span>E:<span class="number">21</span>:B2:C8:<span class="number">0</span>E:<span class="number">74</span>:E9:<span class="number">0</span>E:<span class="number">61</span>:<span class="number">0</span>D:CD:<span class="number">84</span></span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Oct <span class="number">10</span> <span class="number">13</span>:<span class="number">04</span>:<span class="number">10</span> <span class="number">2016</span> GMT (<span class="number">365</span> days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> out of <span class="number">1</span> certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with <span class="number">1</span> new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6 证书签署完成, 把httpd.crt发还给httpd服务端</span></span><br><span class="line">$ scp httpd.crt root@<span class="number">192.168</span>.<span class="number">1.166</span>:/etc/httpd/ssl/</span><br><span class="line">$ ll ssl</span><br><span class="line">total <span class="number">12</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">3658</span> Oct <span class="number">11</span> <span class="number">21</span>:<span class="number">08</span> httpd.crt</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root  <span class="number">631</span> Oct <span class="number">11</span> <span class="number">20</span>:<span class="number">57</span> httpd.csr</span><br><span class="line">-rw------- <span class="number">1</span> root root  <span class="number">887</span> Oct <span class="number">11</span> <span class="number">20</span>:<span class="number">46</span> httpd.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7 让httpd装载ssl模块</span></span><br><span class="line">$ yum info mod_ssl</span><br><span class="line">Available Packages</span><br><span class="line">Name        : mod_ssl</span><br><span class="line">Arch        : x86_64</span><br><span class="line">Epoch       : <span class="number">1</span></span><br><span class="line">Version     : <span class="number">2.2</span>.<span class="number">15</span></span><br><span class="line">Release     : <span class="number">47</span>.el6.centos</span><br><span class="line">Size        : <span class="number">95</span> k</span><br><span class="line">Repo        : updates</span><br><span class="line">Summary     : SSL/TLS module <span class="keyword">for</span> the Apache HTTP Server</span><br><span class="line">URL         : http://httpd.apache.org/</span><br><span class="line">License     : ASL <span class="number">2.0</span></span><br><span class="line">Description : The mod_ssl module provides strong cryptography <span class="keyword">for</span> the Apache Web</span><br><span class="line">            : server via the Secure Sockets Layer (SSL) and Transport Layer</span><br><span class="line">            : Security (TLS) protocols.</span><br><span class="line"></span><br><span class="line">$ yum install -y mod_ssl <span class="comment"># 安装mod_ssl</span></span><br><span class="line">$ rpm -ql mod_ssl</span><br><span class="line">/etc/httpd/conf.d/ssl.conf</span><br><span class="line">/usr/lib64/httpd/modules/mod_ssl.so</span><br><span class="line">/var/cache/mod_ssl</span><br><span class="line">/var/cache/mod_ssl/scache.dir</span><br><span class="line">/var/cache/mod_ssl/scache.pag</span><br><span class="line">/var/cache/mod_ssl/scache.sem</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /etc/httpd/conf.d/</span><br><span class="line">$ cp ssl.conf&#123;,_bak&#125; <span class="comment"># 先备份一份</span></span><br><span class="line">$ vim ssl.conf <span class="comment"># 修改以下配置</span></span><br><span class="line">DocumentRoot <span class="string">"/vhosts/a.com"</span></span><br><span class="line">ServerName www.a.com:<span class="number">443</span></span><br><span class="line">SSLCertificateFile /etc/httpd/ssl/httpd.crt</span><br><span class="line">SSLCertificateKeyFile /etc/httpd/ssl/httpd.key</span><br><span class="line"></span><br><span class="line">$ httpd -t <span class="comment">#检查语法</span></span><br><span class="line">Syntax OK</span><br><span class="line"></span><br><span class="line">$ service httpd restart <span class="comment"># 重启httpd</span></span><br><span class="line">Stopping httpd:                                            [  OK  ]</span><br><span class="line">Starting httpd:                                            [  OK  ]</span><br><span class="line"></span><br><span class="line">$ ss -tnl <span class="comment"># 查看是否有443端口</span></span><br><span class="line">LISTEN      <span class="number">0</span>      <span class="number">128</span> 			:::<span class="number">443</span>               :::*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试, 用openssl s_client</span></span><br><span class="line">openssl s_client [-connect host:port] [-cert certname] [-CApath directory] [-CAfile filename]</span><br><span class="line">$ scp cacert.pem <span class="number">192.168</span>.<span class="number">1.166</span>:/tmp</span><br><span class="line">$ openssl s_client -connect www.a.com:<span class="number">443</span> -CAfile /tmp/cacert.pem</span><br><span class="line">CONNECTED(<span class="number">00000003</span>)</span><br><span class="line">depth=<span class="number">1</span> C = CN, ST = HA, L = ZZ, O = molloc, OU = Ops, CN = ca.molloc.com</span><br><span class="line">verify <span class="built_in">return</span>:<span class="number">1</span></span><br><span class="line">depth=<span class="number">0</span> C = CN, ST = HA, O = molloc, OU = Ops, CN = www.a.com</span><br><span class="line">verify <span class="built_in">return</span>:<span class="number">1</span></span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> <span class="number">0</span> s:/C=CN/ST=HA/O=molloc/OU=Ops/CN=www.a.com</span><br><span class="line">   i:/C=CN/ST=HA/L=ZZ/O=molloc/OU=Ops/CN=ca.molloc.com</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIIDHTCCAgWgAwIBAgIBATANBgkqhkiG9w0BAQsFADBeMQswCQYDVQQGEwJDTjEL</span><br><span class="line">MAkGA1UECAwCSEExCzAJBgNVBAcMAlpaMQ8wDQYDVQQKDAZtb2xsb2MxDDAKBgNV</span><br><span class="line">BAsMA09wczEWMBQGA1UEAwwNY2EubW9sbG9jLmNvbTAeFw0xNTEwMTExMzA0MTBa</span><br><span class="line">Fw0xNjEwMTAxMzA0MTBaME0xCzAJBgNVBAYTAkNOMQswCQYDVQQIDAJIQTEPMA0G</span><br><span class="line">A1UECgwGbW9sbG9jMQwwCgYDVQQLDANPcHMxEjAQBgNVBAMMCXd3dy5hLmNvbTCB</span><br><span class="line">nzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwLIm+gsOGRcvktui+v7CQz6AtSWO</span><br><span class="line">EkT<span class="keyword">do</span>M+mX2e+gmn8egBhMlA0ln01DsZ+<span class="number">4</span>luHQdOFYTInOeeF4fhuuHvI9c6bu6J2</span><br><span class="line">yzHGP6CbbcPhx2CCAAdn5QtH3gdWqpJmteEiRsJEjFYTGQTd304YoYqZcgESUqU3</span><br><span class="line">RfY2yjHaEVuMvKcCAwEAAaN7MHkwCQYDVR0TBAIwADAsBglghkgBhvhCAQ0EHxYd</span><br><span class="line">T3BlblNTTCBHZW5lcmF0ZWQgQ2VydGlmaWNhdGUwHQYDVR0OBBYEFGxaEPlleEBA</span><br><span class="line">F3frKJxYSwAal24QMB8GA1UdIwQYMBaAFCikhhMdOpCvjiGyyA506Q5hDc2EMA0G</span><br><span class="line">CSqGSIb3DQEBCwUAA4IBAQB6FNVZBPaGUsCStOi8lItIvF+I4ilnYO4m0NB5r2eM</span><br><span class="line">O9QyBZDlkWr2a8PnHvjwAbWZAW00gXpNDxHhPs36LN9+yBc2p1Xa4G4XwCMYdeYS</span><br><span class="line"><span class="number">9</span>tHBsRlAByjKtFUsOpyXZWibSWjslb7gjkA/<span class="number">7</span>ptLSbxYTCms1sVzuz+Ui0jTGrnH</span><br><span class="line">DGBWPmajtZt+yGhd310VWYEmMasPy3vTSYu9M7gHWfm5VWltjrS+T2o0llWM8Rok</span><br><span class="line"><span class="number">4</span>KlsI0K7y35VoGwCEwn4SH18BWIdhAbpAdcjpXw0Xie4d18BvEIaCk0QWPD8cTi9</span><br><span class="line">nUgkqy/tjmQEVZq/LmWQ+<span class="number">4</span>UEZ/<span class="number">6</span>QDqAth3X9KeBye+pa</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">subject=/C=CN/ST=HA/O=molloc/OU=Ops/CN=www.a.com</span><br><span class="line">issuer=/C=CN/ST=HA/L=ZZ/O=molloc/OU=Ops/CN=ca.molloc.com</span><br><span class="line">---</span><br><span class="line">No client certificate CA names sent</span><br><span class="line">Server Temp Key: ECDH, prime256v1, <span class="number">256</span> bits</span><br><span class="line">---</span><br><span class="line">SSL handshake has <span class="built_in">read</span> <span class="number">1364</span> bytes and written <span class="number">375</span> bytes</span><br><span class="line">---</span><br><span class="line">New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">Server public key is <span class="number">1024</span> bit</span><br><span class="line">Secure Renegotiation IS supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">SSL-Session:</span><br><span class="line">    Protocol  : TLSv1.<span class="number">2</span></span><br><span class="line">    Cipher    : ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">    Session-ID: D3A4E31DBAF1F7E77F6B56A5144ABF9C2A957F194891985DC638EBE113669DA9</span><br><span class="line">    Session-ID-ctx:</span><br><span class="line">    Master-Key: <span class="number">178</span>BF6E19D37D65961819A4BC0409F8126DA64BE4BAE1DA32BBFB1F3EAA230B20293ADBF924FA0273831F01C144D09CD</span><br><span class="line">    Key-Arg   : None</span><br><span class="line">    Krb5 Principal: None</span><br><span class="line">    PSK identity: None</span><br><span class="line">    PSK identity hint: None</span><br><span class="line">    TLS session ticket lifetime hint: <span class="number">300</span> (seconds)</span><br><span class="line">    TLS session ticket:</span><br><span class="line">    <span class="number">0000</span> - <span class="number">47</span> <span class="number">38</span> <span class="number">90</span> f7 ef d3 c3 aa-<span class="number">92</span> <span class="number">9</span>f de <span class="number">54</span> c4 <span class="number">44</span> <span class="number">4</span>d f9   G8.........T.DM.</span><br><span class="line">    <span class="number">0010</span> - <span class="number">12</span> <span class="number">69</span> <span class="number">8</span>b f6 <span class="number">96</span> ae <span class="number">77</span> c7-<span class="number">38</span> <span class="number">27</span> f7 <span class="number">56</span> <span class="number">25</span> a3 <span class="number">6</span>a <span class="number">23</span>   .i....w.<span class="number">8</span><span class="string">'.V%.j#</span><br><span class="line">    0020 - 83 69 ad 77 e4 25 a4 96-df e4 32 87 7e ba d0 83   .i.w.%....2.~...</span><br><span class="line">    0030 - ba e1 9a 46 8d c7 c7 ff-a4 87 60 68 67 07 33 84   ...F......`hg.3.</span><br><span class="line">    0040 - 13 5c 0d 6c 61 fe be e5-a0 0a 68 87 a4 1d 55 3d   .\.la.....h...U=</span><br><span class="line">    0050 - 65 2c f0 00 9c bb c1 e2-ad 47 54 a4 5d 27 ea 16   e,.......GT.]'</span>..</span><br><span class="line">    <span class="number">0060</span> - <span class="number">61</span> ae <span class="number">73</span> <span class="number">12</span> ee <span class="number">02</span> <span class="number">63</span> <span class="number">1</span>f-<span class="number">95</span> <span class="number">4</span>f <span class="number">31</span> <span class="number">0</span>b bf e4 ae <span class="number">51</span>   a.s...c..O1....Q</span><br><span class="line">    <span class="number">0070</span> - <span class="number">3</span>c dc <span class="number">5</span>a fd <span class="number">3</span>d fb <span class="number">58</span> <span class="number">23</span>-<span class="number">84</span> <span class="number">43</span> dc aa <span class="number">9</span>a <span class="number">34</span> <span class="number">57</span> dc   &lt;.Z.=.X<span class="comment">#.C...4W.</span></span><br><span class="line">    <span class="number">0080</span> - <span class="number">00</span> <span class="number">87</span> <span class="number">3</span>f b0 <span class="number">00</span> <span class="number">74</span> <span class="number">0</span>d <span class="number">6</span>c-<span class="number">06</span> <span class="number">4</span>a <span class="number">27</span> <span class="number">38</span> d1 <span class="number">41</span> <span class="number">48</span> e9   ..?..t.l.J<span class="string">'8.AH.</span><br><span class="line">    0090 - 51 bd 6d 61 1a c9 08 a7-65 2b 60 ce 2c 47 ed ff   Q.ma....e+`.,G..</span><br><span class="line">    00a0 - 19 ab 6a 47 13 7b ae 8c-37 47 ed 44 34 ee 18 6b   ..jG.&#123;..7G.D4..k</span><br><span class="line">    00b0 - e8 c7 7a 6f b1 95 bc f8-e6 f0 f8 e1 04 be 27 6b   ..zo..........'</span>k</span><br><span class="line"></span><br><span class="line">    Start Time: <span class="number">1444570628</span></span><br><span class="line">    Timeout   : <span class="number">300</span> (sec)</span><br><span class="line">    Verify <span class="built_in">return</span> code: <span class="number">0</span> (ok)</span><br><span class="line">---</span><br><span class="line">GET /rc.txt HTTP/<span class="number">1.1</span></span><br><span class="line">Host: www.a.com</span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Sun, <span class="number">11</span> Oct <span class="number">2015</span> <span class="number">13</span>:<span class="number">37</span>:<span class="number">18</span> GMT</span><br><span class="line">Server: Apache/<span class="number">2.2</span>.<span class="number">15</span> (CentOS)</span><br><span class="line">Last-Modified: Sun, <span class="number">11</span> Oct <span class="number">2015</span> <span class="number">12</span>:<span class="number">04</span>:<span class="number">08</span> GMT</span><br><span class="line">ETag: <span class="string">"c0005-4e81-521d30299a676"</span></span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: <span class="number">20097</span></span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/plain; charset=UTF-<span class="number">8</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="httpd自带的工具程序"><a class="header-anchor" href="#httpd自带的工具程序"></a>httpd自带的工具程序</h2>
<ul>
<li><code>htpasswd</code> basic认证基于文件实现时, 用到的账号密码文件生成工具.</li>
<li><code>apachectl</code> httpd自带的服务控制脚本. 支持<code>start, stop</code></li>
<li><code>apxs</code> 由httpd-devel包提供的,扩展httpd使用第三方模块的工具.</li>
<li><code>rotatelogs</code> 日志滚动工具</li>
<li><code>suexec</code> 访问某些有特殊权限配置的资源时,临时切换至指定用户运行</li>
<li><code>ab</code> apache benchmark</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ab [options] url</span><br><span class="line">	-n 总的请求数</span><br><span class="line">	-c 模拟的并发数</span><br><span class="line">	-k 以持有连接模式测试</span><br><span class="line"></span><br><span class="line"><span class="built_in">ulimit</span> -n <span class="comment">#: 调整当前用户所同时打开的文件数.</span></span><br></pre></td></tr></table></figure>
<h2 id="http压力测试工具-ab-webbench-http-load-jmeter-loaderunner-tcpcopy"><a class="header-anchor" href="#http压力测试工具-ab-webbench-http-load-jmeter-loaderunner-tcpcopy"></a>http压力测试工具 ab, webbench, http_load, jmeter, loaderunner, tcpcopy</h2>
<h2 id="http协议"><a class="header-anchor" href="#http协议"></a>HTTP协议</h2>
<p>URL: Unifrom Resource Locator</p>
<ul>
<li>URL方案: schema eg:<code>http://, https://</code></li>
<li>服务器地址: IP:PORT</li>
<li>资源路径: path</li>
</ul>
<p>基本语法: <code>&lt;scheme&gt;://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;:&lt;port&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;frag&gt;</code></p>
<p>版本: <code>http/0.9, http/1.0, http/1.1, http/2.0</code></p>
<p>http协议是无状态的. <code>steteless</code>服务器无法持续追踪访问者来源.(可以基于cookie, session来追踪同一个用户)</p>
<p>http事物</p>
<ul>
<li>请求: request</li>
<li>响应: response</li>
</ul>
<h2 id="报文语法格式"><a class="header-anchor" href="#报文语法格式"></a>报文语法格式</h2>
<ul>
<li>method: 请求方法, 表明客户端希望服务器对资源执行的动作, <code>GET, HEADE, POST, PUT, DELETE</code></li>
<li>version: <code>HTTP/&lt;major&gt;.&lt;minor&gt;</code></li>
<li>status: 三位的数字, <code>200, 301, 302, 404, 502</code>, 标记请求处理过程中发生的情况.</li>
<li>reason-phrase: 状态码所标记的状态的简要描述 <code>OK, NOT FOUND</code></li>
<li>headers: 用来标记请求或响应的属性. 每个请求和响应报文可包含任意个首部.格式<code>key:value</code></li>
<li>entity-body: 请求时附加的数据或响应时附加的数据.</li>
</ul>
<h2 id="method"><a class="header-anchor" href="#method"></a>method</h2>
<ul>
<li>GET 从服务器获取一个资源.</li>
<li>HEAD 只从服务器获取文档的响应首部.</li>
<li>POST 向服务器发送要处理的数据.</li>
<li>PUT 将请求的主题部分存储在服务器上.</li>
<li>DELETE 请求删除服务器上指定的文档.</li>
<li>TRACE 追踪请求到达服务器中间经过的代理服务器.</li>
<li>OPTIONS 请求服务器返回对指定资源支持使用的请求方法.</li>
</ul>
<p>协议查看或分析的工具<code>tcpdump, tshark, wireshark</code></p>
<h2 id="status"><a class="header-anchor" href="#status"></a>status</h2>
<ul>
<li>1xx 100-101 信息提示.</li>
<li>2xx 200-206 成功类的响应.</li>
<li>3xx 300-305 重定向类的状态码.</li>
<li>4xx 400-415 错误类信息, 客户端错误.</li>
<li>5xx 500-505 错误类信息, 服务器端错误.</li>
</ul>
<h2 id="常用的状态码"><a class="header-anchor" href="#常用的状态码"></a>常用的状态码</h2>
<ul>
<li>200 <code>OK</code> 请求的所有数据通过响应报文的entity-body全部发送.</li>
<li>301 <code>Moved Permanently</code> 请求的URL指向的资源已经被删除, 但在响应报文中通过首部Location指明了资源现在所处的新位置.永久重定向</li>
<li>302 <code>Found</code> 与301相似, 但在响应报文中通过Location指明资源现在所处临时新位置, 临时重定向</li>
<li>304 <code>Not Modified</code> 客户端发出了条件式请求, 但服务器上的资源未曾发生改变,则通过304响应状态码通知客户端.</li>
<li>401 <code>Unauthorized</code> 需要输入账号密码认证方能访问资源.</li>
<li>403 <code>Forbidden</code> 请求被禁止</li>
<li>404 <code>Not Found</code> 服务器无法找到客户端请求的资源.</li>
<li>500 <code>Internal Server Error</code> 服务器内部错误</li>
<li>502 <code>Bad Gateway</code> 代理服务器从后端服务器收到了一条伪响应.</li>
</ul>
<h2 id="首部-header-的分类"><a class="header-anchor" href="#首部-header-的分类"></a>首部(header)的分类</h2>
<ul>
<li>通用首部
<ul>
<li>Date 报文的创建时间.</li>
<li>Connection 连接方式 <code>keep-alive, close</code></li>
<li>Via 显示报文经过的中间节点.</li>
<li>Cache-Control 控制缓存</li>
<li>Pragma</li>
</ul>
</li>
<li>请求首部
<ul>
<li>Accept 通知服务器自己可接受的媒体类型.</li>
<li>Accept-Charset 通知服务器自己可接受的字符集</li>
<li>Accept-Encoding 通知服务器自己可接受的编码格式, eg: <code>gzip, deflate, sdch</code></li>
<li>Accept-Language 通知服务器自己可接受的语言</li>
<li>Client-IP</li>
<li>Host 请求的服务器名称和端口号</li>
<li>Referer 包含了当前正在请求的资源的上一级资源.</li>
<li>User-Agent 客户端代理</li>
<li>条件式请求首部
<ul>
<li>Expect</li>
<li>If-Modified-Since 自从指定的时间之后, 请求的资源是否发生过修改.</li>
<li>If-Unmodified-Since</li>
<li>If-None-Match 本地缓存中存储的文档的Etag标签是否与服务器文档的Etag标签不匹配</li>
<li>If-Match</li>
</ul>
</li>
<li>安全请求首部
<ul>
<li>Authorization 向服务器发送认证信息, 比如账号密码</li>
<li>Cookie 客户端请求时, 向服务器端发送cookie标识</li>
<li>Cookie2</li>
</ul>
</li>
</ul>
</li>
<li>代理请求首部
<ul>
<li>Proxy-Authorization 向代理服务器认证</li>
</ul>
</li>
<li>响应首部
<ul>
<li>Age 响应持续市场</li>
<li>Server 服务器程序软件名称和版本 <code>Apache/2.2.15 (CentOS), nginx</code></li>
<li>协商首部, 某资源有多种表示方法时使用
<ul>
<li>Accept-Ranges: 服务器可接受的请求范围类型.</li>
<li>Vary: 服务器查看的其他首部列表.</li>
</ul>
</li>
<li>安全响应首部
<ul>
<li>Set-Cookie 想客户端设置cookie</li>
<li>Set-Cookie2</li>
<li>www-Authenticate 来自服务器对客户端的质询认证表单</li>
</ul>
</li>
</ul>
</li>
<li>实体首部
<ul>
<li>Allow 列出对此资源可使用的请求方法.</li>
<li>Location 告诉客户端真正实体位于何处</li>
<li>Content-Encoding 内容的编码格式</li>
<li>Content-Language</li>
<li>Content-length 主体的长度</li>
<li>Content-Location 实体真正所处的位置</li>
<li>Content-Range</li>
<li>Content-Type 主体的对象的类型</li>
<li>缓存相关
<ul>
<li>Etag 实体的扩展标签</li>
<li>Expires 实体的过期时间</li>
<li>Last-Modified 最后一次的修改时间</li>
</ul>
</li>
</ul>
</li>
<li>扩展首部</li>
</ul>
<p>example</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control:max-age=<span class="number">900</span></span><br><span class="line">Connection:keep-alive</span><br><span class="line">Content-Type:text/html; charset=utf-<span class="number">8</span></span><br><span class="line">Date:Sun, <span class="number">11</span> Oct <span class="number">2015</span> <span class="number">08</span>:<span class="number">33</span>:<span class="number">08</span> GMT</span><br><span class="line">ETag:<span class="string">"56171ec1-cd9f"</span></span><br><span class="line">Expires:Sun, <span class="number">11</span> Oct <span class="number">2015</span> <span class="number">08</span>:<span class="number">35</span>:<span class="number">53</span> GMT</span><br><span class="line">Last-Modified:Fri, <span class="number">09</span> Oct <span class="number">2015</span> <span class="number">01</span>:<span class="number">56</span>:<span class="number">17</span> GMT</span><br><span class="line">X-Via:<span class="number">1.0</span> zhj76:<span class="number">8109</span> (Cdn Cache Server V2.<span class="number">0</span>), <span class="number">1.0</span> wenzhou20:<span class="number">5</span> (Cdn Cache Server V2.<span class="number">0</span>)</span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*/*;q=<span class="number">0.8</span></span><br><span class="line">Accept-Encoding:gzip, deflate, sdch</span><br><span class="line">Accept-Language:zh-CN,zh;q=<span class="number">0.8</span>,en-US;q=<span class="number">0.6</span>,en;q=<span class="number">0.4</span></span><br><span class="line">Cache-Control:max-age=<span class="number">0</span></span><br><span class="line">Connection:keep-alive</span><br><span class="line">Cookie:xmuuid=XMGUEST-D468AF20-<span class="number">6</span>FF1-<span class="number">11</span>E5-<span class="number">8384</span>-<span class="number">2</span>F3D6C29A250</span><br></pre></td></tr></table></figure>
<p><code>request</code>报文</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;method&gt; &lt;request-URL&gt; &lt;version&gt; <span class="comment"># 起始行</span></span><br><span class="line">&lt;headers&gt; <span class="comment"># 头信息, 后面是两次换行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;entity-body&gt;</span><br></pre></td></tr></table></figure>
<p><code>response</code>报文</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;version&gt; &lt;status&gt; &lt;reason-phrase&gt; <span class="comment"># 起始行</span></span><br><span class="line">&lt;headers&gt; <span class="comment"># 头信息, 后面是两次换行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;entity-body&gt; <span class="comment"># 响应实体</span></span><br></pre></td></tr></table></figure>
<h2 id="curl命令"><a class="header-anchor" href="#curl命令"></a>curl命令</h2>
<p><code>curl</code>是基于URL语法在命令行方式下工作的文本传输工具, 它支持<code>FTP, FTPS, HTTP, HTTPS, GOPHER, TELNET, DICT, FILE, LDAP</code>等协议,<code>curl</code>支持HTTPS认证,并且支持HTTP的<code>POST, PUT</code>等方法, FTP上传, kerberos认证, HTTP上传, 代理服务器, cookies, 用户名/密码认证, 下载文件断点续传,上载文件断点续传, http代理服务器管道(proxy tunneling), 甚至它还支持IPV6,socks5代理服务器, 通过http代理服务器上传文件到FTP服务器等,功能是分强大.</p>
<p>curl的常用选项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用户</span></span><br><span class="line">curl [options] [URL...]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用选项</span></span><br><span class="line">-A/--user-agent &lt;string&gt; <span class="comment"># 设置用户代理发送给服务器</span></span><br><span class="line">-basic <span class="comment"># 使用HTTP基本认证</span></span><br><span class="line">-tcp-nodelay <span class="comment"># 使用TCP_NODELAY选项</span></span><br><span class="line"><span class="operator">-e</span>/--referer &lt;URL&gt; <span class="comment"># 来源网址</span></span><br><span class="line">--cacert &lt;file&gt; <span class="comment"># CA证书(SSL)</span></span><br><span class="line">--compressed <span class="comment"># 要求返回的是压缩的格式</span></span><br><span class="line">-H/--header &lt;line&gt; <span class="comment"># 自定义头信息传递给服务器</span></span><br><span class="line">-I/--header <span class="comment"># 只显示响应报文首部信息</span></span><br><span class="line">--limit-rate &lt;rate&gt; <span class="comment"># 设置传输速率</span></span><br><span class="line">-u/--user &lt;user[:password]&gt; <span class="comment"># 设置服务器的用户名和密码</span></span><br><span class="line">-<span class="number">0</span>/--http1.<span class="number">0</span> <span class="comment"># 使用http 1.0</span></span><br></pre></td></tr></table></figure>
<p>另一个工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elinks [options]...[url]...</span><br><span class="line">	-dump <span class="comment"># 不进入交互式模式, 而直接将URL的内容输出至标准输出.</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>网络模型大概有两种,一种是OSI的参考模型,它把协议栈大体上分为七层,上三层叫资源子网,下四层叫通讯子网,TCP协议将协议栈分成四层,TCP协议栈的应用层对用OSI的上三层,用来表示应用的,底下的三层,首先TCP,UDP这一层也叫传输层,对应OSI的传输层,其次互联网层(IPV4,IPV6)层对用OSI的网络层,最后身边驱动程序和硬件则对应OSI的数据链路层和物理层.传输层及传输层以下的叫通讯子网,而上面的叫资源子网.</p>
<p>IP地址用于标记主机到主机的,数据链路层的MAC地址是用来标记设备到设备的.</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-08-30]]></title>
    <link href="http://molloc.me/2015/09/26/ZY-2015-08-30/"/>
    <id>http://molloc.me/2015/09/26/ZY-2015-08-30/</id>
    <published>2015-09-26T02:55:52.000Z</published>
    <updated>2015-09-27T14:57:42.188Z</updated>
    <content type="html"><![CDATA[<p>Vim是一个类似于Vi的著名的功能强大、高度可定制的文本编辑器，在Vi的基础上改进和增加了很多特性。VIM是纯粹的自由软件。Vim普遍被推崇为类Vi编辑器中最好的一个，事实上真正的劲敌来自Emacs的不同变体。1999 年Emacs被选为Linuxworld文本编辑分类的优胜者，Vim屈居第二。但在2000年2月Vim赢得了Slashdot Beanie的最佳开放源代码文本编辑器大奖，又将Emacs推至二线， 总的来看， Vim和Emacs同样都是非常优秀的文本编辑器。</p>
<a id="more"></a>
<p><code>vi, vi iMproved</code> --&gt; <code>vim</code></p>
<h2 id="vim的模式"><a class="header-anchor" href="#vim的模式"></a>vim的模式</h2>
<ul>
<li>编辑模式,也叫命令模式</li>
<li>输入模式</li>
<li>末行模式</li>
</ul>
<h2 id="编辑模式到输入模式"><a class="header-anchor" href="#编辑模式到输入模式"></a>编辑模式到输入模式</h2>
<ul>
<li><code>i</code> insert</li>
<li><code>a</code> append</li>
<li><code>o</code> new line, 当前行的下方</li>
<li><code>O</code> new line, 当前行的上方</li>
<li><code>I</code> 行首</li>
<li><code>A</code> 行尾</li>
</ul>
<h2 id="输入模式到编辑模式"><a class="header-anchor" href="#输入模式到编辑模式"></a>输入模式到编辑模式</h2>
<ul>
<li><code>ESC</code></li>
</ul>
<h2 id="编辑模式到末行模式"><a class="header-anchor" href="#编辑模式到末行模式"></a>编辑模式到末行模式</h2>
<ul>
<li><code>:</code></li>
</ul>
<h2 id="末行模式到编辑模式"><a class="header-anchor" href="#末行模式到编辑模式"></a>末行模式到编辑模式</h2>
<ul>
<li><code>ESC</code></li>
</ul>
<p>无法直接从输入模式回到末行模式,必须先按<code>ESC</code>退回到编辑模式,然后在进入末行模式.</p>
<h2 id="打开vim"><a class="header-anchor" href="#打开vim"></a>打开<code>vim</code></h2>
<ul>
<li><code>vim</code></li>
<li><code>vim /PATH/TO/SOMEFILE</code></li>
<li><code>+#</code> <code>#</code>为行号,打开文件的时候,光标直接位于<code>#</code>行</li>
<li><code>+/PATTERN</code> 打开文件的时候,光标位于<code>PATTERN</code>第一次匹配的位置.</li>
</ul>
<h2 id="关闭vim"><a class="header-anchor" href="#关闭vim"></a>关闭vim</h2>
<ul>
<li><code>:q</code>  退出</li>
<li><code>:wq</code> 存盘并退出</li>
<li><code>:q!</code> 不保存退出</li>
<li><code>:x</code>  保存退出</li>
<li><code>:w /PATH/TO/SOMEFILE</code> 另存为SOMEFILE文件</li>
<li>在编辑模式下<code>ZZ</code> 保存退出</li>
</ul>
<h2 id="vim中的跳转"><a class="header-anchor" href="#vim中的跳转"></a>vim中的跳转</h2>
<p>(1) 逐字符跳转<code>h(左),l(右),j(下),k(上)</code>一个字符. <code>#{h|l|j|k}</code>可以跳转#个字符,<code>10h</code>表示向左移动10字符.其他类似.</p>
<p>(2) 单词间跳转<code>w,e,b</code></p>
<p>连字符代表<code>-</code>,不包括上划线和下划线.</p>
<p><code>w</code> 表示跳至下一个单词的词首,此处的单词是由连续的字母加数字,下划线(不包括特殊字符和连字符,特殊字符和连字符算一个单词)组成.</p>
<p><code>e</code> 跳至当前或下一个单词的词尾,此处的单词是由连续的字符,数字,下划线组成(不包括特殊字符,特殊字符算一个单词).</p>
<p><code>b</code> 跳至当前或上一个单词的词首,此处的单词是由连续的字符,数字,下划线组成(不包括特殊字符,特殊字符算一个单词).</p>
<p><code>#{w|e|b}</code> 跳转<code>#</code>个单词位置.</p>
<p>(3) 行内跳转</p>
<p><code>^</code> 跳转至行首的第一个非空白字符</p>
<p><code>0</code> 跳转至行首(绝对行首)</p>
<p><code>$</code> 跳转至行尾(绝对行尾)</p>
<p>(4) 行间移动</p>
<p><code>#G</code> 跳转至<code>#</code>行, <code>1G</code>跳转至第一行,<code>G</code>跳转至最后一行.</p>
<p><code>gg</code> 跳转至第一行</p>
<p>(5) 句间移动(针对写论文之类的比较有意义)</p>
<p><code>)</code> 跳转至下一句</p>
<p><code>(</code> 跳转至上一句</p>
<p>(6) 段落间移动</p>
<p><code>}</code> 跳转至下一段落</p>
<p><code>{</code> 跳转至上一段落</p>
<h2 id="vim的编辑命令"><a class="header-anchor" href="#vim的编辑命令"></a>vim的编辑命令</h2>
<p>(1) 字符编辑操作</p>
<p><code>x</code>  删除光标所在处的字符.</p>
<p><code>#x</code> 删除光标所在处以及向后的指定个数的字符.</p>
<p><code>xp</code> <code>p</code>表示粘贴之意,把光标所在的字符与后一个字符对调.<code>to</code> --&gt; <code>ot</code></p>
<p><code>r</code> 替换光标所在处的字符.</p>
<p>(2) 删除命令</p>
<p><code>d</code>  根光标跳转结合起来使用.</p>
<p><code>d$</code> 删除光标所在处到行尾的所有字符.</p>
<p><code>d^</code> 删除光标所在处到行首的所有字符.</p>
<p><code>d0</code> 删除光标所在处到行首(绝对行首)的所有字符.</p>
<p><code>[#]dw</code> 删除光标所在处到词尾或下一个单词词尾的的字符(注意单词的界定)</p>
<p><code>[#]db</code> 删除光标所在处到词首或前一个单词的词首的字符(注意单词的界定)</p>
<p><code>[#]dd</code> 删除光标所在处的一整行的内容,<code>3dd</code>代表删除3行.</p>
<p>Note: 删除的内容会被vim编辑器保存至缓冲区当中.最近一次的删除操作还可以粘贴到某位置.</p>
<p>(3) 粘贴命令</p>
<p><code>p</code> <code>p</code>(<em>paste,put</em>), 取决于我们之前删除的是什么</p>
<p>3.1 如果此复制或删除的内容不是一个完整行.小写<code>p</code>跟大写<code>P</code>是有区别的.</p>
<p><code>p</code> 小写<code>p</code>表示把内容粘贴至当前光标所在处的后面.</p>
<p><code>P</code> 大写<code>P</code>表示把内容粘贴至当前光标所在处的前面.</p>
<p>3.2 如果此复制或删除的内容是一个完整行(可不止一行)</p>
<p><code>p</code> 小写<code>p</code>表示把内容粘贴至当前光标所在行的下方.</p>
<p><code>P</code> 大写<code>P</code>表示把内容粘贴至当前光标所在行的上方.</p>
<p>(4) 复制命令</p>
<p><code>y</code> <em>yank</em>跟<code>d</code>用法一样<code>y$, y0, y^, 3y, yw, yb, ye, yy</code></p>
<p><code>[#]yy</code> 复制整行, <code>3yy</code>复制3行.</p>
<p>(5) 改变命令</p>
<p><code>c</code> <em>change</em>, 删除一部分内容后并立即从编辑模式切换到输入模式.</p>
<p><code>c$, c^, c0, cw, cb, ce, cc</code></p>
<p><code>[#]cc</code> 删除整行, <code>3cc</code>删除3行并立即从编辑模式切换到输入模式.</p>
<p>(6) 撤销之前的操作</p>
<p><code>u</code> <em>undo</em> 撤销此前的编辑操作</p>
<p><code>#u</code> 撤销此前的<code>#</code>次操作</p>
<p>(7) 恢复此前的撤销操作</p>
<p><code>ctrl+r</code></p>
<p><code>.</code> 重复前一个编辑操作</p>
<p>(8) 翻屏操作</p>
<p><code>ctrl+f</code> 向后翻一屏</p>
<p><code>ctrl+b</code> 向前翻一屏</p>
<p><code>ctrl+d</code> 向后半屏</p>
<p><code>ctrl+d</code> 向前半屏</p>
<p>vim内建教程,<code>vimtutor</code></p>
<h2 id="vim的末行模式"><a class="header-anchor" href="#vim的末行模式"></a>vim的末行模式(<code>:</code>)</h2>
<p>(1) 地址,定界</p>
<p><code>:start_pos, end_pos</code></p>
<p><code>:#</code> 就是第<code>#</code>行</p>
<p><code>.</code> 表示当前行</p>
<p><code>$</code> 表示最后一行</p>
<p><code>%</code> 表示全文,相当于<code>1,$</code></p>
<p><code>/pattern/</code>表示第一次被正则匹配到的行.</p>
<p><code>:#, #</code></p>
<p><code>1,10</code> 表示第一行到第十行(绝对地址定界+绝对地址定界的方式).</p>
<p><code>1,+3</code>表示第一行到第一行再向下三行,一共四行(绝对地址定界+相对地址定界的方式).</p>
<p><code>. $-1</code> 当前行到导出第二行.</p>
<p><code>/patern1/,/pattern2/</code> 从第一次匹配到<em>pattern1</em>的行到第一次匹配到<em>pattern2</em>的行结束.</p>
<p><code>#,/pattern2/</code> 从<code>#</code>行到第一次匹配到<em>pattern1</em>的行结束.</p>
<p><em>NOTE:</em> 上面的命令后面都可以跟一个编辑命令.<code>d, y, w</code></p>
<p><code>:1,100w /tmp/a.txt</code> 把文件的第1到100行保存到<code>/tmp/a.txt</code>文件中.</p>
<p><code>:[#]r /etc/fstab</code> 在<code>#</code>行后面读入<code>/etc/tstab</code>文件中的内容.直接插入到当前文件中.</p>
<p>(2) 查找功能</p>
<p><code>/PATTERN</code> 从当前光标位置向尾部查找</p>
<p><code>?PATTERN</code> 从当前光标位置向首部查找</p>
<p><em>NOTE:</em> 快速找到下一个 <code>n</code>表示与命令同方向, <code>N</code>表示与命令反方向</p>
<p>(3) 查找替换功能</p>
<p><code>s</code> <em>substitute</em> 在末行模式下,在地址定界的范围内完成查找替换操作.</p>
<p><code>s/要查早的内容/替换为的内容/修饰符</code></p>
<p>要查找的内容: 可使用模式</p>
<p>替换为的内容: 不能使用模式,但可以使用后向引用符号,以引用前面模式中的分组括号所匹配到的内容.<code>\1, \2, &amp;</code>.<code>&amp;</code>引用&quot;要查找内容&quot;.</p>
<p>修饰符: <code>i</code> 忽略大小写, <code>g</code> 全局替换(不加<code>g</code>的效果如果一行当中有多个匹配, 只把每一行的第一次匹配替换).</p>
<p><code>/</code> 用于分隔符, 所以,要查找的内容或替换为的内容中出现此符合,需要使用<code>\</code>对其转义.<code>\/</code></p>
<p><em>NOTE:</em> 分隔符可替换为其他字符, <code>@, #</code>, <em>eg</em> <code>%s@/dev/mapper@/etc/fstab@g</code></p>
<h2 id="vim多文件模式"><a class="header-anchor" href="#vim多文件模式"></a>vim多文件模式</h2>
<p>(1) <code>vim file...</code>默认打开第一个文件</p>
<ul>
<li><code>:next</code>  进入下一个文件</li>
<li><code>:prev</code>  进入上一个文件</li>
<li><code>:first</code> 进入第一个文件</li>
<li><code>:last</code>  进入最后一个文件</li>
<li><code>:wqall</code> 保存并退出所有文件</li>
<li><code>:q!all</code> 所有都不保存退出</li>
</ul>
<p>(2) <code>vim -o file...</code> 几个文件就打开几个窗口.横排</p>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-30/vim-multi-window.png" alt="vim-multi-window"></p>
<p>(3) <code>vim -O file...</code> 几个文件就打开几个窗口.竖排</p>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-30/vim-multi-window-v.png" alt="vim-multi-window-v"></p>
<p>(4) <code>ctrl + w, ARROW</code> 先按<code>ctrl+w</code>松开在按<code>s</code>切换窗口.</p>
<h2 id="vim多文件窗口分隔"><a class="header-anchor" href="#vim多文件窗口分隔"></a>vim多文件窗口分隔</h2>
<p><code>vim [-o|O] files...</code>, <code>Ctrl+w, ARROW</code> 切换窗口</p>
<p>单文件窗口分隔</p>
<p><code>Ctrl+w, s</code> <em>split</em> 水平分隔</p>
<p><code>Ctrl+w, v</code> <em>vertical</em> 垂直分隔</p>
<h2 id="定制vim的工作特性"><a class="header-anchor" href="#定制vim的工作特性"></a>定制vim的工作特性</h2>
<ul>
<li><code>set nu|nonu</code> 行号</li>
<li><code>set sm|nosm</code> 括号匹配</li>
<li><code>set ai|noai</code> 自动缩进</li>
<li><code>set hlsearch|nohlsearch</code> 高亮搜索</li>
<li><code>syntax on|off</code> 语法着色</li>
<li><code>set ic|noic</code>  忽略大小写</li>
<li><code>help SUBJECT</code> 获取帮助信息</li>
</ul>
<h2 id="vim的配置文件"><a class="header-anchor" href="#vim的配置文件"></a>vim的配置文件</h2>
<ul>
<li><code>/etc/vimrc</code> 全局配置文件：</li>
<li><code>~/.vimrc</code>   用户个人的配置文件：</li>
</ul>
<h2 id="实践"><a class="header-anchor" href="#实践"></a>实践</h2>
<h3 id="1-复制-etc-grub2-cfg配置文件至-tmp目录-用查找替换命令删除-tmp-grub2-cfg文件中的行首的空白字符"><a class="header-anchor" href="#1-复制-etc-grub2-cfg配置文件至-tmp目录-用查找替换命令删除-tmp-grub2-cfg文件中的行首的空白字符"></a>1. 复制/etc/grub2.cfg配置文件至/tmp目录，用查找替换命令删除/tmp/grub2.cfg文件中的行首的空白字符</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">$  cp /etc/grub2.cfg /tmp</span><br><span class="line">$  vim grub2.cfg</span><br><span class="line">$  :%s/^[[:space:]]\+//</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#DO NOT EDIT THIS FILE</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#It is automatically generated by grub2-mkconfig using templates</span></span><br><span class="line"><span class="comment">#from /etc/grub.d and settings from /etc/default/grub</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###BEGIN /etc/grub.d/00_header ###</span></span><br><span class="line">setpager=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>[ <span class="operator">-s</span> <span class="variable">$prefix</span>/grubenv ]; <span class="keyword">then</span></span><br><span class="line">load_env</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span>[ <span class="string">"<span class="variable">$&#123;next_entry&#125;</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">set</span> default=<span class="string">"<span class="variable">$&#123;next_entry&#125;</span>"</span></span><br><span class="line"><span class="built_in">set</span> next_entry=</span><br><span class="line">save_env next_entry</span><br><span class="line"><span class="built_in">set</span> boot_once=<span class="literal">true</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">set</span> default=<span class="string">"<span class="variable">$&#123;saved_entry&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>[ x<span class="string">"<span class="variable">$&#123;feature_menuentry_id&#125;</span>"</span> = xy ]; <span class="keyword">then</span></span><br><span class="line">menuentry_id_option=<span class="string">"--id"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">menuentry_id_option=<span class="string">""</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-复制-etc-rc-d-init-d-functions文件至-tmp目录-用查找替换命令为-tmp-functions的每行开头为空白字符的行的行首加一个-原有空白字符保留"><a class="header-anchor" href="#2-复制-etc-rc-d-init-d-functions文件至-tmp目录-用查找替换命令为-tmp-functions的每行开头为空白字符的行的行首加一个-原有空白字符保留"></a>2. 复制<code>/etc/rc.d/init.d/functions</code>文件至<code>/tmp</code>目录，用查找替换命令为<code>/tmp/functions</code>的每行开头为空白字符的行的行首加一个#; 原有空白字符保留</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ cp /etc/rc.d/init.d/<span class="built_in">functions</span> /tmp</span><br><span class="line">$ vim <span class="built_in">functions</span></span><br><span class="line">$ :%s/^[[:space:]]\+/<span class="comment">#&amp;/</span></span><br><span class="line"><span class="comment"># -*-Shell-script-*-</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># functions This file contains functions to be used by most or all</span></span><br><span class="line"><span class="comment">#       shell scripts in the /etc/init.d directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">TEXTDOMAIN=initscripts</span><br><span class="line"></span><br><span class="line"><span class="comment"># Make sure umask is sane</span></span><br><span class="line"><span class="built_in">umask</span> <span class="number">022</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up a default search path.</span></span><br><span class="line">PATH=<span class="string">"/sbin:/usr/sbin:/bin:/usr/bin"</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">systemctl_redirect</span></span> () &#123;</span><br><span class="line"><span class="comment">#   local s</span></span><br><span class="line"><span class="comment">#   local prog=$&#123;1##*/&#125;</span></span><br><span class="line"><span class="comment">#        local command=$2</span></span><br><span class="line"><span class="comment">#        local options=""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#   case "$command" in</span></span><br><span class="line"><span class="comment">#   start)</span></span><br><span class="line"><span class="comment">#       s=$"Starting $pro</span></span><br></pre></td></tr></table></figure>
<h3 id="3-替换-tmp-functions文件中的-etc-sysconfig-init为-var-log"><a class="header-anchor" href="#3-替换-tmp-functions文件中的-etc-sysconfig-init为-var-log"></a>3. 替换/tmp/functions文件中的/etc/sysconfig/init为/var/log</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ vim <span class="built_in">functions</span></span><br><span class="line">$ /\/etc\/sysconfig\/init</span><br><span class="line"><span class="comment"># Read in our configuration</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$&#123;BOOTUP:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="operator">-f</span> /etc/sysconfig/init ]; <span class="keyword">then</span></span><br><span class="line">      . /etc/sysconfig/init</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># This all seem confusing? Look in /etc/sysconfig/init,</span></span><br><span class="line">    <span class="comment"># or in /usr/share/doc/initscripts-*/sysconfig.txt</span></span><br><span class="line">    BOOTUP=color</span><br><span class="line">    RES_COL=<span class="number">60</span></span><br><span class="line">    MOVE_TO_COL=<span class="string">"echo -en \\033[<span class="variable">$&#123;RES_COL&#125;</span>G"</span></span><br><span class="line">    SETCOLOR_SUCCESS=<span class="string">"echo -en \\033[1;32m"</span></span><br><span class="line">    SETCOLOR_FAILURE=<span class="string">"echo -en \\033[1;31m"</span></span><br><span class="line">    SETCOLOR_WARNING=<span class="string">"echo -en \\033[1;33m"</span></span><br><span class="line">    SETCOLOR_NORMAL=<span class="string">"echo -en \\033[0;39m"</span></span><br><span class="line">    LOGLEVEL=<span class="number">1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">$ :%s@/etc/sysconfig/init@/var/<span class="built_in">log</span>@g</span><br><span class="line"><span class="comment"># Read in our configuration</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$&#123;BOOTUP:-&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="operator">-f</span> /var/<span class="built_in">log</span> ]; <span class="keyword">then</span></span><br><span class="line">      . /var/<span class="built_in">log</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># This all seem confusing? Look in /var/log,</span></span><br><span class="line">    <span class="comment"># or in /usr/share/doc/initscripts-*/sysconfig.txt</span></span><br><span class="line">    BOOTUP=color</span><br><span class="line">    RES_COL=<span class="number">60</span></span><br><span class="line">    MOVE_TO_COL=<span class="string">"echo -en \\033[<span class="variable">$&#123;RES_COL&#125;</span>G"</span></span><br><span class="line">    SETCOLOR_SUCCESS=<span class="string">"echo -en \\033[1;32m"</span></span><br><span class="line">    SETCOLOR_FAILURE=<span class="string">"echo -en \\033[1;31m"</span></span><br><span class="line">    SETCOLOR_WARNING=<span class="string">"echo -en \\033[1;33m"</span></span><br><span class="line">    SETCOLOR_NORMAL=<span class="string">"echo -en \\033[0;39m"</span></span><br><span class="line">    LOGLEVEL=<span class="number">1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="4-删除-tmp-functions文件中所以-开头-且-后面至少跟了一个空白字符的行的行首-例2的反向操作"><a class="header-anchor" href="#4-删除-tmp-functions文件中所以-开头-且-后面至少跟了一个空白字符的行的行首-例2的反向操作"></a>4. 删除/tmp/functions文件中所以#开头，且#后面至少跟了一个空白字符的行的行首#. 例2的反向操作.</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">$ vim <span class="built_in">functions</span></span><br><span class="line">$ :%s/^<span class="comment">#\([[:space:]]\+\)/\1/</span></span><br><span class="line">$ cp /etc/rc.d/init.d/<span class="built_in">functions</span> /tmp</span><br><span class="line">$ vim <span class="built_in">functions</span></span><br><span class="line">$ :%s/^[[:space:]]\+/<span class="comment">#&amp;/</span></span><br><span class="line"> -*-Shell-script-*-</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"> <span class="built_in">functions</span> This file contains <span class="built_in">functions</span> to be used by most or all</span><br><span class="line">       shell scripts <span class="keyword">in</span> the /etc/init.d directory.</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">TEXTDOMAIN=initscripts</span><br><span class="line"></span><br><span class="line"> Make sure <span class="built_in">umask</span> is sane</span><br><span class="line"><span class="built_in">umask</span> <span class="number">022</span></span><br><span class="line"></span><br><span class="line"> Set up a default search path.</span><br><span class="line">PATH=<span class="string">"/sbin:/usr/sbin:/bin:/usr/bin"</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">systemctl_redirect</span></span> () &#123;</span><br><span class="line">   <span class="built_in">local</span> s</span><br><span class="line">   <span class="built_in">local</span> prog=<span class="variable">$&#123;1##*/&#125;</span></span><br><span class="line">        <span class="built_in">local</span> <span class="built_in">command</span>=<span class="variable">$2</span></span><br><span class="line">        <span class="built_in">local</span> options=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">case</span> <span class="string">"<span class="variable">$command</span>"</span> <span class="keyword">in</span></span><br><span class="line">   start)</span><br><span class="line">       s=$<span class="string">"Starting <span class="variable">$pro</span></span></span><br></pre></td></tr></table></figure>
<h2 id="文件查找"><a class="header-anchor" href="#文件查找"></a>文件查找</h2>
<p>在文件系统上查找符合条件的文件的过程</p>
<h2 id="文件查找命令locate-find"><a class="header-anchor" href="#文件查找命令locate-find"></a>文件查找命令<code>locate, find</code></h2>
<ul>
<li><code>locate</code> 非实时查找工具；依赖于事先构建的索引；索引的构建是在系统较为空闲时自动进行(周期性任务)；手动更新此数据库(<code>updatedb</code>)；查找速度快；模糊查找；</li>
<li><code>find</code> 实时查找；查找速度略慢；精确查找；</li>
</ul>
<h2 id="文件类型"><a class="header-anchor" href="#文件类型"></a>文件类型</h2>
<ul>
<li><code>f</code> 普通文件</li>
<li><code>d</code> 目录</li>
<li><code>l</code> 符号链接</li>
<li><code>b</code> 块设备</li>
<li><code>c</code> 字符设备</li>
<li><code>p</code> 命名管道</li>
<li><code>s</code> 套接字</li>
</ul>
<h2 id="find"><a class="header-anchor" href="#find"></a>find</h2>
<h3 id="语法"><a class="header-anchor" href="#语法"></a>语法</h3>
<p><code>find [OPTION] [path...] [condition] [action]</code></p>
<p><code>path</code> 不指定默认为当前路径.</p>
<p><code>condition</code> 指定查找的标准,可以根据文件名,大小,属组,属主,类型等进行,默认为指定路径下的所有文件.</p>
<p><code>action</code> 对符合条件的文件做什么操作,默认为输出至屏幕.</p>
<h3 id="查找条件"><a class="header-anchor" href="#查找条件"></a>查找条件</h3>
<ul>
<li><code>-name &quot;filename&quot;</code>    <code>filename</code>支持<code>glob</code>.</li>
<li><code>-iname &quot;filename&quot;</code>   <code>filename</code>,不区分字符大小写,支持<code>glob</code>.</li>
<li><code>-regex &quot;PATTERN&quot;</code>    以<code>PATTERN</code>匹配整个文件路径字符串,而不仅仅是文件名称.</li>
<li><code>-user USERNAME</code>      查找指定用户的文件.</li>
<li><code>-group GROUPNAME</code>    查找指定属组的文件.</li>
<li><code>-uid UID</code>            查找文件的属主指定<code>uid</code>的文件.</li>
<li><code>-uid GroupID</code>        查找文件的属主指定<code>gid</code>的文件.</li>
<li><code>-nouser</code>             查找没有属主的文件.</li>
<li><code>-nogroup</code>            查找没有属组的文件.</li>
<li><code>-type TYPE</code>          查找指定文件类型的文件</li>
<li><code>-size [+|-]#UNIT</code>    根据文件大小来查找</li>
</ul>
<h3 id="根据文件权限查找"><a class="header-anchor" href="#根据文件权限查找"></a>根据文件权限查找</h3>
<ul>
<li><code>-perm [/|-]MODE</code></li>
</ul>
<h3 id="根据时间戳查找"><a class="header-anchor" href="#根据时间戳查找"></a>根据时间戳查找</h3>
<p>(1) 以天为单位</p>
<ul>
<li><code>-atime [+|-]#</code></li>
<li><code>-mtime [+|-]#</code></li>
<li><code>-ctime [+|-]#</code></li>
</ul>
<p>(2) 以分钟为单位</p>
<ul>
<li><code>-amin [+|-]#</code></li>
<li><code>-mmin [+|-]#</code></li>
<li><code>-cmin [+|-]#</code></li>
</ul>
<h3 id="组合查找条件"><a class="header-anchor" href="#组合查找条件"></a>组合查找条件</h3>
<ul>
<li><code>-a</code>      与条件</li>
<li><code>-o</code>      或条件</li>
<li><code>-not,!</code>  取反</li>
<li><code>!A -o !B = !(A -a B)</code></li>
<li><code>!A -a !B = !(A -o B)</code></li>
</ul>
<h3 id="处理动作"><a class="header-anchor" href="#处理动作"></a>处理动作</h3>
<ul>
<li><code>-print</code>  默认处理动作.</li>
<li><code>-ls</code>     类似与对查找到的每个文件做<code>ls -l</code>的操作.</li>
<li><code>-delete</code> 删除查找到的文件.</li>
<li><code>-fls /PATH/TO/SOMEFILE</code> 查找到的文件的详细路径信息保存至指定文件中.</li>
<li><code>-ok COMMAND {} \;</code>    <code>-ok</code>在执行<code>COMMAND</code>是需要确认,<code>\;</code>为固定格式.</li>
<li><code>-exec COMMAND {} \;</code>  <code>-exec</code>在执行<code>COMMAND</code>无需确认,<code>\;</code>为固定格式.</li>
</ul>
<h3 id="理解"><a class="header-anchor" href="#理解"></a>理解</h3>
<p>(1) 不加组合条件标识符,默认是与条件.</p>
<p><code>find /tmp -nouser -nogroup mygrp</code> &lt;-&gt; <code>find /tmp -nouser -a -nogroup mygrp</code></p>
<p>(2) 注意<code>-ls</code>针对的是<code>-user marion</code>,下面的命令<code>-ls</code>不会打印符合<code>-nouser</code>的信息.</p>
<p><code>find /tmp -nouser -o -user marion -ls</code> &lt;-&gt; <code>find /tmp -nouser -o -user marion -a -ls</code></p>
<p><code>find /tmp \( -nouser -o -user marion \) -ls</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">1</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">2</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">3</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">4</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">5</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">6</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">7</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">8</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span> marion marion <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> <span class="number">9</span></span><br><span class="line">-rw-r--r-- <span class="number">1</span>   <span class="number">1001</span>   <span class="number">1001</span> <span class="number">0</span> Sep <span class="number">26</span> <span class="number">19</span>:<span class="number">46</span> a.txt</span><br><span class="line"></span><br><span class="line">$ find /tmp -nouser -o -user marion -ls</span><br><span class="line"><span class="number">67151761</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">1</span></span><br><span class="line"><span class="number">69018299</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">2</span></span><br><span class="line"><span class="number">69018300</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">3</span></span><br><span class="line"><span class="number">69018301</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">4</span></span><br><span class="line"><span class="number">69018302</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">5</span></span><br><span class="line"><span class="number">69018303</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">6</span></span><br><span class="line"><span class="number">69018305</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">7</span></span><br><span class="line"><span class="number">69018306</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">8</span></span><br><span class="line"><span class="number">69018310</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">9</span></span><br><span class="line"></span><br><span class="line">$ find /tmp \( -nouser -o -user marion \) -ls <span class="comment"># 注意比较上面命令的输出</span></span><br><span class="line"><span class="number">67151717</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> <span class="number">1001</span>     <span class="number">1001</span>            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">19</span>:<span class="number">46</span> /tmp/<span class="built_in">test</span>/a.txt</span><br><span class="line"><span class="number">67151761</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">1</span></span><br><span class="line"><span class="number">69018299</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">2</span></span><br><span class="line"><span class="number">69018300</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">3</span></span><br><span class="line"><span class="number">69018301</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">4</span></span><br><span class="line"><span class="number">69018302</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">5</span></span><br><span class="line"><span class="number">69018303</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">6</span></span><br><span class="line"><span class="number">69018305</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">7</span></span><br><span class="line"><span class="number">69018306</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">8</span></span><br><span class="line"><span class="number">69018310</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> marion   marion          <span class="number">0</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">08</span> /tmp/<span class="built_in">test</span>/<span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>(3) 查找<code>/etc</code>下不以<code>.conf</code>结尾的文件.</p>
<p><code>find /etc ! -name &quot;*.conf&quot; -ls</code></p>
<p>(4) <code>#UNIT, +#UNIT, -#UNIT</code> 针对<code>-size</code></p>
<ul>
<li><code>#UNIT</code>  --&gt;  <code>(#-1, #]</code></li>
<li><code>+#UNIT</code> --&gt;  <code>(#, oo)</code></li>
<li><code>-#UNIT</code> --&gt;  <code>[0, #-1]</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc -size <span class="number">3</span>k -exec ls -lh &#123;&#125; \;</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.5</span>K Mar <span class="number">10</span>  <span class="number">2015</span> /etc/yum/yum-cron-hourly.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.5</span>K Mar <span class="number">10</span>  <span class="number">2015</span> /etc/yum/yum-cron.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.2</span>K May <span class="number">13</span> <span class="number">03</span>:<span class="number">41</span> /etc/ssh/ssh_config</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root <span class="number">2.2</span>K Jun <span class="number">24</span> <span class="number">07</span>:<span class="number">44</span> /etc/dhcp/dhclient.d/ntp.sh</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.6</span>K Sep <span class="number">19</span>  <span class="number">2014</span> /etc/rsyslog.d/gluster.conf.example</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.8</span>K Oct <span class="number">29</span>  <span class="number">2014</span> /etc/bashrc</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.5</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/dbus-<span class="number">1</span>/system.d/oddjob.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.8</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/dbus-<span class="number">1</span>/session.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">3.0</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/dbus-<span class="number">1</span>/system.conf</span><br><span class="line">-rw-------. <span class="number">1</span> root root <span class="number">2.1</span>K Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">45</span> /etc/lvm/archive/cent</span><br><span class="line"></span><br><span class="line">$ find /etc/ -size -<span class="number">3</span>k -exec ls -ldh &#123;&#125; \;</span><br><span class="line">-rw-r-----. <span class="number">1</span> root root <span class="number">1.8</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/sudo.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">2.0</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/purple/prefs.xml</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">1.5</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/numbers-dot6.tti</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">1.5</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/numbers-dot8.tti</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">1.5</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/numbers-french.tti</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">1.5</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/numbers-nemeth.tti</span><br><span class="line"></span><br><span class="line">$ find /etc/ -size +<span class="number">3</span>k -exec ls -ldh &#123;&#125; \;</span><br><span class="line">drwxr-xr-x. <span class="number">3</span> root root <span class="number">4.0</span>K Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">40</span> /etc/sane.d</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">4.1</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/artec_eplus48u.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">3.1</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/canon_dr.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">3.1</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/umax.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">3.4</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/xerox_mfp.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">7.7</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/gt68xx.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">3.8</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/mustek_pp.conf</span><br></pre></td></tr></table></figure>
<p>(4) <code>#, +#, -#</code> 针对时间选项</p>
<ul>
<li><code>#</code>  --&gt;  <code>[#, #+1)</code></li>
<li><code>+#</code> --&gt;  <code>[#+1, oo)</code></li>
<li><code>-#</code> --&gt;  <code>[0, #)</code></li>
</ul>
<p>(5) <code>MODE, /MODE, -MODE</code> 针对权限<code>-perm</code>选项</p>
<ul>
<li><code>MODE</code>  精确权限, 必须跟我们指定的权限完全一样.</li>
<li><code>/MODE</code> 任何一类对象(u,g,o)的任何一位权限符合条件即可,隐含或条件.</li>
<li><code>-MODE</code> 为每一类对象指定的每一位权限都必须存在方为符合条件,隐含与条件.</li>
</ul>
<p><em>NOTE</em>  <code>MODE</code> 中为0的为不参与匹配,也就是说,不关心此位.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ ll</span><br><span class="line">-r--r--r-- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> a</span><br><span class="line">-rw-r----- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> b</span><br><span class="line">-rw-rw---- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> c</span><br><span class="line">-rwxrwxrwx <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> d</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> e</span><br><span class="line"></span><br><span class="line">$ find -perm /<span class="number">222</span> -ls <span class="comment"># 任何一位有写权限就可以</span></span><br><span class="line"><span class="number">69018296</span>    <span class="number">0</span> drwxr-xr-x   <span class="number">2</span> root     root           <span class="number">46</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> .</span><br><span class="line"><span class="number">69018309</span>    <span class="number">0</span> -rw-r-----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./b</span><br><span class="line"><span class="number">69018311</span>    <span class="number">0</span> -rw-rw----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./c</span><br><span class="line"><span class="number">69018315</span>    <span class="number">0</span> -rwxrwxrwx   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./d</span><br><span class="line"><span class="number">69018316</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./e</span><br><span class="line"></span><br><span class="line">$ find -perm /<span class="number">200</span> -ls <span class="comment"># 必须属主能写</span></span><br><span class="line"><span class="number">69018296</span>    <span class="number">0</span> drwxr-xr-x   <span class="number">2</span> root     root           <span class="number">46</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> .</span><br><span class="line"><span class="number">69018309</span>    <span class="number">0</span> -rw-r-----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./b</span><br><span class="line"><span class="number">69018311</span>    <span class="number">0</span> -rw-rw----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./c</span><br><span class="line"><span class="number">69018315</span>    <span class="number">0</span> -rwxrwxrwx   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./d</span><br><span class="line"><span class="number">69018316</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./e</span><br><span class="line"></span><br><span class="line">$ find -perm /<span class="number">020</span> -ls <span class="comment"># 必须属组能写</span></span><br><span class="line"><span class="number">69018311</span>    <span class="number">0</span> -rw-rw----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./c</span><br><span class="line"><span class="number">69018315</span>    <span class="number">0</span> -rwxrwxrwx   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./d</span><br></pre></td></tr></table></figure>
<p>(6) <code>-exec COMMAND {} \;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ find -perm -<span class="number">222</span> -exec ls -lh &#123;&#125; \;</span><br><span class="line">-rwxrwxrwx <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./d</span><br><span class="line"></span><br><span class="line">$ find -perm -<span class="number">003</span> -exec chmod o-w &#123;&#125; \;</span><br><span class="line">-rwxrwxr-x <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> d</span><br><span class="line"></span><br><span class="line">$ find -not -perm /<span class="number">111</span> -ls <span class="comment"># 所有用户都没有执行权限</span></span><br><span class="line"><span class="number">69018308</span>    <span class="number">0</span> -r--r--r--   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./a</span><br><span class="line"><span class="number">69018309</span>    <span class="number">0</span> -rw-r-----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./b</span><br><span class="line"><span class="number">69018311</span>    <span class="number">0</span> -rw-rw----   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./c</span><br><span class="line"><span class="number">69018316</span>    <span class="number">0</span> -rw-r--r--   <span class="number">1</span> root     root            <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> ./e</span><br><span class="line"></span><br><span class="line">$ find -not -perm /<span class="number">111</span> -exec mv &#123;&#125; &#123;&#125;.old \;</span><br><span class="line">-r--r--r-- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> a.old</span><br><span class="line">-rw-r----- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> b.old</span><br><span class="line">-rw-rw---- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> c.old</span><br><span class="line">-rwxrwxr-x <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> d</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">0</span> Sep <span class="number">26</span> <span class="number">21</span>:<span class="number">15</span> e.old</span><br></pre></td></tr></table></figure>
<h2 id="find实践"><a class="header-anchor" href="#find实践"></a>find实践</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ date <span class="string">"+%F %T"</span></span><br><span class="line"><span class="number">2015</span>-<span class="number">09</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">23</span></span><br></pre></td></tr></table></figure>
<h3 id="1-查找-var目录属主为root-且属组为mail的所有文件；"><a class="header-anchor" href="#1-查找-var目录属主为root-且属组为mail的所有文件；"></a>1. 查找<code>/var</code>目录属主为<code>root</code>，且属组为mail的所有文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find /var -user root <span class="operator">-a</span> -group mail -ls</span><br><span class="line"><span class="number">100664354</span>    <span class="number">0</span> drwxrwxr-x   <span class="number">2</span> root    mail  <span class="number">42</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">10</span> /var/spool/mail</span><br></pre></td></tr></table></figure>
<h3 id="2-查找-usr目录下不属于root-bin或hadoop的所有文件；"><a class="header-anchor" href="#2-查找-usr目录下不属于root-bin或hadoop的所有文件；"></a>2. 查找<code>/usr</code>目录下不属于<code>root、bin</code>或<code>hadoop</code>的所有文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ useradd hadoop</span><br><span class="line">$ find /usr -not \( -user root -o -user bin -o -user hadoop \) -ls</span><br><span class="line"><span class="number">101</span> <span class="number">4</span>  drwx------   <span class="number">2</span> polkitd  root         <span class="number">4096</span> Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">40</span> /usr/share/polkit-<span class="number">1</span></span><br><span class="line"><span class="number">343</span> <span class="number">12</span> -rwsr-sr-x   <span class="number">1</span> abrt     abrt        <span class="number">11240</span> Jun <span class="number">11</span> <span class="number">00</span>:<span class="number">11</span> /usr/libexec/abrt-action</span><br></pre></td></tr></table></figure>
<h3 id="3-查找-etc目录下最近一周内其内容修改过-且属主不为root或hadoop的所有文件；"><a class="header-anchor" href="#3-查找-etc目录下最近一周内其内容修改过-且属主不为root或hadoop的所有文件；"></a>3. 查找<code>/etc</code>目录下最近一周内其内容修改过，且属主不为<code>root</code>或<code>hadoop</code>的所有文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc -mtime -<span class="number">7</span> <span class="operator">-a</span> -not \( -user root -o -user hadoop \) -exec ls -ld --full-time &#123;&#125; \;</span><br><span class="line">-rw-------. <span class="number">1</span> tss tss <span class="number">6411</span> <span class="number">2015</span>-<span class="number">09</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">13.944833926</span> +<span class="number">0800</span> /etc/tcsd.conf</span><br></pre></td></tr></table></figure>
<h3 id="4-查找当前系统上没有属主或属组-且最近一周内曾被访问过的所有文件；"><a class="header-anchor" href="#4-查找当前系统上没有属主或属组-且最近一周内曾被访问过的所有文件；"></a>4. 查找当前系统上没有属主或属组，且最近一周内曾被访问过的所有文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ find / -atime -<span class="number">7</span> <span class="operator">-a</span> \( -nouser -o -nogroup \) -exec ls -ld --full-time &#123;&#125; \;</span><br><span class="line">-rw-r--r-- <span class="number">1</span> <span class="number">1001</span> <span class="number">1001</span> <span class="number">0</span> <span class="number">2015</span>-<span class="number">09</span>-<span class="number">26</span> <span class="number">19</span>:<span class="number">46</span>:<span class="number">29.494863251</span> +<span class="number">0800</span> /tmp/<span class="built_in">test</span>/a.txt</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root <span class="number">1004</span> <span class="number">0</span> <span class="number">2015</span>-<span class="number">09</span>-<span class="number">26</span> <span class="number">22</span>:<span class="number">55</span>:<span class="number">24.298981485</span> +<span class="number">0800</span> /tmp/<span class="built_in">test</span>/b.txt</span><br></pre></td></tr></table></figure>
<h3 id="5-查找-etc目录下大于20k且类型为普通文件的所有文件；"><a class="header-anchor" href="#5-查找-etc目录下大于20k且类型为普通文件的所有文件；"></a>5. 查找<code>/etc</code>目录下大于<code>20k</code>且类型为普通文件的所有文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc -type f <span class="operator">-a</span> -size +<span class="number">20</span>K -exec ls -lhd &#123;&#125; \;</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">392</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/zh-tw-ucb.ctb</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">1.4</span>M Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty/zh-tw.ctb</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">22</span>K Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/brltty.conf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">21</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/postfix/access</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">22</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/postfix/header_checks</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">27</span>K Jun <span class="number">10</span>  <span class="number">2014</span> /etc/postfix/main.cf</span><br><span class="line">-rw-r--r--. <span class="number">1</span> root root <span class="number">51</span>K May <span class="number">15</span>  <span class="number">2013</span> /etc/mime.types</span><br></pre></td></tr></table></figure>
<h3 id="6-查找-etc目录下所有用户都没有写权限的文件；"><a class="header-anchor" href="#6-查找-etc目录下所有用户都没有写权限的文件；"></a>6. 查找/etc目录下所有用户都没有写权限的文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc -not -perm /<span class="number">222</span> -ls</span><br><span class="line"><span class="number">68121580</span>    <span class="number">4</span> -r--r--r--   <span class="number">1</span> root     root           <span class="number">33</span> Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">38</span> /etc/machine-id</span><br><span class="line"><span class="number">68121595</span>    <span class="number">4</span> ----------   <span class="number">1</span> root     root         <span class="number">1248</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">10</span> /etc/shadow-</span><br><span class="line"><span class="number">69018322</span>    <span class="number">4</span> ----------   <span class="number">1</span> root     root         <span class="number">1277</span> Sep <span class="number">26</span> <span class="number">22</span>:<span class="number">04</span> /etc/shadow</span><br><span class="line"><span class="number">68899018</span>    <span class="number">4</span> -r--r--r--   <span class="number">1</span> root     root          <span class="number">146</span> Jun <span class="number">18</span> <span class="number">19</span>:<span class="number">06</span> /etc/pam.d/cups</span><br><span class="line"><span class="number">67929369</span>    <span class="number">4</span> ----------   <span class="number">1</span> root     root          <span class="number">723</span> Sep <span class="number">26</span> <span class="number">20</span>:<span class="number">10</span> /etc/gshadow-</span><br><span class="line"><span class="number">67929742</span>    <span class="number">4</span> -r--------   <span class="number">1</span> root     root           <span class="number">45</span> Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">38</span> /etc/openldap/certs/password</span><br><span class="line"><span class="number">70068545</span>    <span class="number">4</span> -r--r-----   <span class="number">1</span> root     root         <span class="number">4000</span> Mar  <span class="number">6</span>  <span class="number">2015</span> /etc/sudoers</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="7-查找-etc目录下至少有一类用户没有执行权限的文件；"><a class="header-anchor" href="#7-查找-etc目录下至少有一类用户没有执行权限的文件；"></a>7. 查找/etc目录下至少有一类用户没有执行权限的文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc -not -perm -<span class="number">111</span> -ls</span><br><span class="line"><span class="number">1426363</span>     <span class="number">0</span> drwxr-x---   <span class="number">2</span> root     named           <span class="number">6</span> Sep  <span class="number">3</span> <span class="number">18</span>:<span class="number">35</span> /etc/named</span><br><span class="line"><span class="number">34652843</span>    <span class="number">0</span> drwx------   <span class="number">2</span> root     lp              <span class="number">6</span> Jun <span class="number">18</span> <span class="number">19</span>:<span class="number">06</span> /etc/cups/ssl</span><br><span class="line"><span class="number">2385651</span>     <span class="number">4</span> -rw-r--r--   <span class="number">1</span> root     root          <span class="number">984</span> Jun <span class="number">10</span>  <span class="number">2014</span> /etc/sane.d/dc210.conf</span><br></pre></td></tr></table></figure>
<h3 id="8-查找-etc-init-d目录下-所有用户都有执行权限-且其它用户拥有写权限的文件；"><a class="header-anchor" href="#8-查找-etc-init-d目录下-所有用户都有执行权限-且其它用户拥有写权限的文件；"></a>8. 查找/etc/init.d目录下，所有用户都有执行权限，且其它用户拥有写权限的文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find /etc/init.d -perm -<span class="number">111</span> <span class="operator">-a</span> -perm /<span class="number">002</span> -ls</span><br><span class="line"><span class="number">67564774</span>    <span class="number">0</span> lrwxrwxrwx   <span class="number">1</span> root     root           <span class="number">11</span> Sep <span class="number">13</span> <span class="number">05</span>:<span class="number">37</span> /etc/init.d -&gt; rc.d/init.d</span><br></pre></td></tr></table></figure>
<h2 id="bash环境配置"><a class="header-anchor" href="#bash环境配置"></a>bash环境配置</h2>
<h3 id="配置文件-生效范围划分-存在两类"><a class="header-anchor" href="#配置文件-生效范围划分-存在两类"></a>配置文件，生效范围划分，存在两类</h3>
<ul>
<li>全局配置: <code>/etc/profile, /etc/profile.d/*.sh, /etc/bashrc</code></li>
<li>个人配置: <code>~/.bash_profile, ~/.bashrc</code></li>
</ul>
<h3 id="按功能来划分-存在两类"><a class="header-anchor" href="#按功能来划分-存在两类"></a>按功能来划分,存在两类</h3>
<p>(1) <code>profile</code>类: 为交互式登陆的shell提供配置</p>
<p><code>/etc/profile, /etc/profile.d/*.sh, ~/.bash_profile</code>的作用</p>
<ol>
<li>定义环境变量,例如<code>PATH, PS1</code></li>
<li>运行命令或脚本</li>
</ol>
<p>(2) <code>bashrc</code>类:  为非交互式登陆shell提供配置</p>
<p><code>/etc/bashrc, ~/.bashrc</code>的作用</p>
<ol>
<li>定义命令别名</li>
<li>定义本地变量</li>
</ol>
<h3 id="shell的登录类型"><a class="header-anchor" href="#shell的登录类型"></a>shell的登录类型</h3>
<ul>
<li>交互式登录, (1)直接通过终端进行的登录.(2)通过<code>su -l USERNAME</code>命令实现的用户切换.</li>
<li>非交互式登录, (1)图形界面下打开的命令行窗口.(2)执行脚本时.(3)通过<code>su USERNAME</code></li>
</ul>
<h3 id="配置文件的作用次序"><a class="header-anchor" href="#配置文件的作用次序"></a>配置文件的作用次序</h3>
<p>(1) 对交互式登录来讲,配置文件读取顺序</p>
<p><code>etc/profile</code> --&gt; <code>/etc/profile.d/*.sh</code> --&gt; <code>~/.bash_profile</code> --&gt; <code>~/.bashrc</code> --&gt; <code>/etc/bashrc</code></p>
<p>(2) 对非交互式登录来讲,配置文件读取顺序</p>
<p><code>~/.bashrc</code> --&gt; <code>/etc/bashrc</code> --&gt; <code>/etc/profile.d/*.sh</code></p>
<h3 id="编辑配置文件后如何生效呢"><a class="header-anchor" href="#编辑配置文件后如何生效呢"></a>编辑配置文件后如何生效呢?</h3>
<ul>
<li>重新登录</li>
<li><code>source CONFIG</code> 让当前<code>shell</code>进程重新读取指定的配置文件.</li>
<li><code>. CONFIG</code> 注意点后面是有空格的</li>
</ul>
<h2 id="变量-内存空间-变量名"><a class="header-anchor" href="#变量-内存空间-变量名"></a>变量: 内存空间, 变量名</h2>
<h3 id="类型"><a class="header-anchor" href="#类型"></a>类型</h3>
<ul>
<li>环境变量：作用范围当前shell进程及其子进程</li>
<li>本地变量：作用范围当前shell进程</li>
<li>局部变量：作用范围仅为当前shell进程中某代码片断(通常为函数上下文)</li>
<li>位置变量：<code>$1, $2</code></li>
<li>特殊变量：<code>$?</code></li>
</ul>
<h3 id="变量定义方式"><a class="header-anchor" href="#变量定义方式"></a>变量定义方式</h3>
<ul>
<li>bash内置变量：可直接调用，内置了许多环境变量，例如PATH等</li>
<li>自定义变量 变量赋值：变量名=值</li>
</ul>
<p>(1) 定义本地变量</p>
<p><code>name=value</code>, 查看用<code>set</code></p>
<p>(2) 定义环境变量</p>
<p><code>export name=value</code></p>
<p><code>declare -x name=value</code></p>
<p>查看：<code>env, printenv, export</code></p>
<p>(3) 撤销变量 <code>unset name</code></p>
<p>(4) 引用变量 <code>${name}, $name</code></p>
<h3 id="bash弱类型"><a class="header-anchor" href="#bash弱类型"></a>bash弱类型</h3>
<p>变量存储数据时，默认均采用字符形式；任何变量可以不经声明，直接引用；</p>
<h3 id="bash中的引用符号"><a class="header-anchor" href="#bash中的引用符号"></a>bash中的引用符号</h3>
<ul>
<li><code>''</code> 强引用，变量替换不会发生</li>
<li><code>&quot;&quot;</code> 弱引用</li>
<li>``   命令引用</li>
</ul>
<h2 id="linux-文件系统的特殊权限"><a class="header-anchor" href="#linux-文件系统的特殊权限"></a>Linux 文件系统的特殊权限</h2>
<p>权限模型 <code>u, g, o</code> 每类用户有3类权限<code>r, w, x</code></p>
<h3 id="进程的安全上下文"><a class="header-anchor" href="#进程的安全上下文"></a>进程的安全上下文</h3>
<p>前提: 进程有属主(进程以哪个用户的身份运行),文件有属主和属组.</p>
<p>(1) 用户是否能够把某个可执行程序文件启动为进程, 取决于用户对程序文件是否有可执行权限.</p>
<p>(2) 程序启动为进程后, 此进程的属主为当前用户,也即进程的发起者,进程所属的组,为发起者的基本组.</p>
<p>(3) 进程拥有的权限,取决于其属主的访问权限</p>
<ul>
<li>进程的属主同文件属主, 则应用文件属主权限.</li>
<li>进程的属主, 属于文件的属组, 则应用文件属组权限.</li>
<li>否则应用其他权限</li>
</ul>
<h3 id="suid"><a class="header-anchor" href="#suid"></a>SUID</h3>
<ul>
<li>任何一个可执行程序文件能不能启动为进程,取决于发起者对程序文件是否有执行权限.</li>
<li>启动为进程之后, 其属主不是发起者, 而是程序文件自己的属主.这种机制称之为<code>SUID</code></li>
<li>权限设定: <code>chmod u+s FILE..., chmod u-s FILE...</code></li>
</ul>
<p><em>NOTE</em> 权限位有可能为大写S,也有可能为小写s</p>
<ul>
<li><code>S</code> 属主原本没有<code>x</code>权限.</li>
<li><code>s</code> 属主原本拥有<code>x</code>权限.</li>
</ul>
<h3 id="sgid"><a class="header-anchor" href="#sgid"></a>SGID</h3>
<p>默认情况下,用户创建文件时, 其属组为此用户所属的基本组,一旦某目录被设定了<code>SGID</code>权限, 则对此目录拥有写权限的用户在此目录创建的文件所属的组为目录的属组,而非用户的基本组.</p>
<p>权限设定<code>chmod g+s FILE..., chmod g-s FILE...</code></p>
<p><em>NOTE</em> 权限位有可能为大写S,也有可能为小写s</p>
<ul>
<li><code>S</code> 属主原本没有<code>x</code>权限.</li>
<li><code>s</code> 属主原本拥有<code>x</code>权限.</li>
</ul>
<h3 id="sticky"><a class="header-anchor" href="#sticky"></a>Sticky</h3>
<p>对于一个多人可写的目录, 此权限限制用户仅能删除自己的文件.</p>
<p>权限设定<code>chmod o+t FILE..., chmod o-t FILE...</code></p>
<p><em>NOTE</em> 权限位有可能为大写S,也有可能为小写s</p>
<ul>
<li><code>T</code> 属主原本没有<code>x</code>权限.</li>
<li><code>t</code> 属主原本拥有<code>x</code>权限.</li>
</ul>
<h2 id="实践-v2"><a class="header-anchor" href="#实践-v2"></a>实践</h2>
<h3 id="1-让普通用户能使用-tmp-cat去查看-etc-shadow文件；"><a class="header-anchor" href="#1-让普通用户能使用-tmp-cat去查看-etc-shadow文件；"></a>1. 让普通用户能使用/tmp/cat去查看/etc/shadow文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cp /usr/bin/cat /tmp</span><br><span class="line">$ chmod u+s /tmp/cat</span><br><span class="line">$ ll /tmp/cat</span><br><span class="line">-rwsr-xr-x <span class="number">1</span> root root <span class="number">54040</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">24</span> /tmp/cat</span><br><span class="line">$ /tmp/cat /etc/shadow</span><br><span class="line">rtkit:!!:<span class="number">16690</span>::::::</span><br><span class="line">radvd:!!:<span class="number">16690</span>::::::</span><br><span class="line">rpcuser:!!:<span class="number">16690</span>::::::</span><br><span class="line">nfsnobody:!!:<span class="number">16690</span>::::::</span><br><span class="line">qemu:!!:<span class="number">16690</span>::::::</span><br><span class="line">chrony:!!:<span class="number">16690</span>::::::</span><br><span class="line">abrt:!!:<span class="number">16690</span>::::::</span><br><span class="line">sssd:!!:<span class="number">16690</span>::::::</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="2-创建目录-test-data-让某组内普通用户对其有写权限-且创建的所有文件的属组为目录所属的组；此外-每个用户仅能删除自己的文件；"><a class="header-anchor" href="#2-创建目录-test-data-让某组内普通用户对其有写权限-且创建的所有文件的属组为目录所属的组；此外-每个用户仅能删除自己的文件；"></a>2. 创建目录/test/data，让某组内普通用户对其有写权限，且创建的所有文件的属组为目录所属的组；此外，每个用户仅能删除自己的文件；</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /<span class="built_in">test</span>/data  			<span class="comment"># 创建目录/test/data</span></span><br><span class="line"></span><br><span class="line">$ groupadd mygrp	   			<span class="comment"># 添加mygrp组</span></span><br><span class="line"></span><br><span class="line">$ usermod -G mygrp gentoo  		<span class="comment"># 修改gentoo的附加组为mygrp</span></span><br><span class="line">$ id gentoo</span><br><span class="line">uid=<span class="number">1007</span>(gentoo) gid=<span class="number">1009</span>(gentoo) groups=<span class="number">1009</span>(gentoo),<span class="number">1008</span>(mygrp)</span><br><span class="line"></span><br><span class="line">$ useradd -G mygrp centos		<span class="comment"># 添加centos用户附加组为mygrp</span></span><br><span class="line">$ id centos</span><br><span class="line">uid=<span class="number">1008</span>(centos) gid=<span class="number">1010</span>(centos) groups=<span class="number">1010</span>(centos),<span class="number">1008</span>(mygrp)</span><br><span class="line"></span><br><span class="line">$ chown :mygrp /<span class="built_in">test</span>/data   	<span class="comment"># 修改data的属组为mygrp</span></span><br><span class="line">$ ls -ld /<span class="built_in">test</span>/data/</span><br><span class="line">drwxr-xr-x <span class="number">2</span> root mygrp <span class="number">6</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">33</span> /<span class="built_in">test</span>/data/</span><br><span class="line"></span><br><span class="line">$ chmod g+w /<span class="built_in">test</span>/data 			<span class="comment"># 让某组内普通用户对其有写权限</span></span><br><span class="line">$ ls -ld /<span class="built_in">test</span>/data/</span><br><span class="line">drwxrwxr-x <span class="number">2</span> root mygrp <span class="number">6</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">33</span> /<span class="built_in">test</span>/data/</span><br><span class="line"></span><br><span class="line">$ chmod g+s /<span class="built_in">test</span>/data 			<span class="comment"># 且创建的所有文件的属组为目录所属的组</span></span><br><span class="line">$ ls -ld /<span class="built_in">test</span>/data/</span><br><span class="line">drwxrwsr-x <span class="number">2</span> root mygrp <span class="number">6</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">33</span> /<span class="built_in">test</span>/data/</span><br><span class="line"></span><br><span class="line">$ chmod o+t /<span class="built_in">test</span>/data 			<span class="comment"># 每个用户仅能删除自己的文件</span></span><br><span class="line">$ ls -ld /<span class="built_in">test</span>/data/</span><br><span class="line">drwxrwsr-t <span class="number">2</span> root mygrp <span class="number">6</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">33</span> /<span class="built_in">test</span>/data/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用gentoo用户操作</span></span><br><span class="line">$ su - gentoo</span><br><span class="line">$ touch /<span class="built_in">test</span>/data/gentoo.a</span><br><span class="line">$ ll /<span class="built_in">test</span>/data/</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> centos mygrp <span class="number">0</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">42</span> centos.a</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> gentoo mygrp <span class="number">0</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">41</span> gentoo.a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用gentoo用户删除centos用户创建的centos.a</span></span><br><span class="line">$ rm <span class="operator">-f</span> /<span class="built_in">test</span>/data/centos.a</span><br><span class="line">rm: cannot remove ‘/<span class="built_in">test</span>/data/centos.a’: Operation not permitted</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用centos用户操作</span></span><br><span class="line">$ su - centos</span><br><span class="line">$ touch /<span class="built_in">test</span>/data/centos.a</span><br><span class="line">$ ll /<span class="built_in">test</span>/data/</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> centos mygrp <span class="number">0</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">42</span> centos.a</span><br><span class="line">-rw-rw-r-- <span class="number">1</span> gentoo mygrp <span class="number">0</span> Sep <span class="number">27</span> <span class="number">21</span>:<span class="number">41</span> gentoo.a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用centos用户删除gentoo用户创建的gentoo.a</span></span><br><span class="line">$ rm <span class="operator">-f</span> /<span class="built_in">test</span>/data/gentoo.a</span><br><span class="line">rm: cannot remove ‘/<span class="built_in">test</span>/data/gentoo.a’: Operation not permitted</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>Vim是一个类似于Vi的著名的功能强大、高度可定制的文本编辑器，在Vi的基础上改进和增加了很多特性。VIM是纯粹的自由软件。Vim普遍被推崇为类Vi编辑器中最好的一个，事实上真正的劲敌来自Emacs的不同变体。1999 年Emacs被选为Linuxworld文本编辑分类的优胜者，Vim屈居第二。但在2000年2月Vim赢得了Slashdot Beanie的最佳开放源代码文本编辑器大奖，又将Emacs推至二线， 总的来看， Vim和Emacs同样都是非常优秀的文本编辑器。</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-17]]></title>
    <link href="http://molloc.me/2015/09/21/ZY-2015-09-17/"/>
    <id>http://molloc.me/2015/09/21/ZY-2015-09-17/</id>
    <published>2015-09-21T13:59:43.000Z</published>
    <updated>2015-09-26T01:30:43.100Z</updated>
    <content type="html"><![CDATA[<p>Linux进程查看与管理</p>
<p>OS的基本功能：文件系统、网络功能、进程管理、内存管理、驱动程序、安全功能</p>
<p>OS提供虚拟的计算机，进而能够将有限资源借助于“保护”机制分配多个同时运行的程序，即“进程”使用，从而实现了所谓的多任务；</p>
<p>Linux进程查看及管理工具</p>
<p><code>top, pstree, ps, pidof, pgrep, pkill, htop, glances, pmap, vmstat, dstat, iostat, sar, kill, job, bg, fg</code></p>
<p>程序=指令+数据</p>
<a id="more"></a>
<h2 id="进程管理与查看"><a class="header-anchor" href="#进程管理与查看"></a>进程管理与查看</h2>
<h3 id="cpu"><a class="header-anchor" href="#cpu"></a>CPU</h3>
<ul>
<li>特权指令</li>
<li>普通指令</li>
</ul>
<h3 id="程序的执行环境"><a class="header-anchor" href="#程序的执行环境"></a>程序的执行环境</h3>
<ul>
<li>内核模式: 运行内核级命令</li>
<li>用户模式: 运行普通指令</li>
</ul>
<h3 id="应用程序"><a class="header-anchor" href="#应用程序"></a>应用程序</h3>
<ul>
<li>运行普通指令: 直接运行于CPU</li>
<li>运行特权指令: 通过<code>system call</code></li>
</ul>
<p>进程就是运行中的程序,进程需要运行在一个所谓的内存空间中(指令+数据),这个内存空间是由物理内存映射而形成的逻辑地址空间.</p>
<p>对于<code>32bit</code>的主机来讲,他的寻址能力大概是</p>
<p><code>2^32, 0-2^32-1, 2^10*2^10*2^10*2^2 bytes = 2^10*2^10*2^2 kilo bytes = 2^10*2^2 MB = 4GB</code></p>
<p>对于<code>64bit</code>的主机来讲, <code>2^64, 4billions 4G</code></p>
<h3 id="进程的创建"><a class="header-anchor" href="#进程的创建"></a>进程的创建</h3>
<ol>
<li>请求发出者 --&gt; 进程：<code>fork(), clone()</code></li>
<li>COW: Copy On Writing 写时复制</li>
</ol>
<p>在Linux上,每一个进程都是由其父进程<code>fork()</code>而来,属系统调用.</p>
<p><code>parent --&gt; fork() --&gt; child</code></p>
<p>CoW(Copy on Write)机制,当父进程或子进程需要修改数据的时候.</p>
<p>Task Struct(保存了进程自己的元数据), 内核为每一个进程创建一个Task Struct,以实现内核中进程的追踪.</p>
<p>当只有一颗CPU的时候,某一个时刻只能有一个进程在运行,其他进程就处于等待,此时就需要进程间切换.</p>
<p>进程的上下文切换(Context Switch),上下文切换的时候,每个进程退出之前(还没执行完,比如有50个指令只执行了30个,此时处于挂起状态)都会找一个位置把自己的中间状态保存下来.这个位置就存在自己的内核中追踪的Task Struct当中.当再次运行的时候,就会从上次终止的地方开始执行.</p>
<h3 id="进程调度"><a class="header-anchor" href="#进程调度"></a>进程调度</h3>
<p>多任务：多进程同时运行, 抢占式多任务</p>
<h3 id="进程分类"><a class="header-anchor" href="#进程分类"></a>进程分类</h3>
<ul>
<li>CPU bound: CPU密集型(eg: 高清视频播放器)</li>
<li>I/O bound: IO密集型 (eg: 文本编辑器)</li>
</ul>
<h3 id="进程优先级"><a class="header-anchor" href="#进程优先级"></a>进程优先级</h3>
<ul>
<li>1-99：实时优先级，数字越大优先级越高</li>
<li>100-139：数字越小，优先级越高；
<ul>
<li>静态优先级</li>
<li>动态优先级</li>
</ul>
</li>
</ul>
<p>Linux 准备了140个队列,一个队列对应一个优先级</p>
<h3 id="进程的状态"><a class="header-anchor" href="#进程的状态"></a>进程的状态</h3>
<ul>
<li>running           运行态</li>
<li>sleeping          睡眠态</li>
<li>interruptible     可中断睡眠</li>
<li>uninterruptible   不可中断睡眠,被IO阻塞的进程</li>
<li>runnable          就绪态</li>
<li>stopped           停止态,不可被调度为运行状态；</li>
<li>zombie            僵死态(子进程还没有终止而父进程意外终止,成为一个orphan)</li>
</ul>
<p>CPU并行扩展机制(多核),现在程序开发时,为了提升程序运行的性能,都把程序开发为多线程,称为并发编程模型.</p>
<h3 id="进程管理"><a class="header-anchor" href="#进程管理"></a>进程管理</h3>
<ul>
<li>task struct: 用于保存每个进程元数据信息.例如：pid, ppid, memory, thread, files</li>
<li>task list: 用一种称作“链表”的数据结构来保存每个进程的task struct</li>
</ul>
<h3 id="进程切换-context-switch"><a class="header-anchor" href="#进程切换-context-switch"></a>进程切换(context switch)</h3>
<ul>
<li>保存现场</li>
<li>恢复现场</li>
</ul>
<h3 id="线程：tread"><a class="header-anchor" href="#线程：tread"></a>线程：tread</h3>
<ul>
<li>共享进程的资源，如打开文件等；</li>
<li>更轻量的、可被单独调度的运行单元</li>
</ul>
<p>LWP：Light Weight Process</p>
<p>Linux系统上除init以外的所有子进程，都是由其父进程<code>fork()</code>自身而来，遵循COW机制；进程展现为&quot;进程树&quot;</p>
<h3 id="ipc-进程间通信-常见的形式"><a class="header-anchor" href="#ipc-进程间通信-常见的形式"></a>IPC: 进程间通信,常见的形式</h3>
<ul>
<li>message queue 消息队列</li>
<li>semerphore 信号量,它负责协调各个线程, 以保证它们能够正确、合理的使用公共资源。</li>
<li>shared memory 共享内存</li>
<li>signal</li>
</ul>
<h3 id="signal-传递给进程的短小信息"><a class="header-anchor" href="#signal-传递给进程的短小信息"></a>signal: 传递给进程的短小信息</h3>
<p>Linux主机支持的进程间可用到的信息</p>
<ol>
<li>kill -l</li>
<li>man 7 signal</li>
</ol>
<p>信号表示方式</p>
<ul>
<li>完整名称，例如SIGINT</li>
<li>简写名称，例如INT</li>
<li>数据代称，例如2</li>
</ul>
<p>常用信号：</p>
<ul>
<li><code>SIGHUP: 1</code> 通知进程重读其配置文件以让新的配置生效，但不用重新启动进程；</li>
<li><code>SIGINT： 2</code> 打断正在运行中的进程，相当于键盘组合键Ctrl+c</li>
<li><code>SIGKILL： 9</code> 强行中止正在运行中的进程</li>
<li><code>SIGTERM： 15</code> 安全中止正在运行中的进程</li>
<li><code>SIGSTOP： 19</code> 暂停进程</li>
<li><code>SIGCONT： 18</code> 继续运行指定进程</li>
</ul>
<p>命令总结：<code>htop, vmstat, glances, dstat, kill, killall, sar, iostat, ifstat, tsar</code></p>
<h3 id="作业管理："><a class="header-anchor" href="#作业管理："></a>作业管理：</h3>
<ul>
<li>前台作业：通过终端启动，并且在停止之前也会一直占据终端；</li>
<li>后台作业：作业启动之时与终端无关，或者是在前台启动，但启动后转为与终端无关模式运行；</li>
</ul>
<h3 id="如何让作业运行于后台？"><a class="header-anchor" href="#如何让作业运行于后台？"></a>如何让作业运行于后台？</h3>
<ol>
<li>对于已经启动并处于运行中的作业：</li>
</ol>
<p><code>Ctrl+z</code></p>
<p>Note: 作业被送往后台后，默认处于stopped状态；</p>
<ol start="2">
<li>对于尚未启动的作业：</li>
</ol>
<p><code>COMMAND &amp;</code></p>
<p>注意: 此两类方式相关作业，仍然与终端相关；这意味着，终端终止，将会导致与此终端相关的所有作业被终止；</p>
<p>剥离进程与终端的关系：<code># nohup COMMAND &amp;</code>, 意味着跟session leader相分离了.</p>
<h3 id="作业查看："><a class="header-anchor" href="#作业查看："></a>作业查看：</h3>
<p>jobs命令, 作业号、作业状态、启动命令行程序</p>
<h3 id="作业控制命令："><a class="header-anchor" href="#作业控制命令："></a>作业控制命令：</h3>
<ul>
<li>fg [[%]job_num]：把指定的作业调回前台；</li>
<li>bg [[%]job_num]：把调往后台的指定的作业启动起来，让其后台默默运行；但此作业必须支持运行于后台；</li>
<li>kill [%job_num]：终止指定的作业；其中的%不可以省略.</li>
</ul>
<h3 id="进程优先级调整："><a class="header-anchor" href="#进程优先级调整："></a>进程优先级调整：</h3>
<h4 id="实时优先级1-99-数字越大优先级越高"><a class="header-anchor" href="#实时优先级1-99-数字越大优先级越高"></a>实时优先级1-99,数字越大优先级越高.</h4>
<h4 id="静态优先级100-139：通过指定进程的nice值来调整其优先级；用户-空间运行的进程一般都有其nice值；默认启动进程时-其nice值为0-其优先级为120；"><a class="header-anchor" href="#静态优先级100-139：通过指定进程的nice值来调整其优先级；用户-空间运行的进程一般都有其nice值；默认启动进程时-其nice值为0-其优先级为120；"></a>静态优先级100-139：通过指定进程的nice值来调整其优先级；用户 空间运行的进程一般都有其nice值；默认启动进程时，其nice值为0, 其优先级为120；</h4>
<ul>
<li>nice值：  -20, 19</li>
<li>优先级：  100, 139(数字越小优先级越高)</li>
</ul>
<h2 id="command"><a class="header-anchor" href="#command"></a>COMMAND</h2>
<h3 id="pstree"><a class="header-anchor" href="#pstree"></a>pstree</h3>
<p><strong>查看进程树</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ pstree</span><br><span class="line">	-p <span class="comment"># 显示各进程的PID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exercise</span></span><br><span class="line">$ pstree</span><br><span class="line">systemd─┬─ModemManager───<span class="number">2</span>*[&#123;ModemManager&#125;]</span><br><span class="line">        ├─NetworkManager───<span class="number">3</span>*[&#123;NetworkManager&#125;]</span><br><span class="line">        ├─<span class="number">2</span>*[abrt-watch-log]</span><br><span class="line">        ├─abrtd</span><br><span class="line">        ├─agetty</span><br><span class="line">        ├─alsactl</span><br><span class="line">        ├─atd</span><br><span class="line">        ├─auditd─┬─audispd─┬─sedispatch</span><br><span class="line">        │        │         └─&#123;audispd&#125;</span><br><span class="line">        │        └─&#123;auditd&#125;</span><br><span class="line">        ├─avahi-daemon───avahi-daemon</span><br><span class="line">        ├─chronyd</span><br><span class="line">        ├─crond</span><br><span class="line">        ├─dbus-daemon</span><br><span class="line">        ├─irqbalance</span><br><span class="line">        ├─ksmtuned───sleep</span><br><span class="line">        ├─libvirtd───<span class="number">10</span>*[&#123;libvirtd&#125;]</span><br><span class="line">        ├─lsmd</span><br><span class="line">        ├─lvmetad</span><br><span class="line">        ├─master─┬─pickup</span><br><span class="line">        │        └─qmgr</span><br><span class="line">        ├─polkitd───<span class="number">5</span>*[&#123;polkitd&#125;]</span><br><span class="line">        ├─rngd</span><br><span class="line">        ├─rsyslogd───<span class="number">2</span>*[&#123;rsyslogd&#125;]</span><br><span class="line">        ├─smartd</span><br><span class="line">        ├─sshd─┬─sshd───bash───man───less</span><br><span class="line">        │      └─sshd───bash───pstree</span><br><span class="line">        ├─systemd-journal</span><br><span class="line">        ├─systemd-logind</span><br><span class="line">        ├─systemd-udevd</span><br><span class="line">        ├─tuned───<span class="number">4</span>*[&#123;tuned&#125;]</span><br><span class="line">        └─vmtoolsd───&#123;vmtoolsd&#125;</span><br><span class="line"></span><br><span class="line">$ pstree -p</span><br><span class="line">systemd(<span class="number">1</span>)─┬─ModemManager(<span class="number">939</span>)─┬─&#123;ModemManager&#125;(<span class="number">965</span>)</span><br><span class="line">           │                   └─&#123;ModemManager&#125;(<span class="number">973</span>)</span><br><span class="line">           ├─NetworkManager(<span class="number">932</span>)─┬─&#123;NetworkManager&#125;(<span class="number">976</span>)</span><br><span class="line">           │                     ├─&#123;NetworkManager&#125;(<span class="number">991</span>)</span><br><span class="line">           │                     └─&#123;NetworkManager&#125;(<span class="number">992</span>)</span><br><span class="line">           ├─abrt-watch-log(<span class="number">927</span>)</span><br><span class="line">           ├─abrt-watch-log(<span class="number">928</span>)</span><br><span class="line">           ├─abrtd(<span class="number">925</span>)</span><br><span class="line">           ├─agetty(<span class="number">1239</span>)</span><br><span class="line">           ├─alsactl(<span class="number">918</span>)</span><br><span class="line">           ├─atd(<span class="number">1233</span>)</span><br><span class="line">           ├─auditd(<span class="number">894</span>)─┬─audispd(<span class="number">905</span>)─┬─sedispatch(<span class="number">909</span>)</span><br><span class="line">           │             │              └─&#123;audispd&#125;(<span class="number">910</span>)</span><br><span class="line">           │             └─&#123;auditd&#125;(<span class="number">904</span>)</span><br><span class="line">           ├─avahi-daemon(<span class="number">942</span>)───avahi-daemon(<span class="number">962</span>)</span><br><span class="line">           ├─chronyd(<span class="number">936</span>)</span><br><span class="line">           ├─crond(<span class="number">1231</span>)</span><br><span class="line">           ├─dbus-daemon(<span class="number">953</span>)</span><br><span class="line">           ├─irqbalance(<span class="number">943</span>)</span><br><span class="line">           ├─ksmtuned(<span class="number">960</span>)───sleep(<span class="number">3856</span>)</span><br><span class="line">           ├─libvirtd(<span class="number">1219</span>)─┬─&#123;libvirtd&#125;(<span class="number">2081</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2083</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2084</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2085</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2086</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2087</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2089</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2090</span>)</span><br><span class="line">           │                ├─&#123;libvirtd&#125;(<span class="number">2091</span>)</span><br><span class="line">           │                └─&#123;libvirtd&#125;(<span class="number">2092</span>)</span><br><span class="line">           ├─lsmd(<span class="number">920</span>)</span><br><span class="line">           ├─lvmetad(<span class="number">763</span>)</span><br><span class="line">           ├─master(<span class="number">1788</span>)─┬─pickup(<span class="number">3454</span>)</span><br><span class="line">           │              └─qmgr(<span class="number">1814</span>)</span><br><span class="line">           ├─polkitd(<span class="number">1001</span>)─┬─&#123;polkitd&#125;(<span class="number">1006</span>)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(<span class="number">1007</span>)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(<span class="number">1009</span>)</span><br><span class="line">           │               ├─&#123;polkitd&#125;(<span class="number">1017</span>)</span><br><span class="line">           │               └─&#123;polkitd&#125;(<span class="number">1032</span>)</span><br><span class="line">           ├─rngd(<span class="number">946</span>)</span><br><span class="line">           ├─rsyslogd(<span class="number">937</span>)─┬─&#123;rsyslogd&#125;(<span class="number">964</span>)</span><br><span class="line">           │               └─&#123;rsyslogd&#125;(<span class="number">967</span>)</span><br><span class="line">           ├─smartd(<span class="number">950</span>)</span><br><span class="line">           ├─sshd(<span class="number">1222</span>)─┬─sshd(<span class="number">2467</span>)───bash(<span class="number">2469</span>)───man(<span class="number">3700</span>)───less(<span class="number">3711</span>)</span><br><span class="line">           │            └─sshd(<span class="number">3748</span>)───bash(<span class="number">3750</span>)───pstree(<span class="number">3857</span>)</span><br><span class="line">           ├─systemd-journal(<span class="number">760</span>)</span><br><span class="line">           ├─systemd-logind(<span class="number">951</span>)</span><br><span class="line">           ├─systemd-udevd(<span class="number">771</span>)</span><br><span class="line">           ├─tuned(<span class="number">938</span>)─┬─&#123;tuned&#125;(<span class="number">1078</span>)</span><br><span class="line">           │            ├─&#123;tuned&#125;(<span class="number">1079</span>)</span><br><span class="line">           │            ├─&#123;tuned&#125;(<span class="number">1080</span>)</span><br><span class="line">           │            └─&#123;tuned&#125;(<span class="number">1081</span>)</span><br><span class="line">           └─vmtoolsd(<span class="number">923</span>)───&#123;vmtoolsd&#125;(<span class="number">974</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ps"><a class="header-anchor" href="#ps"></a>ps</h3>
<p>Linux运行中的内核的相关信息是通过<code>/proc</code>伪文件系统输出的；各进程都有一个以其PID命名的子目录，每个子目录中有许多文件存储了进程的相关状态信息；显示的是ps命令执行时，系统上当前进程状态信息的快照；所以，为静态结果.</p>
<p>常用的选项组合一 <code>ps aux</code></p>
<p>根据进程启动时是否是通过终端上的用户接口交互式启动的，进程可分为两类</p>
<ul>
<li>与终端相关的进程: a</li>
<li>与终端无关的进程: x</li>
<li>以用户为中心组织进程状态信息显示：u</li>
</ul>
<p>常用的选项组合二 <code>ps ef</code></p>
<ul>
<li><code>-e</code>: 显示所有进程；</li>
<li><code>-f</code>: 显示丰富格式信息</li>
</ul>
<p>常用的选项组合三 <code>ps -eFH</code></p>
<ul>
<li><code>-F</code>: 显示额外信息</li>
<li><code>-H</code>: 以层级形式显示进程间关系</li>
</ul>
<p>自定义需要显示的信息：<code>ps axo</code></p>
<ul>
<li><code>ps axo pid,command,psr,pri,ni</code></li>
<li><code>psr</code>: 当前进程运行的CPU编号；</li>
<li><code>pri</code>: 当前进程的优先级；</li>
<li><code>ni</code>: 当前进程的nice值(-20, 19)；</li>
</ul>
<p>支持众多选项</p>
<ul>
<li>BSD风格(不需要加<code>-</code>)</li>
<li>SysV风格(需要加<code>-</code>)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ ps aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root        <span class="number">542</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [scsi_tmf_1]</span><br><span class="line">root        <span class="number">545</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [mpt_poll_0]</span><br><span class="line">root        <span class="number">546</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [mpt/<span class="number">0</span>]</span><br><span class="line">root        <span class="number">552</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S    <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [scsi_eh_2]</span><br><span class="line">root        <span class="number">553</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [scsi_tmf_2]</span><br><span class="line">root        <span class="number">554</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [ttm_swap]</span><br><span class="line">root        <span class="number">622</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S    <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">05</span> [kworker/<span class="number">1</span>:<span class="number">2</span>]</span><br><span class="line">root        <span class="number">625</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [kdmflush]</span><br><span class="line">root        <span class="number">626</span>  <span class="number">0.0</span>  <span class="number">0.0</span>      <span class="number">0</span>     <span class="number">0</span> ?        S&lt;   <span class="number">21</span>:<span class="number">21</span>   <span class="number">0</span>:<span class="number">00</span> [bioset]</span><br><span class="line"></span><br><span class="line"><span class="comment"># commnet</span></span><br><span class="line"><span class="comment"># USER 		--&gt; 属主, PID --&gt; 进程ID, %CPU --&gt; 占用CPU的使用率</span></span><br><span class="line"><span class="comment"># %MEM 		--&gt; 占用内存的使用率</span></span><br><span class="line"><span class="comment"># VSZ  		--&gt; 线性地址空间占用的空间大小</span></span><br><span class="line"><span class="comment"># RSS  		--&gt; 常驻内存集；指不可以被交换至swap空间的数据占据空间大小</span></span><br><span class="line"><span class="comment"># TTY		--&gt; 使用的终端 ? 标识未知</span></span><br><span class="line"><span class="comment"># START 	--&gt; 启动时间</span></span><br><span class="line"><span class="comment"># TIME 		--&gt; 占据CPU累积时长</span></span><br><span class="line"><span class="comment"># COMMAND 	--&gt; 启动当前进程或线程的命令行程序，[]表示为内核线程</span></span><br><span class="line"><span class="comment"># STAT：进程状态</span></span><br><span class="line">	<span class="comment"># R: running，运行状态；</span></span><br><span class="line">	<span class="comment"># S：interruptible sleeping，可中断睡眠</span></span><br><span class="line">	<span class="comment"># D：uniterruptible sleeping, 不可中断睡眠</span></span><br><span class="line">	<span class="comment"># T: stopped</span></span><br><span class="line">	<span class="comment"># Z: zombie</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># s: session leader 会话领导者</span></span><br><span class="line">	<span class="comment"># +: 前台进程，占据着某终端</span></span><br><span class="line">	<span class="comment"># l: 多线程进程</span></span><br><span class="line">	<span class="comment"># &lt;: 高优先级进程</span></span><br><span class="line">	<span class="comment"># N: 低优先级进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SysV风格</span></span><br><span class="line">$ ps -ef</span><br></pre></td></tr></table></figure>
<h3 id="pgrep"><a class="header-anchor" href="#pgrep"></a>pgrep</h3>
<p>用来过滤进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ pgrep [OPTIONS] <span class="string">"PATTERN"</span></span><br><span class="line">	-U UID  <span class="comment">#仅显示制定用户身份运行的进程</span></span><br><span class="line">	-G GID</span><br><span class="line">	<span class="operator">-l</span> 		<span class="comment"># 显示PID和进程名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># demo</span></span><br><span class="line">$ pgrep -U postfix</span><br><span class="line"><span class="number">1804</span></span><br><span class="line"><span class="number">1805</span></span><br><span class="line"></span><br><span class="line">$ pgrep -U postfix <span class="operator">-l</span></span><br><span class="line"><span class="number">1804</span> pickup</span><br><span class="line"><span class="number">1805</span> qmgr</span><br></pre></td></tr></table></figure>
<h3 id="pidof"><a class="header-anchor" href="#pidof"></a>pidof</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ pidof PROGRAM <span class="comment"># PROGRAM: 给定命令行程序</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># demo</span></span><br><span class="line">$ pidof sshd</span><br><span class="line"><span class="number">2459</span> <span class="number">1223</span></span><br></pre></td></tr></table></figure>
<h3 id="top"><a class="header-anchor" href="#top"></a>top</h3>
<p><strong>有许多交互式的子命令</strong></p>
<ul>
<li><code>P</code>   以占据的CPU百分比大小排序；</li>
<li><code>M</code>   以占据Memory空间大小排序；</li>
<li><code>T</code>   CPU累积占用时间排序；</li>
<li><code>l</code>   是否显示系统负载行；队列长度的合理区间：CPU颗数*0.7</li>
<li><code>t</code>   是否显示进程摘要信息及CPU负载状态；</li>
<li><code>1</code>   平均或单独显示CPU的负载状态；</li>
<li><code>m</code>   是否显示内存相关的状态信息；</li>
<li><code>q</code>   退出命令</li>
<li><code>s</code>   修改延迟时长</li>
<li><code>k</code>   终止指定进程</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Cpu(s):  <span class="number">0.0</span>%us,  <span class="number">0.0</span>%sy,  <span class="number">0.0</span>%ni,<span class="number">100.0</span>%id,  <span class="number">0.0</span>%wa,  <span class="number">0.0</span>%hi,  <span class="number">0.0</span>%si,  <span class="number">0.0</span>%st</span><br><span class="line">	us: user space</span><br><span class="line">	sy: system (kernel space)</span><br><span class="line">	ni: nice</span><br><span class="line">	id: idle</span><br><span class="line">	wa: <span class="built_in">wait</span> io</span><br><span class="line">	hi: hardware interrupt</span><br><span class="line">	si: software interrupt</span><br><span class="line">	st: stolen, 被虚拟机“偷走”的百分比</span><br><span class="line"></span><br><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ top</span><br><span class="line">	-b batch   <span class="comment"># 批次显示</span></span><br><span class="line">	-n 		   <span class="comment">#: 显示的批次数量</span></span><br><span class="line">	<span class="operator">-d</span> 		   <span class="comment">#: 指明延迟时长</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exercise</span></span><br><span class="line">$ top</span><br><span class="line">top - <span class="number">22</span>:<span class="number">55</span>:<span class="number">07</span> up <span class="number">3</span> days, <span class="number">22</span>:<span class="number">27</span>,  <span class="number">1</span> user,  load average: <span class="number">1.70</span>, <span class="number">0.46</span>, <span class="number">0.15</span></span><br><span class="line">Tasks:  <span class="number">96</span> total,   <span class="number">7</span> running,  <span class="number">89</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line"><span class="comment"># Tasks当前系统上一共有多少个进程</span></span><br><span class="line">Cpu(s): <span class="number">99.3</span>%us,  <span class="number">0.3</span>%sy,  <span class="number">0.0</span>%ni,  <span class="number">0.0</span>%id,  <span class="number">0.0</span>%wa,  <span class="number">0.0</span>%hi,  <span class="number">0.3</span>%si,  <span class="number">0.0</span>%st</span><br><span class="line">Mem:   <span class="number">1018516</span>k total,   <span class="number">950732</span>k used,    <span class="number">67784</span>k free,    <span class="number">67796</span>k buffers</span><br><span class="line">Swap:  <span class="number">1048572</span>k total,        <span class="number">0</span>k used,  <span class="number">1048572</span>k free,   <span class="number">210728</span>k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</span><br><span class="line"><span class="number">10140</span> www       <span class="number">20</span>   <span class="number">0</span>  <span class="number">382</span>m  <span class="number">47</span>m  <span class="number">27</span>m R <span class="number">17.0</span>  <span class="number">4.8</span>   <span class="number">1</span>:<span class="number">03.54</span> php-fpm</span><br><span class="line"> <span class="number">1097</span> www       <span class="number">20</span>   <span class="number">0</span>  <span class="number">400</span>m  <span class="number">57</span>m  <span class="number">32</span>m R <span class="number">16.6</span>  <span class="number">5.8</span>   <span class="number">2</span>:<span class="number">27.93</span> php-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment"># uptime命令: 显示当前系统时间，运行时长，登录用户数及系统平均负载</span></span><br><span class="line"><span class="comment"># (0.00 --&gt; 过去一分钟的平均负载, 0.00 过去五分钟的平均负载 , 0.00 过去十五分钟的平均负载)</span></span><br><span class="line">$ uptime</span><br><span class="line"> <span class="number">22</span>:<span class="number">44</span>:<span class="number">41</span> up <span class="number">3</span> days, <span class="number">22</span>:<span class="number">17</span>,  <span class="number">1</span> user,  load average: <span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.00</span></span><br></pre></td></tr></table></figure>
<h3 id="htop"><a class="header-anchor" href="#htop"></a>htop</h3>
<p><em>htop - interactive process viewer</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">htop</span><br><span class="line"><span class="comment"># 交互式命令</span></span><br><span class="line">	u <span class="comment"># 过滤仅显示选定用户的进程；</span></span><br><span class="line">	s <span class="comment"># 跟踪选定的进程所发起的系统调用；</span></span><br><span class="line">	l <span class="comment"># 显示选定进程所打开的文件；</span></span><br><span class="line">	t <span class="comment"># 显示进程的层次结构；</span></span><br><span class="line">	a <span class="comment"># 设定进程的cpu亲缘性；（将选定的进程绑定在指定的CPU上）</span></span><br><span class="line">	F2,S <span class="comment"># 到设置界面</span></span><br><span class="line">	F3,/ <span class="comment"># 进程搜索,search会将光标定位到符合条件的进程上</span></span><br><span class="line">	F4,\ <span class="comment"># 进程过滤,filter会直接将符合条件的进程筛选出来</span></span><br><span class="line">	F5   <span class="comment"># 显示进程树；</span></span><br><span class="line">	F7   <span class="comment"># 减小nice值,选择某一个进程,直接按F7</span></span><br><span class="line">	F8   <span class="comment"># 增加nice值,选择某一个进程,直接按F8</span></span><br><span class="line">	F9   <span class="comment"># 杀掉指定进程</span></span><br><span class="line">	F10  <span class="comment"># 退出htop</span></span><br><span class="line">	U	 <span class="comment"># 取消所有选中的进程；</span></span><br><span class="line">	I	 <span class="comment"># 对排序的结果进行反转显示；</span></span><br><span class="line">	M    <span class="comment"># 按照内存使用百分比排序，对应MEM%列；</span></span><br><span class="line">	P    <span class="comment"># 按照CPU使用百分比排序，对应CPU%列；</span></span><br><span class="line">	T    <span class="comment"># 按照进程运行的时间排序，对应TIME+列；</span></span><br><span class="line">	K    <span class="comment"># 隐藏内核线程；</span></span><br><span class="line">	H    <span class="comment"># 隐藏用户线程；</span></span><br><span class="line">	<span class="comment">#    # 快速定位光标到PID所指定的进程上。</span></span><br><span class="line"><span class="comment"># 选项</span></span><br><span class="line">	<span class="operator">-d</span> <span class="comment"># 延迟时长</span></span><br><span class="line">	-u <span class="comment"># USERNAME: 仅显示指定用户的进程；</span></span><br><span class="line">	<span class="operator">-s</span> <span class="comment"># COLUMN: 根据指定的字段进行排序；</span></span><br><span class="line">	空格键 <span class="comment"># 用于标记选中的进程，用于实现对多个进程同时操作；</span></span><br><span class="line">$ htop</span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-17/htop-view.png" alt="htop-view"></p>
<h3 id="vmstat"><a class="header-anchor" href="#vmstat"></a>vmstat</h3>
<h4 id="procs"><a class="header-anchor" href="#procs"></a>procs</h4>
<ul>
<li>r: 等待运行的进程的个数；（队列长度）</li>
<li>b：处理不可中断睡眠状态的进程的个数；（即IO阻塞队列长度）</li>
</ul>
<h4 id="memory"><a class="header-anchor" href="#memory"></a>memory</h4>
<ul>
<li>swpd: 交换内存使用量；</li>
<li>free: 空间的物理内存量；</li>
<li>buffer: 用于buffer的内存总量；</li>
<li>cache: 用于cache的内存总量；</li>
</ul>
<h4 id="swap"><a class="header-anchor" href="#swap"></a>swap</h4>
<ul>
<li>si: 数据进入swap中的速率(kb/s)</li>
<li>so: 数据离开swap的速率(kb/s)</li>
</ul>
<h4 id="io"><a class="header-anchor" href="#io"></a>io</h4>
<ul>
<li>bi: 从块设备读入数据到系统的速率(kb/s)</li>
<li>bo: 保存数据至块设备的速率(kb/s)</li>
</ul>
<h4 id="system"><a class="header-anchor" href="#system"></a>system</h4>
<ul>
<li>in: 中断速率</li>
<li>cs: 进程切换的速率</li>
</ul>
<h4 id="cpu-v2"><a class="header-anchor" href="#cpu-v2"></a>cpu</h4>
<ul>
<li>us: user space</li>
<li>sy: system (kernel space)</li>
<li>id: idle</li>
<li>wa: wait io</li>
<li>st: stolen, 被虚拟机“偷走”的百分比</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">vmstat [delay [count]] <span class="comment"># delay 显示延迟的时间, count 显示批次的数量</span></span><br><span class="line">		<span class="operator">-s</span> 	<span class="comment"># 显示内存的状态统计数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#exercise</span></span><br><span class="line">$ vmstat <span class="number">5</span> <span class="number">5</span></span><br><span class="line">procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----</span><br><span class="line">r  b  swpd   free   buff  cache   si   so    bi    bo   <span class="keyword">in</span>   cs    us sy id wa st</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span> <span class="number">1617644</span>  <span class="number">24580</span> <span class="number">123460</span>   <span class="number">0</span>    <span class="number">0</span>   <span class="number">139</span>     <span class="number">4</span>   <span class="number">384</span>  <span class="number">328</span>    <span class="number">1</span>  <span class="number">6</span> <span class="number">85</span>  <span class="number">1</span>  <span class="number">6</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span> <span class="number">1617504</span>  <span class="number">24580</span> <span class="number">123488</span>   <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">6</span>   <span class="number">417</span>  <span class="number">246</span>    <span class="number">0</span>  <span class="number">0</span> <span class="number">99</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span> <span class="number">1617512</span>  <span class="number">24588</span> <span class="number">123488</span>   <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">3</span>   <span class="number">407</span>  <span class="number">250</span>    <span class="number">0</span>  <span class="number">0</span> <span class="number">99</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span> <span class="number">1617512</span>  <span class="number">24588</span> <span class="number">123488</span>   <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>   <span class="number">346</span>  <span class="number">249</span>    <span class="number">0</span>  <span class="number">0</span> <span class="number">100</span> <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>     <span class="number">0</span> <span class="number">1617512</span>  <span class="number">24588</span> <span class="number">123488</span>   <span class="number">0</span>    <span class="number">0</span>     <span class="number">0</span>     <span class="number">0</span>   <span class="number">280</span>  <span class="number">248</span>    <span class="number">0</span>  <span class="number">0</span> <span class="number">100</span> <span class="number">0</span>  <span class="number">0</span></span><br><span class="line"></span><br><span class="line">$ vmstat <span class="operator">-s</span> <span class="comment"># 显示内存的状态统计数据</span></span><br><span class="line">   <span class="number">1870512</span> K total memory</span><br><span class="line">    <span class="number">120004</span> K used memory</span><br><span class="line">     <span class="number">69036</span> K active memory</span><br><span class="line">    <span class="number">106952</span> K inactive memory</span><br><span class="line">   <span class="number">1571952</span> K free memory</span><br><span class="line">       <span class="number">920</span> K buffer memory</span><br><span class="line">    <span class="number">177636</span> K swap cache</span><br><span class="line">   <span class="number">4194296</span> K total swap</span><br><span class="line">         <span class="number">0</span> K used swap</span><br><span class="line">   <span class="number">4194296</span> K free swap</span><br><span class="line">       <span class="number">492</span> non-nice user cpu ticks</span><br><span class="line">         <span class="number">0</span> nice user cpu ticks</span><br><span class="line">      <span class="number">1827</span> system cpu ticks</span><br><span class="line">   <span class="number">3437284</span> idle cpu ticks</span><br><span class="line">        <span class="number">57</span> IO-wait cpu ticks</span><br><span class="line">         <span class="number">0</span> IRQ cpu ticks</span><br><span class="line">       <span class="number">548</span> softirq cpu ticks</span><br><span class="line">         <span class="number">0</span> stolen cpu ticks</span><br><span class="line">    <span class="number">138580</span> pages paged <span class="keyword">in</span></span><br><span class="line">      <span class="number">9589</span> pages paged out</span><br><span class="line">         <span class="number">0</span> pages swapped <span class="keyword">in</span></span><br><span class="line">         <span class="number">0</span> pages swapped out</span><br><span class="line">    <span class="number">312716</span> interrupts</span><br><span class="line">    <span class="number">490920</span> CPU context switches</span><br><span class="line"><span class="number">1443013324</span> boot time</span><br><span class="line">         <span class="number">4022</span> forks</span><br></pre></td></tr></table></figure>
<h3 id="pmap"><a class="header-anchor" href="#pmap"></a>pmap</h3>
<p><strong>查看指定进程的内存映射关系</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">pmap [OPTIONS] pid...</span><br><span class="line">		-x: <span class="comment"># 显示扩展信息</span></span><br></pre></td></tr></table></figure>
<h3 id="glances"><a class="header-anchor" href="#glances"></a>glances</h3>
<p><strong>一个跨平台的监控工具</strong></p>
<h4 id="glances交互式命令"><a class="header-anchor" href="#glances交互式命令"></a>glances交互式命令</h4>
<p><em>You can use the following keys while in Glances !</em></p>
<ul>
<li><code>a</code> <em>Sort process list automatically</em></li>
<li><code>b</code> <em>Switch between bit/s or Byte/s for network I/O</em></li>
<li><code>c</code> <em>Sort processes by CPU usage</em></li>
<li><code>d</code> <em>Show/hide disk I/O stats</em></li>
<li><code>f</code> <em>Show/hide file system stats</em></li>
<li><code>h</code> <em>Show/hide the help screen</em></li>
<li><code>i</code> <em>Sort processes by I/O rate</em></li>
<li><code>l</code> <em>Show/hide log messages</em></li>
<li><code>m</code> <em>Sort processes by MEM usage</em></li>
<li><code>n</code> <em>Show/hide network stats</em></li>
<li><code>p</code> <em>Sort processes by name</em></li>
<li><code>q</code> <em>Quit</em></li>
<li><code>s</code> <em>Show/hide sensors stats (only available with -e flag)</em></li>
<li><code>t</code> <em>View network I/O as combination</em></li>
<li><code>u</code> <em>View cumulative network I/O</em></li>
<li><code>w</code> <em>Delete finished warning log messages</em></li>
<li><code>x</code> <em>Delete finished warning and critical log messages</em></li>
<li><code>y</code> <em>Show/hide hddtemp stats (only available with -y flag)</em></li>
<li><code>z</code> <em>Show/hide processes list (for low CPU consumption)</em></li>
<li><code>p</code> <em>Sort processes by name</em></li>
<li><code>q</code> <em>Quit</em></li>
<li><code>s</code> <em>Show/hide sensors stats (only available with -e flag)</em></li>
<li><code>t</code> <em>View network I/O as combination</em></li>
<li><code>u</code> <em>View cumulative network I/O</em></li>
<li><code>w</code> <em>Delete finished warning log messages</em></li>
<li><code>x</code> <em>Delete finished warning and critical log messages</em></li>
<li><code>y</code> <em>Show/hide hddtemp stats (only available with -y flag)</em></li>
<li><code>z</code> <em>Show/hide processes list (for low CPU consumption)</em></li>
<li><code>1</code> <em>Switch between global CPU and per-CPU stats</em></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">glances [-bdehmnrsvyz1] [-B <span class="built_in">bind</span>] [-c server] [-C conffile] [-p port] [-P password] [--password] [-t refresh] [<span class="operator">-f</span> file] [-o output]</span><br><span class="line"></span><br><span class="line"><span class="comment"># options</span></span><br><span class="line"> -b  <span class="comment"># Display network rate in Byte per second (default: bit per second)</span></span><br><span class="line"> -B @IP|HOST <span class="comment"># 将服务绑定到给定的IPv4 / IPv6地址或主机名</span></span><br><span class="line"> -c @IP|HOST <span class="comment"># 连接到一个glances服务用给定的IPv4 / IPv6地址或主机名</span></span><br><span class="line"> <span class="operator">-s</span>  <span class="comment"># 运行glances在server模式下</span></span><br><span class="line"> -<span class="number">1</span>  <span class="comment"># 单独显示每颗CPU相关负载数据信息</span></span><br><span class="line"> -t  <span class="comment"># 指定延迟时长，默认为3秒</span></span><br><span class="line"> -n  <span class="comment"># 关闭网络功能模块</span></span><br><span class="line"> -m  <span class="comment"># 关闭mount功能模块</span></span><br><span class="line"> <span class="operator">-f</span>  <span class="comment"># /PATH/TO/SOMEFILE：设置输出文件的位置及格式</span></span><br><span class="line"> <span class="operator">-d</span>  <span class="comment"># 关闭磁盘I/O功能模块</span></span><br><span class="line"> -o  <span class="comment"># &#123;HTML|CSV&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exercise</span></span><br><span class="line"><span class="comment"># 演示glances的服务模式</span></span><br><span class="line">$ glances <span class="operator">-s</span> -B <span class="number">192.168</span>.<span class="number">1.160</span> -p <span class="number">9999</span> &amp;</span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line">[<span class="number">1</span>]+  Running  glances <span class="operator">-s</span> -B <span class="number">192.168</span>.<span class="number">1.160</span> -p <span class="number">9999</span> &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端去连接</span></span><br><span class="line">$ glances -c <span class="number">192.168</span>.<span class="number">1.160</span> -p <span class="number">9999</span></span><br><span class="line"><span class="comment"># 参考下图</span></span><br><span class="line">Connected to <span class="number">192.168</span>.<span class="number">1.160</span> | Press <span class="string">'h'</span> <span class="keyword">for</span> <span class="built_in">help</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-17/glances-client.png" alt="glances-client"></p>
<h3 id="安装pip-bottle-batinfo"><a class="header-anchor" href="#安装pip-bottle-batinfo"></a>安装pip,bottle,batinfo</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pip</span></span><br><span class="line">$ wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">$ python get-pip.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试pip是否安装</span></span><br><span class="line">$ pip install bottle <span class="comment"># 用pip安装bottle</span></span><br><span class="line">Stored <span class="keyword">in</span> directory: /root/.cache/pip/wheels/<span class="number">2</span>e/<span class="number">69</span>/<span class="number">1</span>f/bcf8d1</span><br><span class="line">Successfully built bottle</span><br><span class="line">Installing collected packages: bottle</span><br><span class="line">Successfully installed bottle-<span class="number">0.12</span>.<span class="number">8</span></span><br><span class="line"></span><br><span class="line">$ pip install batinfo</span><br><span class="line">Building wheels <span class="keyword">for</span> collected packages: batinfo</span><br><span class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> batinfo</span><br><span class="line">  Stored <span class="keyword">in</span> directory: /root/.cache/pip/wheels/<span class="number">04</span>/<span class="number">85</span>/aa/<span class="number">90</span>fac8b</span><br><span class="line">Successfully built batinfo</span><br><span class="line">Installing collected packages: batinfo</span><br><span class="line">Successfully installed batinfo-<span class="number">0.3</span></span><br></pre></td></tr></table></figure>
<h3 id="dstat"><a class="header-anchor" href="#dstat"></a>dstat</h3>
<p><strong>整合了vmstat, iostat, netstat and ifstat四款工具的功能</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">dstat [-afv] [options..] [delay [count]]</span><br><span class="line">	-c <span class="comment"># 显示cpu性能指标相关的统计数据；</span></span><br><span class="line">	<span class="operator">-d</span> <span class="comment"># 显示disk相关的速率数据；</span></span><br><span class="line">	-g <span class="comment"># 显示page相关的速率数据；</span></span><br><span class="line">	-i <span class="comment"># 显示interrupt相关的速率数据；</span></span><br><span class="line">	<span class="operator">-l</span> <span class="comment"># 显示load average相关的统计数据；</span></span><br><span class="line">	-m <span class="comment"># 显示memory相关的统计数据；</span></span><br><span class="line">	-n <span class="comment"># 显示网络收发数据的速率；`</span></span><br><span class="line">	-p <span class="comment"># 显示进程相关的统计数据，</span></span><br><span class="line">	-r <span class="comment"># io请求的速率；</span></span><br><span class="line">	<span class="operator">-s</span> <span class="comment"># 显示swap的相关数据</span></span><br><span class="line">	-y <span class="comment"># 显示系统相关的数据，包括中断和进程切换；</span></span><br><span class="line">	--top-cpu   <span class="comment"># 显示最占用CPU的进程；</span></span><br><span class="line">	--top-bio   <span class="comment"># 显示最消耗block io的进程；</span></span><br><span class="line">	--top-io    <span class="comment"># 最占用io的进程；</span></span><br><span class="line">	--top-mem   <span class="comment"># 显示最占用内存的进程；</span></span><br><span class="line">	--ipc 		<span class="comment"># 显示进程间通信相关的速率数据；</span></span><br><span class="line">	--raw 		<span class="comment"># 显示raw套接的相关的数据；</span></span><br><span class="line">	--tcp 		<span class="comment"># 显示tcp套接字的相关数据；</span></span><br><span class="line">	--udp 		<span class="comment"># 显示udp套接字的相关数据；</span></span><br><span class="line">	--unix 		<span class="comment"># 显示unix sock接口相关的统计数据；</span></span><br><span class="line">	--socket</span><br><span class="line">	<span class="operator">-a</span>: -cdngy</span><br><span class="line">	delay count <span class="comment"># 延长多少时间显示多少批</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exercise</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-17/dstat-view.png" alt="dstat-view"></p>
<h3 id="kill"><a class="header-anchor" href="#kill"></a>kill</h3>
<p><em>kill - terminate a process</em></p>
<p>Linux中的<code>kill</code>命令用来终止指定的进程(terminate a process)的运行，是Linux下进程管理的常用命令。通常，终止一个前台进程可以使用<code>Ctrl+C</code>键，但是，对于一个后台进程就须用<code>kill</code>命令来终止，我们就需要先使用<code>ps/pidof/pstree/top</code>等工具获取进程<code>PID</code>，然后使用<code>kill</code>命令来杀掉该进程。<code>kill</code>命令是通过向进程或进程组发送指定的信号来结束相应进程的。在默认情况下，采用编号为15的TERM信号。TERM信号将终止所有不能捕获该信号的进程。对于那些可以捕获该信号的进程就要用编号为9的kill信号，强行“杀掉”该进程。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line"><span class="built_in">kill</span> [<span class="operator">-s</span> signal|-p] [-q sigval] [<span class="operator">-a</span>] [--] pid...</span><br><span class="line"><span class="built_in">kill</span> <span class="operator">-l</span> [signal]</span><br><span class="line"></span><br><span class="line"><span class="comment"># options</span></span><br><span class="line"><span class="operator">-s</span> <span class="comment">#指定发送的信号。</span></span><br><span class="line">-p <span class="comment">#模拟发送信号。</span></span><br><span class="line"><span class="operator">-l</span> <span class="comment">#指定信号的名称列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 向进程发信号</span></span><br><span class="line"><span class="built_in">kill</span> [-SIGNAL] PID <span class="comment">#默认的信号为SIGTERM</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kill相似的一组进程</span></span><br><span class="line">killall [-SIGNAL] PROGRAM</span><br><span class="line"></span><br><span class="line"><span class="comment"># /bin/kill</span></span><br><span class="line">$ /bin/<span class="built_in">kill</span> -p <span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"></span><br><span class="line">$ /bin/<span class="built_in">kill</span> -L</span><br><span class="line"> <span class="number">1</span> HUP      <span class="number">2</span> INT      <span class="number">3</span> QUIT     <span class="number">4</span> ILL      <span class="number">5</span> TRAP     <span class="number">6</span> ABRT     <span class="number">6</span> IOT</span><br><span class="line"> <span class="number">7</span> BUS      <span class="number">8</span> FPE      <span class="number">9</span> KILL    <span class="number">10</span> USR1    <span class="number">11</span> SEGV    <span class="number">12</span> USR2    <span class="number">13</span> PIPE</span><br><span class="line"><span class="number">14</span> ALRM    <span class="number">15</span> TERM    <span class="number">16</span> STKFLT  <span class="number">17</span> CHLD    <span class="number">17</span> CLD     <span class="number">18</span> CONT    <span class="number">19</span> STOP</span><br><span class="line"><span class="number">20</span> TSTP    <span class="number">21</span> TTIN    <span class="number">22</span> TTOU    <span class="number">23</span> URG     <span class="number">24</span> XCPU    <span class="number">25</span> XFSZ    <span class="number">26</span> VTALRM</span><br><span class="line"><span class="number">27</span> PROF    <span class="number">28</span> WINCH   <span class="number">29</span> IO      <span class="number">29</span> POLL    <span class="number">30</span> PWR     <span class="number">31</span> UNUSED  <span class="number">31</span> SYS</span><br><span class="line"><span class="number">34</span> RTMIN   <span class="number">64</span> RTMAX</span><br></pre></td></tr></table></figure>
<h3 id="jobs"><a class="header-anchor" href="#jobs"></a>jobs</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">$ <span class="built_in">jobs</span></span><br><span class="line">[<span class="number">1</span>]-  Stopped                 glances</span><br><span class="line">[<span class="number">2</span>]+  Stopped                 htop <span class="comment"># + 代码fg第一个被恢复的</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">fg</span></span><br><span class="line">[<span class="number">1</span>]+  Stopped                 glances</span><br></pre></td></tr></table></figure>
<h3 id="nice-renice"><a class="header-anchor" href="#nice-renice"></a>nice, renice</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">nice -n N COMMAND <span class="comment"># 对于尚未启动的进程</span></span><br><span class="line">renice -n N PID <span class="comment"># 对于已经启动并处于运行中的进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：普通用户仅能够调大nice，调低优先级；</span></span><br><span class="line"></span><br><span class="line">$ ps axo pid,<span class="built_in">command</span>,ni | grep httpd | grep -v grep</span><br><span class="line"><span class="number">2641</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"><span class="number">2642</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"><span class="number">2643</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"><span class="number">2644</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"><span class="number">2645</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"><span class="number">2647</span> /usr/sbin/httpd -DFOREGROUN   <span class="number">0</span></span><br><span class="line"></span><br><span class="line">$ killall httpd</span><br><span class="line">$ nice -n <span class="number">5</span> httpd</span><br><span class="line">$ ps axo pid,<span class="built_in">command</span>,ni | grep httpd | grep -v grep</span><br><span class="line"><span class="number">2781</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2796</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2797</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2798</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2799</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2800</span> httpd                         <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于已经启动的进程,用renice调整优先级</span></span><br><span class="line">$ renice -n <span class="number">10</span> <span class="number">2800</span></span><br><span class="line"><span class="number">2800</span> (process ID) old priority <span class="number">5</span>, new priority <span class="number">10</span></span><br><span class="line"></span><br><span class="line">$ ps axo pid,<span class="built_in">command</span>,ni | grep httpd | grep -v grep</span><br><span class="line"><span class="number">2781</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2796</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2797</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2798</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2799</span> httpd                         <span class="number">5</span></span><br><span class="line"><span class="number">2800</span> httpd                         <span class="number">10</span></span><br></pre></td></tr></table></figure>
<h3 id="iostat"><a class="header-anchor" href="#iostat"></a>iostat</h3>
<p><em>iostat - Report Central Processing Unit (CPU) statistics and input/output statistics for devices and partitions.</em></p>
<p>iostat工具将对系统的磁盘操作活动进行监视。它的特点是汇报磁盘活动统计情况，同时也会汇报出CPU使用情况。同<code>vmstat</code>一样，<code>iostat</code>也有一个弱点，就是它不能对某个进程进行深入分析，仅对系统的整体情况进行分析。<code>iostat</code>属于<code>sysstat</code>软件包。可以用<code>yum install sysstat</code>直接安装。通过iostat方便查看CPU、网卡、tty设备、磁盘、CD-ROM 等等设备的活动情况,负载信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line">iostat [options] [ interval [ count ] ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># options</span></span><br><span class="line">-C 		  <span class="comment"># 显示CPU使用情况</span></span><br><span class="line"><span class="operator">-d</span> 		  <span class="comment"># 显示磁盘使用情况</span></span><br><span class="line">-k 		  <span class="comment"># 以 KB 为单位显示</span></span><br><span class="line">-m 		  <span class="comment"># 以 M 为单位显示</span></span><br><span class="line">-N 		  <span class="comment"># 显示磁盘阵列(LVM) 信息</span></span><br><span class="line">-n 		  <span class="comment"># 显示NFS 使用情况</span></span><br><span class="line">-p [ &#123; device [,...] | ALL &#125; ] <span class="comment"># 显示磁盘和分区的情况</span></span><br><span class="line">-t 		  <span class="comment"># 显示终端和CPU的信息</span></span><br><span class="line">-x 		  <span class="comment"># 显示详细信息</span></span><br><span class="line">-V 		  <span class="comment"># 显示版本信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1 显示所有设备负载情况</span></span><br><span class="line">$ iostat</span><br><span class="line">Linux <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">229.14</span>.<span class="number">1</span>.el7.x86_64 (kernel) 	<span class="number">09</span>/<span class="number">26</span>/<span class="number">2015</span> 	_x86_64_	(<span class="number">4</span> CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           <span class="number">0.01</span>    <span class="number">0.00</span>    <span class="number">0.08</span>    <span class="number">0.01</span>    <span class="number">0.00</span>   <span class="number">99.90</span></span><br><span class="line"></span><br><span class="line">Device:            tps    kB_<span class="built_in">read</span>/s    kB_wrtn/s    kB_<span class="built_in">read</span>    kB_wrtn</span><br><span class="line">scd0              <span class="number">0.00</span>         <span class="number">0.01</span>         <span class="number">0.00</span>         <span class="number">44</span>          <span class="number">0</span></span><br><span class="line">sda               <span class="number">1.75</span>        <span class="number">29.76</span>         <span class="number">2.27</span>     <span class="number">142284</span>      <span class="number">10838</span></span><br><span class="line">dm-<span class="number">0</span>              <span class="number">0.05</span>         <span class="number">0.21</span>         <span class="number">0.00</span>       <span class="number">1008</span>          <span class="number">0</span></span><br><span class="line">dm-<span class="number">1</span>              <span class="number">1.16</span>        <span class="number">22.77</span>         <span class="number">1.41</span>     <span class="number">108838</span>       <span class="number">6726</span></span><br><span class="line">dm-<span class="number">2</span>              <span class="number">0.05</span>         <span class="number">0.13</span>         <span class="number">0.43</span>        <span class="number">610</span>       <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 显示指定磁盘信息</span></span><br><span class="line">$ iostat <span class="operator">-d</span> sda1</span><br><span class="line">Linux <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">229.14</span>.<span class="number">1</span>.el7.x86_64 (kernel) 	<span class="number">09</span>/<span class="number">26</span>/<span class="number">2015</span> 	_x86_64_	(<span class="number">4</span> CPU)</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_<span class="built_in">read</span>/s    kB_wrtn/s    kB_<span class="built_in">read</span>    kB_wrtn</span><br><span class="line">sda1              <span class="number">2.48</span>        <span class="number">30.28</span>         <span class="number">2.23</span>      <span class="number">27752</span>       <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 以M为单位显示所有信息</span></span><br><span class="line">$ iostat -m</span><br><span class="line">Linux <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">229.14</span>.<span class="number">1</span>.el7.x86_64 (kernel) 	<span class="number">09</span>/<span class="number">26</span>/<span class="number">2015</span> 	_x86_64_	(<span class="number">4</span> CPU)</span><br><span class="line"></span><br><span class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</span><br><span class="line">           <span class="number">0.08</span>    <span class="number">0.00</span>    <span class="number">0.24</span>    <span class="number">0.01</span>    <span class="number">0.00</span>   <span class="number">99.67</span></span><br><span class="line"></span><br><span class="line">Device:            tps    MB_<span class="built_in">read</span>/s    MB_wrtn/s    MB_<span class="built_in">read</span>    MB_wrtn</span><br><span class="line">scd0              <span class="number">0.01</span>         <span class="number">0.00</span>         <span class="number">0.00</span>          <span class="number">0</span>          <span class="number">0</span></span><br><span class="line">sda               <span class="number">6.51</span>         <span class="number">0.12</span>         <span class="number">0.01</span>        <span class="number">139</span>          <span class="number">7</span></span><br><span class="line">dm-<span class="number">0</span>              <span class="number">0.21</span>         <span class="number">0.00</span>         <span class="number">0.00</span>          <span class="number">0</span>          <span class="number">0</span></span><br><span class="line">dm-<span class="number">1</span>              <span class="number">4.04</span>         <span class="number">0.09</span>         <span class="number">0.00</span>        <span class="number">106</span>          <span class="number">3</span></span><br><span class="line">dm-<span class="number">2</span>              <span class="number">0.20</span>         <span class="number">0.00</span>         <span class="number">0.00</span>          <span class="number">0</span>          <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 查看TPS和吞吐量信息</span></span><br><span class="line">$ iostat <span class="operator">-d</span> -k <span class="number">1</span> <span class="number">1</span></span><br><span class="line">Linux <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">229.14</span>.<span class="number">1</span>.el7.x86_64 (kernel) 	<span class="number">09</span>/<span class="number">26</span>/<span class="number">2015</span> 	_x86_64_	(<span class="number">4</span> CPU)</span><br><span class="line"></span><br><span class="line">Device:            tps    kB_<span class="built_in">read</span>/s    kB_wrtn/s    kB_<span class="built_in">read</span>    kB_wrtn</span><br><span class="line">scd0              <span class="number">0.01</span>         <span class="number">0.03</span>         <span class="number">0.00</span>         <span class="number">44</span>          <span class="number">0</span></span><br><span class="line">sda               <span class="number">6.12</span>       <span class="number">112.94</span>         <span class="number">6.13</span>     <span class="number">142588</span>       <span class="number">7735</span></span><br><span class="line">dm-<span class="number">0</span>              <span class="number">0.20</span>         <span class="number">0.80</span>         <span class="number">0.00</span>       <span class="number">1008</span>          <span class="number">0</span></span><br><span class="line">dm-<span class="number">1</span>              <span class="number">3.80</span>        <span class="number">86.38</span>         <span class="number">2.88</span>     <span class="number">109046</span>       <span class="number">3635</span></span><br><span class="line">dm-<span class="number">2</span>              <span class="number">0.19</span>         <span class="number">0.49</span>         <span class="number">1.62</span>        <span class="number">614</span>       <span class="number">2048</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5 查看设备使用率（%util）、响应时间（await）</span></span><br><span class="line">$ iostat <span class="operator">-d</span> -x-k <span class="number">1</span> <span class="number">1</span></span><br><span class="line">Linux <span class="number">3.10</span>.<span class="number">0</span>-<span class="number">229.14</span>.<span class="number">1</span>.el7.x86_64 (kernel) 	<span class="number">09</span>/<span class="number">26</span>/<span class="number">2015</span> 	_x86_64_	(<span class="number">4</span> CPU)</span><br><span class="line"></span><br><span class="line">Device: rrqm/s wrqm/s  r/s  w/s rkB/s wkB/s avgrq-sz avgqu-sz await r_await w_await svctm %util</span><br><span class="line">scd0      <span class="number">0.00</span>   <span class="number">0.00</span> <span class="number">0.01</span> <span class="number">0.00</span>  <span class="number">0.03</span>  <span class="number">0.00</span>     <span class="number">8.00</span>     <span class="number">0.00</span>  <span class="number">0.64</span>    <span class="number">0.64</span>    <span class="number">0.00</span>  <span class="number">0.64</span>  <span class="number">0.00</span></span><br><span class="line">sda       <span class="number">0.54</span>   <span class="number">0.02</span> <span class="number">4.11</span> <span class="number">0.81</span> <span class="number">90.69</span>  <span class="number">4.93</span>    <span class="number">38.86</span>     <span class="number">0.00</span>  <span class="number">0.39</span>    <span class="number">0.37</span>    <span class="number">0.47</span>  <span class="number">0.22</span>  <span class="number">0.11</span></span><br><span class="line">dm-<span class="number">0</span>      <span class="number">0.00</span>   <span class="number">0.00</span> <span class="number">0.16</span> <span class="number">0.00</span>  <span class="number">0.64</span>  <span class="number">0.00</span>     <span class="number">8.00</span>     <span class="number">0.00</span>  <span class="number">0.29</span>    <span class="number">0.29</span>    <span class="number">0.00</span>  <span class="number">0.16</span>  <span class="number">0.00</span></span><br><span class="line">dm-<span class="number">1</span>      <span class="number">0.00</span>   <span class="number">0.00</span> <span class="number">2.88</span> <span class="number">0.17</span> <span class="number">69.36</span>  <span class="number">2.32</span>    <span class="number">46.87</span>     <span class="number">0.00</span>  <span class="number">0.50</span>    <span class="number">0.42</span>    <span class="number">1.87</span>  <span class="number">0.26</span>  <span class="number">0.08</span></span><br><span class="line">dm-<span class="number">2</span>      <span class="number">0.00</span>   <span class="number">0.00</span> <span class="number">0.15</span> <span class="number">0.00</span>  <span class="number">0.39</span>  <span class="number">1.30</span>    <span class="number">22.66</span>     <span class="number">0.00</span>  <span class="number">0.19</span>    <span class="number">0.13</span>    <span class="number">3.25</span>  <span class="number">0.15</span>  <span class="number">0.00</span></span><br></pre></td></tr></table></figure>
<p>cpu属性值说明</p>
<ul>
<li><code>%user</code>   CPU处在用户模式下的时间百分比。</li>
<li><code>%nice</code>   CPU处在带NICE值的用户模式下的时间百分比。</li>
<li><code>%system</code> CPU处在系统模式下的时间百分比。</li>
<li><code>%iowait</code> CPU等待输入输出完成时间的百分比。</li>
<li><code>%steal</code>  管理程序维护另一个虚拟处理器时，虚拟CPU的无意识等待时间百分比。</li>
<li><code>%idle</code>   CPU空闲时间百分比。</li>
</ul>
<p>如果<code>%iowait</code>的值过高，表示硬盘存在I/O瓶颈，<code>%idle</code>值高，表示CPU较空闲，如果<code>%idle</code>值高但系统响应慢时，有可能是CPU等待分配内存，此时应加大内存容量。<code>%idle</code>值如果持续低于10，那么系统的CPU处理能力相对较低，表明系统中最需要解决的资源是CPU。</p>
<p>disk属性值说明</p>
<ul>
<li><code>rrqm/s</code>      每秒进行 merge 的读操作数目。即 rmerge/s</li>
<li><code>wrqm/s</code>      每秒进行 merge 的写操作数目。即 wmerge/s</li>
<li><code>r/s</code>         每秒完成的读 I/O 设备次数。即 rio/s</li>
<li><code>w/s</code>         每秒完成的写 I/O 设备次数。即 wio/s</li>
<li><code>rsec/s</code>      每秒读扇区数。即 rsect/s</li>
<li><code>wsec/s</code>      每秒写扇区数。即 wsect/s</li>
<li><code>rkB/s</code>       每秒读K字节数。因为每扇区大小为512字节。</li>
<li><code>wkB/s</code>       每秒写K字节数。</li>
<li><code>avgrq-sz</code>    平均每次设备I/O操作的数据大小 (扇区)。</li>
<li><code>avgqu-sz</code>    平均I/O队列长度。</li>
<li><code>await</code>       平均每次设备I/O操作的等待时间 (毫秒)。</li>
<li><code>svctm</code>       平均每次设备I/O操作的服务时间 (毫秒)。</li>
<li><code>%util</code>       一秒中有百分之多少的时间用于 I/O 操作，即被io消耗的cpu百分比</li>
</ul>
<p>说明</p>
<ul>
<li><code>tps</code> 该设备每秒的传输次数（Indicate the number of transfers per second that were issued to the device.）。“一次传输”意思是“一次I/O请求”。多个逻辑请求可能会被合并为“一次I/O请求”。“一次传输”请求的大小是未知的。</li>
<li><code>kB_read/s</code>   每秒从设备（drive expressed）读取的数据量；</li>
<li><code>kB_wrtn/s</code>   每秒向设备（drive expressed）写入的数据量；</li>
<li><code>kB_read</code>     读取的总数据量；</li>
<li><code>kB_wrtn</code>     写入的总数量数据量；</li>
</ul>
<p>这些单位都为Kilobytes。</p>
<p>上面的例子中，我们可以看到磁盘sda以及它的各个分区的统计数据，当时统计的磁盘总TPS是22.73，下面是各个分区的TPS。（因为是瞬间值，所以总TPS并不严格等于各个分区TPS的总和）</p>
<p>如果 <code>%util</code> 接近 100%，说明产生的<code>I/O</code>请求太多，<code>I/O</code>系统已经满负荷，该磁盘可能存在瓶颈。如果 <code>svctm</code> 比较接近 <code>await</code>，说明 <code>I/O</code> 几乎没有等待时间；如果 <code>await</code> 远大于 <code>svctm</code>，说明<code>I/O</code>队列太长，io响应太慢，则需要进行必要优化。如果<code>avgqu-sz</code>比较大，也表示有大量io在等待。</p>
<h3 id="sar"><a class="header-anchor" href="#sar"></a>sar</h3>
]]></content>
    <summary type="html">
    <![CDATA[<p>Linux进程查看与管理</p>
<p>OS的基本功能：文件系统、网络功能、进程管理、内存管理、驱动程序、安全功能</p>
<p>OS提供虚拟的计算机，进而能够将有限资源借助于“保护”机制分配多个同时运行的程序，即“进程”使用，从而实现了所谓的多任务；</p>
<p>Linux进程查看及管理工具</p>
<p><code>top, pstree, ps, pidof, pgrep, pkill, htop, glances, pmap, vmstat, dstat, iostat, sar, kill, job, bg, fg</code></p>
<p>程序=指令+数据</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-15]]></title>
    <link href="http://molloc.me/2015/09/15/ZY-2015-09-15/"/>
    <id>http://molloc.me/2015/09/15/ZY-2015-09-15/</id>
    <published>2015-09-15T15:19:32.000Z</published>
    <updated>2015-09-19T08:46:31.500Z</updated>
    <content type="html"><![CDATA[<h2 id="sed"><a class="header-anchor" href="#sed"></a>Sed</h2>
<p><em>Sed Stream editor</em></p>
<p>sed和awk是用户、程序员和管理员应用的工具。之所以称为sed是因为它是一个流编辑器（stream editor），用于对许多文件执行一系列的编辑操作。awk是根据它的开发者Aho、Weinberger和Kernighan命名的。awk是一种编程语言，它可以使你很容易地处理结构化数据和生成格式化报告。</p>
<p>Sed的工作方式,一次从文件中读取一行到<code>pattern space</code>,然后判断这一行是不是我们需要编辑的行,如何符合条件则对其进行处理,</p>
<p>处理完之后把处理的结果输出到屏幕上.如果不符合要求也输出到屏幕上来(Sed的默认操作,称之为打印模式空间).</p>
<a id="more"></a>
<h3 id="语法"><a class="header-anchor" href="#语法"></a>语法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sed [OPTION]... &#123;script-only-if-no-other-script&#125; [input-file]...</span><br><span class="line"></span><br><span class="line">	-r 	<span class="comment"># 支持扩展正则表达式</span></span><br><span class="line">	-n  <span class="comment"># 静默模式；</span></span><br><span class="line">	<span class="operator">-e</span>  <span class="comment"># 指定多脚本运行 eg: -e script1 -e script2 -e script3</span></span><br><span class="line">	<span class="operator">-f</span>  <span class="comment"># 从指定的文件中读取脚本并运行, -f /path/to/script_file</span></span><br><span class="line">	-i: <span class="comment"># 直接修改源文件；</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># script 的组成有两部分, 地址定界和边界命令</span></span><br><span class="line"><span class="comment">## 地址定界</span></span><br><span class="line">	<span class="comment"># 							# 指定行；</span></span><br><span class="line">	$							<span class="comment"># 最后一行；</span></span><br><span class="line">	/regexp/	  				<span class="comment"># 任何能够被regexp所匹配到的行；</span></span><br><span class="line">	\%regexp%					<span class="comment"># 同上，只不过换作%为regexp边界符；</span></span><br><span class="line">	/regexp/</span><br><span class="line">	\%regexp%|  				<span class="comment"># 匹配时忽略字符大小写；</span></span><br><span class="line">	startline,endline</span><br><span class="line">		<span class="comment">#,/regexp/				# 从#行开始，到第一次被/regexp/所匹配到的行结束，中间的所有行；</span></span><br><span class="line">		<span class="comment">#,#</span></span><br><span class="line">		/regexp1/,/regexp2/		<span class="comment"># 从第一次被/regexp1/匹配到的行开始，到第一次被/regexp2/匹配到的行结束，中间的所有行；</span></span><br><span class="line">		<span class="comment">#,+n					# 从#行开始，一直到向下的n行；</span></span><br><span class="line">	first~step 					<span class="comment"># 指定起始行，以及步长；</span></span><br><span class="line">		<span class="number">1</span>~<span class="number">2</span>，<span class="number">2</span>~<span class="number">2</span></span><br><span class="line"><span class="comment">## 编辑命令</span></span><br><span class="line">	d 						 	<span class="comment"># 删除模式空间中的行；</span></span><br><span class="line">	=						 	<span class="comment"># 显示行号；</span></span><br><span class="line">	a \text					 	<span class="comment"># 附加text</span></span><br><span class="line">	i \text					 	<span class="comment"># 插入text，支持\n实现多行插入；</span></span><br><span class="line">	c \text					 	<span class="comment"># 用text替换匹配到的行；</span></span><br><span class="line">	p 						 	<span class="comment"># 打印模式空间中的行；</span></span><br><span class="line">	s /regexp/replacement/g   	<span class="comment"># 替换由regexp所匹配到的内容为replacement;g全局替换；</span></span><br><span class="line">	w /path/to/somefile		 	<span class="comment"># 把指定的内容另存至/path/to/somefile路径所指定的文件中；</span></span><br><span class="line">	r /path/from/somefile	 	<span class="comment"># 在文件的指定位置插入另一个文件的所有内容，完成文件合并</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 高级命令</span></span><br><span class="line">	h	<span class="comment"># 将pattern space中的内容拷贝到hold space中，原来的hold space里的内容被清除</span></span><br><span class="line">	H	<span class="comment"># 将pattern space中的内容append到hold space\n后</span></span><br><span class="line">	g	<span class="comment"># 将hold space中的内容拷贝到pattern space中，原来pattern space里的内容清除</span></span><br><span class="line">	G	<span class="comment"># 将hold space中的内容append到pattern space\n后</span></span><br><span class="line">	x	<span class="comment"># 交换pattern space和hold space的内容</span></span><br><span class="line">	n	<span class="comment"># 读取匹配到的行的下一行至模式空间；（会覆盖模式空间中的原有内容）；</span></span><br><span class="line">	N	<span class="comment"># 读取匹配到的行的下一行至模式空间，追加在模式空间中原有内容的后面；</span></span><br><span class="line">	d	<span class="comment"># 删除模式空间中的内容；</span></span><br><span class="line">	D	<span class="comment"># 删除多行模式空间中的首行；</span></span><br><span class="line">		<span class="comment"># 注意：命令功能可使用!取反(对命令取反,eg: sed '1,3!d' 代表删除第1到3行之外的行)；分号可用于分隔脚本；</span></span><br></pre></td></tr></table></figure>
<h3 id="实践"><a class="header-anchor" href="#实践"></a>实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#0 /etc/fstab最初的内容</span></span><br><span class="line">$ cat /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1 删除/etc/fstab下以UUID开头的行</span></span><br><span class="line">$ sed <span class="string">'/^UUID/d'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 删除/etc/fstab第一至七行</span></span><br><span class="line">$ sed <span class="string">'1,7d'</span> /etc/fstab</span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 显示/etc/fstab第1到4行的行号</span></span><br><span class="line">$ sed <span class="string">'1,4='</span> /etc/fstab</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5 每一个UUID开头的行,后面附加一个new text</span></span><br><span class="line">$ sed <span class="string">'/^UUID/a \new text'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">new text</span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6 在以UUID开头行的前面插入new line, second line</span></span><br><span class="line">$ sed <span class="string">'/^UUID/i \new line.\second line.'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">new line.</span><br><span class="line">second line.</span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6 在以UUID开头行替换成new line.</span></span><br><span class="line">$ sed <span class="string">'/^UUID/c \new line.'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">new line.</span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#7 打印模式空间中的行,一定是匹配到的</span></span><br><span class="line">$ sed -n <span class="string">'/^UUID/p'</span> /etc/fstab</span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################查找替换命令################################</span></span><br><span class="line"><span class="comment">## 此时/etc/fstab中的内容</span></span><br><span class="line">$ cat /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=<span class="number">7</span>ad769dc-<span class="number">1</span>ec8-<span class="number">4582</span>-be29-<span class="number">8</span>f39cfd466ad / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#8 查找UUID开头,替换成小写的UUID</span></span><br><span class="line">$ sed <span class="string">'s/^UUID/uuid/'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">uuid=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">uuid=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">uuid=<span class="number">7</span>ad769dc-<span class="number">1</span>ec8-<span class="number">4582</span>-be29-<span class="number">8</span>f39cfd466ad / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#9 读取所有的奇数行,然后保存到/tmp/bak.log</span></span><br><span class="line">$ sed <span class="string">'1~2w /tmp/bak.log'</span> /etc/fstab</span><br><span class="line">$ cat /tmp/bak.log</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">sysfs                   /sys                    sysfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">none                  /proc/xen               xenfs		defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#10 在/etc/fstab 第5行后面插入某个文件的内容</span></span><br><span class="line">$ sed <span class="string">'5r /etc/passwd'</span> /ect/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line">root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br><span class="line">...</span><br><span class="line">bin:x:<span class="number">1</span>:<span class="number">1</span>:bin:/bin:/sbin/nologin</span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=<span class="number">7</span>ad769dc-<span class="number">1</span>ec8-<span class="number">4582</span>-be29-<span class="number">8</span>f39cfd466ad / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#11 删除/boot/grub2/grub.cfg文件中所有行的行首的空白字符；</span></span><br><span class="line">$ sed <span class="string">'s/^[[:space:]]\+//'</span> /boot/grub2/grub.cfg</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># DO NOT EDIT THIS FILE</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># It is automatically generated by grub2-mkconfig using templates</span></span><br><span class="line"><span class="comment"># from /etc/grub.d and settings from /etc/default/grub</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">### BEGIN /etc/grub.d/00_header ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#12 删除/etc/fstab文件中所有以#开头，后跟至少一个空白字符的行的行首的#和空白字符；</span></span><br><span class="line">$ sed <span class="string">'s/^#[[:space:]]\+//'</span> /etc/fstab</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/etc/fstab</span><br><span class="line">Created by anaconda on Thu Aug <span class="number">14</span> <span class="number">21</span>:<span class="number">16</span>:<span class="number">42</span> <span class="number">2014</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">Accessible filesystems, by reference, are maintained under <span class="string">'/dev/disk'</span></span><br><span class="line">See man pages fstab(<span class="number">5</span>), findfs(<span class="number">8</span>), mount(<span class="number">8</span>) and/or blkid(<span class="number">8</span>) <span class="keyword">for</span> more info</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=<span class="number">94</span>e4e384-<span class="number">0</span>ace-<span class="number">437</span>f-bc96-<span class="number">057</span>dd64f42ee / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=<span class="number">7</span>ad769dc-<span class="number">1</span>ec8-<span class="number">4582</span>-be29-<span class="number">8</span>f39cfd466ad / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#13 把/etc/fstab文件的奇数行另存为/tmp/fstab.3;</span></span><br><span class="line">$ sed <span class="string">'1~2w /tmp/fstab.3'</span> /etc/fstab</span><br><span class="line">$ cat /tmp/fstab.<span class="number">3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Aug 14 21:16:42 2014</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">UUID=a20840d4-<span class="number">638</span>c-<span class="number">4</span>c56-<span class="number">99</span>e8-ca0e9b15c516 / ext4 defaults,barrier=<span class="number">0</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">sysfs                   /sys                    sysfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">none                  /proc/xen               xenfs		defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#14 echo一个文件路径给sed命令, 取出其基名；</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'/tmp/test/'</span> | sed <span class="string">'s@^.*/\([^/]\+\)/\?$@\1@'</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#15 echo一个文件路径给sed命令, 取出其路径名</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'/tmp/test/'</span> | sed <span class="string">'s@[^/]\+/\?$@@'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 高级用法示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># test.log最初的数据</span></span><br><span class="line">$ cat test.log</span><br><span class="line">one line.</span><br><span class="line">second line.</span><br><span class="line">three line.</span><br><span class="line"></span><br><span class="line"><span class="comment">#16 在文件中的每行后方添加空白行</span></span><br><span class="line">$ sed <span class="string">'G'</span> test.log</span><br><span class="line">one line.</span><br><span class="line"></span><br><span class="line">second line.</span><br><span class="line"></span><br><span class="line">three line.</span><br><span class="line"></span><br><span class="line"><span class="comment">#17 保留最后一行</span></span><br><span class="line">$ sed <span class="string">'$1d'</span> test.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#18 保证指定的文件每一行后方有且只有一个空白行；</span></span><br><span class="line">$ sed <span class="string">'/^$/d;G'</span> test.log</span><br><span class="line">one line.</span><br><span class="line"></span><br><span class="line">second line.</span><br><span class="line"></span><br><span class="line">three line.</span><br><span class="line"></span><br><span class="line"><span class="comment">#19 保留奇数行</span></span><br><span class="line">$ sed <span class="string">'n;d'</span> test.log</span><br><span class="line">one line.</span><br><span class="line">three line.</span><br><span class="line"></span><br><span class="line"><span class="comment">#20 把/ect/issue中的内容倒置</span></span><br><span class="line">$ sed <span class="string">'1!G;h;$!d'</span> /etc/issue</span><br><span class="line"></span><br><span class="line"><span class="comment">#21 大写变小写</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'HELLO WOLRD'</span> | sed <span class="string">'s/[A-Z]/\L&amp;/g'</span></span><br><span class="line">hello wolrd</span><br><span class="line"></span><br><span class="line"><span class="comment">#21 小写变大写</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'hello world'</span> | sed <span class="string">'s/[a-z]/\U&amp;/g'</span></span><br><span class="line">HELLO WORLD</span><br></pre></td></tr></table></figure>
<p><strong>接下来我们看两个有趣的示例,用到的示例文件是:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat t.txt</span><br><span class="line">one</span><br><span class="line">two</span><br><span class="line">three</span><br></pre></td></tr></table></figure>
<p>第一个示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'H;g'</span> t.txt</span><br><span class="line">one</span><br><span class="line"></span><br><span class="line">one</span><br><span class="line">two</span><br><span class="line"></span><br><span class="line">one</span><br><span class="line">two</span><br><span class="line">three</span><br></pre></td></tr></table></figure>
<p>是不是有点没看懂，我作个图你就看懂了。</p>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-15/sed_demo_00.jpg" alt="sed 'H;g' t.txt" title="sed 'H;g' t.txt"></p>
<p>第二个示例，反序了一个文件的行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">'1!G;h;$!d'</span> t.txt</span><br><span class="line">three</span><br><span class="line">two</span><br><span class="line">one</span><br></pre></td></tr></table></figure>
<p>其中的 <code>1!G;h;$!d</code> 可拆解为三个命令</p>
<ul>
<li><code>1!G</code> —— 只有第一行不执行G命令，将hold space中的内容append回到pattern space</li>
<li><code>h</code> —— 第一行都执行h命令，将pattern space中的内容拷贝到hold space中</li>
<li><code>$!d</code> —— 除了最后一行不执行d命令，其它行都执行d命令，删除当前行</li>
</ul>
<p>这个执行序列很难理解，做个图如下大家就明白了</p>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-15/sed_demo.jpg" alt="sed '1!G;h;$!d' t.txt" title="sed '1!G;h;$!d' t.txt"></p>
<h2 id="awk"><a class="header-anchor" href="#awk"></a>Awk</h2>
<p><em>报告生成器, AWK a.k.a Aho, Weinberger, Kernighan, Gnu AWK, gawk</em></p>
<h3 id="语法-v2"><a class="header-anchor" href="#语法-v2"></a>语法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">awk [options] <span class="string">'program'</span> file file ...</span><br><span class="line">awk [options] <span class="string">'PATTERN&#123;action&#125;'</span> file file ...</span><br><span class="line"></span><br><span class="line"><span class="comment">## options</span></span><br><span class="line">	-F FS <span class="comment"># 只能分隔</span></span><br></pre></td></tr></table></figure>
<h3 id="awk-的输出"><a class="header-anchor" href="#awk-的输出"></a>awk 的输出</h3>
<p><code>print item1, item2,...</code></p>
<p><strong>要点</strong></p>
<ul>
<li>各项目之间使用逗号分隔，而输出时则使用输出分隔符分隔；</li>
<li>输出的各item可以字符串或数值、当前记录的字段、变量或awk的表达式；数值会被隐式转换为字符串后输出；</li>
<li>print后面item如果省略，相当于print $0；输出空白，使用pirnt &quot;&quot;；</li>
</ul>
<h3 id="awk-的变量"><a class="header-anchor" href="#awk-的变量"></a>awk 的变量</h3>
<p><em>内置变量，自定义变量</em></p>
<p><strong>(1) 内置变量</strong></p>
<ul>
<li>FS：Field Seperator, 输入时的字段分隔符</li>
<li>RS：Record Seperator, 输入行分隔符</li>
<li>OFS: Output Field Seperator, 输出时的字段分隔符;</li>
<li>ORS: Outpput Row Seperator, 输出时的行分隔符；</li>
<li>NF：Numbers of Field，字段数(<code>$NF</code>就变成最后一个字段的值)</li>
<li>NR：Numbers of Record, 行数；所有文件的一并计数；</li>
<li>FNR：行数；各文件分别计数；</li>
<li>ARGV：数组，保存命令本身这个字符，awk '{print $0}' 1.txt 2.txt，意味着ARGV[0]保存awk,</li>
<li>ARGC: 保存awk命令中参数的个数；</li>
<li>FILENAME： awk正在处理的当前文件的名称；</li>
</ul>
<p><strong>(2) 可自定义变量</strong></p>
<ul>
<li><code>-v var_name=VALUE</code> 变量名区分字符大小写；</li>
<li>(1) 可以program中定义变量；</li>
<li>(2) 可以命令行中通过-v选项自定义变量；</li>
</ul>
<h3 id="awk的printf命令"><a class="header-anchor" href="#awk的printf命令"></a>awk的printf命令</h3>
<p><strong>命令的使用格式</strong>：<code>printf format, item1, item2,...</code></p>
<p><strong>要点</strong></p>
<ul>
<li>要指定format；</li>
<li>不会自动换行；如需换行则需要给出<code>\n</code></li>
<li>format用于为后面的每个item指定其输出格式；</li>
</ul>
<p><strong>format格式的指示符都%开头，后跟一个字符</strong></p>
<ul>
<li>%c: 显示字符的ASCII码；</li>
<li>%d, %i: 十进制整数；</li>
<li>%e, %E: 科学计数法显示数值；</li>
<li>%f: 显示浮点数；</li>
<li>%g, %G: 以科学计数法格式或浮点数格式显示数值；</li>
<li>%s: 显示字符串；</li>
<li>%u: 显示无符号整数；</li>
<li>%%: 显示%自身；</li>
</ul>
<p><strong>修饰符</strong></p>
<ul>
<li>#：显示宽度</li>
<li>-：左对齐</li>
<li>+：显示数值的符号</li>
<li>.#: 取值精度</li>
</ul>
<h3 id="awk输出重定向"><a class="header-anchor" href="#awk输出重定向"></a>awk输出重定向</h3>
<ul>
<li><code>print items &gt; output-file</code></li>
<li><code>print items &gt;&gt; output-file</code></li>
<li><code>print items | command</code></li>
</ul>
<h3 id="awk模式"><a class="header-anchor" href="#awk模式"></a>awk模式</h3>
<ul>
<li>Regexp: 格式为<code>/PATTERN/</code>,仅处理被<code>/PATTERN/</code>匹配到的行；</li>
<li>Expression: 表达式，其结果为非0或非空字符串时满足条件；仅处理满足条件的行</li>
<li>Ranges: 行范围，此前地址定界，NR仅处理范围内的行</li>
<li>BEGIN/END: 特殊模式，仅在awk命令的program运行之前（BEGIN）或运行之后（END）执行一次；</li>
<li>Empty:空模式，匹配任意行；</li>
</ul>
<h3 id="awk控制语句"><a class="header-anchor" href="#awk控制语句"></a>awk控制语句</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>-else</span><br><span class="line"><span class="comment"># 格式：if (condition) &#123;then body&#125; else &#123;else body&#125;</span></span><br><span class="line">$ awk -F: <span class="string">'&#123;if ($3&gt;=500) &#123;print $1,"is a common user"&#125; else &#123;print $1, "is an admin or system user"&#125;&#125;'</span> /etc/passwd</span><br><span class="line">$ awk <span class="string">'&#123;if (NF&gt;=8) &#123;print&#125;&#125;'</span> /etc/inittab</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span></span><br><span class="line"><span class="comment"># 格式：while (condition) &#123;while body&#125;</span></span><br><span class="line">$ awk <span class="string">'&#123;i=1; while (i&lt;=NF)&#123;printf "%s ",$i;i+=2&#125;;print ""&#125;'</span> /etc/inittab</span><br><span class="line">$ awk <span class="string">'&#123;i=1; while (i&lt;=NF)&#123;if (length($i)&gt;=6) &#123;print $i&#125;; i++&#125;&#125;'</span> /etc/inittab</span><br><span class="line"></span><br><span class="line"><span class="comment"># length函数：取字符串的长度</span></span><br><span class="line">length()</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span>-while</span><br><span class="line"><span class="comment"># 格式：do &#123;do-while body&#125; while (condition)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#for</span></span><br><span class="line"><span class="comment"># 格式：for (variable assignment; condition; iteration process) &#123;for body&#125;</span></span><br><span class="line">$ awk <span class="string">'&#123;for (i=1;i&lt;=NF;i+=2)&#123;printf "%s ",$i&#125;;print ""&#125;'</span> /etc/inittab</span><br><span class="line">$ awk <span class="string">'&#123;for (i=1;i&lt;=NF;i++)&#123;if (length($i)&gt;=6) print $i&#125;&#125;'</span> /etc/inittab</span><br><span class="line"></span><br><span class="line"><span class="comment"># for循环可用来遍历数组元素：</span></span><br><span class="line">$ <span class="keyword">for</span> (i <span class="keyword">in</span> array) &#123;<span class="keyword">for</span> body&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># case语句</span></span><br><span class="line">switch (expression) &#123;<span class="keyword">case</span> VALUE or /RGEEXP/: statement1;... default: stementN&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环控制</span></span><br><span class="line"><span class="built_in">break</span></span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># next</span></span><br><span class="line"><span class="comment">#提前结束对本行的处理进而提前进入下一行的处理；</span></span><br><span class="line">$ awk -F: <span class="string">'&#123;if($3%2==0) next;print $1,$3&#125;'</span> /etc/passwd</span><br><span class="line">$ awk -F: <span class="string">'&#123;if(NR%2==0) next; print NR,$1&#125;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<h3 id="awk数组"><a class="header-anchor" href="#awk数组"></a>awk数组</h3>
<p>传统数组：Index编号从1开始；</p>
<p>关联数组：</p>
<p>(1) <code>array[index-expression]</code></p>
<p>index-expression: 可以使用任意字符串; 如果某数组元素事先不存在，那么在引用时，awk会自动创建此元素并将其初始化空串；因此，要判断某数组是否存在某元素，必须使用“index in array”这种格式；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A[first]=<span class="string">"hello awk"</span></span><br><span class="line"><span class="built_in">print</span> A[second]</span><br></pre></td></tr></table></figure>
<p>(2) 要遍历数组中的每一个元素，需要使用如下特殊结构：</p>
<p><code>for (var in array) {for body}</code></p>
<p>其var会遍历array的索引；</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">state[LISTEN]++</span><br><span class="line">state[ESTABLISHED]++</span><br><span class="line">$ netstat -tan | awk <span class="string">'/^tcp/&#123;++state[$NF]&#125;END&#123;for (s in state) &#123;print s,state[s]&#125;&#125;'</span></span><br><span class="line">$ awk <span class="string">'&#123;ip[$1]++&#125;END&#123;for (i in ip) &#123;print i,ip[i]&#125;&#125;'</span> /var/<span class="built_in">log</span>/httpd/access_<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
<p>(3) 删除数组元素：
<code>delete array[index]</code></p>
<h3 id="awk的内置函数"><a class="header-anchor" href="#awk的内置函数"></a>awk的内置函数</h3>
<p>(1) <code>split(string,array[,fieldsep[,seps]])</code></p>
<p>功能：将string表示的字符串以fieldsep为分隔符进行切片，并切片后的结果保存至array为名的数组中；数组下标从1开始；</p>
<p><code>root:x:0:0::/root:/bin/bash</code></p>
<p><code>user[1]=&quot;root&quot;, user[2]</code></p>
<p>此函数有返回值，返回值为切片后的元素的个数</p>
<p><code>$ netstat -tn | awk '/^tcp/{lens=split($5,client,&quot;:&quot;);ip[client[1]]++}END{for (i in ip) print i,ip[i]}'</code></p>
<p>(2) <code>length(string)</code></p>
<p>功能：返回给定字串的长度</p>
<p>(3) <code>substr(string,start[,length])</code></p>
<p>功能：从string中取子串，从start为起始位置为取length长度的子串；</p>
<h3 id="实践-v2"><a class="header-anchor" href="#实践-v2"></a>实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 把/etc/passwd按:切片</span></span><br><span class="line">$ awk -F: <span class="string">'&#123;print $1,$NF&#125;'</span> /etc/passwd</span><br><span class="line">postfix /sbin/nologin</span><br><span class="line">sshd /sbin/nologin</span><br><span class="line">avahi /sbin/nologin</span><br><span class="line">tcpdump /sbin/nologin</span><br><span class="line">kernel /bin/bash</span><br><span class="line">gentoo /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 内置变量NR,FNR(行号不同)</span></span><br><span class="line">$ awk <span class="string">'&#123;print NR, $0&#125;'</span> /etc/fstab /etc/issue</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="comment">#</span></span><br><span class="line"><span class="number">3</span> <span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="number">4</span> <span class="comment"># Created by anaconda on Sat Sep 12 17:37:10 2015</span></span><br><span class="line"><span class="number">5</span> <span class="comment">#</span></span><br><span class="line"><span class="number">6</span> <span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="number">7</span> <span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="number">8</span> <span class="comment">#</span></span><br><span class="line"><span class="number">9</span> /dev/mapper/centos_kernel-root	/       xfs     defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">11</span> /dev/mapper/centos_kernel-home	/home   xfs     defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">12</span> /dev/mapper/centos_kernel-swap	swap    swap    defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">13</span> /dev/sda5						/data	ext4	defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">14</span> /dev/sda7						swap	swap	defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">15</span> \S</span><br><span class="line"><span class="number">16</span> Kernel \r on an \m</span><br><span class="line"><span class="number">17</span></span><br><span class="line"></span><br><span class="line">$ awk <span class="string">'&#123;print FNR, $0&#125;'</span> /etc/fstab /etc/issue</span><br><span class="line">$ awk <span class="string">'&#123;print NR, $0&#125;'</span> /etc/fstab /etc/issue</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span> <span class="comment">#</span></span><br><span class="line"><span class="number">3</span> <span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="number">4</span> <span class="comment"># Created by anaconda on Sat Sep 12 17:37:10 2015</span></span><br><span class="line"><span class="number">5</span> <span class="comment">#</span></span><br><span class="line"><span class="number">6</span> <span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="number">7</span> <span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="number">8</span> <span class="comment">#</span></span><br><span class="line"><span class="number">9</span> /dev/mapper/centos_kernel-root	/       xfs     defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">11</span> /dev/mapper/centos_kernel-home	/home   xfs     defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">12</span> /dev/mapper/centos_kernel-swap	swap    swap    defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">13</span> /dev/sda5						/data	ext4	defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">14</span> /dev/sda7						swap	swap	defaults   <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span> \S</span><br><span class="line"><span class="number">2</span> Kernel \r on an \m</span><br><span class="line"><span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 /etc/grub2.cfg 中每一行拥有的字段数</span></span><br><span class="line">$ awk <span class="string">'&#123;print NF&#125;'</span> /etc/grub2.cfg</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">9</span></span><br><span class="line"><span class="number">7</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">#4 打印/etc/passwd第一字段和最后一字段</span></span><br><span class="line">$ awk -F: <span class="string">'BEGIN&#123;printf "%-20s%-10s\n", "USER", "SHELL"&#125;;&#123;printf "%-20s%-10s\n", $1, $NF&#125;'</span> /etc/passwd</span><br><span class="line">USER                SHELL</span><br><span class="line">root                /bin/bash</span><br><span class="line">bin                 /sbin/nologin</span><br><span class="line">daemon              /sbin/nologin</span><br><span class="line">adm                 /sbin/nologin</span><br><span class="line">lp                  /sbin/nologin</span><br><span class="line">sync                /bin/sync</span><br><span class="line">shutdown            /sbin/shutdown</span><br><span class="line">halt                /sbin/halt</span><br><span class="line">mail                /sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 演示自定义变量</span></span><br><span class="line">$ awk -v <span class="built_in">test</span>=<span class="string">'hello'</span> -F: <span class="string">'&#123;print test, $1&#125;'</span> /etc/passwd</span><br><span class="line">hello root</span><br><span class="line">hello bin</span><br><span class="line">hello daemon</span><br><span class="line">hello adm</span><br><span class="line">hello lp</span><br><span class="line">hello sync</span><br><span class="line"></span><br><span class="line"><span class="comment">#6 演示条件表达式</span></span><br><span class="line">$ awk -F: <span class="string">'&#123;$3&gt;=1000?utype="common user":utype="admin or sys user"; print $1, "is a", utype&#125;'</span> /etc/passwd</span><br><span class="line">postfix is a admin or sys user</span><br><span class="line">sshd is a admin or sys user</span><br><span class="line">avahi is a admin or sys user</span><br><span class="line">tcpdump is a admin or sys user</span><br><span class="line">kernel is a common user</span><br><span class="line">gentoo is a common user</span><br><span class="line"></span><br><span class="line"><span class="comment">#7 显示/etc/fstab,以UUID开头的第三个字段</span></span><br><span class="line">$ awk <span class="string">'/^(UUID|uuid)/&#123;print $1, $3&#125;'</span> /etc/fstab</span><br><span class="line">UUID=<span class="number">944</span>c8505-<span class="number">929</span>d-<span class="number">42</span><span class="built_in">cd</span>-<span class="number">8</span>d3f-cc2f66c7df55 xfs</span><br><span class="line"></span><br><span class="line"><span class="comment">#8 如果用户的ID大于1000,就把它的用户名ID显示出来</span></span><br><span class="line">$ awk -F: <span class="string">'$3&gt;=1000&#123;print $1, $3&#125;'</span> /etc/passwd</span><br><span class="line">nfsnobody <span class="number">65534</span></span><br><span class="line">kernel <span class="number">1000</span></span><br><span class="line">gentoo <span class="number">1001</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#9 如果用户的shell是bash,就把它的用户名,shell显示出来</span></span><br><span class="line">$ awk -F: <span class="string">'$NF~/bash$/&#123;print $1, $NF&#125;'</span> /etc/passwd</span><br><span class="line">root /bin/bash</span><br><span class="line">kernel /bin/bash</span><br><span class="line">gentoo /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#10 处理指定的行,显示/etc/passwd第3-6行</span></span><br><span class="line">$ awk -F: <span class="string">'NR&gt;=3&amp;&amp;NR&lt;=6&#123;print NR, $1, $NF&#125;'</span> /etc/passwd</span><br><span class="line"><span class="number">3</span> daemon /sbin/nologin</span><br><span class="line"><span class="number">4</span> adm /sbin/nologin</span><br><span class="line"><span class="number">5</span> lp /sbin/nologin</span><br><span class="line"><span class="number">6</span> sync /bin/sync</span><br><span class="line"></span><br><span class="line"><span class="comment">#11 读取/etc/passwd文件的偶数行</span></span><br><span class="line">$ awk <span class="string">'&#123;if(NR%2) next; print NR, $0&#125;'</span> /etc/passwd</span><br><span class="line"><span class="number">2</span> bin:x:<span class="number">1</span>:<span class="number">1</span>:bin:/bin:/sbin/nologin</span><br><span class="line"><span class="number">4</span> adm:x:<span class="number">3</span>:<span class="number">4</span>:adm:/var/adm:/sbin/nologin</span><br><span class="line"><span class="number">6</span> sync:x:<span class="number">5</span>:<span class="number">0</span>:sync:/sbin:/bin/sync</span><br><span class="line"><span class="number">8</span> halt:x:<span class="number">7</span>:<span class="number">0</span>:halt:/sbin:/sbin/halt</span><br><span class="line"><span class="number">10</span> operator:x:<span class="number">11</span>:<span class="number">0</span>:operator:/root:/sbin/nologin</span><br><span class="line"><span class="number">12</span> ftp:x:<span class="number">14</span>:<span class="number">50</span>:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line"><span class="number">14</span> dbus:x:<span class="number">81</span>:<span class="number">81</span>:System message bus:/:/sbin/nologin</span><br><span class="line"><span class="number">16</span> tss:x:<span class="number">59</span>:<span class="number">59</span>:<span class="number">1</span>:/dev/null:/sbin/nologin</span><br><span class="line"><span class="number">18</span> usbmuxd:x:<span class="number">113</span>:<span class="number">113</span>:usbmuxd user:/:/sbin/nologin</span><br><span class="line"><span class="number">20</span> libstoragemgmt:x:<span class="number">997</span>:<span class="number">995</span>:<span class="number">1</span>:/var/run/lsm:/sbin/nologin</span><br><span class="line"><span class="number">22</span> rpc:x:<span class="number">32</span>:<span class="number">32</span>:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin</span><br><span class="line"><span class="number">24</span> radvd:x:<span class="number">75</span>:<span class="number">75</span>:radvd user:/:/sbin/nologin</span><br><span class="line"><span class="number">26</span> nfsnobody:x:<span class="number">65534</span>:<span class="number">65534</span>:nfs:/var/lib/nfs:/sbin/nologin</span><br><span class="line"><span class="number">28</span> chrony:x:<span class="number">995</span>:<span class="number">994</span>::/var/lib/chrony:/sbin/nologin</span><br><span class="line"><span class="number">30</span> sssd:x:<span class="number">994</span>:<span class="number">993</span>:User <span class="keyword">for</span> sssd:/:/sbin/nologin</span><br><span class="line"><span class="number">32</span> unbound:x:<span class="number">993</span>:<span class="number">992</span>:b:/etc/unbound:/sbin/nologin</span><br><span class="line"><span class="number">34</span> gdm:x:<span class="number">42</span>:<span class="number">42</span>::/var/lib/gdm:/sbin/nologin</span><br><span class="line"><span class="number">36</span> postfix:x:<span class="number">89</span>:<span class="number">89</span>::/var/spool/postfix:/sbin/nologin</span><br><span class="line"><span class="number">38</span> avahi:x:<span class="number">70</span>:<span class="number">70</span>:s:/sbin/nologin</span><br><span class="line"><span class="number">40</span> kernel:x:<span class="number">1000</span>:<span class="number">1000</span>:kernel:/home/kernel:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#12 测试自定义数组</span></span><br><span class="line">$ awk <span class="string">'BEGIN&#123;arr["mon"]="monday";arr["tue"]="tuesday";for(idx in arr)&#123;print arr[idx]&#125;&#125;'</span></span><br><span class="line">tuesday</span><br><span class="line">monday</span><br><span class="line"></span><br><span class="line"><span class="comment">#13 按最后一个字段统计</span></span><br><span class="line">netstat -tan | awk <span class="string">'/^tcp/&#123;state[$NF]++&#125;END&#123;for(idx in state)&#123;print idx,state[idx]&#125;&#125;'</span> | sort</span><br><span class="line">ESTABLISHED <span class="number">2</span></span><br><span class="line">LISTEN <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#14 统计某个IP的访问次数</span></span><br><span class="line">$ awk <span class="string">'&#123;ip[$1]++&#125;END&#123;for(idx in ip)&#123;print idx, ip[idx]&#125;&#125;'</span> /var/<span class="built_in">log</span>/httpd/access_<span class="built_in">log</span></span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.102</span> <span class="number">67</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">10000</span></span><br><span class="line"><span class="number">192.168</span>.<span class="number">1.160</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="sed"><a class="header-anchor" href="#sed"></a>Sed</h2>
<p><em>Sed Stream editor</em></p>
<p>sed和awk是用户、程序员和管理员应用的工具。之所以称为sed是因为它是一个流编辑器（stream editor），用于对许多文件执行一系列的编辑操作。awk是根据它的开发者Aho、Weinberger和Kernighan命名的。awk是一种编程语言，它可以使你很容易地处理结构化数据和生成格式化报告。</p>
<p>Sed的工作方式,一次从文件中读取一行到<code>pattern space</code>,然后判断这一行是不是我们需要编辑的行,如何符合条件则对其进行处理,</p>
<p>处理完之后把处理的结果输出到屏幕上.如果不符合要求也输出到屏幕上来(Sed的默认操作,称之为打印模式空间).</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-13]]></title>
    <link href="http://molloc.me/2015/09/13/ZY-2015-09-13/"/>
    <id>http://molloc.me/2015/09/13/ZY-2015-09-13/</id>
    <published>2015-09-13T15:19:32.000Z</published>
    <updated>2015-09-20T16:33:30.416Z</updated>
    <content type="html"><![CDATA[<h2 id="shell"><a class="header-anchor" href="#shell"></a>Shell</h2>
<p>注意本文讨论的是Bash，而不一定是/bin/sh所链接的那个shell。这里出现的所有代码片段，默认在顶上都添加了<code>#!/bin/bash</code>。</p>
<p>计算机理解语言的 0 和 1 的称为二进制语言。</p>
<p>在早期的计算机时代，指令提供使用二进制语言，很难对我们所有人，读和写。所以在 Os 中是叫 Shell 的特别节目。壳 (大部分) 接受你的指令或命令在英语中的，如果它是一个有效的命令，它是传递给内核。</p>
<p>外壳是用户或程序是提供用户交互环境。Shell 是命令语言解释器执行命令从标准输入设备 (键盘) 或从文件读取。</p>
<p><code>Shell</code>不是系统内核的一部分，但使用系统内核执行程序、 创建文件等。</p>
<a id="more"></a>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-09-13/linux-system-call.png" alt="linux-system-call.png"></p>
<h2 id="进程"><a class="header-anchor" href="#进程"></a>进程</h2>
<ul>
<li>守护进程,服务进程: 启动,开机时自动启动.</li>
<li>交互式进程: shell应用程序</li>
</ul>
<h2 id="shell应用程序"><a class="header-anchor" href="#shell应用程序"></a>shell应用程序</h2>
<p><em>广义上分为: GUI,CLI</em></p>
<h3 id="cli"><a class="header-anchor" href="#cli"></a>CLI</h3>
<p><em>由<code>prompt(#|$) COMMAND options arguments</code> 组成, 在进行词法分析</em></p>
<p>命令有有内建命令,外部命令(PATH)之分.把一系列命令写在一个文件中,称为shell脚本.</p>
<p>脚本或程序源文件执行的两种方式:</p>
<ul>
<li>编译执行: 预处理 --&gt; 编译 --&gt; 链接; 事先完成,最终生成二进制文件.</li>
<li>解释执行: 有解释器全程参与运行过程, 每次读取一行, 运行一行.</li>
</ul>
<h2 id="程序"><a class="header-anchor" href="#程序"></a>程序</h2>
<ul>
<li>程序：指令+数据</li>
<li>过程式编程：以指令为中心，设计算法，数据服务于算法；</li>
<li>对象式编程：以数据为中心，设计数据结构(类)，程序服务于数据结构</li>
</ul>
<h3 id="python：编程库"><a class="header-anchor" href="#python：编程库"></a>Python：编程库</h3>
<ul>
<li>程序控制结构，调用编程库完成程序编写；</li>
<li>库文件：功能模块，在编程中可调用；通过其API；</li>
</ul>
<h3 id="bash：编程"><a class="header-anchor" href="#bash：编程"></a>Bash：编程</h3>
<ul>
<li>程序控制结构，调用机器上命令程序文件进行程序编写；</li>
<li>外部命令：各应用程序提供；</li>
</ul>
<h3 id="bash过程式编程"><a class="header-anchor" href="#bash过程式编程"></a>bash过程式编程</h3>
<ul>
<li>顺序执行：逐个执行</li>
<li>选择执行：只执行其中一个分支</li>
<li>循环执行：一段代码要执行0,1或多遍</li>
<li>编程元素：变量、流程、函数</li>
</ul>
<h2 id="shell基本语法"><a class="header-anchor" href="#shell基本语法"></a>Shell基本语法</h2>
<h3 id="变量"><a class="header-anchor" href="#变量"></a>变量</h3>
<ul>
<li>本地变量：当前shell进程；</li>
<li>环境变量：当前shell进程及其子进程；</li>
<li>局部变量：某个函数执行过程；</li>
<li>位置参数变量：在脚本中引用传递给脚本的参数；在函数中引用传递给函数的参数；</li>
<li>特殊变量：<code>$?, $*, $@, $#, $$</code></li>
</ul>
<h3 id="引用"><a class="header-anchor" href="#引用"></a>引用</h3>
<ul>
<li>弱引用: &quot;&quot;, 其内部的变量引用会被替换为变量值；</li>
<li>强引用：''，其变量的变量引用会保持原有字符；</li>
<li>命令引用：<code>COMMAND</code>, <code>$(COMMAND)</code>，引用命令的执行结果；</li>
</ul>
<h3 id="本地变量"><a class="header-anchor" href="#本地变量"></a>本地变量</h3>
<p>变量名：只能包含数字、字母和下划线；且不能以数字开头；
引用变量：${name}, $name</p>
<h3 id="声明"><a class="header-anchor" href="#声明"></a>声明</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> -i name[=value]</span><br><span class="line"><span class="built_in">let</span> name=value</span><br></pre></td></tr></table></figure>
<p>查看所有变量<code>set</code>, 手动销毁变量<code>unset name</code></p>
<h3 id="环境变量"><a class="header-anchor" href="#环境变量"></a>环境变量</h3>
<p>被&quot;导出&quot;的本地变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> name[=value]</span><br><span class="line"><span class="built_in">declare</span> -x name[=value]</span><br></pre></td></tr></table></figure>
<p>查看所有环境变量<code>env, printenv, export</code>, 销毁<code>unset name</code></p>
<p>变量的类型作用: 存储空间, 运算, 存储格式;</p>
<p>Bash变量只有两种类型，字符串和数组。不过从严格意义上，Bash没有变量类型。Bash中的变量，在运行的时候会被展开成其对应的值（字符串）。你可以把它看做C/C++中的宏定义，或者一些模板语言中的占位符。</p>
<p>一般情况下，变量通过=赋值，注意=两边不要留空格。有些好孩子，已经养成了符号两端留空格的习惯，结果当开始写Bash的时候，他们抓狂了。</p>
<p>要想访问变量，只需在变量名前面添加<code>$</code>，解释器就会对它进行展开。如果该变量并不存在，解释器会把它展开成“”。</p>
<p>作为脚本语言，第一要义当然是要随时随地获取到命令行输入啦。</p>
<p>在Bash中，使用<code>$1</code>可以获取命令行输入的第一个参数，<code>$2</code>可以获取命令行输入的第2个参数，<code>$3</code>可以获取命令行输入的第......
你看，<code>$1</code>到<code>$10000</code>的用法就这么交代完了。Bash还是挺有逻辑的嘛。</p>
<p>顺便一提，<code>$0</code>获取的脚本的名字（其实就是其他语言中的第0个参数），<code>$@</code>获取所有的参数，<code>$#</code>获取参数的数目。记住<code>@</code>和<code>#</code>这两个符号，在Bash这一神秘的符文体系中，前者表示全部参数，后者表示参数的数目。</p>
<p>假如Bash变量中含有空白字符，或者含有特殊字符，比如<code>*</code>，展开后会污染到外面的字符串.所以需要加双引号括起来.</p>
<p>另外一种Bomb的可能是，变量后面需要接其它字符串，比如<code>$FRUITs</code>。如果想让解释器识别成<code>$FRUIT</code>变量，而不是<code>$FRUITs</code>，需要用花括号括起来，像<code>${FRUIT}s</code></p>
<p>Bash中可以使用两种容器。</p>
<p>一种是数组，另一种是关联数组，类似于其他语言中的<code>Map/Hash/Dict</code>。</p>
<ul>
<li>声明数组的常用语法： <code>declare -a ARY</code>或者<code>ARY=(1 2 3)</code></li>
<li>声明关联数组的唯一语法： <code>declare -A MAP</code></li>
</ul>
<p>赋值的语法：</p>
<ul>
<li>直接<code>ARY[N]=VALUE</code>，<code>N</code>可以是数字索引也可以是键。</li>
<li>关联数组可以使用<code>MAP=([x]=a [y]=b)</code>进行多项赋值。</li>
</ul>
<p>注意这是赋值的语句而不是声明。数组中的索引不一定要按顺序来，你可以先给2和3上的元素赋值。</p>
<p>往现有数组批量添加元素：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ARY+=(a b c)</span><br><span class="line">MAP+=([a]=<span class="number">1</span> [b]=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>取值：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;ARY[INDEX]&#125;</span></span><br><span class="line"><span class="variable">$&#123;MAP[KEY]&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="花括号的使用"><a class="header-anchor" href="#花括号的使用"></a>花括号的使用</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;A[@]&#125;</span>   		<span class="comment"># 展开成所有的变量，</span></span><br><span class="line"><span class="variable">$&#123;#A[@]&#125;</span>  		<span class="comment"># 而获取数组长度使用</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;ARY[@]:N:M&#125;</span> 	<span class="comment"># N是offset而M是length</span></span><br><span class="line"><span class="variable">$&#123;!MAP[@]&#125;</span> 		<span class="comment"># 返回索引，相当于keys()</span></span><br></pre></td></tr></table></figure>
<p>试试下面的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">declare</span> <span class="operator">-a</span> ARY</span><br><span class="line"><span class="built_in">declare</span> -A MAP</span><br><span class="line">MAP+=([a]=<span class="number">1</span> [b]=<span class="number">2</span>)</span><br><span class="line">ARY+=(a b c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;ARY[1]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;MAP[a]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;ARY[@]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;MAP[@]&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;ARY[@]:0:1&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;#ARY[@]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;!MAP[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">ARY[<span class="number">4</span>]=a</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;ARY[@]&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;ARY[3]&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="变量-字符串-变换"><a class="header-anchor" href="#变量-字符串-变换"></a>变量（字符串）变换</h3>
<p>Bash中的变量变换，大体是${变量[操作符]}的形式</p>
<h3 id="大小写变换"><a class="header-anchor" href="#大小写变换"></a>大小写变换</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HI=HellO</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$HI</span>"</span> <span class="comment"># HellO</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI^&#125;</span> <span class="comment"># HellO</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI^^&#125;</span> <span class="comment"># HELLO</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI,&#125;</span> <span class="comment"># hellO</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI,,&#125;</span> <span class="comment"># hello</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI~&#125;</span> <span class="comment"># hellO</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;HI~~&#125;</span> <span class="comment">#hELLo</span></span><br></pre></td></tr></table></figure>
<p><code>^</code>大写，<code>,</code>小写， <code>~</code>大小写切换</p>
<p>重复一次只修改首字母，重复两次则应用于所有字母。</p>
<p>混着用会怎样？</p>
<p><code>echo ${HI^,^} # HellO</code></p>
<p>看来是不行的×_×</p>
<h3 id="移除匹配的字符串"><a class="header-anchor" href="#移除匹配的字符串"></a>移除匹配的字符串</h3>
<ul>
<li><code>%xx</code> 从后往前，开始匹配，移除匹配的内容</li>
<li><code>%%xx</code> 跟上面的差不多，不过这是贪婪匹配</li>
<li><code>#xx</code> 从前往后，开始匹配，移除匹配的内容</li>
<li><code>##xx</code> 跟上面的差不多，不过这是贪婪匹配</li>
</ul>
<p>这个比较难理解，不过看下面几个例子应该能明白了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FILENAME=/home/spacewander/param.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME%/*&#125;</span> <span class="comment"># /home/spacewander</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME%%/*&#125;</span> <span class="comment">#</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME#*/&#125;</span> <span class="comment"># home/spacewander/param.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME##*/&#125;</span> <span class="comment"># param.sh</span></span><br></pre></td></tr></table></figure>
<h3 id="查找并替换"><a class="header-anchor" href="#查找并替换"></a>查找并替换</h3>
<ul>
<li><code>/MATCH/VALUE</code> 替换第一个匹配的内容。</li>
<li><code>//MATCH/VALUE</code> 替换匹配的内容</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME/home/office&#125;</span> <span class="comment"># /office/spacewander/param.sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;FILENAME//s/S&#125;</span> <span class="comment"># /home/Spacewander/param.Sh</span></span><br></pre></td></tr></table></figure>
<h3 id="其它字符串操作"><a class="header-anchor" href="#其它字符串操作"></a>其它字符串操作</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#FILENAME&#125;</span> 		<span class="comment"># 获取变量（字符串）长度：</span></span><br><span class="line"><span class="variable">$&#123;STR:offset:len&#125;</span> 	<span class="comment"># 字符串切片：跟数组切片是同样的语法，</span></span><br><span class="line"></span><br><span class="line">TEXT=这个程序充满了BUG!</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;TEXT:0:8&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;TEXT:4&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 你还可以使用负数作为offset，这时候就是从后往前算起。注意负数要用括号括起来，避免冲突。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;TEXT:(-4)&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="关于变量-其它的内容"><a class="header-anchor" href="#关于变量-其它的内容"></a>关于变量，其它的内容</h3>
<p>Bash中有一项特性，你可以方便地检查某个变量是否设置了，如果没有设置，就赋予一个默认值。尤其在处理环境变量的时候，这项特性会让你感到欣慰。</p>
<p>语法是<code>${VAR:=VALUE}</code>或者<code>${VAR:=VALUE}</code>。此外，还有一个相似的语法，<code>${VAR:=VALUE}</code>和<code>${VAR：=VALUE}</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 当变量未定义或者值为空时,返回值为word的内容,否则返回变量的值.</span></span><br><span class="line"><span class="variable">$&#123;value:-word&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 与前者类似,只是若变量未定义或者值为空时,在返回word的值的同时将word赋值给value</span></span><br><span class="line"><span class="variable">$&#123;value:=word&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 若变量已赋值的话,正常替换.否则将消息message送到标准错误输出(若此替换出现在Shell程序中,那么该程序将终止运行)</span></span><br><span class="line"><span class="variable">$&#123;value:?message&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 若变量已赋值的话,其值才用word替换,否则不进行任何替换</span></span><br><span class="line"><span class="variable">$&#123;value:+word&#125;</span></span><br></pre></td></tr></table></figure>
<p>下面展示下两者的区别</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># expand to default variable</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NULL-"Not null"&#125;</span> <span class="comment"># Not null</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NULL&#125;</span> <span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set default variable</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NIL="Not nil"&#125;</span> <span class="comment"># Not nil</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;NIL&#125;</span> <span class="comment"># Not nil</span></span><br></pre></td></tr></table></figure>
<p>可以看出，前者只是当变量不存在时，展开成指定的值。而后者在变量不存在时，将变量的值设置为指定值。</p>
<p>最后介绍一个，当目标变量不存在时，指定报错信息的语法。</p>
<p><code>echo ${TARGET?Not Found}</code> 当<code>$TARGET</code>不存在时，显示<code>TARGET: Not Found</code>，并结束程序。</p>
<hr>
<h2 id="脚本"><a class="header-anchor" href="#脚本"></a>脚本</h2>
<p>运行脚本：事实上是运行一个bash进程，此进程负责从脚本文件中读取一个执行逻辑，而后由bash进程负责解析并运行此逻辑。</p>
<h3 id="启动脚本"><a class="header-anchor" href="#启动脚本"></a>启动脚本</h3>
<ul>
<li><code>bash /PATH/TO/SCRIPT_FILE</code></li>
<li>一个执行权限，<code>./PATH/TO/SCRIPT_FILE</code></li>
</ul>
<h3 id="bash的常用选项"><a class="header-anchor" href="#bash的常用选项"></a>bash的常用选项</h3>
<ul>
<li><code>-n</code> 检查脚本中的语法错误。</li>
<li><code>-x</code> 调试执行脚本。</li>
</ul>
<h3 id="命令的状态结果"><a class="header-anchor" href="#命令的状态结果"></a>命令的状态结果</h3>
<p>bash进程用于追踪执行的命令成功与否的状态：</p>
<ul>
<li><code>0</code> 成功。</li>
<li><code>1-255</code> 失败。</li>
<li>特殊变量<code>$?</code>，上一条命令的执行状态结果。</li>
<li>自定义脚本的状态结果<code>exit [n]</code>。</li>
</ul>
<h3 id="条件测试"><a class="header-anchor" href="#条件测试"></a>条件测试</h3>
<p>界定程序执行环境</p>
<ul>
<li>根据运行命令的状态结果。</li>
<li>测试表达式<code>test EXPRESSION</code>,<code>[ EXPRESSION ]</code>,<code>[[ EXPRESSION ]]</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 整数测试：隐含着做数值大小比较，所以不要给变量引用加引用；</span></span><br><span class="line"><span class="variable">$A</span> <span class="operator">-gt</span> <span class="variable">$B</span> <span class="comment"># 大于</span></span><br><span class="line"><span class="variable">$A</span> -ge <span class="variable">$B</span> <span class="comment"># 大于等于</span></span><br><span class="line"><span class="variable">$A</span> <span class="operator">-lt</span> <span class="variable">$B</span> <span class="comment"># 小于</span></span><br><span class="line"><span class="variable">$A</span> -le <span class="variable">$B</span> <span class="comment"># 小于等于</span></span><br><span class="line"><span class="variable">$A</span> <span class="operator">-eq</span> <span class="variable">$B</span> <span class="comment"># 等于</span></span><br><span class="line"><span class="variable">$A</span> <span class="operator">-ne</span> <span class="variable">$B</span> <span class="comment"># 不等于</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 字符串测试：ASCII数值越大，字符比较时其值越大；</span></span><br><span class="line"><span class="string">"<span class="variable">$A</span>"</span> &gt; <span class="string">"<span class="variable">$B</span>"</span>  	<span class="comment"># 大于</span></span><br><span class="line"><span class="string">"<span class="variable">$A</span>"</span> &lt; <span class="string">"<span class="variable">$B</span>"</span>  	<span class="comment"># 小于</span></span><br><span class="line"><span class="string">"<span class="variable">$A</span>"</span> == <span class="string">"<span class="variable">$B</span>"</span> 	<span class="comment"># 等于</span></span><br><span class="line"><span class="string">"<span class="variable">$A</span>"</span> != <span class="string">"<span class="variable">$B</span>"</span>  	<span class="comment"># 不等于</span></span><br><span class="line">-z <span class="string">"<span class="variable">$B</span>"</span>  		<span class="comment"># 为空</span></span><br><span class="line">-n <span class="string">"<span class="variable">$B</span>"</span>  		<span class="comment"># 不为空</span></span><br><span class="line"><span class="comment"># 注意, 用[]的时候&lt;,&gt;需要转义为\&lt;,\&gt;,用[[EXPRESSION]]的时候不需要转义,建议使用[[]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 文件测试：测试文件的存在性以及属性；</span></span><br><span class="line"><span class="string">"-a <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在</span></span><br><span class="line"><span class="string">"-b <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为块设备文件</span></span><br><span class="line"><span class="string">"-c <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为字符设备文件</span></span><br><span class="line"><span class="string">"-d <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为目录</span></span><br><span class="line"><span class="string">"-e <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在</span></span><br><span class="line"><span class="string">"-f <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为普通文件</span></span><br><span class="line"><span class="string">"-g <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且有SGID权限</span></span><br><span class="line"><span class="string">"-h <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为符号链接文件</span></span><br><span class="line"><span class="string">"-k <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且具有Sticky bit权限</span></span><br><span class="line"><span class="string">"-p <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为管道文件</span></span><br><span class="line"><span class="string">"-r <span class="variable">$file</span>"</span>		<span class="comment"># 当前用户对文件是否拥有读权限</span></span><br><span class="line"><span class="string">"-s <span class="variable">$file</span>"</span>		<span class="comment"># 检测文件名是否存在且为非空白文件(filesize &gt; 0)</span></span><br><span class="line"><span class="string">"-t <span class="variable">$file</span>"</span>		<span class="comment"># <span class="doctag"><span class="keyword">TODO</span></span></span></span><br><span class="line"><span class="string">"-u <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且具有SUID权限</span></span><br><span class="line"><span class="string">"-w <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且具有可写权限</span></span><br><span class="line"><span class="string">"-x <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且具有执行权限</span></span><br><span class="line"><span class="string">"-G <span class="variable">$file</span>"</span>		<span class="comment"># 当前用户是否为指定文件的属组</span></span><br><span class="line"><span class="string">"-L <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为符号链接文件</span></span><br><span class="line"><span class="string">"-O <span class="variable">$file</span>"</span>		<span class="comment"># 当前用户是否为指定文件的属主</span></span><br><span class="line"><span class="string">"-S <span class="variable">$file</span>"</span>		<span class="comment"># 是否存在且为套接字文件</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$file1</span> -nt <span class="variable">$file2</span> <span class="comment"># file1是否新于file2, file1的最近一次的修改时间戳是否晚于file2的；</span></span><br><span class="line"><span class="variable">$file1</span> -ot <span class="variable">$file2</span> <span class="comment"># file1是否旧于file2, file1的最近一次的修改时间戳是否早于file2的；</span></span><br><span class="line"><span class="variable">$file1</span> -ef <span class="variable">$file2</span> <span class="comment"># file1与file2是否指向了同一个inode；测试二者是否为同一个文件的硬链接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 模式匹配测试</span></span><br><span class="line">[[ <span class="string">"STRING"</span> =~ PATTERN ]] <span class="comment"># 模式匹配测试：</span></span><br></pre></td></tr></table></figure>
<h3 id="组合测试条件"><a class="header-anchor" href="#组合测试条件"></a>组合测试条件</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 表达式组合</span></span><br><span class="line">[[ CONDITION1 <span class="operator">-a</span> CONDITION2 ]] <span class="comment"># 与</span></span><br><span class="line">[[ CONDITION1 -o CONDITION2 ]] <span class="comment"># 或</span></span><br><span class="line">[ ! CONDITION ]   			   <span class="comment"># 取反</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 命令组合</span></span><br><span class="line">COMMAND1 &amp;&amp; COMMAND2  &lt;-- [ EXPR1 ] &amp;&amp; [ EXPR2 ]</span><br><span class="line">COMMAND1 || COMMAND2</span><br><span class="line">! COMMAND</span><br></pre></td></tr></table></figure>
<h3 id="短路操作符"><a class="header-anchor" href="#短路操作符"></a>短路操作符<code>&amp;&amp;</code>,<code>||</code></h3>
<h3 id="特殊设备"><a class="header-anchor" href="#特殊设备"></a>特殊设备</h3>
<ul>
<li><code>/dev/null</code> 空，bit buckets，吞下所有数据，并直接丢弃</li>
<li><code>/dev/zero</code> 吐出一堆0</li>
</ul>
<h3 id="条件判断"><a class="header-anchor" href="#条件判断"></a>条件判断</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax</span></span><br><span class="line"><span class="comment">#1 if/then, cash</span></span><br><span class="line"><span class="keyword">if</span> CONDITION; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#Do Something.</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> CONDITION; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#Do Something.</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="comment">#Do Something.</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> CONDITION1; <span class="keyword">then</span></span><br><span class="line">	<span class="comment"># if-CONDITION1-true-分支</span></span><br><span class="line"><span class="keyword">elif</span> CONDITION2; <span class="keyword">then</span></span><br><span class="line">	<span class="comment"># if-CONDITION2-true-分支</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="comment"># if-ALL-false-分支</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 循环 for, while, until</span></span><br><span class="line"><span class="keyword">for</span> VARIABLE <span class="keyword">in</span> LIST; <span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 循环体</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># LIST：是由一个或多个空格或换行符分隔开的字符串组成；</span></span><br><span class="line"><span class="comment"># 把列表的每个字符串逐个赋值给VARIABLE表示的变量</span></span><br><span class="line"><span class="comment"># LIST的生成方法</span></span><br><span class="line"><span class="comment"># (1) 整数列表</span></span><br><span class="line"><span class="comment"># 	(a) &#123;start..end&#125;</span></span><br><span class="line"><span class="comment"># 	(b) $(seq [start [[step]] end)</span></span><br><span class="line"><span class="comment"># (2) 直接给出列表</span></span><br><span class="line"><span class="comment"># (3) glob</span></span><br><span class="line"><span class="comment"># (4) 命令生成</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 case 语句</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$VARIABLE</span> <span class="keyword">in</span></span><br><span class="line">	PATTERN_1)</span><br><span class="line">		<span class="comment"># branch_1</span></span><br><span class="line">		;;</span><br><span class="line">	PATTERN_2)</span><br><span class="line">		<span class="comment"># branch_2</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="comment"># default branch</span></span><br><span class="line">		;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 流程控制语句while, until</span></span><br><span class="line"><span class="keyword">while</span> CONDITION; <span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 循环体</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#5 until循环,退出条件,CONDITION为真时退出</span></span><br><span class="line">until CONDITION; <span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 循环体</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#6 循环控制</span></span><br><span class="line"><span class="built_in">continue</span> [n] <span class="comment"># 提前结束本轮循环,而直接进入下一轮</span></span><br><span class="line"><span class="built_in">break</span> [n] 	 <span class="comment"># 提前结束循环</span></span><br></pre></td></tr></table></figure>
<h3 id="case中的pattern可以使用glob模式的通配符"><a class="header-anchor" href="#case中的pattern可以使用glob模式的通配符"></a><code>case中</code>的<code>PATTERN</code>可以使用<code>glob</code>模式的通配符</h3>
<ul>
<li><code>*</code>: 任意长度的任意字符；</li>
<li><code>?</code>: 任意单个字符；</li>
<li><code>[]</code>: 指定范围内的任意单个字符；</li>
<li><code>a|b</code>: 多选1；</li>
</ul>
<h3 id="while-循环的特殊用法-遍历文件的每一行"><a class="header-anchor" href="#while-循环的特殊用法-遍历文件的每一行"></a>while 循环的特殊用法,遍历文件的每一行</h3>
<ul>
<li>expr1: 定义控制变量，并初始赋值</li>
<li>expr2: 循环控制条件</li>
<li>expr3: 修正控制变量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 处理每一行内容</span></span><br><span class="line"><span class="keyword">done</span> &lt; /PATH/TO/SOMEFILE</span><br></pre></td></tr></table></figure>
<h3 id="for循环的特殊用法"><a class="header-anchor" href="#for循环的特殊用法"></a>for循环的特殊用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((expr1;expr2;expr3)); <span class="keyword">do</span></span><br><span class="line">	<span class="comment"># 循环体</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="脚本参数-位置参数变量"><a class="header-anchor" href="#脚本参数-位置参数变量"></a>脚本参数(位置参数变量)</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ./script.sh /etc/fstab /etc/grb.cfg</span></span><br><span class="line"><span class="comment"># 	$0 			$1 			$2</span></span><br></pre></td></tr></table></figure>
<h3 id="与用户交互"><a class="header-anchor" href="#与用户交互"></a>与用户交互</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read</span></span><br><span class="line">$ <span class="built_in">read</span> [options] VAR ...</span><br><span class="line">		-P <span class="string">"PROMPT"</span></span><br><span class="line">		-t timeout</span><br></pre></td></tr></table></figure>
<h3 id="特殊变量"><a class="header-anchor" href="#特殊变量"></a>特殊变量</h3>
<ul>
<li><code>$?</code> 命令的状态结果；</li>
<li><code>$#</code> 传递给脚本或函数的参数的个数；</li>
<li><code>$*</code> 引用传递给脚本或函数的参数列表；受IFS控制</li>
<li><code>$@</code> 引用传递给脚本或函数的参数列表；不受IFS控制</li>
</ul>
<p>注：IFS:IFS(Internal Field Seperator)在Linux的shell中预设的分隔符，用来把command line分解成word（字段）。IFS可以是White Space（空白键）、Tab（ 表格键）、Enter（ 回车键）中的一个或几个。</p>
<p><code>shift [n]</code>：轮替</p>
<h3 id="算术运算"><a class="header-anchor" href="#算术运算"></a>算术运算</h3>
<ul>
<li><code>$[$A+$B]</code></li>
<li><code>$(($A+$B))</code></li>
<li><code>let VARIABLE=$A+$B</code></li>
<li><code>VARIABLE=$(expr $A + $B)</code></li>
</ul>
<h3 id="增强型赋值"><a class="header-anchor" href="#增强型赋值"></a>增强型赋值</h3>
<ul>
<li><code>let count=$[$count+1]</code> --&gt; <code>let count+=1</code> --&gt; <code>let count++</code></li>
<li><code>let count=$[$count-1]</code> --&gt; <code>let count-=1</code> --&gt; <code>let count--</code></li>
</ul>
<h3 id="函数"><a class="header-anchor" href="#函数"></a>函数</h3>
<p>把一段具有独立功能代码封装在一起，并给予命名；后续用到时，可直接通过给定函数名来调用整体代码.函数的作用(1)代码重用.(2)模块化编程.</p>
<p>自定义函数的状态的返回值<code>return [n]</code> 0:成功, 1-255: 失败.</p>
<h3 id="定义函数的二种格式"><a class="header-anchor" href="#定义函数的二种格式"></a>定义函数的二种格式</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># first</span></span><br><span class="line"><span class="keyword">function</span> f_name &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># second</span></span><br><span class="line"><span class="function"><span class="title">f_name</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数 : f_name [arg1, arg2, arg3, ...]</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="实践"><a class="header-anchor" href="#实践"></a>实践</h2>
<h3 id="1-如果某路径不存在-则将其创建为目录；否则显示其存在-并显示内容类型"><a class="header-anchor" href="#1-如果某路径不存在-则将其创建为目录；否则显示其存在-并显示内容类型"></a>(1) 如果某路径不存在，则将其创建为目录；否则显示其存在，并显示内容类型</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename create_file.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line">filename=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$filename</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"<span class="variable">$filename</span> exists. "</span> &amp;&amp; file <span class="variable">$filename</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	/usr/bin/mkdir -p <span class="variable">$filename</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$filename</span> creation done."</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="2-写一个脚本-判断给定的两个数值-孰大孰小；给定数值的方法：脚本参数-命令交互"><a class="header-anchor" href="#2-写一个脚本-判断给定的两个数值-孰大孰小；给定数值的方法：脚本参数-命令交互"></a>(2) 写一个脚本，判断给定的两个数值，孰大孰小；给定数值的方法：脚本参数，命令交互</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: integer_compare.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Plz enter two integer: "</span> -t <span class="number">10</span> n1 n2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ (-z <span class="string">"<span class="variable">$n1</span>"</span>) || (-z <span class="string">"<span class="variable">$n2</span>"</span>) ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Plz give two integers."</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n1</span> -ge <span class="variable">$n2</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Max: <span class="variable">$n1</span>, Min: <span class="variable">$n2</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Max: <span class="variable">$n2</span>, Min: <span class="variable">$n1</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="3-for循环中list取值测试"><a class="header-anchor" href="#3-for循环中list取值测试"></a>(3) for循环中LIST取值测试</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: generate_list_to_for_loop.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list with &#123;1..10&#125;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">1</span>..<span class="number">10</span>&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">"%-2sx%-2s=%-.2f\n"</span> <span class="variable">$i</span> <span class="variable">$i</span> $((<span class="variable">$i</span>*<span class="variable">$i</span>))</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list with glob</span></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> /var/<span class="built_in">log</span>/httpd/*; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">"%-20s%-20s\n"</span> <span class="string">"FILENAME"</span> <span class="string">"FILETYPE"</span></span><br><span class="line">    <span class="built_in">printf</span> <span class="string">"%-20s%-20s\n"</span> $(basename <span class="variable">$filename</span>) $(file <span class="variable">$filename</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># list with command result</span></span><br><span class="line"><span class="keyword">for</span> username <span class="keyword">in</span> $(cut <span class="operator">-d</span>: <span class="operator">-f</span>1 /etc/passwd | tail -n <span class="number">5</span>); <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$username</span> primary group: <span class="variable">$(id -n -g $username)</span>."</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="4-求100以内所有偶数之和；使用至少三种方法实现"><a class="header-anchor" href="#4-求100以内所有偶数之和；使用至少三种方法实现"></a>(4) 求100以内所有偶数之和；使用至少三种方法实现</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: even_sum.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">declare</span> -i sum_v1=<span class="number">0</span></span><br><span class="line"><span class="built_in">declare</span> -i sum_v2=<span class="number">0</span></span><br><span class="line"><span class="built_in">declare</span> -i sum_v3=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"----------------------v1--------------------"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">0</span> <span class="number">2</span> <span class="number">100</span>); <span class="keyword">do</span></span><br><span class="line">    sum_v1+=<span class="variable">$i</span>;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Even Sum_v1: <span class="variable">$sum_v1</span>."</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"----------------------v2--------------------"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">1</span>..<span class="number">100</span>&#125;; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ $((<span class="variable">$i</span>%<span class="number">2</span>)) <span class="operator">-eq</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">        sum_v2+=<span class="variable">$i</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Even Sum_v2: <span class="variable">$sum_v2</span>."</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"----------------------v3--------------------"</span></span><br><span class="line"><span class="built_in">declare</span> -i i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$i</span> <span class="operator">-gt</span> <span class="number">100</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Even Sum_v3: <span class="variable">$sum_v3</span>."</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        sum_v3+=<span class="variable">$i</span>;</span><br><span class="line">        i+=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="5-写一个脚本实现如下功能；获取当前主机的主机名；如果当前主机的主机名为空-或者为localhost-则将其修改为www-molloc-com"><a class="header-anchor" href="#5-写一个脚本实现如下功能；获取当前主机的主机名；如果当前主机的主机名为空-或者为localhost-则将其修改为www-molloc-com"></a>(5) 写一个脚本实现如下功能；获取当前主机的主机名；如果当前主机的主机名为空，或者为localhost，则将其修改为www.molloc.com</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: modify_hostname.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">hostname=$(hostname)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ -z <span class="string">"<span class="variable">$hostname</span>"</span> || <span class="string">"<span class="variable">$hostname</span>"</span> =~ <span class="string">"localhost"</span> ]]; <span class="keyword">then</span></span><br><span class="line">    /usr/bin/hostname www.molloc.com</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="6-写一个脚本"><a class="header-anchor" href="#6-写一个脚本"></a>(6) 写一个脚本</h3>
<ul>
<li>传递两个文本文件路径给脚本；</li>
<li>显示两个文件中空白行数较多的文件及其空白行的个数；</li>
<li>显示两个文件中总行数较多的文件及其总行数；</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: count_blank_lines.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Plz Enter two filename: "</span> -t <span class="number">10</span> f1 f2</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="operator">-e</span> <span class="string">"<span class="variable">$f1</span>"</span> <span class="operator">-a</span> <span class="operator">-e</span> <span class="string">"<span class="variable">$f2</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    line_f1=$(egrep <span class="string">'^$'</span> -c <span class="variable">$f1</span>)</span><br><span class="line">    line_f2=$(egrep <span class="string">'^$'</span> -c <span class="variable">$f2</span>)</span><br><span class="line">    [ <span class="variable">$line_f1</span> <span class="operator">-gt</span> <span class="variable">$line_f2</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"File: <span class="variable">$f1</span>, blank lines: <span class="variable">$line_f1</span>"</span> || <span class="built_in">echo</span> <span class="string">"File: <span class="variable">$f2</span>, blank lines: <span class="variable">$line_f2</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"No such file for input."</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="7-写一个脚本"><a class="header-anchor" href="#7-写一个脚本"></a>(7) 写一个脚本</h3>
<ul>
<li>提示用户输入一个字符串；</li>
<li>判断：如果输入的是quit，则退出脚本;否则，则显示其输入的字符串内容</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: echo_str.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Plz enter a string or enter 'quit' exit : "</span> -t <span class="number">10</span> str</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [[ <span class="string">"quit"</span> == <span class="variable">$str</span> ]]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Buy~"</span> &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$str</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="7-写一个脚本-打印九九乘法表"><a class="header-anchor" href="#7-写一个脚本-打印九九乘法表"></a>(7) 写一个脚本,打印九九乘法表</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: multiply.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">1</span>..<span class="number">9</span>&#125;; <span class="keyword">do</span></span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> $(seq <span class="number">1</span> <span class="variable">$i</span>); <span class="keyword">do</span></span><br><span class="line">		<span class="built_in">echo</span> -n <span class="operator">-e</span> <span class="string">"<span class="variable">$&#123;j&#125;</span>x<span class="variable">$&#123;i&#125;</span>=<span class="variable">$(($i*$j)</span>)\t"</span></span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line">	<span class="built_in">echo</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"------------------------------------V2-------------------------------"</span></span><br><span class="line">seq <span class="number">9</span> | sed <span class="string">'H;g'</span> | awk -v RS=<span class="string">''</span> <span class="string">'&#123;for(i=1;i&lt;=NF;i++)printf("%dx%d=%d%s", i, NR, i*NR, i==NR?"\n":"\t")&#125;'</span></span><br></pre></td></tr></table></figure>
<h3 id="8-脚本可接受四个参数"><a class="header-anchor" href="#8-脚本可接受四个参数"></a>(8)脚本可接受四个参数</h3>
<ul>
<li><code>start</code>: 创建文件/var/lock/subsys/SCRIPT_NAME</li>
<li><code>stop</code>: 删除此文件</li>
<li><code>restart</code>: 删除此文件并重新创建</li>
<li><code>status</code>: 如果文件存在，显示为&quot;running&quot;，否则，显示为&quot;stopped&quot;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: run_script.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">command</span>_name=$(basename <span class="variable">$0</span>)</span><br><span class="line">lock_file=<span class="string">"/var/lock/subsys/<span class="variable">$command_name</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-lt</span> <span class="number">1</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$command_name</span> start|stop|restart|status"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">"start"</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is started yet."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$command_name</span> ok..."</span> || <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$command_name</span> failed..."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">"stop"</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$command_name</span> ok..."</span> || <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$command_name</span> failed..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is stopped yet."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">"restart"</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Restarting <span class="variable">$command_name</span> ok..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is stopped, Starging <span class="variable">$command_name</span> ok..."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">"status"</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is running..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is stopped..."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$command_name</span> start|stop|restart|status"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="9-上一个例子的case版本"><a class="header-anchor" href="#9-上一个例子的case版本"></a>(9) 上一个例子的<code>case</code>版本</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: case_run_script.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span>_name=$(basename <span class="variable">$0</span>)</span><br><span class="line">lock_file=<span class="string">"/var/lock/subsys/<span class="variable">$command_name</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$#</span>"</span> <span class="operator">-lt</span> <span class="number">1</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$command_name</span> start|stop|restart|status."</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">	start)</span><br><span class="line">		<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is started yet."</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$command_name</span> ok..."</span> || <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$command_name</span> failed..."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		;;</span><br><span class="line">	stop)</span><br><span class="line">		<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">			rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$command_name</span> ok...."</span> || <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$command_name</span> failed..."</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is Stopped yet."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		;;</span><br><span class="line">	restart)</span><br><span class="line">		<span class="keyword">if</span> [ <span class="operator">-f</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">			rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Restarting <span class="variable">$command_name</span> ok..."</span></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$command_name</span> is stopped, Starting <span class="variable">$command_name</span> ok...."</span></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		;;</span><br><span class="line">	status)</span><br><span class="line">		[ <span class="operator">-e</span> <span class="variable">$lock_file</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"Running..."</span> || <span class="built_in">echo</span> <span class="string">"Stopped..."</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$command_name</span> start|stop|restart|status."</span></span><br><span class="line">		<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h3 id="9-分别求100以内所有奇数之和-及所有偶数之和"><a class="header-anchor" href="#9-分别求100以内所有奇数之和-及所有偶数之和"></a>(9) 分别求100以内所有奇数之和，及所有偶数之和</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: sum.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">declare</span> -i even_sum=<span class="number">0</span></span><br><span class="line"><span class="built_in">declare</span> -i odd_sum=<span class="number">0</span></span><br><span class="line"><span class="built_in">declare</span> -i i=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$i</span> -le <span class="number">100</span> ]; <span class="keyword">do</span></span><br><span class="line">	<span class="keyword">if</span> [ $[<span class="variable">$i</span>%<span class="number">2</span>] <span class="operator">-eq</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">		 even_sum+=<span class="variable">$i</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		 odd_sum+=<span class="variable">$i</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	<span class="built_in">let</span>	i++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Even Sum : <span class="variable">$&#123;even_sum&#125;</span>, Odd Sum : <span class="variable">$&#123;odd_sum&#125;</span>."</span></span><br></pre></td></tr></table></figure>
<h3 id="10-求100以内所有正整数之和-用until语法"><a class="header-anchor" href="#10-求100以内所有正整数之和-用until语法"></a>(10) 求100以内所有正整数之和,用until语法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: until_sum.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">declare</span> -i i=<span class="number">0</span></span><br><span class="line"><span class="built_in">declare</span> -i sum=<span class="number">0</span></span><br><span class="line"></span><br><span class="line">until [ <span class="variable">$i</span> <span class="operator">-gt</span> <span class="number">100</span> ]; <span class="keyword">do</span></span><br><span class="line">	<span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line">	<span class="built_in">let</span> i++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Sum : <span class="variable">$&#123;sum&#125;</span>."</span></span><br></pre></td></tr></table></figure>
<h3 id="11-找出uid为偶数的所有用户-显示其用户名和id号"><a class="header-anchor" href="#11-找出uid为偶数的所有用户-显示其用户名和id号"></a>(11) 找出UID为偶数的所有用户，显示其用户名和ID号</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: process_line_use_while.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> line; <span class="keyword">do</span></span><br><span class="line">	uid=$(<span class="built_in">echo</span> <span class="variable">$line</span> | cut <span class="operator">-d</span>: <span class="operator">-f</span>3)</span><br><span class="line">	<span class="keyword">if</span> [ $[<span class="variable">$uid</span>%<span class="number">2</span>] <span class="operator">-eq</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">$line</span> | cut <span class="operator">-d</span>: <span class="operator">-f</span>1,<span class="number">3</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> &lt; /etc/passwd</span><br></pre></td></tr></table></figure>
<h3 id="12-求100以内所有正整数之和-使用for循环的特殊用法实现"><a class="header-anchor" href="#12-求100以内所有正整数之和-使用for循环的特殊用法实现"></a>(12) 求100以内所有正整数之和,使用for循环的特殊用法实现</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: for_sum.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="built_in">declare</span> -i sum=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=<span class="number">0</span>;i&lt;=<span class="number">100</span>;i++)); <span class="keyword">do</span></span><br><span class="line">	sum+=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Sum : <span class="variable">$&#123;sum&#125;</span>."</span></span><br></pre></td></tr></table></figure>
<h3 id="13-传递一个文本文件为参数给脚本-取出此文件的所有的偶数行给予显示-行前要显示行号"><a class="header-anchor" href="#13-传递一个文本文件为参数给脚本-取出此文件的所有的偶数行给予显示-行前要显示行号"></a>(13) 传递一个文本文件为参数给脚本，取出此文件的所有的偶数行给予显示，行前要显示行号</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: process_text_use_awk.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-lt</span> <span class="number">1</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Must take a parameter."</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">	awk <span class="string">'&#123;if(NR%2==0)&#123;print NR, $0&#125;&#125;'</span> <span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"No such file for <span class="variable">$1</span>."</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h3 id="14-用函数重构示例9"><a class="header-anchor" href="#14-用函数重构示例9"></a>(14) 用函数重构示例9</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: func_server.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">server_name=$(basename <span class="variable">$0</span>)</span><br><span class="line">lock_file=<span class="string">"/var/lock/subsys/<span class="variable">$server_name</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-lt</span> <span class="number">1</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$prog</span> start|stop|restart|status"</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$server_name</span> is started yet."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$server_name</span> ok..."</span> || <span class="built_in">echo</span> <span class="string">"Starting <span class="variable">$server_name</span> failed."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$server_name</span> ok..."</span> || <span class="built_in">echo</span> <span class="string">"Stop <span class="variable">$server_name</span> failed..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"<span class="variable">$server_name</span> is stopped yet."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		rm <span class="operator">-f</span> <span class="variable">$lock_file</span> &amp;&amp; touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"Restarting <span class="variable">$server_name</span> ok..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		touch <span class="variable">$lock_file</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">"<span class="variable">$server_name</span> is stopped, Staring <span class="variable">$server_name</span> ok..."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status</span></span>() &#123;</span><br><span class="line">	<span class="keyword">if</span> [ <span class="operator">-e</span> <span class="variable">$lock_file</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Running..."</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Stopped..."</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">	start)</span><br><span class="line">		start</span><br><span class="line">		;;</span><br><span class="line">	stop)</span><br><span class="line">		stop</span><br><span class="line">		;;</span><br><span class="line">	restart)</span><br><span class="line">		restart</span><br><span class="line">		;;</span><br><span class="line">	status)</span><br><span class="line">		status</span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$prog</span> start|stop|restart|status"</span></span><br><span class="line">		<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h3 id="15-写一个脚本-打印2-n表；n等于一个用户输入的值"><a class="header-anchor" href="#15-写一个脚本-打印2-n表；n等于一个用户输入的值"></a>(15) 写一个脚本，打印2^n表；n等于一个用户输入的值</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: func_power.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> <span class="operator">-lt</span> <span class="number">1</span> ]; <span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Plz Enter a Integer[1-9]: "</span></span><br><span class="line">	<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">power</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"2^<span class="variable">$1</span>=$[2**<span class="variable">$1</span>]"</span></span><br><span class="line">	[ <span class="variable">$1</span> <span class="operator">-eq</span> <span class="number">1</span> ] &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span> || power $[<span class="variable">$1</span>-<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">	[<span class="number">1</span>-<span class="number">9</span>][<span class="number">0</span>-<span class="number">9</span>]*)</span><br><span class="line">		power <span class="variable">$1</span></span><br><span class="line">		;;</span><br><span class="line">	*)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"Invalid arguments [<span class="variable">$1</span>]. the arguments must be a integer."</span></span><br><span class="line">		<span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<h3 id="16-写一个脚本-写这么几个函数：函数1-实现给定的两个数值的之和；函数2-取给定两个数值的最大公约数；函数3-取给定两个数值的最小公倍数；关于函数的选定-两个数值的大小都将通过交互式输入来提供"><a class="header-anchor" href="#16-写一个脚本-写这么几个函数：函数1-实现给定的两个数值的之和；函数2-取给定两个数值的最大公约数；函数3-取给定两个数值的最小公倍数；关于函数的选定-两个数值的大小都将通过交互式输入来提供"></a>(16) 写一个脚本，写这么几个函数：函数1、实现给定的两个数值的之和；函数2、取给定两个数值的最大公约数；函数3、取给定两个数值的最小公倍数；关于函数的选定、两个数值的大小都将通过交互式输入来提供。</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment"># filename: func_math.sh</span></span><br><span class="line"><span class="comment"># author: kernel</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Plz Enter Two Integers: "</span> -t <span class="number">10</span> n1 n2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">sum</span></span>() &#123;</span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Sum : $[<span class="variable">$1</span>+<span class="variable">$2</span>]"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">highest_common_factor</span></span>() &#123;</span><br><span class="line">	reminder=$[<span class="variable">$1</span>%<span class="variable">$2</span>]</span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$reminder</span> <span class="operator">-eq</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">return</span> <span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		highest_common_factor <span class="variable">$2</span> <span class="variable">$reminder</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">least_common_multiply</span></span>()&#123;</span><br><span class="line">	highest_common_factor <span class="variable">$1</span> <span class="variable">$2</span></span><br><span class="line">	<span class="built_in">return</span> $(<span class="built_in">echo</span> <span class="string">"$[<span class="variable">$1</span>*<span class="variable">$2</span>]/$?"</span> | bc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$n1</span>=~<span class="string">"[1-9][0-9]*"</span> <span class="operator">-a</span> <span class="variable">$n2</span>=~<span class="string">"[1-9][0-9]*"</span> ]; <span class="keyword">then</span></span><br><span class="line">	sum <span class="variable">$n1</span> <span class="variable">$n2</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$n1</span> <span class="operator">-gt</span> <span class="variable">$n2</span> ]; <span class="keyword">then</span></span><br><span class="line">		highest_common_factor <span class="variable">$n1</span> <span class="variable">$n2</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"HCF : $?"</span></span><br><span class="line">		least_common_multiply <span class="variable">$n1</span> <span class="variable">$n2</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"LCM : $?"</span></span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		highest_common_factor <span class="variable">$n2</span> <span class="variable">$n1</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"HCF : $?"</span></span><br><span class="line">		least_common_multiply <span class="variable">$n2</span> <span class="variable">$n1</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"LCM : $?"</span></span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Invalid arguments : <span class="variable">$n1</span> <span class="variable">$n2</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="shell"><a class="header-anchor" href="#shell"></a>Shell</h2>
<p>注意本文讨论的是Bash，而不一定是/bin/sh所链接的那个shell。这里出现的所有代码片段，默认在顶上都添加了<code>#!/bin/bash</code>。</p>
<p>计算机理解语言的 0 和 1 的称为二进制语言。</p>
<p>在早期的计算机时代，指令提供使用二进制语言，很难对我们所有人，读和写。所以在 Os 中是叫 Shell 的特别节目。壳 (大部分) 接受你的指令或命令在英语中的，如果它是一个有效的命令，它是传递给内核。</p>
<p>外壳是用户或程序是提供用户交互环境。Shell 是命令语言解释器执行命令从标准输入设备 (键盘) 或从文件读取。</p>
<p><code>Shell</code>不是系统内核的一部分，但使用系统内核执行程序、 创建文件等。</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-01]]></title>
    <link href="http://molloc.me/2015/09/12/ZY-2015-09-01/"/>
    <id>http://molloc.me/2015/09/12/ZY-2015-09-01/</id>
    <published>2015-09-12T09:42:18.000Z</published>
    <updated>2015-09-14T15:47:55.613Z</updated>
    <content type="html"><![CDATA[<h2 id="linux-磁盘管理"><a class="header-anchor" href="#linux-磁盘管理"></a>Linux 磁盘管理</h2>
<p><strong>硬盘分为:机械式硬盘,SSD</strong></p>
<h3 id="机械式硬盘"><a class="header-anchor" href="#机械式硬盘"></a>机械式硬盘</h3>
<ul>
<li>rpm: 5400, 7200, 10000, 15000</li>
<li>track</li>
<li>sector 512byte</li>
<li>cylinder, 分区以柱面为基本单位进行的</li>
<li>MBR(Master Boot Record)</li>
</ul>
<a id="more"></a>
<p>MBR位于0磁道,占512byte,</p>
<p>其中前446字节是存放bootloader,</p>
<p>后64字节是存放filesystem allocation table.</p>
<p>后64字节中,每16字节标识一个分区,因此只能有四个分区,</p>
<p>最后2个字节(55,55AA)用来标记次MBR中的数据有效与否.</p>
<h3 id="磁盘接口的类型"><a class="header-anchor" href="#磁盘接口的类型"></a>磁盘接口的类型</h3>
<ul>
<li>IDE(ATA) -&gt; 理论接口速率(133MB/s) -&gt; (在centos5下,被识别为<code>/dev/hd[a-z]</code>)</li>
<li>SCSI -&gt; 理论接口速率(640MB/s)</li>
<li>SATA -&gt; 理论接口速率(6Gbps/s)</li>
<li>SAS -&gt; 理论接口速率(6Gbps/s)</li>
<li>USB -&gt; 理论接口速率(480MB/s)</li>
</ul>
<h3 id="识别硬盘设备-dev-sd"><a class="header-anchor" href="#识别硬盘设备-dev-sd"></a>识别硬盘设备: <code>/dev/sd</code></h3>
<ul>
<li>标记不同的硬盘设备<code>/dev/sd[a-z]</code></li>
<li>标记同一设备上的不同分区<code>/dev/sd[a-z][1-n]</code>
<ul>
<li>1-4: 主或扩展分区标识</li>
<li>5+ : 逻辑分区标识</li>
</ul>
</li>
</ul>
<p>设备文件是一种特殊文件,每一个设备文件它都没有大小,而有设备号的概念,</p>
<p>设备号由major(用来标识识别类型),minor(用来标识同一类型下的不同设备)组成.</p>
<p>major(主设备号)的主要作用在于让内核去识别配套的设备驱动的.</p>
<p>minor(次设备号)的主要作用在于让驱动程序来识别同一种驱动程序上所映射到的不同设备的.</p>
<p>&quot;块&quot; block, 设备类型标识均为'b', 允许随机访问,因此也被称为随机访问设备.</p>
<p>&quot;字符&quot; character 设备类型标识均为 'c', 也称为线性设备.</p>
<p>大于2T的硬盘用MBR管理会有问题,MBR不能识别大于2T的空间, 可以用GPT技术来管理.</p>
<h3 id="分区"><a class="header-anchor" href="#分区"></a>分区</h3>
<p>分区,主要用来分隔存储空间为多个小的空间,每个空间可独立使用文件系统.</p>
<p>分区工具,fdisk, parted, sfdisk</p>
<p>fdisk工具的使用,最多支持在一块磁盘上管理15个分区.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fdisk 操纵磁盘分区表</span></span><br><span class="line">SYNOPSIS</span><br><span class="line">       fdisk [-uc] [-b sectorsize] [-C cyls] [-H heads] [-S sects] device</span><br><span class="line"></span><br><span class="line">       fdisk <span class="operator">-l</span> [-u] [device...]</span><br><span class="line"></span><br><span class="line">       fdisk <span class="operator">-s</span> partition...</span><br><span class="line"></span><br><span class="line">       fdisk -v</span><br><span class="line"></span><br><span class="line">       fdisk -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分区</span></span><br><span class="line">$ fdisk /dev/sda</span><br><span class="line"></span><br><span class="line">Welcome to fdisk (util-linux <span class="number">2.23</span>.<span class="number">2</span>).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): m <span class="comment"># 键入m获取帮助</span></span><br><span class="line"></span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag</span><br><span class="line">   b   edit bsd disklabel</span><br><span class="line">   c   toggle the dos compatibility flag</span><br><span class="line">   d   delete a partition <span class="comment"># 删除一个分区</span></span><br><span class="line">   g   create a new empty GPT partition table</span><br><span class="line">   G   create an IRIX (SGI) partition table</span><br><span class="line">   l   list known partition types <span class="comment"># 列出所有支持的ID类型</span></span><br><span class="line">   m   <span class="built_in">print</span> this menu <span class="comment"># 获取帮助</span></span><br><span class="line">   n   add a new partition <span class="comment"># 添加一个新分区</span></span><br><span class="line">   o   create a new empty DOS partition table</span><br><span class="line">   p   <span class="built_in">print</span> the partition table <span class="comment"># 显示当前磁盘的分区表</span></span><br><span class="line">   q   quit without saving changes <span class="comment"># 放弃修改并退出</span></span><br><span class="line">   s   create a new empty Sun disklabel</span><br><span class="line">   t   change a partition\<span class="string">'s system id # 修改分区的ID</span><br><span class="line">   u   change display/entry units</span><br><span class="line">   v   verify the partition table</span><br><span class="line">   w   write table to disk and exit # 保存退出</span><br><span class="line">   x   extra functionality (experts only)</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (3 primary, 0 extended, 1 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default e):</span><br><span class="line">Using default response e</span><br><span class="line">Selected partition 4</span><br><span class="line">First sector (110077952-251658239, default 110077952):</span><br><span class="line">Using default value 110077952</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (110077952-251658239, default 251658239):</span><br><span class="line">Using default value 251658239</span><br><span class="line">Partition 4 of type Extended and of size 67.5 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 128.8 GB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0009454e</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1            2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048     5220351     2097152   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3   *     5220352   110077951    52428800   83  Linux</span><br><span class="line">/dev/sda4       110077952   251658239    70790144    5  Extended</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">All primary partitions are in use</span><br><span class="line">Adding logical partition 5</span><br><span class="line">First sector (110080000-251658239, default 110080000):</span><br><span class="line">Using default value 110080000</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (110080000-251658239, default 251658239): +10G</span><br><span class="line">Partition 5 of type Linux and of size 10 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 128.8 GB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0009454e</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1            2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048     5220351     2097152   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3   *     5220352   110077951    52428800   83  Linux</span><br><span class="line">/dev/sda4       110077952   251658239    70790144    5  Extended</span><br><span class="line">/dev/sda5       110080000   131051519    10485760   83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help): n</span><br><span class="line">All primary partitions are in use</span><br><span class="line">Adding logical partition 6</span><br><span class="line">First sector (131053568-251658239, default 131053568):</span><br><span class="line">Using default value 131053568</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (131053568-251658239, default 251658239): +20G</span><br><span class="line">Partition 6 of type Linux and of size 20 GiB is set</span><br><span class="line"></span><br><span class="line">Command (m for help): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 128.8 GB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0009454e</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1            2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048     5220351     2097152   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3   *     5220352   110077951    52428800   83  Linux</span><br><span class="line">/dev/sda4       110077952   251658239    70790144    5  Extended</span><br><span class="line">/dev/sda5       110080000   131051519    10485760   83  Linux</span><br><span class="line">/dev/sda6       131053568   172996607    20971520   83  Linux</span><br><span class="line"></span><br><span class="line">Command (m for help):w</span><br><span class="line"></span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line"></span><br><span class="line">WARNING: Re-reading the partition table failed with error 16: Device or resource busy.</span><br><span class="line">The kernel still uses the old table. The new table will be used at</span><br><span class="line">the next reboot or after you run partprobe(8) or kpartx(8)</span><br><span class="line">Syncing disks.</span><br><span class="line"></span><br><span class="line"># 查看fdisk -l /dev/sda 此时fdisk能识别,内核不一定能识别</span><br><span class="line">$ fdisk -l /dev/sda</span><br><span class="line">Disk /dev/sda: 128.8 GB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0009454e</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1            2048     1026047      512000   83  Linux</span><br><span class="line">/dev/sda2         1026048     5220351     2097152   82  Linux swap / Solaris</span><br><span class="line">/dev/sda3   *     5220352   110077951    52428800   83  Linux</span><br><span class="line">/dev/sda4       110077952   251658239    70790144    5  Extended</span><br><span class="line">/dev/sda5       110080000   131051519    10485760   83  Linux</span><br><span class="line">/dev/sda6       131053568   172996607    20971520   83  Linux</span><br><span class="line"></span><br><span class="line"># 创建完成后查看内核有没有识别新的分区</span><br><span class="line">$ cat /proc/partitions</span><br><span class="line"></span><br><span class="line">major minor  #blocks  name</span><br><span class="line"></span><br><span class="line">8        0  125829120 sda</span><br><span class="line">8        1    2097152 sda1</span><br><span class="line">8        2   52428800 sda2</span><br><span class="line">11        0    7413760 sr0</span><br><span class="line"></span><br><span class="line"># 有三个命令可以让内核重读磁盘分区表</span><br><span class="line">CentOS5 partprobe [DEVICE]</span><br><span class="line">CentOS6,7 partx, kpartx</span><br><span class="line"></span><br><span class="line"># partx 告诉内核关于磁盘分区的现状和编号</span><br><span class="line">SYNOPSIS</span><br><span class="line">   partx [-a|-d|-s|-u] [-t TYPE] [-n M:N] [-] disk</span><br><span class="line">   partx [-a|-d|-s|-u] [-t TYPE] partition [disk]</span><br><span class="line"></span><br><span class="line">$ partx DEVICE</span><br><span class="line"></span><br><span class="line">$ partx -a DEVICE</span><br><span class="line"></span><br><span class="line">$ partx -a -n M:N DEVICE</span><br><span class="line"></span><br><span class="line">$ partx -a -n 3:6 /dev/sda</span><br><span class="line">$ cat /etc/partitions</span><br><span class="line">major minor  #blocks  name</span><br><span class="line"></span><br><span class="line">   8        0  125829120 sda</span><br><span class="line">   8        1     512000 sda1</span><br><span class="line">   8        2   44047360 sda2</span><br><span class="line">   8        3   10485760 sda3</span><br><span class="line">   8        4          1 sda4</span><br><span class="line">   8        5   10485760 sda5</span><br><span class="line">   8        6   20971520 sda6</span><br><span class="line">  11        0    1048575 sr0</span><br><span class="line"> 253        0    2097152 dm-0</span><br><span class="line"> 253        1   20971520 dm-1</span><br><span class="line"> 253        2   20971520 dm-2</span><br><span class="line"></span><br><span class="line">## 到此分区结束</span></span><br></pre></td></tr></table></figure>
<h2 id="linux-文件系统"><a class="header-anchor" href="#linux-文件系统"></a>linux 文件系统</h2>
<p>linux 通过 VFS(Virtual File System) 管理众多文件系统.</p>
<h3 id="分类"><a class="header-anchor" href="#分类"></a>分类</h3>
<ul>
<li>Linux: ext2, ext3, ext4, reiserfs, xfs, btrfs, swap, ISO9660</li>
<li>Window: fat32(vfat), ntfs</li>
<li>Unix: ffs, ufs, jfs, jfs2</li>
<li>网络文件系统: nfs, cifs</li>
<li>集群文件系统: ocfs2, gfs2</li>
<li>分布式文件系统: ceph, moosefs, mogilefs, hdfs, gfs, glusterfs</li>
</ul>
<h3 id="有无日志"><a class="header-anchor" href="#有无日志"></a>有无日志</h3>
<ul>
<li>日志型文件系统(ext3...)</li>
<li>非日志型文件系统(ext2)</li>
</ul>
<h3 id="swap"><a class="header-anchor" href="#swap"></a>swap</h3>
<p>交换分区,避免内存用尽</p>
<h3 id="创建文件系统"><a class="header-anchor" href="#创建文件系统"></a>创建文件系统</h3>
<p>创建文件系统实质就是在分区上执行格式化(高级格式化),要使用某种文件系统,需满足2个条件,</p>
<p>(1) 内核中支持此种文件系统.</p>
<p>(2) 有专门的文件系统管理工具.</p>
<p>创建工具的公用接口: <code>mkfs</code>, 检查工具的公用接口: <code>fsck</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建工具: mkfs (make filesystem)</span></span><br><span class="line">NAME</span><br><span class="line">   mkfs - build a Linux filesystem</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">   mkfs [options] [-t <span class="built_in">type</span>] [fs-options] device [size]</span><br><span class="line"></span><br><span class="line">$ mkfs -t ext4 /dev/sda5</span><br><span class="line"></span><br><span class="line">-&gt; mke2fs <span class="number">1.42</span>.<span class="number">9</span> (<span class="number">28</span>-Dec-<span class="number">2013</span>)</span><br><span class="line">   Filesystem label=</span><br><span class="line">   OS <span class="built_in">type</span>: Linux</span><br><span class="line">   Block size=<span class="number">4096</span> (<span class="built_in">log</span>=<span class="number">2</span>)</span><br><span class="line">   Fragment size=<span class="number">4096</span> (<span class="built_in">log</span>=<span class="number">2</span>)</span><br><span class="line">   Stride=<span class="number">0</span> blocks, Stripe width=<span class="number">0</span> blocks</span><br><span class="line">   <span class="number">655360</span> inodes, <span class="number">2621440</span> blocks</span><br><span class="line">   <span class="number">131072</span> blocks (<span class="number">5.00</span>%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">   First data block=<span class="number">0</span></span><br><span class="line">   Maximum filesystem blocks=<span class="number">2151677952</span></span><br><span class="line">   <span class="number">80</span> block groups</span><br><span class="line">   <span class="number">32768</span> blocks per group, <span class="number">32768</span> fragments per group</span><br><span class="line">   <span class="number">8192</span> inodes per group</span><br><span class="line">   Superblock backups stored on blocks:</span><br><span class="line">   	<span class="number">32768</span>, <span class="number">98304</span>, <span class="number">163840</span>, <span class="number">229376</span>, <span class="number">294912</span>, <span class="number">819200</span>, <span class="number">884736</span>, <span class="number">1605632</span></span><br><span class="line"></span><br><span class="line">   Allocating group tables: <span class="keyword">done</span></span><br><span class="line">   Writing inode tables: <span class="keyword">done</span></span><br><span class="line">   Creating journal (<span class="number">32768</span> blocks): <span class="keyword">done</span></span><br><span class="line">   Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">$ mkfs.xfs /dev/sda3</span><br><span class="line">-&gt; meta-data=/dev/sda3              isize=<span class="number">256</span>    agcount=<span class="number">4</span>, agsize=<span class="number">655360</span> blks</span><br><span class="line">            =                       sectsz=<span class="number">512</span>   attr=<span class="number">2</span>, projid32bit=<span class="number">1</span></span><br><span class="line">            =                       crc=<span class="number">0</span>        finobt=<span class="number">0</span></span><br><span class="line">   data     =                       bsize=<span class="number">4096</span>   blocks=<span class="number">2621440</span>, imaxpct=<span class="number">25</span></span><br><span class="line">            =                       sunit=<span class="number">0</span>      swidth=<span class="number">0</span> blks</span><br><span class="line">   naming   =version <span class="number">2</span>              bsize=<span class="number">4096</span>   ascii-ci=<span class="number">0</span> ftype=<span class="number">0</span></span><br><span class="line">   <span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=<span class="number">4096</span>   blocks=<span class="number">2560</span>, version=<span class="number">2</span></span><br><span class="line">            =                       sectsz=<span class="number">512</span>   sunit=<span class="number">0</span> blks, lazy-count=<span class="number">1</span></span><br><span class="line">   realtime =none                   extsz=<span class="number">4096</span>   blocks=<span class="number">0</span>, rtextents=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## mke2fs ext系列文件系统的专用管理工具</span></span><br><span class="line">$ mke2fs -t &#123;ext2|ext3|ext4&#125; DEVICE</span><br><span class="line">		 -b &#123;<span class="number">1024</span>|<span class="number">2048</span>|<span class="number">4096</span>&#125; <span class="comment"># 只能是 1024, 2048, 4096</span></span><br><span class="line">		 -L <span class="string">'LABEL'</span> <span class="comment"># 设定卷标</span></span><br><span class="line">		 -j <span class="comment"># 启动日志功能,相当于mke2fs -t ext3</span></span><br><span class="line">		 -i <span class="comment">#</span></span><br><span class="line">		 -N <span class="comment"># 一共保留多少个inode</span></span><br><span class="line">		 -m <span class="comment"># 预留磁盘空间占据多大百分比的空间为后期管理使用</span></span><br><span class="line">		 -O <span class="comment"># feature(启用), ^feature(不启用), 启用指定特性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文件系统属性查看及调整工具</span></span><br><span class="line">$ tune2fs <span class="comment">#显示ext系列文件系统的属性,或调整其属性</span></span><br><span class="line">		<span class="operator">-l</span> <span class="comment"># 显示超级块中的信息,显示整个文件的属性及布局等相关信息.</span></span><br><span class="line">		-L <span class="comment"># 'LABAL' 修改卷标</span></span><br><span class="line">		-m <span class="comment"># 调整预留给管理员的管理空间占据百分比</span></span><br><span class="line">		-j <span class="comment"># ext2 --&gt; ext3</span></span><br><span class="line">		-O <span class="comment"># 启用或禁用某种属性,文件系统属性的启动或关闭</span></span><br><span class="line">		-o <span class="comment"># 文件系统默认挂载选项的启用或关闭</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## dumpe2fs 能显示整个文件系统的布局管理及超级块信息</span></span><br><span class="line">$ dume2fs</span><br><span class="line">		-h <span class="comment"># 仅显示超级块信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## fsck 文件系统检查关系</span></span><br><span class="line">$ fsck -t <span class="built_in">type</span></span><br><span class="line">		fsck.type</span><br><span class="line">			<span class="operator">-a</span> <span class="comment"># 自动修复错误</span></span><br><span class="line">			<span class="operator">-f</span> <span class="comment"># 强制检测</span></span><br><span class="line">			-r <span class="comment"># 交互式修复错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1 检查sda5分区</span></span><br><span class="line">$ fsck.ext4 /dev/sda5</span><br><span class="line">-&gt; e2fsck <span class="number">1.42</span>.<span class="number">9</span> (<span class="number">28</span>-Dec-<span class="number">2013</span>)</span><br><span class="line">   MYDATA: clean, <span class="number">11</span>/<span class="number">655360</span> files, <span class="number">83137</span>/<span class="number">2621440</span> blocks</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 强制检查sda5分区</span></span><br><span class="line">$ fsck.ext4 <span class="operator">-f</span> /dev/sda5</span><br><span class="line">-&gt; e2fsck <span class="number">1.42</span>.<span class="number">9</span> (<span class="number">28</span>-Dec-<span class="number">2013</span>)</span><br><span class="line">   Pass <span class="number">1</span>: Checking inodes, blocks, and sizes</span><br><span class="line">   Pass <span class="number">2</span>: Checking directory structure</span><br><span class="line">   Pass <span class="number">3</span>: Checking directory connectivity</span><br><span class="line">   Pass <span class="number">4</span>: Checking reference counts</span><br><span class="line">   Pass <span class="number">5</span>: Checking group summary information</span><br><span class="line">   MYDATA: <span class="number">11</span>/<span class="number">655360</span> files (<span class="number">0.0</span>% non-contiguous), <span class="number">83137</span>/<span class="number">2621440</span> blocks</span><br><span class="line"></span><br><span class="line">$ e2fsck <span class="comment"># ext 系列文件系统专用检查修复工具</span></span><br><span class="line">      -y <span class="comment"># 自动回答为'yes'</span></span><br><span class="line">      <span class="operator">-f</span> <span class="comment"># force 强制检测</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## e2label 查看或设置ext系列文件系统的卷标</span></span><br><span class="line">$ e2label</span><br><span class="line">		e2label DEVICE [LABEL] <span class="comment"># 带卷标就是设置卷标,不带就是查看此设备的卷标.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## blkid 查看分区相关信息</span></span><br><span class="line">$ blkid /dev/sda5</span><br><span class="line">-&gt; /dev/sda5: UUID=<span class="string">"a20840d4-638c-4c56-99e8-ca0e9b15c516"</span> TYPE=<span class="string">"ext4"</span></span><br></pre></td></tr></table></figure>
<h3 id="文件系统的挂载和使用"><a class="header-anchor" href="#文件系统的挂载和使用"></a>文件系统的挂载和使用</h3>
<p>kernel --&gt; rootfs(分区)</p>
<p>具有<code>bin,sbin,etc,lib,lib64,dev,tmp,proc,sys</code>目录的分区才可能是rootfs分区.需要加载<code>/sbin/init</code>的程序,在CentOS7下是<code>systemd</code>, 第一次加载的系统一定是根文件系统,将额外文件系统与根文件系统某现存的目录建立起关联关系,进而使得此目录作为其他文件系统访问入口的行为,称之为挂载,解除此关联关系的过程,称之为卸载.设备挂载至的位置称之为挂载点(mount point),如果挂载点之下原来就有文件的话,原文件会被隐藏,当卸载后,又会显现,所以挂载点最好使用空目录.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">$ mount <span class="comment"># 不带任何参数,是通过读取/etc/mtab文件来显示当前系统所有已经挂载的设备.</span></span><br><span class="line">$ mount <span class="operator">-a</span> <span class="comment"># 挂载/etc/fstab文件中的所有支持自动挂载的文件系统</span></span><br><span class="line">$ mount [options] [-o options] DEVICE MOUNT_POINT <span class="comment"># 第一个options是命令选项,第二个options是挂载选项.</span></span><br><span class="line">         <span class="comment"># DEVICE 要挂载的设备</span></span><br><span class="line">         <span class="comment"># (1) 设备文件,/dev/sda5</span></span><br><span class="line">         <span class="comment"># (2) 卷标, -L 'LABEL'</span></span><br><span class="line">         <span class="comment"># (3) UUID, -U 'UUID'</span></span><br><span class="line">         <span class="comment"># (4) 伪文件系统需要指定伪文件系统名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># COMMAND</span></span><br><span class="line">$ mount -t <span class="comment"># type: 文件系统类型</span></span><br><span class="line">        -r <span class="comment"># 以'只读'方式挂载此文件系统.</span></span><br><span class="line">        -w <span class="comment"># 以'读写'方式挂载此文件系统.</span></span><br><span class="line">        -n <span class="comment"># 每个文件系统在挂载时都会自动更新/etc/mtab文件,-n是禁止此功能.</span></span><br><span class="line">           <span class="comment"># 此时如果想查看挂载的所有文件系统,可以 cat /proc/mounts</span></span><br><span class="line">        <span class="operator">-a</span> <span class="comment"># 自动挂载所有支持自动挂载的设备.</span></span><br><span class="line">        -L <span class="comment"># 以LABEL的方式挂载</span></span><br><span class="line">        -B <span class="comment"># 与某个目录绑定</span></span><br><span class="line">         <span class="comment">########</span></span><br><span class="line">        -o <span class="comment"># 挂载选项</span></span><br><span class="line">            async                <span class="comment"># 异步模式</span></span><br><span class="line">            sync                 <span class="comment"># 同步模式</span></span><br><span class="line">            atime/noatime        <span class="comment"># 是否更新访问时间戳</span></span><br><span class="line">            diratime/nodiratime  <span class="comment"># 是否更新目录访问时间戳</span></span><br><span class="line">            auto/noauto          <span class="comment"># 是否允许次设备自动挂载</span></span><br><span class="line">            <span class="built_in">exec</span>/noexec          <span class="comment"># 是否允许执行次文件系统上的应用程序</span></span><br><span class="line">            dev/nodev            <span class="comment"># 是否支持在次设备上使用设备文件</span></span><br><span class="line">            remount              <span class="comment"># 重新挂载</span></span><br><span class="line">            ro</span><br><span class="line">            rw</span><br><span class="line">            nouser/user          <span class="comment"># 是否允许普通用户挂载次设备</span></span><br><span class="line">            act                  <span class="comment"># 是否支持此设备上使用facl</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## umount 卸载命令</span></span><br><span class="line">$ umount &#123;DEVICE|MOUNT_POINT&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 卸载/dev/sda5</span></span><br><span class="line">$ umount /dev/sda5</span><br><span class="line">-&gt; umount: /data: target is busy.</span><br><span class="line">        (In some cases useful info about processes that use</span><br><span class="line">         the device is found by lsof(<span class="number">8</span>) or fuser(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">$ fuser -v /data/ <span class="comment"># 查看正在访问指定挂载点的进程</span></span><br><span class="line">                     USER        PID ACCESS COMMAND</span><br><span class="line">/data:               root     kernel mount /data</span><br><span class="line">                     root       <span class="number">3337</span> ..c.. bash</span><br><span class="line"></span><br><span class="line">$ fuser -km /data/ <span class="comment"># 终止所有正在访问指定的挂载点的进程</span></span><br><span class="line">$ umount /data/</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 把/dev/sda5挂载至/data目录</span></span><br><span class="line">$ mount /dev/sda5 /data</span><br><span class="line">$ mount | tail -n <span class="number">1</span></span><br><span class="line">-&gt; /dev/sda5 on /data <span class="built_in">type</span> ext4 (rw,relatime,seclabel,data=ordered)</span><br></pre></td></tr></table></figure>
<h3 id="交换分区swap"><a class="header-anchor" href="#交换分区swap"></a>交换分区swap</h3>
<p>SWAP就是LINUX下的虚拟内存分区,它的作用是在物理内存使用完之后,将磁盘空间(也就是SWAP分区)虚拟成内存来使用.
它和Windows系统的交换文件作用类似，但是它是一段连续的磁盘空间，并且对用户不可见。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># COMMAND</span></span><br><span class="line">$ free <span class="comment">#查看memory和swap的使用状态.</span></span><br><span class="line">$ free -m 以MB为单位</span><br><span class="line">       -g 以GB为单位</span><br><span class="line"></span><br><span class="line">$ free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           <span class="number">1826</span>         <span class="number">155</span>        <span class="number">1458</span>           <span class="number">8</span>         <span class="number">212</span>        <span class="number">1494</span></span><br><span class="line">Swap:          <span class="number">2047</span>           <span class="number">0</span>        <span class="number">2047</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#1 添加一块交换分区</span></span><br><span class="line">$ fdisk <span class="operator">-l</span> /dev/sda</span><br><span class="line"></span><br><span class="line">Disk /dev/sda: <span class="number">128.8</span> GB, <span class="number">128849018880</span> bytes, <span class="number">251658240</span> sectors</span><br><span class="line">Units = sectors of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> bytes</span><br><span class="line">Sector size (logical/physical): <span class="number">512</span> bytes / <span class="number">512</span> bytes</span><br><span class="line">I/O size (minimum/optimal): <span class="number">512</span> bytes / <span class="number">512</span> bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: <span class="number">0</span>x0009722d</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        <span class="number">2048</span>     <span class="number">1026047</span>      <span class="number">512000</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda2         <span class="number">1026048</span>    <span class="number">89120767</span>    <span class="number">44047360</span>   <span class="number">8</span>e  Linux LVM</span><br><span class="line">/dev/sda3        <span class="number">89120768</span>   <span class="number">110092287</span>    <span class="number">10485760</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda4       <span class="number">110092288</span>   <span class="number">251658239</span>    <span class="number">70782976</span>    <span class="number">5</span>  Extended</span><br><span class="line">/dev/sda5       <span class="number">110094336</span>   <span class="number">131065855</span>    <span class="number">10485760</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda6       <span class="number">131067904</span>   <span class="number">173010943</span>    <span class="number">20971520</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda7       <span class="number">173012992</span>   <span class="number">177207295</span>     <span class="number">2097152</span>   <span class="number">82</span>  Linux swap / Solaris</span><br><span class="line"></span><br><span class="line"><span class="comment"># COMMAND</span></span><br><span class="line">$ mkswap [option] DEVICE <span class="comment"># 创建交换分区</span></span><br><span class="line">         -L <span class="string">'LABEL'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 创建交换分区</span></span><br><span class="line">$ mkswap /dev/sda7</span><br><span class="line"></span><br><span class="line">Setting up swapspace version <span class="number">1</span>, size = <span class="number">2097148</span> KiB</span><br><span class="line">no label, UUID=<span class="number">7</span>ad769dc-<span class="number">1</span>ec8-<span class="number">4582</span>-be29-<span class="number">8</span>f39cfd466ad</span><br><span class="line"></span><br><span class="line"><span class="comment"># COMMAND</span></span><br><span class="line">$ swapon [option] [DEVICE]</span><br><span class="line">         <span class="operator">-a</span> <span class="comment"># 激活所有交换分区</span></span><br><span class="line">         -p PRIORITY <span class="comment"># 设定其优先级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 启用交换分区</span></span><br><span class="line">$ swapon /dev/sda7</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           <span class="number">1826</span>         <span class="number">159</span>        <span class="number">1454</span>           <span class="number">8</span>         <span class="number">212</span>        <span class="number">1491</span></span><br><span class="line">Swap:          <span class="number">4095</span>           <span class="number">0</span>        <span class="number">4095</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 若要关闭则用swapoff</span></span><br><span class="line">$ swapoff /dev/sda7</span><br></pre></td></tr></table></figure>
<p>文件系统等空间占用信息的查看工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#COMMAND</span></span><br><span class="line">$ df <span class="comment"># 显示磁盘空间占用信息</span></span><br><span class="line">   -h <span class="comment"># human-readable 人类可读的</span></span><br><span class="line">   -i <span class="comment"># 显示inode数量</span></span><br><span class="line">   -P <span class="comment"># 以POSIX兼容的格式显示</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#COMMAND</span></span><br><span class="line">$ du <span class="comment"># 评估文件空间使用情况</span></span><br><span class="line">   -h <span class="comment"># human-readable 人类可读的</span></span><br><span class="line">   <span class="operator">-s</span> <span class="comment"># summary 概要情况</span></span><br></pre></td></tr></table></figure>
<p>文件系统相关的挂载配置文件<code>/etc/fstab</code>,每次系统启动都回去读取该文件,并自动挂载该文件下定义的文件系统,包含伪文件系统.此文件中每行定义一个文件系统.格式如下:</p>
<p>&quot;要挂载的设备或伪文件系统   挂载点   文件系统类型   挂载选项  转储频率  自检次序&quot;</p>
<ul>
<li>要挂载的设备或伪文件系统, 可以使用设备文件, LABLE=, UUID=, 使用伪文件系统名称</li>
<li>挂载点 <code>/data</code></li>
<li>文件系统类型 <code>ext2, ext3, xfs...</code></li>
<li>defaults # Use default options: rw, suid, dev, exec, auto, nouser, and async.</li>
<li>转储频率, 可以理解为备份, (0: 不转储, 1: 每天转储, 2: 每隔一天转储)</li>
<li>自检次序, (0: 不自检, 1: 首先自检,通常只有/才为1, 2: 其他)</li>
</ul>
<h3 id="软连接与硬链接"><a class="header-anchor" href="#软连接与硬链接"></a>软连接与硬链接</h3>
<p>硬链接:两个路径指向同一个inode.(不能对目录进行,不能跨分区进行)</p>
<p>指向同一个inode的多个不同路径,创建文件的硬链接会增加inode的引用计数,删除硬链接仅是删除其一个访问路径,直到最后一个路径被删除.</p>
<p>符号链接:链接文件的数据指向另一个文件路径(可以对目录进行,也可以跨分区,指向的是另一个文件路径,而非inode,对文件创建符号链接不会增加其引用计数,删除原文件,符号链接也丢失)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#COMMAND</span></span><br><span class="line">$ ln [<span class="operator">-s</span>] SRC DEST</span><br><span class="line">   <span class="operator">-s</span> <span class="comment"># symbolic link</span></span><br><span class="line">   -v <span class="comment"># verbose</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="linux-磁盘管理"><a class="header-anchor" href="#linux-磁盘管理"></a>Linux 磁盘管理</h2>
<p><strong>硬盘分为:机械式硬盘,SSD</strong></p>
<h3 id="机械式硬盘"><a class="header-anchor" href="#机械式硬盘"></a>机械式硬盘</h3>
<ul>
<li>rpm: 5400, 7200, 10000, 15000</li>
<li>track</li>
<li>sector 512byte</li>
<li>cylinder, 分区以柱面为基本单位进行的</li>
<li>MBR(Master Boot Record)</li>
</ul>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-10]]></title>
    <link href="http://molloc.me/2015/09/11/ZY-2015-09-10/"/>
    <id>http://molloc.me/2015/09/11/ZY-2015-09-10/</id>
    <published>2015-09-11T15:18:37.000Z</published>
    <updated>2015-09-12T08:58:58.860Z</updated>
    <content type="html"><![CDATA[<p>总结rpm和yum实现程序包的管理功能</p>
<h2 id="程序包管理"><a class="header-anchor" href="#程序包管理"></a>程序包管理</h2>
<h3 id="包管理器"><a class="header-anchor" href="#包管理器"></a>包管理器</h3>
<p><strong>打包,包管理(安装,升级,卸载,查询及校验)</strong></p>
<ul>
<li>deb: debian</li>
<li>rpm: redhat package manager --&gt; RPM is Package Manager</li>
<li>DNF:</li>
</ul>
<a id="more"></a>
<p>systemctl set-default multi-user.target # 切换runlevel</p>
<h4 id="rpm包的命名机制"><a class="header-anchor" href="#rpm包的命名机制"></a>rpm包的命名机制</h4>
<p>name-VERSION-RELEASE.ARCH.rpm</p>
<ul>
<li><code>bash-4.2.4-1.e17.x76_64.rpm</code> 其中,<code>1.e17</code>是rpm包的relase号(<code>el7</code>是适用的操作系统,也当做release号的一部分).</li>
<li><code>bash-devel-4.2.4-1.e17.x76_64.rpm</code></li>
</ul>
<p>包与包之间有可能存在依赖关系: X --&gt; Y,通过rpm数据库<code>/var/lib/rpm/</code>,追踪rpm的关系</p>
<p>如何获取rpm包的途径</p>
<ul>
<li>发行版提供的程序包(<code>mkdir /media/cdrom;mount -r /dev/cdrom /media/cdrom</code>)</li>
<li>Fedora-EPEL</li>
<li>某个项目程序的官方站点</li>
<li>搜索引擎(http://rpm.pbone.net, http:pkgs.org)</li>
</ul>
<p>基于rpm命令实现程序包管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装</span></span><br><span class="line">rpm &#123;-i|--install&#125; [install-options] PACKAGE_FILE ...</span><br><span class="line"><span class="comment"># 与-i常用的选项:</span></span><br><span class="line"><span class="comment"># -v: 显示详细过程, -vv, -vvv</span></span><br><span class="line"><span class="comment"># -h: 显示安装进度</span></span><br><span class="line"></span><br><span class="line">rpm -q <span class="comment"># 查询包相关信息,一般跟上包名就可以了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个rpm包提供一个或多个capabilities</span></span><br><span class="line">--nodeps <span class="comment"># 忽略依赖关系</span></span><br><span class="line">--test <span class="comment">#做测试</span></span><br><span class="line">--replacepkgs <span class="comment"># 重装程序包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 升级,需提供包文件(package-file)</span></span><br><span class="line">rpm &#123;-U|--upgrade&#125; [install-options] PACKAGE_FILE ...</span><br><span class="line">rpm &#123;-F|--freshen&#125; [install-options] PACKAGE_FILE ...</span><br><span class="line"></span><br><span class="line">-Uvh: 如果有旧版程序包,则升级之.如果没有,则安装之.</span><br><span class="line">-Fvh: 如果有旧版程序包,则升级之.如果没有,则不安装.</span><br><span class="line"></span><br><span class="line">--nodeps <span class="comment"># 忽略依赖关系</span></span><br><span class="line">--oldpackage <span class="comment"># 降级</span></span><br><span class="line">--force <span class="comment"># 强制升级</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 卸载, 仅需提供包名(Package-name)</span></span><br><span class="line">rpm &#123;<span class="operator">-e</span>|--erase&#125; [--allmatches] [--nodeps] [--noscripts]</span><br><span class="line">           [--notriggers] [--test] PACKAGE_NAME ...</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询</span></span><br><span class="line">rpm &#123;-q|--query&#125; [select-options] [query-options]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询选项</span></span><br><span class="line">-qa <span class="comment"># 查询本机已经安装的所有程序包.</span></span><br><span class="line">-qf /PATH/TO/SOMEFILE <span class="comment"># 查询此处指定的文件由那个程序包安装生成</span></span><br><span class="line"></span><br><span class="line">-qc <span class="comment"># 查询指定程序包安装生成的配置文件.</span></span><br><span class="line">-qd <span class="comment"># 查询指定程序包安装生成的文档.</span></span><br><span class="line">-qi <span class="comment"># 查询指定程序包的相关信息.</span></span><br><span class="line">-ql <span class="comment"># 查询指定程序包生成的所有文件的列表.</span></span><br><span class="line">-qR <span class="comment"># 查询指定程序包依赖那些能力</span></span><br><span class="line">-q --scripts <span class="comment"># 查询程序包相关脚本</span></span><br><span class="line">			 <span class="comment"># 四类脚本</span></span><br><span class="line">			 <span class="comment"># preinstall 安装前脚本</span></span><br><span class="line">			 <span class="comment"># postinstall 安装后脚本</span></span><br><span class="line">			 <span class="comment"># preuninstall 卸载前脚本</span></span><br><span class="line">			 <span class="comment"># ppostuninstall 卸载后脚本</span></span><br><span class="line"></span><br><span class="line">-p <span class="comment"># 查询针对的是未安装程序包文件</span></span><br><span class="line">$ rpm -qpi php-mysqlnd-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">23</span>.el7_0.<span class="number">3</span>.x86_64.rpm</span><br><span class="line">--&gt; Name        : php-mysqlnd</span><br><span class="line">	Version     : <span class="number">5.4</span>.<span class="number">16</span></span><br><span class="line">	Release     : <span class="number">23</span>.el7_0.<span class="number">3</span></span><br><span class="line">	Architecture: x86_64</span><br><span class="line">	Install Date: (not installed)</span><br><span class="line">	Group       : Development/Languages</span><br><span class="line">	Size        : <span class="number">472238</span></span><br><span class="line">	License     : PHP</span><br><span class="line">	Signature   : RSA/SHA256, Fri <span class="number">31</span> Oct <span class="number">2014</span> <span class="number">10</span>:<span class="number">24</span>:<span class="number">58</span> PM CST, Key ID <span class="number">24</span>c6a8a7f4a80eb5</span><br><span class="line">	Source RPM  : php-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">23</span>.el7_0.<span class="number">3</span>.src.rpm</span><br><span class="line">	Build Date  : Fri <span class="number">31</span> Oct <span class="number">2014</span> <span class="number">09</span>:<span class="number">07</span>:<span class="number">27</span> PM CST</span><br><span class="line">	Build Host  : worker1.bsys.centos.org</span><br><span class="line">	Relocations : (not relocatable)</span><br><span class="line">	Packager    : CentOS BuildSystem &lt;http://bugs.centos.org&gt;</span><br><span class="line">	Vendor      : CentOS</span><br><span class="line">	URL         : http://www.php.net/</span><br><span class="line">	Summary     : A module <span class="keyword">for</span> PHP applications that use MySQL databases</span><br><span class="line">	Description :</span><br><span class="line"></span><br><span class="line">$ rpm -qpl php-mysqlnd-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">23</span>.el7_0.<span class="number">3</span>.x86_64.rpm</span><br><span class="line">--&gt; /etc/php.d/mysqlnd.ini</span><br><span class="line">	/etc/php.d/mysqlnd_mysql.ini</span><br><span class="line">	/etc/php.d/mysqlnd_mysqli.ini</span><br><span class="line">	/etc/php.d/pdo_mysqlnd.ini</span><br><span class="line"></span><br><span class="line"><span class="comment">## 校验</span></span><br><span class="line">rpm &#123;-V|--verify&#125; [select-options] [verify-options]</span><br><span class="line">$ rpm -V zsh</span><br><span class="line">--&gt; S.<span class="number">5</span>....T.    /usr/share/zsh/<span class="number">5.0</span>.<span class="number">2</span>/<span class="built_in">functions</span>/run-help</span><br><span class="line"><span class="comment"># S.5....T.</span></span><br><span class="line">S file Size differs <span class="comment"># 文件大小发生改变</span></span><br><span class="line">M Mode differs (includes permissions and file <span class="built_in">type</span>) <span class="comment"># 权限发生改变</span></span><br><span class="line"><span class="number">5</span> digest (formerly MD5 sum) differs <span class="comment"># 校验码发生改变</span></span><br><span class="line">D Device major/minor number mismatch <span class="comment"># 设备文件的主次设备号不匹配</span></span><br><span class="line">L <span class="built_in">read</span>Link(<span class="number">2</span>) path mismatch</span><br><span class="line">U User ownership differs <span class="comment"># 文件属主发生改变</span></span><br><span class="line">G Group ownership differs <span class="comment"># 文件属组发生改变</span></span><br><span class="line">T mTime differs <span class="comment"># 文件修改时间戳发生改变</span></span><br><span class="line">P caPabilities differ <span class="comment"># 能力改变,比如说删除一个文件</span></span><br></pre></td></tr></table></figure>
<h4 id="打包-一个单一的归档文件"><a class="header-anchor" href="#打包-一个单一的归档文件"></a>打包: 一个单一的归档文件</h4>
<p>通过rpmbuild打包(基于specs文件).</p>
<p>程序当中10中功能,5种常用,3种不常用,2种基本不用,会通过分包机制:</p>
<ul>
<li>核心包: testapp-VERSION.tar.gz</li>
<li>支包: testapp-dev-VERSION.tar.gz</li>
<li>程序包的版本命名机制VERSION: major,minor,release(eg: bash-4.2.4.tar.gz)</li>
</ul>
<h4 id="包校验"><a class="header-anchor" href="#包校验"></a>包校验</h4>
<ul>
<li>来源合法性验证: 基于非对称性加密(公钥加密只能用对应的私钥解密,反之亦然)</li>
<li>完整性验证: 基于单向加密</li>
</ul>
<p>centos相关目录(<code>/etc/pki/tls/,/etc/pki/rpm-gpg</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ls /etc/pki/&#123;tls,rpm-gpg&#125;</span><br><span class="line">--&gt; /etc/pki/rpm-gpg:</span><br><span class="line">	RPM-GPG-KEY-CentOS-<span class="number">7</span>  RPM-GPG-KEY-CentOS-Debug-<span class="number">7</span>  RPM-GPG-KEY-CentOS-Testing-<span class="number">7</span>  RPM-GPG-KEY-EPEL-<span class="number">7</span></span><br><span class="line"></span><br><span class="line">	/etc/pki/tls:</span><br><span class="line">	cert.pem  certs  misc  openssl.cnf  private</span><br><span class="line"></span><br><span class="line"><span class="comment">## 导入校验文件</span></span><br><span class="line">$ rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-<span class="number">7</span></span><br><span class="line"></span><br><span class="line">-K <span class="comment"># 校验来源</span></span><br><span class="line">$ rpm -K zsh-<span class="number">5.0</span>.<span class="number">2</span>-<span class="number">7</span>.el7.x86_64.rpm</span><br><span class="line">--&gt; zsh-<span class="number">5.0</span>.<span class="number">2</span>-<span class="number">7</span>.el7.x86_64.rpm: rsa sha1 (md5) pgp md5 OK</span><br></pre></td></tr></table></figure>
<h3 id="程序包组成"><a class="header-anchor" href="#程序包组成"></a>程序包组成</h3>
<ul>
<li>二进制程序: <code>/bin, /sbin/, /usr/bin, /usr/sbin</code></li>
<li>库文件: <code>/lib64, /lib, /usr/lib64, /usr/lib</code></li>
<li>配置文件: <code>/etc</code></li>
<li>帮助文件: manual, info</li>
</ul>
<hr>
<h2 id="yum"><a class="header-anchor" href="#yum"></a>YUM</h2>
<p><em>Yellowdog Updater Modified</em></p>
<h3 id="yum程序的配置文件"><a class="header-anchor" href="#yum程序的配置文件"></a>YUM程序的配置文件</h3>
<ul>
<li><code>/etc/yum.conf</code>,定义全局配置,对所有仓库都适用的配置.</li>
<li><code>/etc/yum.repos.d/*.repo</code>,一个文件通常用于一个或一组功能相近或相关的仓库.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## yum.conf</span></span><br><span class="line">[main]</span><br><span class="line"><span class="comment"># cachedir：yum缓存的目录，yum在此存储下载的rpm包和数据库，一般</span></span><br><span class="line"><span class="comment"># 是/var/cache/yum/$basearch/$releasever</span></span><br><span class="line">cachedir=/var/cache/yum/<span class="variable">$basearch</span>/<span class="variable">$releasever</span></span><br><span class="line"><span class="comment"># 是否保留缓存内容，0：表示安装后删除软件包，1表示安装后保留软件包</span></span><br><span class="line">keepcache=<span class="number">0</span></span><br><span class="line"><span class="comment"># 除错级别，0──10,默认是2 貌似只记录安装和删除记录</span></span><br><span class="line">debuglevel=<span class="number">2</span></span><br><span class="line">logfile=/var/<span class="built_in">log</span>/yum.log</span><br><span class="line"><span class="comment"># 有两个选项1和0,代表是否只升级和你安装软件包cpu体系一致的包，</span></span><br><span class="line"><span class="comment"># 如果设为1，则如你安装了一个i386的rpm，则yum不会用1686的包来升级。</span></span><br><span class="line">exactarch=<span class="number">1</span></span><br><span class="line">obsoletes=<span class="number">1</span></span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">plugins=<span class="number">1</span></span><br><span class="line">installonly_<span class="built_in">limit</span>=<span class="number">5</span></span><br><span class="line">bugtracker_url=http://bugs.centos.org/<span class="built_in">set</span>_project.php</span><br><span class="line">distroverpkg=centos-release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个仓库的格式</span></span><br><span class="line">[REPOID] <span class="comment"># 唯一</span></span><br><span class="line">name=Centos <span class="number">7</span> Base Repo on aliyun.com</span><br><span class="line">baseurl= <span class="comment"># 可以跟多个路径,用空格,换行隔开</span></span><br><span class="line">mirrorlist=SCHEME://HOSTNAME/PATH/TO/MIRROR_LIST_FILE <span class="comment"># 里面定义了所有可用镜像的列表</span></span><br><span class="line"><span class="built_in">enable</span>=&#123;<span class="number">0</span>|<span class="number">1</span>&#125; <span class="comment"># 0 不启用,1 启用</span></span><br><span class="line">gpgcheck=&#123;<span class="number">0</span>|<span class="number">1</span>&#125; <span class="comment"># 0 不检查,1 检查</span></span><br><span class="line">gpgkey=</span><br><span class="line">cost=</span><br><span class="line"><span class="comment">#failovermethode</span></span><br><span class="line"><span class="comment"># 有两个选项roundrobin和priority，意思分别是有多个url可供选择时，</span></span><br><span class="line"><span class="comment"># yum选择的次序，roundrobin是随机选择，如果连接失</span></span><br><span class="line"><span class="comment"># 败则使用下一个，依次循环，priority则根据url的次序从第一个开始。</span></span><br><span class="line"><span class="comment"># 如果不指明，默认是roundrobin。</span></span><br><span class="line">failovermethod=priority</span><br><span class="line"></span><br><span class="line"><span class="comment">## 使用发行的仓库当本地仓库,先挂载光盘至某目录</span></span><br><span class="line">[LocalRepo]</span><br><span class="line">name=</span><br><span class="line">baseurl=file:///media/cdrom</span><br><span class="line">gpgcheck=<span class="number">1</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 创建本地仓库</span></span><br><span class="line">yum install createrepo</span><br><span class="line">createrepo /PATH/TO/RPMFILES/</span><br><span class="line"></span><br><span class="line"><span class="comment">## 定义仓库的可用变量</span></span><br><span class="line"><span class="variable">$releasever</span>: <span class="comment"># 引用当前系统的主版本号</span></span><br><span class="line"><span class="variable">$basearch</span>: <span class="comment"># 引用当前系统的基本架构</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## command yum</span></span><br><span class="line">yum [options] [<span class="built_in">command</span>] [package ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 安装</span></span><br><span class="line">yum install mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">## 卸载</span></span><br><span class="line"><span class="comment"># remove 一个包的时候,依赖与此包的包一并被卸载.</span></span><br><span class="line"><span class="comment"># eg: php-mbstring 依赖于 php-common,那么卸载php-common的时候,php-mbstring也会被卸载.</span></span><br><span class="line">yum remove php-common</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查询</span></span><br><span class="line">yum info KEYWORD <span class="comment"># 安装不安装都可以查询</span></span><br><span class="line">yum seach KEYWORD <span class="comment"># 基于关键字做搜索,而且只是基于包名,概要做匹配</span></span><br><span class="line">yum list [all|installed|availiable]</span><br><span class="line">yum provides KEYWORD <span class="comment"># 查询指定文件有那个包安装生成</span></span><br><span class="line">yum reinstall KEYWORD <span class="comment"># 重新安装</span></span><br><span class="line">yum localinstall KEYWORD <span class="comment"># 从本地安装, localinstall已被废弃,建议使用install安装.</span></span><br><span class="line">yum downgrade KEYWORD <span class="comment"># 降级</span></span><br><span class="line">yum clean [ packages | metadata | expire-cache | rpmdb | plugins | all ] <span class="comment"># 清理缓存</span></span><br><span class="line">yum makecache [fast] <span class="comment"># 手动生成缓存</span></span><br><span class="line">yum grouplist <span class="comment"># 列出包组名</span></span><br><span class="line">yum groupinfo PACKAGE_GROUP_NAME <span class="comment"># 查看包组里面的内容, 带加号的是必须要装上去的,不带的为已经装过的.还有可选的</span></span><br><span class="line">yum groupinstall PACKAGE_GROUP_NAME <span class="comment"># 安装包组</span></span><br><span class="line">yum groupremove PACKAGE_GROUP_NAME <span class="comment"># 移除包组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 仓库相关</span></span><br><span class="line">yum repolist [ all | enabled | disabled ] <span class="comment"># 列出所有,可用的,禁用的</span></span><br><span class="line">yum repoinfo [ all | enabled | disabled ]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 帮助</span></span><br><span class="line">yum <span class="built_in">help</span> repoinfo</span><br><span class="line"></span><br><span class="line"><span class="comment">## 升级</span></span><br><span class="line">yum check-update <span class="comment"># 检查有那些可用升级</span></span><br></pre></td></tr></table></figure>
<h2 id="yum-history"><a class="header-anchor" href="#yum-history"></a>yum history</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 列出所有操作</span></span><br><span class="line">$ yum <span class="built_in">history</span></span><br><span class="line"><span class="comment">### OR ###</span></span><br><span class="line">$ yum <span class="built_in">history</span> list</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">ID     | Command line             | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">     <span class="number">2</span> | install -y php-mbstring  | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">36</span> | Install        |    <span class="number">2</span></span><br><span class="line">     <span class="number">1</span> | remove php-common        | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">12</span>:<span class="number">57</span> | Erase          |    <span class="number">2</span></span><br><span class="line"><span class="built_in">history</span> list</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 列出某个指定的`historyID`</span></span><br><span class="line">$ yum <span class="built_in">history</span> list <span class="number">1</span></span><br><span class="line">Loaded plugins: axelget, fastestmirror, langpacks</span><br><span class="line">ID     | Command line             | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">     <span class="number">1</span> | remove php-common        | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">12</span>:<span class="number">57</span> | Erase          |    <span class="number">2</span></span><br><span class="line"><span class="built_in">history</span> list</span><br><span class="line"></span><br><span class="line"><span class="comment">#3 由历史标识(historyID)显示全部信息。</span></span><br><span class="line">$ yum <span class="built_in">history</span> info <span class="number">2</span></span><br><span class="line">Loaded plugins: axelget, fastestmirror, langpacks</span><br><span class="line">Transaction ID : <span class="number">2</span></span><br><span class="line">Begin time     : Sat Sep <span class="number">12</span> <span class="number">14</span>:<span class="number">36</span>:<span class="number">30</span> <span class="number">2015</span></span><br><span class="line">Begin rpmdb    : <span class="number">1273</span>:d5fafe71514a5f40941114c75679544fcb3f2d30</span><br><span class="line">End time       :                           (<span class="number">0</span> seconds)</span><br><span class="line">End rpmdb      : <span class="number">1275</span>:<span class="number">08</span>e0ab8a5924efd808d9de461722e9376fe2e529</span><br><span class="line">User           : root &lt;root&gt;</span><br><span class="line">Return-Code    : Success</span><br><span class="line">Command Line   : install -y php-mbstring</span><br><span class="line">Transaction performed with:</span><br><span class="line">    Installed     rpm-<span class="number">4.11</span>.<span class="number">1</span>-<span class="number">25</span>.el7.x86_64                      @anaconda</span><br><span class="line">    Installed     yum-<span class="number">3.4</span>.<span class="number">3</span>-<span class="number">125</span>.el7.centos.noarch               @anaconda</span><br><span class="line">    Installed     yum-plugin-fastestmirror-<span class="number">1.1</span>.<span class="number">31</span>-<span class="number">29</span>.el7.noarch @anaconda</span><br><span class="line">Packages Altered:</span><br><span class="line">    Dep-Install php-common-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1.x86_64   @updates</span><br><span class="line">    Install     php-mbstring-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1.x86_64 @updates</span><br><span class="line"><span class="built_in">history</span> info</span><br><span class="line"></span><br><span class="line"><span class="comment">#4 Shows summary of lates operations.</span></span><br><span class="line">Loaded plugins: axelget, fastestmirror, langpacks</span><br><span class="line">Login user                 | Time                | Action(s)        | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">root &lt;root&gt;                | Last day            | E, I             |        <span class="number">6</span></span><br><span class="line"><span class="built_in">history</span> summary</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 yum history repeat command repeats old operation by history ID.</span></span><br><span class="line">$ yum <span class="built_in">history</span></span><br><span class="line">ID     | Command line             | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">     <span class="number">4</span> | remove php-mbstring      | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">49</span> | Erase          |    <span class="number">1</span></span><br><span class="line">     <span class="number">3</span> | install yum-axelget.noar | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">40</span> | Install        |    <span class="number">2</span></span><br><span class="line">     <span class="number">2</span> | install -y php-mbstring  | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">14</span>:<span class="number">36</span> | Install        |    <span class="number">2</span></span><br><span class="line">     <span class="number">1</span> | remove php-common        | <span class="number">2015</span>-<span class="number">09</span>-<span class="number">12</span> <span class="number">12</span>:<span class="number">57</span> | Erase          |    <span class="number">2</span></span><br><span class="line"><span class="built_in">history</span> list</span><br><span class="line"></span><br><span class="line">$ yum <span class="built_in">history</span> repeat <span class="number">2</span></span><br><span class="line">Dependencies Resolved</span><br><span class="line">...</span><br><span class="line">Install  <span class="number">1</span> Package</span><br><span class="line"></span><br><span class="line">Total download size: <span class="number">503</span> k</span><br><span class="line">Installed size: <span class="number">1.3</span> M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">php-mbstring-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1.x86_64.rpm</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : php-mbstring-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1.x86_64</span><br><span class="line">  Verifying  : php-mbstring-<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1.x86_64</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  php-mbstring.x86_64 <span class="number">0</span>:<span class="number">5.4</span>.<span class="number">16</span>-<span class="number">36</span>.el7_1</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 清空History</span></span><br><span class="line">$ yum <span class="built_in">history</span> new</span><br><span class="line">Loaded plugins: dellsysidplugin2, fastestmirror, refresh-packagekit</span><br><span class="line">ID     | Login user             | Date and time    | Action(s)      | Altered</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"><span class="built_in">history</span> list</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>总结rpm和yum实现程序包的管理功能</p>
<h2 id="程序包管理"><a class="header-anchor" href="#程序包管理"></a>程序包管理</h2>
<h3 id="包管理器"><a class="header-anchor" href="#包管理器"></a>包管理器</h3>
<p><strong>打包,包管理(安装,升级,卸载,查询及校验)</strong></p>
<ul>
<li>deb: debian</li>
<li>rpm: redhat package manager --&gt; RPM is Package Manager</li>
<li>DNF:</li>
</ul>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-09-05]]></title>
    <link href="http://molloc.me/2015/09/09/ZY-2015-09-05/"/>
    <id>http://molloc.me/2015/09/09/ZY-2015-09-05/</id>
    <published>2015-09-09T14:18:46.000Z</published>
    <updated>2015-09-11T15:22:08.112Z</updated>
    <content type="html"><![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<h2 id="linux上的任务计划"><a class="header-anchor" href="#linux上的任务计划"></a>Linux上的任务计划</h2>
<h3 id="任务计划"><a class="header-anchor" href="#任务计划"></a>任务计划</h3>
<ul>
<li>在未来时间点一次性执行某任务: <code>at, batch</code></li>
<li>周期性执行某任务: <code>crontab</code></li>
</ul>
<h3 id="电子邮件服务"><a class="header-anchor" href="#电子邮件服务"></a>电子邮件服务</h3>
<ul>
<li>smtp: Simple Mail Transfer Protocol</li>
<li>POP3: Post Office Protocol - Version 3</li>
<li>imap4: Internet Message Access Protocol 4 交互式数据消息访问协议第四个版本</li>
<li>邮件用户代理（MUA，Mail User Agent）(mail,mailx)</li>
<li>邮件传送代理（MTA，Mail Transport Agent）(sendmail)</li>
<li>邮件分发代理（MDA，Mail Deliver Agent）</li>
<li>通俗的说MUA就是用户使用的客户端，而MTA则是真正发送邮件的发送进程，MUA编写的邮件最终也交由MTA发送至目标端。</li>
<li>mail和mailx即为负责查看、编写邮件和向MTA发送邮件的MUA。mailx是mail的功能加强版。</li>
<li>sendmail即为负责邮件在网络上传输的MTA，将邮件从一个MTA传送至另一个MTA。</li>
</ul>
<p>linux中mail的存放路径<code>/var/sool/mail/USERNAME</code></p>
<a id="more"></a>
<h2 id="相关命令"><a class="header-anchor" href="#相关命令"></a>相关命令</h2>
<h3 id="mailx"><a class="header-anchor" href="#mailx"></a>mailx</h3>
<p><strong>mailx - 发送和接收 Internet 邮件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">mailx [-BDdEFintv~] [<span class="operator">-s</span> subject] [<span class="operator">-a</span> attachment ] [-c cc-addr] [-b bcc-addr] [-r from-addr] [-h hops] [-A account] to-addr</span><br><span class="line">      . . .</span><br><span class="line">mailx [-BDdeEHiInNRv~] [-T name] [-A account] [-S variable[=value]] <span class="operator">-f</span> [name]</span><br><span class="line">mailx [-BDdeE<span class="keyword">in</span>NRv~] [-A account] [-S variable[=value]] [-u user]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s subject //指定邮件的主题,有空格需要引号引起来</span></span><br><span class="line">$ mailx <span class="operator">-s</span> <span class="string">'hello mailx'</span> root@localhost <span class="comment"># 进入交互式收发邮件接口</span></span><br><span class="line">hello new world.</span><br><span class="line">...</span><br><span class="line"><span class="comment">#CTRL+D (保存退出)</span></span><br><span class="line"></span><br><span class="line">$ mailx</span><br><span class="line">--&gt; Heirloom Mail version <span class="number">12.5</span> <span class="number">7</span>/<span class="number">5</span>/<span class="number">10</span>.  Type ? <span class="keyword">for</span> help.</span><br><span class="line">	<span class="string">"/var/spool/mail/root"</span>: <span class="number">3</span> messages <span class="number">1</span> new <span class="number">2</span> unread</span><br><span class="line">	 U  <span class="number">1</span> user@localhost.local  Wed Aug <span class="number">19</span> <span class="number">23</span>:<span class="number">07</span> <span class="number">709</span>/<span class="number">52085</span> <span class="string">"[abrt] full crash report"</span></span><br><span class="line">	    <span class="number">2</span> root                  Wed Sep  <span class="number">9</span> <span class="number">22</span>:<span class="number">55</span>  <span class="number">19</span>/<span class="number">619</span>   <span class="string">"hello mailx"</span></span><br><span class="line">	&gt;N  <span class="number">3</span> root                  Wed Sep  <span class="number">9</span> <span class="number">23</span>:<span class="number">01</span>  <span class="number">18</span>/<span class="number">629</span>   <span class="string">"hello mailx"</span></span><br><span class="line">&amp;(此处键入编号查看邮件内容)</span><br><span class="line">&amp;(输入quit退出)</span><br><span class="line"></span><br><span class="line">$ mailx <span class="operator">-s</span> <span class="string">'hello mailx'</span> root@localhost &lt; cat /PATH/FROM/SOMEFILE</span><br><span class="line">$ COMMAND | mailx <span class="operator">-s</span> <span class="string">'hello mailx'</span> root@localhost</span><br></pre></td></tr></table></figure>
<h3 id="at"><a class="header-anchor" href="#at"></a>at</h3>
<p><strong>at - 在一个指定的时间执行一个指定任务，只能执行一次，且需要开启atd进程,支持使用作业队列,默认使用a队列</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">at [OPTION]... TIME</span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用参数</span></span><br><span class="line">-m 当指定的任务被完成之后，将给用户发送邮件，即使没有标准输出</span><br><span class="line"><span class="operator">-l</span> atq的别名</span><br><span class="line"><span class="operator">-d</span> atrm的别名</span><br><span class="line">-v 显示任务将被执行的时间</span><br><span class="line">-c 打印任务的内容到标准输出</span><br><span class="line">-V 显示版本信息</span><br><span class="line">-q&lt;列队&gt; 使用指定的列队</span><br><span class="line"><span class="operator">-f</span>&lt;文件&gt; 从指定文件读入任务而不是从标准输入读入</span><br><span class="line">-t&lt;时间参数&gt; 以时间参数的形式提交要运行的任务</span><br><span class="line"></span><br><span class="line"><span class="comment">## 操作实践</span></span><br><span class="line">$ at now+<span class="number">3</span>minutes</span><br><span class="line">at&gt; cat /etc/passwd</span><br><span class="line">&lt;CTRL+D&gt;</span><br><span class="line"></span><br><span class="line">$ atq</span><br><span class="line">--&gt; <span class="number">1</span>	Thu Sep <span class="number">10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a centos</span><br><span class="line">	<span class="number">2</span>	Wed Sep  <span class="number">9</span> <span class="number">23</span>:<span class="number">38</span>:<span class="number">00</span> <span class="number">2015</span> a admin</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 三天后的下午 5 点钟执行 /bin/ls</span></span><br><span class="line">$ at <span class="number">5</span>pm + <span class="number">3</span>days</span><br><span class="line">at&gt; /bin/ls</span><br><span class="line">&lt;CTRL+D&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 明天17点钟，输出时间到指定文件内</span></span><br><span class="line">$ at <span class="number">17</span>:<span class="number">00</span> tomorrow</span><br><span class="line">at&gt; date &gt; /tmp/date.log</span><br><span class="line">&lt;CTRL+D&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3 计划任务设定后，在没有执行之前我们可以用atq命令来查看系统没有执行工作任务</span></span><br><span class="line">$ atq</span><br><span class="line">--&gt; <span class="number">1</span>	Thu Sep <span class="number">10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a centos</span><br><span class="line">	<span class="number">3</span>	Thu Sep <span class="number">10</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a root</span><br><span class="line">	<span class="number">4</span>	Thu Sep <span class="number">10</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a root</span><br><span class="line">	<span class="number">5</span>	Thu Sep <span class="number">10</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a root</span><br><span class="line"></span><br><span class="line"><span class="comment">#4 删除已经设置的任务</span></span><br><span class="line">$ atrm <span class="number">5</span></span><br><span class="line">$ atq</span><br><span class="line">--&gt; <span class="number">1</span>	Thu Sep <span class="number">10</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a centos</span><br><span class="line">		<span class="number">3</span>	Thu Sep <span class="number">10</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a root</span><br><span class="line">		<span class="number">4</span>	Thu Sep <span class="number">10</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span> <span class="number">2015</span> a root</span><br><span class="line"></span><br><span class="line"><span class="comment">#5 显示已经设置的任务内容</span></span><br><span class="line">$ at -c <span class="number">1</span></span><br><span class="line">--&gt; <span class="comment">#!/bin/sh</span></span><br><span class="line">	<span class="comment"># atrun uid=1001 gid=1001</span></span><br><span class="line">	<span class="comment"># mail centos 0</span></span><br><span class="line">	<span class="built_in">umask</span> <span class="number">2</span></span><br><span class="line">	XDG_SESSION_ID=<span class="number">14</span>; <span class="built_in">export</span> XDG_SESSION_ID</span><br><span class="line">	HOSTNAME=kernel; <span class="built_in">export</span> HOSTNAME</span><br><span class="line">	SHELL=/bin/bash; <span class="built_in">export</span> SHELL</span><br><span class="line">	HISTSIZE=<span class="number">1000</span>; <span class="built_in">export</span> HISTSIZE</span><br><span class="line">	...</span><br><span class="line">	cat ~/.bashrc</span><br><span class="line">	marcinDELIMITER2ccbf31a</span><br></pre></td></tr></table></figure>
<hr>
<p>既然是计划任务，那么应该会有任务执行的方式，并且将这些任务排进行程表中。那么产生计划任务的方式是怎么进行的?</p>
<p>事实上，我们使用 at 这个命令来产生所要运行的计划任务，并将这个计划任务以文字档的方式写入 /var/spool/at/ 目录内，该工作便能等待 atd 这个服务的取用与运行了。就这么简单。</p>
<p>不过，并不是所有的人都可以进行 at 计划任务。为什么?</p>
<p>因为系统安全的原因。很多主机被所谓的攻击破解后，最常发现的就是他们的系统当中多了很多的黑客程序， 这些程序非常可能运用一些计划任务来运行或搜集你的系统运行信息,并定时的发送给黑客。</p>
<p>所以，除非是你认可的帐号，否则先不要让他们使用 at 命令。那怎么达到使用 at 的可控呢?</p>
<p>我们可以利用 /etc/at.allow 与 /etc/at.deny 这两个文件来进行 at 的使用限制。加上这两个文件后， at 的工作情况是这样的：</p>
<p>先找寻 /etc/at.allow 这个文件，写在这个文件中的使用者才能使用 at ，没有在这个文件中的使用者则不能使用 at (即使没有写在 at.deny 当中);
如果 /etc/at.allow 不存在，就寻找 /etc/at.deny 这个文件，若写在这个 at.deny 的使用者则不能使用 at ，而没有在这个 at.deny 文件中的使用者，就可以使用 at 命令了。</p>
<p>如果两个文件都不存在，那么只有 root 可以使用 at 这个命令。</p>
<hr>
<p>透过这个说明，我们知道 /etc/at.allow 是管理较为严格的方式，而 /etc/at.deny 则较为松散 (因为帐号没有在该文件中，就能够运行 at 了)。在一般的 distributions 当中，由于假设系统上的所有用户都是可信任的， 因此系统通常会保留一个空的 /etc/at.deny 文件，意思是允许所有人使用 at 命令的意思 (您可以自行检查一下该文件)。 不过，万一你不希望有某些使用者使用 at 的话，将那个使用者的帐号写入 /etc/at.deny 即可！ 一个帐号写一行。</p>
<p>at允许使用一套相当复杂的指定时间的方法。他能够接受在当天的hh:mm（小时:分钟）式的时间指定。</p>
<p>假如该时间已过去，那么就放在第二天执行。当然也能够使用midnight（深夜），noon（中午），teatime（饮茶时间，一般是下午4点）等比较模糊的 词语来指定时间。</p>
<p>用户还能够采用12小时计时制，即在时间后面加上AM（上午）或PM（下午）来说明是上午还是下午。 也能够指定命令执行的具体日期，指定格式为month day（月 日）或mm/dd/yy（月/日/年）或dd.mm.yy（日.月.年）。</p>
<p>指定的日期必须跟在指定时间的后面。上面介绍的都是绝对计时法，其实还能够使用相对计时法，这对于安排不久就要执行的命令是很有好处的。</p>
<p>指定格式为：now + count time-units ，now就是当前时间，timeunits是时间单位，这里能够是minutes（分钟）、hours（小时）、days（天）、weeks（星期）。count是时间的数量，究竟是几天，还是几小时，等等。</p>
<p>更有一种计时方法就是直接使用today（今天）、tomorrow（明天）来指定完成命令的时间。</p>
<h3 id="batch"><a class="header-anchor" href="#batch"></a>batch</h3>
<p>由系统自行选择在资源较为空闲时运行指定的任务；</p>
<h3 id="crontab"><a class="header-anchor" href="#crontab"></a>crontab</h3>
<p><strong>at - 周期性任务计划，且需要开启crond进程</strong></p>
<p>Linux下的任务调度分为两类，系统任务调度和用户任务调度。</p>
<ol>
<li>
<p>系统cron任务；没有默认运行用户身份，所以需要额外指定运行者；
<code>/etc/crontab</code>
vim命令
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name  command to be executed</span></span><br></pre></td></tr></table></figure></p>
<p>7个字段：
前5个字段：时间点
user-name: 以哪个用户的身份运行任务
command to be executed: 要运行任务</p>
</li>
<li>
<p>用户cron任务：由某个用户所提交，默认就以提交者的身份运行，所以无需额外指定运行者；
<code>/var/spool/cron/USERNAME</code>
vim命令；不建议
crontab命令：建议
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  *  command to be executed</span></span><br></pre></td></tr></table></figure></p>
</li>
</ol>
<p>5个时间点：分钟(0-59),小时(0-23),日(1-31)月(1-12),周(0-7)</p>
<ul>
<li>注意：几月几号与4周几，不建议同时使用；*</li>
</ul>
<p>时间表示法：</p>
<ul>
<li>*: 对应时间点有效取值范围内的每个时间点；</li>
<li>-: 一个特定连续时间范围, 3-7</li>
<li>,：一个离散的时间点, 3,5,7</li>
<li>/#：有效时间范围内的每多少时间；用于指定频率；1-30/4, */4</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">at [OPTION]... TIME</span><br><span class="line">crontab [-u user] file</span><br><span class="line">crontab [-u user] [<span class="operator">-l</span> | -r | <span class="operator">-e</span>] [-i] [<span class="operator">-s</span>]</span><br><span class="line">crontab -n [ hostname ]</span><br><span class="line">crontab -c</span><br><span class="line"></span><br><span class="line"><span class="comment">## 常用参数</span></span><br><span class="line">-u user: 不是管理自己的cron任务，而是指定的目标用户的cron任务；仅root拥有管理其它用户的cron任务的权限；默认管理自己的；</span><br><span class="line"><span class="operator">-l</span>: list，列出任务；</span><br><span class="line">-r: remove, 移除所有任务；</span><br><span class="line"><span class="operator">-e</span>: edit，编辑，打开一当前shell会话的默认编辑器来编辑cron任务表；</span><br><span class="line">-i: 在删除用户的crontab文件时给确认提示。</span><br><span class="line"></span><br><span class="line"><span class="comment">## 操作实践</span></span><br><span class="line">$ crontab <span class="operator">-e</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#1 用gentoo创建一个新的crontab文件</span></span><br><span class="line">$ crontab <span class="operator">-e</span></span><br><span class="line">--&gt; no crontab <span class="keyword">for</span> gentoo - using an empty one</span><br><span class="line">	crontab: installing new crontab</span><br><span class="line"></span><br><span class="line">$ crontab <span class="operator">-l</span></span><br><span class="line">--&gt; * * * * * `<span class="built_in">which</span> ls --skip-alias` .</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 在crontab中使用date命令</span></span><br><span class="line">$ crontab <span class="operator">-e</span></span><br><span class="line">* * * * * `<span class="built_in">which</span> --skip-alias ls` -al . &gt; /tmp/gentoo.$(date <span class="string">'+\%F %T'</span>).log</span><br></pre></td></tr></table></figure>
<h2 id="注意事项"><a class="header-anchor" href="#注意事项"></a>注意事项</h2>
<p>有时我们创建了一个crontab，但是这个任务却无法自动执行，而手动执行这个任务却没有问题，这种情况一般是由于在crontab文件中没有配置环境变量引起的。
在crontab文件中定义多个调度任务时，需要特别注意的一个问题就是环境变量的设置，因为我们手动执行某个任务时，是在当前shell环境下进行的，程序当然能找到环境变量，而系统自动执行任务调度时，是不会加载任何环境变量的，因此，就需要在crontab文件中指定任务运行所需的所有环境变量，这样，系统执行任务调度时就没有问题了。
不要假定cron知道所需要的特殊环境，它其实并不知道。所以你要保证在shelll脚本中提供所有必要的路径和环境变量，除了一些自动设置的全局变量。所以注意如下3点：</p>
<ol>
<li>脚本中涉及文件路径时写全局路径；</li>
<li>脚本执行要用到java或其他环境变量时，通过source命令引入环境变量，如：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat start_cbp.sh</span><br><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">export</span> RUN_CONF=/home/d139/conf/platform/cbp/cbp_jboss.conf</span><br><span class="line">/usr/<span class="built_in">local</span>/jboss-<span class="number">4.0</span>.<span class="number">5</span>/bin/run.sh -c mev &amp;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>当手动执行脚本OK，但是crontab死活不执行时。这时必须大胆怀疑是环境变量惹的祸，并可以尝试在crontab中直接引入环境变量解决问题。如：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> * * * * . /etc/profile;/bin/sh /var/www/java/audit_no_count/bin/restart_audit.sh</span><br></pre></td></tr></table></figure>
<h3 id="注意清理系统用户的邮件日志"><a class="header-anchor" href="#注意清理系统用户的邮件日志"></a>注意清理系统用户的邮件日志</h3>
<p>每条任务调度执行完毕，系统都会将任务输出信息通过电子邮件的形式发送给当前系统用户，这样日积月累，日志信息会非常大，可能会影响系统的正常运行，因此，将每条任务进行重定向处理非常重要。
例如，可以在crontab文件中设置如下形式，忽略日志输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> */<span class="number">3</span> * * * /usr/<span class="built_in">local</span>/apache2/apachectl restart &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><code>/dev/null 2&gt;&amp;1</code>表示先将标准输出重定向到<code>/dev/null</code>，然后将标准错误重定向到标准输出，由于标准输出已经重定向到了<code>/dev/null</code>，因此标准错误也会重定向到/dev/null，这样日志输出问题就解决了。</p>
<h3 id="系统级任务调度与用户级任务调度"><a class="header-anchor" href="#系统级任务调度与用户级任务调度"></a>系统级任务调度与用户级任务调度</h3>
<p>系统级任务调度主要完成系统的一些维护操作，用户级任务调度主要完成用户自定义的一些任务，可以将用户级任务调度放到系统级任务调度来完成（不建议这么做），但是反过来却不行，root用户的任务调度操作可以通过<code>crontab –uroot –e</code>来设置，也可以将调度任务直接写入/etc/crontab文件，需要注意的是，如果要定义一个定时重启系统的任务，就必须将任务放到<code>/etc/crontab</code>文件，即使在root用户下创建一个定时重启系统的任务也是无效的。</p>
<h3 id="其他注意事项"><a class="header-anchor" href="#其他注意事项"></a>其他注意事项</h3>
<p>新创建的cron job，不会马上执行，至少要过2分钟才执行。如果重启cron则马上执行。
当crontab突然失效时，可以尝试<code>/etc/init.d/crond restart</code>解决问题。或者查看日志看某个job有没有执行/报错<code>tail -f /var/log/cron</code>。
千万别乱运行crontab -r。它从Crontab目录（/var/spool/cron）中删除用户的Crontab文件。删除了该用户的所有crontab都没了。
在crontab中%是有特殊含义的，表示换行的意思。如果要用的话必须进行转义%，如经常用的date ‘+%Y%m%d’在crontab里是不会执行的，应该换成<code>date &quot;+\%Y\%m\%d&quot;</code>。</p>
<hr>
<p><strong>每周一到周六的凌晨3点20分，运行cp命令对/etc/目录进行归档另存，存储位置为<code>/backups/etc-YYYY-MM-DD</code>;</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span> <span class="number">3</span> * * <span class="number">1</span>-<span class="number">6</span> `<span class="built_in">which</span> cp` <span class="operator">-a</span> /etc/ /backups/etc-$(date <span class="string">'+\%F'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>每周日凌晨2点30分，运行cp命令对/etc/fstab文件进行备份，存储位置为<code>/backups/fstab-YYYY-MM-DD-hh-mm-ss</code>;</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">30</span> <span class="number">2</span> * * <span class="number">0</span> `<span class="built_in">which</span> cp` <span class="operator">-a</span> /etc/fstab /backups/fstab-$(date <span class="string">'+\%F-\%H-\%M-\%S'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>每天晚上12点，取得/proc/meminfo文件中所有以S或M开头的行，追加至<code>/statistics/meminfo.txt</code>文件中，且每天的消息之前，要加上类似===============分隔线;</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> <span class="number">0</span> * * * <span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">'\033[31m===========================\033[0m'</span> &gt;&gt; /statistics/meminfo.txt; \</span><br><span class="line">cat /proc/meminfo | egrep <span class="string">'^(S|M)'</span> &gt;&gt; /statistics/meminfo.txt</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<h2 id="linux上的任务计划"><a class="header-anchor" href="#linux上的任务计划"></a>Linux上的任务计划</h2>
<h3 id="任务计划"><a class="header-anchor" href="#任务计划"></a>任务计划</h3>
<ul>
<li>在未来时间点一次性执行某任务: <code>at, batch</code></li>
<li>周期性执行某任务: <code>crontab</code></li>
</ul>
<h3 id="电子邮件服务"><a class="header-anchor" href="#电子邮件服务"></a>电子邮件服务</h3>
<ul>
<li>smtp: Simple Mail Transfer Protocol</li>
<li>POP3: Post Office Protocol - Version 3</li>
<li>imap4: Internet Message Access Protocol 4 交互式数据消息访问协议第四个版本</li>
<li>邮件用户代理（MUA，Mail User Agent）(mail,mailx)</li>
<li>邮件传送代理（MTA，Mail Transport Agent）(sendmail)</li>
<li>邮件分发代理（MDA，Mail Deliver Agent）</li>
<li>通俗的说MUA就是用户使用的客户端，而MTA则是真正发送邮件的发送进程，MUA编写的邮件最终也交由MTA发送至目标端。</li>
<li>mail和mailx即为负责查看、编写邮件和向MTA发送邮件的MUA。mailx是mail的功能加强版。</li>
<li>sendmail即为负责邮件在网络上传输的MTA，将邮件从一个MTA传送至另一个MTA。</li>
</ul>
<p>linux中mail的存放路径<code>/var/sool/mail/USERNAME</code></p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-08-27]]></title>
    <link href="http://molloc.me/2015/08/30/ZY-2015-08-27/"/>
    <id>http://molloc.me/2015/08/30/ZY-2015-08-27/</id>
    <published>2015-08-29T16:00:33.000Z</published>
    <updated>2015-09-11T15:22:07.648Z</updated>
    <content type="html"><![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>本文涉及的命令有: chmod, chown, chgrp, umask, grep, egrep</em></p>
<a id="more"></a>
<h2 id="linux文件系统的权限"><a class="header-anchor" href="#linux文件系统的权限"></a>Linux文件系统的权限</h2>
<p>属主(owner, u), 属组(group, g), 其他用户(other, o):
rwx, rwx, rwx</p>
<p>对应当前资源,每类账户都通过三位权限限定.(000-111: 0-7)</p>
<h2 id="权限管理相关命令"><a class="header-anchor" href="#权限管理相关命令"></a>权限管理相关命令</h2>
<ul>
<li>权限管理 chmod</li>
<li>所属关系管理: chown, chgrp</li>
<li>文件遮罩码: umask</li>
</ul>
<h2 id="chmod"><a class="header-anchor" href="#chmod"></a>chmod</h2>
<p><strong>chmod - 修改文件的权限</strong></p>
<h3 id="基本用法"><a class="header-anchor" href="#基本用法"></a>基本用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-R: recursive <span class="comment">#递归修改权限</span></span><br></pre></td></tr></table></figure>
<h3 id="二种用法"><a class="header-anchor" href="#二种用法"></a>二种用法</h3>
<ol>
<li>操作指定类别用户的权限</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=model</span><br><span class="line">	=rx, =r, =</span><br><span class="line">	ug=rx, go=, a=</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>操作某类用户的某位或某些位权限<code>+|-</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[\+|-]mode</span><br><span class="line">	u\+r,</span><br><span class="line">		\+x</span><br><span class="line">		\+w</span><br></pre></td></tr></table></figure>
<h3 id="操作实践"><a class="header-anchor" href="#操作实践"></a>操作实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">chmod [OPTION]... MODE[,MODE]... FILE...</span><br><span class="line">chmod [OPTION]... OCTAL-MODE FILE...</span><br><span class="line">chmod [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line">$ chmod u=r file <span class="comment">#会覆盖掉已有的权限</span></span><br><span class="line">--&gt; -r--rwxrwx <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">29</span> <span class="number">15</span>:<span class="number">12</span> file</span><br><span class="line"></span><br><span class="line">$ chmod u+wx file</span><br><span class="line">--&gt; -rwxrwxrwx <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">29</span> <span class="number">15</span>:<span class="number">12</span> file</span><br><span class="line"></span><br><span class="line">$ ll</span><br><span class="line">-rw-rw-rw- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> a</span><br><span class="line">-rw-r--r-- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment">## 参考文件a的权限修改b的权限</span></span><br><span class="line">$ chmod --reference=a b</span><br><span class="line">$ ll</span><br><span class="line">--&gt; -rw-rw-rw- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> a</span><br><span class="line">	-rw-rw-rw- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> b</span><br><span class="line"></span><br><span class="line">$ chmod u-r,g-w c</span><br><span class="line">--&gt; --w-r--rw- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> c</span><br><span class="line"></span><br><span class="line"><span class="comment">#eg:复制/etc/skel目录为/home/tuser1,要求/home/tuser1及其内部文件的属组和其它用户均没有任何访问权限.</span></span><br><span class="line">$ cp -R /etc/skel/ /home/tuser1/</span><br><span class="line">$ chmod go= -R /home/tuser1</span><br><span class="line">$ ll <span class="operator">-a</span> tuser1/</span><br><span class="line">--&gt; drwx------  <span class="number">4</span> root root <span class="number">4096</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .</span><br><span class="line">	drwxr-xr-x. <span class="number">7</span> root root <span class="number">4096</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> ..</span><br><span class="line">	-rw-------  <span class="number">1</span> root root   <span class="number">18</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .bash_<span class="built_in">logout</span></span><br><span class="line">	-rw-------  <span class="number">1</span> root root  <span class="number">176</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .bash_profile</span><br><span class="line">	-rw-------  <span class="number">1</span> root root  <span class="number">124</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .bashrc</span><br><span class="line">	drwx------  <span class="number">2</span> root root <span class="number">4096</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .gnome2</span><br><span class="line">	drwx------  <span class="number">4</span> root root <span class="number">4096</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">34</span> .mozilla</span><br></pre></td></tr></table></figure>
<h2 id="chown"><a class="header-anchor" href="#chown"></a>chown</h2>
<p><strong>chown - 修改文件的属主或属组</strong></p>
<h3 id="基本用法-v2"><a class="header-anchor" href="#基本用法-v2"></a>基本用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">chown [OPTION]... [OWNER][:[GROUP]] FILE...</span><br><span class="line">chown [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line">-R, --recursive <span class="comment"># 递归操纵文件或目录</span></span><br><span class="line"></span><br><span class="line">USER <span class="comment"># 只改属主</span></span><br><span class="line">USER:GROUP(USER.GROUP) <span class="comment"># 同时修改属主,属主</span></span><br></pre></td></tr></table></figure>
<h3 id="操作实践-v2"><a class="header-anchor" href="#操作实践-v2"></a>操作实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改b文件的属主为gentoo</span></span><br><span class="line">$ chown gentoo b</span><br><span class="line">$ ll b</span><br><span class="line">--&gt; -rw-rw-rw- <span class="number">1</span> gentoo root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改b文件的属主,属组为centos</span></span><br><span class="line">$ chown centos:centos b</span><br><span class="line">$ ll</span><br><span class="line">--&gt; -rw-rw-rw- <span class="number">1</span> centos centos <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参照文件b的属主,属主为a设置</span></span><br><span class="line">$ ll a</span><br><span class="line">--&gt; -rw-rw-rw- <span class="number">1</span> root root <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> a</span><br><span class="line">$ chown --reference=b a</span><br><span class="line">$ ll a b</span><br><span class="line">--&gt; -rw-rw-rw- <span class="number">1</span> centos centos <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> a</span><br><span class="line">	-rw-rw-rw- <span class="number">1</span> centos centos <span class="number">0</span> Nov <span class="number">30</span> <span class="number">13</span>:<span class="number">37</span> b</span><br></pre></td></tr></table></figure>
<h2 id="chgrp"><a class="header-anchor" href="#chgrp"></a>chgrp</h2>
<p><strong>chgrp - 修改组</strong></p>
<h3 id="基本用法-v3"><a class="header-anchor" href="#基本用法-v3"></a>基本用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">chgrp [OPTION]... GROUP FILE...</span><br><span class="line">chgrp [OPTION]... --reference=RFILE FILE...</span><br><span class="line"></span><br><span class="line">-R, --recursive <span class="comment"># 递归操纵文件或目录</span></span><br></pre></td></tr></table></figure>
<h2 id="umask"><a class="header-anchor" href="#umask"></a>umask</h2>
<p><strong>umask - 设定和显示遮罩码</strong></p>
<h3 id="操作实践-v3"><a class="header-anchor" href="#操作实践-v3"></a>操作实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示遮罩码</span></span><br><span class="line">$ <span class="built_in">umask</span></span><br><span class="line">--&gt; <span class="number">0022</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置遮罩码, 仅对当前shell进程有效</span></span><br><span class="line">$ <span class="built_in">umask</span> <span class="number">0002</span></span><br><span class="line">$ <span class="built_in">umask</span></span><br><span class="line">--&gt; <span class="number">0002</span></span><br></pre></td></tr></table></figure>
<h2 id="grep"><a class="header-anchor" href="#grep"></a>grep</h2>
<ul>
<li>Linux文本处理三剑客
<ol>
<li>grep: 文本过滤工具；</li>
<li>sed：文本编辑器(行)；stream editor</li>
<li>awk：文本报告生成器；Linux上awk的实现为gawk</li>
</ol>
</li>
<li>作用: 文本搜索工具,根据用户制定的'模式(pattern)'逐行去搜索目标文本,打印匹配到的行.</li>
<li>模式: 有正则表达式的元字符及文本字符所编写的过滤条件.</li>
<li>元字符: 字符不表示其字面的意义,而用于表示通配或控制功能.</li>
<li>BRE: 基本正则表达式</li>
<li>ERE: 扩展正则表达式</li>
</ul>
<h3 id="基本用法-v4"><a class="header-anchor" href="#基本用法-v4"></a>基本用法</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">grep [OPTIONS] PATTERN [FILE...]</span><br><span class="line">grep [OPTIONS] [<span class="operator">-e</span> PATTERN | <span class="operator">-f</span> FILE] [FILE...]</span><br><span class="line"></span><br><span class="line">--color=auto <span class="comment"># 对匹配到的行做高亮显示</span></span><br><span class="line">-v, --invert-match <span class="comment">#显示模式匹配不到的行</span></span><br><span class="line">-i, --ignore-case <span class="comment"># 忽略字符大小写</span></span><br><span class="line">-q, --quiet, --silent <span class="comment"># 静默模式, 不输出到标准输出</span></span><br><span class="line">-E, --extended-regexp <span class="comment"># 解释模式问扩展的正则表达式</span></span><br><span class="line">-P, --perl-regexp <span class="comment"># 解释模式作为一个Perl的正则表达式。这是高度的实验和grep -P可以警告未实现的功能。</span></span><br><span class="line">-c, --count <span class="comment"># 输出匹配到的行数</span></span><br></pre></td></tr></table></figure>
<h3 id="操作实践-v4"><a class="header-anchor" href="#操作实践-v4"></a>操作实践</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出匹配到的行数</span></span><br><span class="line">$ grep <span class="string">'bash\&gt;'</span> /etc/passwd -c</span><br><span class="line">--&gt; <span class="number">6</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="基本正则表达式"><a class="header-anchor" href="#基本正则表达式"></a>基本正则表达式</h2>
<h3 id="字符匹配"><a class="header-anchor" href="#字符匹配"></a>字符匹配</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.: 			<span class="comment"># 匹配任意单个字符；</span></span><br><span class="line">[]：		<span class="comment"># 匹配指定范围内的任意单个字符；</span></span><br><span class="line">[^]：		<span class="comment"># 匹配指定范围内的任意单个字符；</span></span><br><span class="line">[:lower:]   <span class="comment"># 小写字符</span></span><br><span class="line">[:upper:]   <span class="comment"># 大写字符</span></span><br><span class="line">[:alnum:]   <span class="comment"># 文字数字字符</span></span><br><span class="line">[:digit:]   <span class="comment"># 数字字符</span></span><br><span class="line">[:space:]   <span class="comment"># 所有空白字符（新行，空格，制表符)</span></span><br><span class="line">[:blank:]   <span class="comment"># 空格或制表符</span></span><br><span class="line">[:punct:]   <span class="comment"># 标点符号</span></span><br><span class="line">[:alpha:]   <span class="comment"># 文字字符</span></span><br><span class="line">[:blank:]   <span class="comment"># 空格或制表符</span></span><br><span class="line">[:cntrl:]   <span class="comment"># 控制字符</span></span><br><span class="line">[:graph:]   <span class="comment"># 非空字符（非空格、控制字符）</span></span><br><span class="line">[:<span class="built_in">print</span>:]   <span class="comment"># 非空字符（包括空格）</span></span><br><span class="line">[:xdigit:]  <span class="comment"># 十六进制数字（0-9，a-f，A-F）</span></span><br></pre></td></tr></table></figure>
<h3 id="次数匹配"><a class="header-anchor" href="#次数匹配"></a>次数匹配</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?      <span class="comment"># 0到1次</span></span><br><span class="line">*      <span class="comment"># 0到多次</span></span><br><span class="line">+      <span class="comment"># 1到多次</span></span><br><span class="line">&#123;n&#125;    <span class="comment"># 匹配n次</span></span><br><span class="line">&#123;n,&#125;   <span class="comment"># 至少匹配n次</span></span><br><span class="line">&#123;,m&#125;   <span class="comment"># 最多m次</span></span><br><span class="line">&#123;n,m&#125;  <span class="comment"># 最少n次,最多m次</span></span><br><span class="line">.* 	   <span class="comment"># 匹配任意长度的任意字符</span></span><br></pre></td></tr></table></figure>
<h3 id="位置锚定："><a class="header-anchor" href="#位置锚定："></a>位置锚定：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">^: 			<span class="comment"># 行首锚定；用于模式的最左侧；</span></span><br><span class="line">$: 			<span class="comment"># 行尾锚定；用于模式的最右侧；(用单引号)</span></span><br><span class="line">\&lt;, \b: 	<span class="comment"># 词首锚定；用于表示单词的模式的左侧；</span></span><br><span class="line">\&gt;, \b：	<span class="comment"># 词尾锚定；用于表示单词的模式的右侧；</span></span><br><span class="line">^$: 		<span class="comment"># 空白行</span></span><br></pre></td></tr></table></figure>
<h3 id="分组："><a class="header-anchor" href="#分组："></a>分组：()</h3>
<p>分组的小括号中的模式匹配到的内容,会在执行过程中被正则表达式引擎记录下来,并保存在内置变量中,这些变量分别是\1,\2...</p>
<p>\1: 从左侧起,第一个左括号,以及与之配对的右括号中间的模式所匹配到的内容.</p>
<p>\2: ...</p>
<p>向后引用: 使用变量引用前面的分组括号中的模式所匹配到的字符.</p>
<h2 id="扩展的正则表达式"><a class="header-anchor" href="#扩展的正则表达式"></a>扩展的正则表达式</h2>
<h3 id="grep家庭有三个命令"><a class="header-anchor" href="#grep家庭有三个命令"></a>grep家庭有三个命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="comment">#基本正则表达式</span></span><br><span class="line">	-E <span class="comment">#扩展正则表达式</span></span><br><span class="line">	-F <span class="comment">#不支持正则表达式</span></span><br><span class="line">egrep <span class="comment">#扩展正则表达式</span></span><br><span class="line">fgrep <span class="comment">#不支持正则表达式</span></span><br></pre></td></tr></table></figure>
<h3 id="字符匹配-v2"><a class="header-anchor" href="#字符匹配-v2"></a>字符匹配</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. 	<span class="comment"># 任意单个字符</span></span><br><span class="line">[]</span><br><span class="line">[^]</span><br></pre></td></tr></table></figure>
<h3 id="次数匹配-v2"><a class="header-anchor" href="#次数匹配-v2"></a>次数匹配</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">?: 		<span class="comment"># 0次或1次；</span></span><br><span class="line">+: 		<span class="comment"># 1次以上；</span></span><br><span class="line">&#123;m&#125;: 	<span class="comment"># 精确匹配m次；</span></span><br><span class="line">&#123;m,n&#125;:  <span class="comment"># 至少m次，至多n次；</span></span><br></pre></td></tr></table></figure>
<h3 id="位置锚定"><a class="header-anchor" href="#位置锚定"></a>位置锚定</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">^: 		<span class="comment"># 行首锚定；用于模式的最左侧；</span></span><br><span class="line">$: 		<span class="comment"># 行尾锚定；用于模式的最右侧；(用单引号)</span></span><br><span class="line">\&lt;, \b: <span class="comment"># 词首锚定；用于表示单词的模式的左侧；</span></span><br><span class="line">\&gt;, \b：<span class="comment"># 词尾锚定；用于表示单词的模式的右侧；</span></span><br><span class="line">^$: 	<span class="comment"># 空白行</span></span><br></pre></td></tr></table></figure>
<h3 id="或者"><a class="header-anchor" href="#或者"></a>或者</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(a|b)wk <span class="comment"># awk或者bwk</span></span><br></pre></td></tr></table></figure>
<ul>
<li>显示/etc/passwd文件中以bash结尾的行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep <span class="string">'bash$'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/1.png" alt="command" title="1.png"></p>
<ul>
<li>显示/etc/passwd文件中的两位数或三位数</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep <span class="string">'\&lt;[[:digit:]]&#123;2,3&#125;\&gt;'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/2.png" alt="command" title="2.png"></p>
<ul>
<li>显示<code>netstat -tan</code>命令结果中以'LISTEN'后跟0个、1个或者多个空白字符结尾的行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat | egrep <span class="string">'\&lt;LISTEN[[:blank:]]*'</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/3.png" alt="command" title="3.png"></p>
<ul>
<li>添加用户bash、testbash、basher以及nologin用户（nologin用户的shell为/sbin/nologin）；而后找出/etc/                  passwd文件中用户名与其shell名相同的行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep <span class="string">'^([[:alnum:]]*\&gt;).*\1$'</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/4.png" alt="command" title="4.png"></p>
<ul>
<li>显示当前系统上root、centos或者user1用户的默认shell和UID （请事先创建这些用户，若不存在）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep <span class="string">'^(centos|user1|root)'</span> /etc/passwd | cut <span class="operator">-d</span>: <span class="operator">-f</span>3,<span class="number">7</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/5.png" alt="command" title="5.png"></p>
<ul>
<li>找出/etc/rc.d/init.d/functions文件中某单词（单词中间可以存在下划线）后面跟着一组小括号的行</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">egrep <span class="string">'([[:alpha:]]|_)+\(\)'</span> /etc/rc.d/init.d/<span class="built_in">functions</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/6.png" alt="command" title="6.png"></p>
<ul>
<li>使用echo输出一个路径，而后egrep找出其路径基名；进一步的使用egrep取出其目录名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'/usr/local/bin/'</span> | egrep <span class="string">'\&lt;[[:alnum:]]*([[:alnum:]]|/)$'</span> -o</span><br></pre></td></tr></table></figure>
<ul>
<li>找出ifconfig命令执行结果中1-255之间的数字</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | egrep <span class="string">'\&lt;(1?[1-9]&#123;1,2&#125;|2[0-5]&#123;2&#125;)\&gt;'</span></span><br></pre></td></tr></table></figure>
<p><img src="http://static.molloc.com/linux/imgs/ZY-2015-08-27/8.png" alt="command" title="8.png"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>本文涉及的命令有: chmod, chown, chgrp, umask, grep, egrep</em></p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-08-25]]></title>
    <link href="http://molloc.me/2015/08/25/ZY-2015-08-25/"/>
    <id>http://molloc.me/2015/08/25/ZY-2015-08-25/</id>
    <published>2015-08-25T15:39:11.000Z</published>
    <updated>2015-09-11T15:22:07.723Z</updated>
    <content type="html"><![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>用户和组管理的相关命令,useradd、usermod、passwd、userdel groupadd、groupmod、gpasswd、groupdel chage、chsh、chfn id、su</em></p>
<a id="more"></a>
<h2 id="权限-rwx"><a class="header-anchor" href="#权限-rwx"></a>权限(rwx)</h2>
<h3 id="针对文件"><a class="header-anchor" href="#针对文件"></a>针对文件</h3>
<ul>
<li>r: 可以用查看工具查看其内容</li>
<li>w: 可以编译其内容</li>
<li>x: 可将此文件向内核提请启动为进程</li>
</ul>
<h3 id="针对目录"><a class="header-anchor" href="#针对目录"></a>针对目录</h3>
<ul>
<li>r: 可以使用<code>ls</code>命令列出其内部的所有文件或子目录的相关信息(Note: 不包括<code>ls -l</code>)</li>
<li>w: 可在此目录内创建和删除文件</li>
<li>x: 可以<code>cd</code>进此目录,可以使用<code>ls -l</code>查看其内部的所有文件或子目录的相关详细信息</li>
</ul>
<h2 id="权限匹配机制"><a class="header-anchor" href="#权限匹配机制"></a>权限匹配机制</h2>
<p>用户启动某进程访问某资源文件时,权限匹配规则:</p>
<ol>
<li>首先查看次进程的属主,与被访问的文件的属主是否是同一个用户.
<ul>
<li>如果是,则以被访问文件的属主的权限访问,从而应用的权限为属主的权限.</li>
<li>否则,进入2.</li>
</ul>
</li>
<li>查看此进程的属主,是否属于被访问文件的属组
<ul>
<li>如果是,则以被访问文件的属组的权限访问,从而应用的权限为属组的权限.</li>
<li>否则,应用其他类别的权限.</li>
</ul>
</li>
</ol>
<h2 id="linux用户和组的相关配置文件"><a class="header-anchor" href="#linux用户和组的相关配置文件"></a>Linux用户和组的相关配置文件</h2>
<h3 id="etc-passwd"><a class="header-anchor" href="#etc-passwd"></a>/etc/passwd</h3>
<p>用户名,UID,基本信息等.</p>
<p>name:password:UID:GID:GECOS:directory:shell</p>
<p>登录名:x:UID:GID:comment:主目录:用户默认shell</p>
<h3 id="etc-shadow"><a class="header-anchor" href="#etc-shadow"></a>/etc/shadow</h3>
<p>用户密码及相关属性</p>
<p>login name:encrypted password:date of last password change:minimum password age:maximum password age:password warning period:password inactivity period:account expiration date:reserved field</p>
<ol>
<li>login name: 登录名</li>
<li>encrypted password: 加密后的密码</li>
<li>date of last password change: 最近一次密码修改时间(相对于1970-1-1的天数)</li>
<li>minimum password age: 密码的最小期限,0是不限制,相对于上次修改密码的日期而言的一个相对时长,单位为天.</li>
<li>maximum password age: 密码最大使用期限. 限制用户必须周期性改密码</li>
<li>password warning period: 密码警告周期.相对于密码最大使用期限而言,单位为天.0表示不警告.</li>
<li>password inactivity period: 密码的非活动期限.超出非活动期限后,账号将被锁定.</li>
<li>account expiration date: 账号的过期期限.(相对于1970-1-1的天数)</li>
<li>reserved field: 预留字段</li>
</ol>
<h3 id="密码规则"><a class="header-anchor" href="#密码规则"></a>密码规则</h3>
<p>$6$YNzGOv5VyXxmDU2n$PxariU7Ag0mBlzBoNLWUjubn9OBtoLJauXIfoRqQ1FtZt058FrQKJO6QVJTUXkP4LUKPsiH7ejWo8bg6c4RrC1</p>
<p>$加密算法$8位随机字符$加密后的密码</p>
<h4 id="单向加密"><a class="header-anchor" href="#单向加密"></a>单向加密</h4>
<ul>
<li>雪崩效应：初始条件的微小改变,导致结果的巨大改变.</li>
<li>定长输出：</li>
</ul>
<p>eg: <code>md5(centos5), sha1, sha224, sha256, sha384, sha512(centos6.6,centos7用的加密算法)</code></p>
<h3 id="etc-group"><a class="header-anchor" href="#etc-group"></a>/etc/group</h3>
<p>组名,GID,组内包含的用户.</p>
<p>group_name:password:GID:user_list</p>
<p>组名:组密码:以此组为附加组的用户</p>
<h3 id="etc-gshadow"><a class="header-anchor" href="#etc-gshadow"></a>/etc/gshadow</h3>
<p>组的密码及相关属性</p>
<h2 id="密码的复杂性策略"><a class="header-anchor" href="#密码的复杂性策略"></a>密码的复杂性策略</h2>
<ul>
<li>使用数字、小写字母、大写字母、特殊字符四类中至少三类；</li>
<li>足够长；</li>
<li>使用随机密码；</li>
<li>定期更换；</li>
</ul>
<h2 id="useradd"><a class="header-anchor" href="#useradd"></a>useradd</h2>
<p><strong>useradd - 创建一个新用户或更新默认新用户信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">useradd [options] LOGIN</span><br><span class="line">useradd -D</span><br><span class="line">useradd -D [options]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -r, --system 创建一个系统用户</span></span><br><span class="line">$ useradd -r admin</span><br><span class="line">$ id admin</span><br><span class="line">--&gt; uid=<span class="number">496</span>(admin) gid=<span class="number">493</span>(admin) groups=<span class="number">493</span>(admin)</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u, --uid UID 制定UID</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -g, --gid GROUP 指定用户所属基本组，此组必须事先存在</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c, --comment COMMENT 对创建的用户提供简短的描述</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d, --home HOME_DIR /PATH/TO/SOMEWHERE：指定用户的主目录路径；此位置不能事先存在，</span></span><br><span class="line"><span class="comment">## 否则，其用户相关配置文件将不会被复制；(/etc/skel)</span></span><br><span class="line">$ useradd non <span class="operator">-d</span> /tmp</span><br><span class="line">--&gt; useradd: warning: the home directory already exists.</span><br><span class="line">	Not copying any file from skel directory into it.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s SHELL：设定用户的默认shell；shell的类型请用 cat /etc/shells查看</span></span><br><span class="line">$ useradd non <span class="operator">-d</span> /tmp/non <span class="operator">-s</span> /etc/tcsh</span><br><span class="line">$ finger non</span><br><span class="line">--&gt; Login: non            			Name:</span><br><span class="line">	Directory: /tmp/non             Shell: /etc/tcsh</span><br><span class="line">	Never logged in.</span><br><span class="line">	No mail.</span><br><span class="line">	No Plan.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -G GID,...：指定所属的附加组；可指定多个,用逗号隔开,中间不能留空白</span></span><br><span class="line">$ useradd -G root,admin,centos non</span><br><span class="line">$ id non</span><br><span class="line">--&gt; uid=<span class="number">501</span>(non) gid=<span class="number">501</span>(non) groups=<span class="number">501</span>(non),<span class="number">0</span>(root),<span class="number">500</span>(centos),<span class="number">493</span>(admin)</span><br><span class="line"></span><br><span class="line"><span class="comment">## -M 不给用户创建家目录</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 强制创建主目录</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">##  -k, --skel SKEL_DIR 骨架目录，其中包含的文件和目录进行复制到用户的主目录，在主目录通过useradd的创建时。</span></span><br><span class="line">$ ls <span class="operator">-a</span> /ect/skel</span><br><span class="line">--&gt; .bash_<span class="built_in">logout</span>  .bash_profile  .bashrc  .gnome2  .mozilla</span><br><span class="line"></span><br><span class="line"><span class="comment">## 练习：创建用户Oracle，所属附加组database和sql，ID号为3000, 家目录为/home/database；</span></span><br><span class="line">$ useradd <span class="operator">-d</span> /home/database -G database,sql -u <span class="number">3000</span> Oracle</span><br><span class="line">$ id Oracle</span><br><span class="line">--&gt; uid=<span class="number">3000</span>(Oracle) gid=<span class="number">3000</span>(Oracle) groups=<span class="number">3000</span>(Oracle),<span class="number">502</span>(database),<span class="number">503</span>(sql)</span><br></pre></td></tr></table></figure>
<h2 id="usermod"><a class="header-anchor" href="#usermod"></a>usermod</h2>
<p><strong>usermod - 修改用户信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">usermod [options] LOGIN</span><br><span class="line"></span><br><span class="line"><span class="comment">## -a, --append 与-G配合使用</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u, --uid UID 修改用户的uid</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -G GID[,GID,...]：修改用户所属的附加组；同时使用-a选项,追加到已有的附加组.不会覆盖</span></span><br><span class="line">$ usermod <span class="operator">-a</span>G centos non</span><br><span class="line">--&gt; uid=<span class="number">3001</span>(non) gid=<span class="number">3001</span>(non) groups=<span class="number">3001</span>(non),<span class="number">500</span>(centos)</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s SHELL 修改shell</span></span><br><span class="line">$ usermod <span class="operator">-s</span> /bin/tcsh non</span><br><span class="line">$ tail -n <span class="number">1</span> /etc/passwd</span><br><span class="line">--&gt; non:x:<span class="number">3003</span>:<span class="number">3003</span>::/home/non:/bin/tcsh</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 'COMMENT'</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d HOME: 修改用户的家目录为新位置时，用户原来的文件是不会被移动至新家；-m选项可实现同时将其迁至新的家目录；</span></span><br><span class="line">$ usermod -md /home/non_new non</span><br><span class="line">$ tail -n <span class="number">1</span> /etc/passwd</span><br><span class="line">--&gt; non:x:<span class="number">3003</span>:<span class="number">3003</span>::/home/non_new:/bin/tcsh</span><br><span class="line">$ ll <span class="operator">-a</span> /home/non_new/</span><br><span class="line">--&gt; total <span class="number">28</span></span><br><span class="line">	drwx------  <span class="number">4</span> non  non  <span class="number">4096</span> Dec  <span class="number">1</span> <span class="number">14</span>:<span class="number">59</span> .</span><br><span class="line">	drwxr-xr-x. <span class="number">7</span> root root <span class="number">4096</span> Dec  <span class="number">1</span> <span class="number">15</span>:<span class="number">08</span> ..</span><br><span class="line">	-rw-r--r--  <span class="number">1</span> non  non    <span class="number">18</span> Jul <span class="number">24</span>  <span class="number">2015</span> .bash_<span class="built_in">logout</span></span><br><span class="line">	-rw-r--r--  <span class="number">1</span> non  non   <span class="number">176</span> Jul <span class="number">24</span>  <span class="number">2015</span> .bash_profile</span><br><span class="line">	-rw-r--r--  <span class="number">1</span> non  non   <span class="number">124</span> Jul <span class="number">24</span>  <span class="number">2015</span> .bashrc</span><br><span class="line">	drwxr-xr-x  <span class="number">2</span> non  non  <span class="number">4096</span> Nov <span class="number">12</span>  <span class="number">2010</span> .gnome2</span><br><span class="line">	drwxr-xr-x  <span class="number">4</span> non  non  <span class="number">4096</span> Aug <span class="number">20</span>  <span class="number">2015</span> .mozilla</span><br><span class="line"></span><br><span class="line"><span class="comment">## -l LOGIN：修改登录名</span></span><br><span class="line">$ usermod <span class="operator">-l</span> non_new non</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L, --lock 锁定用户</span></span><br><span class="line">$ usermod -L non_new</span><br><span class="line"></span><br><span class="line"><span class="comment">## -U, --unlock 解除用户锁定</span></span><br><span class="line">$ usermod -U non_new</span><br></pre></td></tr></table></figure>
<h2 id="passwd"><a class="header-anchor" href="#passwd"></a>passwd</h2>
<p><strong>passwd - 更新用户的身份验证令牌</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">passwd [-k] [<span class="operator">-l</span>] [-u [<span class="operator">-f</span>]] [<span class="operator">-d</span>] [<span class="operator">-e</span>] [-n mindays] [-x maxdays] [-w warndays] [-i inactivedays] [-S] [--stdin] [username]</span><br><span class="line"></span><br><span class="line"><span class="operator">-l</span>  <span class="comment"># lock user</span></span><br><span class="line">-u  <span class="comment"># unlock user</span></span><br><span class="line">-n  <span class="comment"># mindays: 最短使用期限；</span></span><br><span class="line">-x  <span class="comment"># maxdays：默认为99999天；</span></span><br><span class="line">-w  <span class="comment"># warndays：</span></span><br><span class="line">-i  <span class="comment"># inactivedays：</span></span><br><span class="line"><span class="operator">-e</span>  <span class="comment"># 快速使账号过期的方法</span></span><br><span class="line"><span class="operator">-d</span>  <span class="comment"># 快速删除账号密码</span></span><br><span class="line">-S  <span class="comment"># 显示给定账号关于密码的简短信息</span></span><br><span class="line">--stdin <span class="comment"># 从标准输入接收密码传递给passwd命令(自动化应用)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ passwd -S root</span><br><span class="line">--&gt; root PS <span class="number">2015</span>-<span class="number">08</span>-<span class="number">19</span> <span class="number">0</span> <span class="number">99999</span> <span class="number">7</span> -<span class="number">1</span> (Password <span class="built_in">set</span>, SHA512 crypt.)</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'xxxxxx'</span> | passwd --stdin non_new</span><br><span class="line">--&gt; Changing password <span class="keyword">for</span> user non_new.</span><br><span class="line">	passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>
<h2 id="userdel"><a class="header-anchor" href="#userdel"></a>userdel</h2>
<p><strong>userdel - 删除用户</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">userdel [options] LOGIN</span><br><span class="line"></span><br><span class="line"><span class="operator">-f</span> <span class="comment">## 强制删除用户,即时用户正处于登陆状态,也会强制删除用户的家目录和邮件spool.还有同名的组.</span></span><br><span class="line">   <span class="comment">## 这个选项是危险的，可能会让你的系统处于不一致的状态。</span></span><br><span class="line">-r --remove <span class="comment">## 将用户的家目录也移除</span></span><br></pre></td></tr></table></figure>
<h2 id="groupmod"><a class="header-anchor" href="#groupmod"></a>groupmod</h2>
<p><strong>groupmod - 组属性修改</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">groupmod [options] GROUP</span><br><span class="line"></span><br><span class="line">-n, --new-name 修改组名</span><br><span class="line">-g, --gid GID</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ groupmod -g <span class="number">3005</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ groupmod -n <span class="built_in">test</span>_new <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h2 id="gpasswd"><a class="header-anchor" href="#gpasswd"></a>gpasswd</h2>
<p><strong>gpasswd - 设定组密码</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="newgrp"><a class="header-anchor" href="#newgrp"></a>newgrp</h2>
<p><strong>newgrp - 切换基本组为指定的组</strong></p>
<p><em>当用户切换其基本组为此组时,如果其本就是此组的附加组,则直接切换,否则,则需要提供密码</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">newgrp [-] [group]</span><br></pre></td></tr></table></figure>
<h2 id="groupdel"><a class="header-anchor" href="#groupdel"></a>groupdel</h2>
<p><strong>groupdel - 删除组</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">groupdel group</span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="chage"><a class="header-anchor" href="#chage"></a>chage</h2>
<p><strong>chage - 修改用户账密码期限相关的属性</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">chage [options] [LOGIN]</span><br><span class="line"></span><br><span class="line"><span class="operator">-d</span> LAST_DAY <span class="comment">## 设置用户最后一次修改密码的时间,如果设置为0,用户被强制去更改密码在此用户下次登陆的时候.</span></span><br><span class="line">-E, --expiredate EXPIRE_DATE <span class="comment"># 过期时间</span></span><br><span class="line">-I, --inactive INACTIVE <span class="comment"># 非活动时间,密码过期之后,还有非活动时间,超过非活动时间,账号就会被锁定.</span></span><br><span class="line"><span class="operator">-l</span>, --list <span class="comment"># 显示账号密码信息</span></span><br><span class="line">-m, --mindays MIN_DAYS <span class="comment"># 密码使用的最短期限</span></span><br><span class="line">-M, --maxdays MAX_DAYS <span class="comment">#密码使用的最长期限</span></span><br><span class="line">-W, --warndays WARN_DAYS <span class="comment"># 在最长期限前多少天警告用户.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ chage <span class="operator">-d</span> <span class="number">0</span> centos</span><br><span class="line">$ ssh centos@<span class="number">192.168</span>.<span class="number">1.168</span>:<span class="number">22</span></span><br><span class="line">--&gt; Connecting to <span class="number">192.168</span>.<span class="number">1.168</span>:<span class="number">22</span>...</span><br><span class="line">	Connection established.</span><br><span class="line">	To escape to <span class="built_in">local</span> shell, press <span class="string">'Ctrl+Alt+]'</span>.</span><br><span class="line"></span><br><span class="line">	You are required to change your password immediately (root enforced)</span><br><span class="line">	Last login: Mon Dec  <span class="number">1</span> <span class="number">17</span>:<span class="number">01</span>:<span class="number">20</span> <span class="number">2014</span> from <span class="number">192.168</span>.<span class="number">1.105</span></span><br><span class="line">	WARNING: Your password has expired.</span><br><span class="line">	You must change your password now and login again!</span><br><span class="line">	Changing password <span class="keyword">for</span> user centos.</span><br><span class="line">	Changing password <span class="keyword">for</span> centos.</span><br><span class="line">	(current) UNIX password:</span><br><span class="line">	New password:</span><br><span class="line">	Retype new password:</span><br><span class="line">	passwd: all authentication tokens updated successfully.</span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ chage <span class="operator">-l</span> centos</span><br><span class="line">--&gt; Last password change					: Dec <span class="number">01</span>, <span class="number">2014</span></span><br><span class="line">	Password expires					: never</span><br><span class="line">	Password inactive					: never</span><br><span class="line">	Account expires						: never</span><br><span class="line">	Minimum number of days between password change		: <span class="number">0</span></span><br><span class="line">	Maximum number of days between password change		: <span class="number">99999</span></span><br><span class="line">	Number of days of warning before password expires	: <span class="number">7</span></span><br><span class="line"></span><br><span class="line">$ chage -m <span class="number">3</span> centos</span><br><span class="line">$ chage <span class="operator">-l</span> centos</span><br><span class="line">--&gt; Last password change					: Dec <span class="number">01</span>, <span class="number">2014</span></span><br><span class="line">	Password expires					: never</span><br><span class="line">	Password inactive					: never</span><br><span class="line">	Account expires						: never</span><br><span class="line">	Minimum number of days between password change		: <span class="number">3</span></span><br><span class="line">	Maximum number of days between password change		: <span class="number">99999</span></span><br><span class="line">	Number of days of warning before password expires	: <span class="number">7</span></span><br></pre></td></tr></table></figure>
<h2 id="chsh"><a class="header-anchor" href="#chsh"></a>chsh</h2>
<p><strong>chsh - 改变你的登陆shell</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">chsh [<span class="operator">-s</span> shell] [<span class="operator">-l</span>] [-u] [-v] [username]</span><br><span class="line"></span><br><span class="line"><span class="operator">-s</span>, --shell shell <span class="comment">#修改为制定的shell</span></span><br><span class="line"><span class="operator">-l</span>, --list-shells <span class="comment">#留出当前系统的可用shell</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">--&gt; /bin/bash</span><br><span class="line">$ chsh <span class="operator">-s</span> /bin/sh</span><br><span class="line">--&gt; Changing shell <span class="keyword">for</span> root.</span><br><span class="line">	Shell changed.</span><br><span class="line"><span class="comment"># 重新登陆,查看$SHELL</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line">/bin/csh</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ chsh <span class="operator">-l</span></span><br><span class="line">--&gt; /bin/sh</span><br><span class="line">	/bin/bash</span><br><span class="line">	/sbin/nologin</span><br><span class="line">	/usr/bin/sh</span><br><span class="line">	/usr/bin/bash</span><br><span class="line">	/usr/sbin/nologin</span><br><span class="line">	/bin/tcsh</span><br><span class="line">	/bin/csh</span><br></pre></td></tr></table></figure>
<h2 id="id"><a class="header-anchor" href="#id"></a>id</h2>
<p><strong>id - 打印真正和有效的用户和组 Id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">id [OPTION]... [USER]</span><br><span class="line"></span><br><span class="line">-u: UID</span><br><span class="line">-g: GID</span><br><span class="line">-G: Groups</span><br><span class="line">-n: NAME <span class="comment"># 参数格式为 -n&lt;u|g|G&gt;</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ id</span><br><span class="line">--&gt; uid=<span class="number">0</span>(root) gid=<span class="number">0</span>(root) groups=<span class="number">0</span>(root)</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ id -un</span><br><span class="line">--&gt; root</span><br></pre></td></tr></table></figure>
<h2 id="su"><a class="header-anchor" href="#su"></a>su</h2>
<p><strong>su - 切换用户或以其它用户的身份执行命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">su [options...] [-] [user [args...]] <span class="comment"># user省略时,默认切换到root</span></span><br><span class="line"></span><br><span class="line">-, <span class="operator">-l</span>, --login <span class="comment">#完全切换；登录式切换,意味着将使用目标用户的环境设定,原用户失效.</span></span><br><span class="line">su centos <span class="comment">#非完全切换；非登录式切换,意味着仍然使用原用户的环境设定.</span></span><br><span class="line">su - USERNAME -c <span class="string">'COMMAND'</span> <span class="comment">#仅以指定用户的身份执行指定的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意: 返回原来的用户用exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ su - centos</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ su centos</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ su - centos -c <span class="string">'ls -al ~'</span></span><br><span class="line">--&gt; drwx------  <span class="number">3</span> centos centos  <span class="number">74</span> Sep  <span class="number">2</span> <span class="number">00</span>:<span class="number">08</span> .</span><br><span class="line">	drwxr-xr-x. <span class="number">4</span> root   root    <span class="number">31</span> Sep  <span class="number">2</span> <span class="number">00</span>:<span class="number">08</span> ..</span><br><span class="line">	-rw-r--r--  <span class="number">1</span> centos centos  <span class="number">18</span> Mar  <span class="number">6</span> <span class="number">06</span>:<span class="number">06</span> .bash_<span class="built_in">logout</span></span><br><span class="line">	-rw-r--r--  <span class="number">1</span> centos centos <span class="number">193</span> Mar  <span class="number">6</span> <span class="number">06</span>:<span class="number">06</span> .bash_profile</span><br><span class="line">	-rw-r--r--  <span class="number">1</span> centos centos <span class="number">231</span> Mar  <span class="number">6</span> <span class="number">06</span>:<span class="number">06</span> .bashrc</span><br><span class="line">	drwxr-xr-x  <span class="number">4</span> centos centos  <span class="number">37</span> Aug <span class="number">20</span> <span class="number">06</span>:<span class="number">58</span> .mozilla</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>用户和组管理的相关命令,useradd、usermod、passwd、userdel groupadd、groupmod、gpasswd、groupdel chage、chsh、chfn id、su</em></p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015-08-23]]></title>
    <link href="http://molloc.me/2015/08/23/ZY-2015-08-23/"/>
    <id>http://molloc.me/2015/08/23/ZY-2015-08-23/</id>
    <published>2015-08-23T14:33:37.000Z</published>
    <updated>2015-09-11T15:22:07.824Z</updated>
    <content type="html"><![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>涉及到的命令有,cat, tac, file, history, tree, more, less, tail, head, touch, cp, mv, rm, glob(7),tr,tee, wc, cut, sort, uniq</em></p>
<a id="more"></a>
<h2 id="cat"><a class="header-anchor" href="#cat"></a>cat</h2>
<p><strong>cat - 连接文件（S），或标准输入，到标准输出。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">cat [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -A, --show-all 等价于 -vET</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b, --number-nonblank 跟-n类似,只不过对于空白行不编号</span></span><br><span class="line">$ cat -b /etc/passwd</span><br><span class="line">--&gt;  <span class="number">1</span>	this is a test.</span><br><span class="line"></span><br><span class="line">     <span class="number">2</span>	onew</span><br><span class="line">     <span class="number">3</span>	tow.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -e 等价于 -vE</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -E 显示结束符,显示$在每行的结尾</span></span><br><span class="line">$ cat -E /etc/passwd</span><br><span class="line">--&gt; root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash$</span><br><span class="line">	bin:x:<span class="number">1</span>:<span class="number">1</span>:bin:/bin:/sbin/nologin$</span><br><span class="line">	daemon:x:<span class="number">2</span>:<span class="number">2</span>:daemon:/sbin:/sbin/nologin$</span><br><span class="line">	adm:x:<span class="number">3</span>:<span class="number">4</span>:adm:/var/adm:/sbin/nologin$</span><br><span class="line">	lp:x:<span class="number">4</span>:<span class="number">7</span>:lp:/var/spool/lpd:/sbin/nologin$</span><br><span class="line">	sync:x:<span class="number">5</span>:<span class="number">0</span>:sync:/sbin:/bin/sync$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n 显示行号</span></span><br><span class="line">$ cat -n</span><br><span class="line">--&gt;  <span class="number">1</span>	This is my new life.</span><br><span class="line">     <span class="number">2</span></span><br><span class="line">     <span class="number">3</span>	one line.</span><br><span class="line">     <span class="number">4</span>	The other line.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --squeeze-blank 压制显现重复的空白行,连续的空白行输出一行</span></span><br><span class="line">$ cat <span class="operator">-s</span> <span class="built_in">test</span></span><br><span class="line">--&gt; This is my new life.</span><br><span class="line"></span><br><span class="line">	one line.</span><br><span class="line">	The other line.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -t 参考 -vT</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -T, --show-tabs TAB显示为^I</span></span><br><span class="line">$ cat -T <span class="built_in">test</span></span><br><span class="line">--&gt;	This is my new life.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	one^I line.</span><br><span class="line">	^Itab line.</span><br><span class="line">	The other line.</span><br><span class="line"></span><br><span class="line"><span class="comment">## -v, --show-nonprinting  显示非打印字符 use ^ and M- notation, except for LFD and TAB</span></span><br><span class="line">$ cat -v <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h2 id="tac"><a class="header-anchor" href="#tac"></a>tac</h2>
<p><strong>tac - 将每个指定文件按行倒置并写到标准输出。如果不指定文件，或文件为&quot;-&quot;，则从标准输入读取数据,不常用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">tac [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b, --before 在行前而非行尾添加分隔标志</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -r, --regex 将分隔标志视作正则表达式来解析</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --separator=字符串  使用指定字符串代替换行作为分隔标志</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="file"><a class="header-anchor" href="#file"></a>file</h2>
<p><strong>file - 检查文件的类型</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">file [-bchikLNnprsvz0] [--apple] [--mime-encoding] [--mime-type] [<span class="operator">-e</span> testname] [-F separator] [<span class="operator">-f</span> namefile] [-m magicfiles] file ...</span><br><span class="line">file -C [-m magicfiles]</span><br><span class="line">file [--help]</span><br><span class="line"></span><br><span class="line">@@OPTIONS</span><br><span class="line"><span class="comment">## -b --brief 简短模式, 不输出文件名</span></span><br><span class="line">$ file -b <span class="built_in">test</span></span><br><span class="line">--&gt; ASCII English text</span><br><span class="line"></span><br><span class="line"><span class="comment">## 待续...</span></span><br></pre></td></tr></table></figure>
<h2 id="history"><a class="header-anchor" href="#history"></a>history</h2>
<p><strong>history - 显示或操纵历史列表。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line"><span class="built_in">history</span> [-c] [<span class="operator">-d</span> offset] [n]</span><br><span class="line"><span class="built_in">history</span> -anrw [filename]</span><br><span class="line"><span class="built_in">history</span> -ps arg [arg...]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 清空历史记录</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -a: 当缓冲区中的历史手动追加文件；</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## n 数字,要列出最近的 n 笔命令列表</span></span><br><span class="line">$ <span class="built_in">history</span> <span class="number">4</span></span><br><span class="line">--&gt; <span class="number">849</span>  <span class="built_in">history</span> -n</span><br><span class="line">    <span class="number">850</span>  <span class="built_in">history</span></span><br><span class="line">    <span class="number">851</span>  <span class="built_in">history</span> -n</span><br><span class="line">    <span class="number">852</span>  <span class="built_in">history</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -r 将 histfiles 的内容读到目前这个 shell 的 history 记忆中</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -w 将目前的 history 记忆内容写入 histfiles</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d #: 删除历史中指定的命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 执行history列表中命令的方法</span></span><br><span class="line"><span class="comment">## 调用过去执行过的命令：</span></span><br><span class="line"><span class="comment">## 		!#：调用历史中的第#条命令；</span></span><br><span class="line"><span class="comment">## 		!!: 重复执行上一条命令</span></span><br><span class="line"><span class="comment">## 		!string：调用历史中最近一个以string开头的命令；</span></span><br><span class="line"><span class="comment">## 调用过去执行过的命令的最后一个参数：</span></span><br><span class="line"><span class="comment">## 		!$:</span></span><br><span class="line"><span class="comment">## 		ESC, .</span></span><br><span class="line"><span class="comment">## 		Alt+.</span></span><br></pre></td></tr></table></figure>
<h2 id="tree"><a class="header-anchor" href="#tree"></a>tree</h2>
<p><strong>tree - 命令以树形结构显示文件目录结构</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">tree  [-adfghilnopqrstuvxACDFNS]  [-L  level  [-R]]  [-H  baseHREF]  [-T  title]  [-o  filename]</span><br><span class="line">	  [--nolinks] [-P pattern] [-I pattern]</span><br><span class="line">      [--inodes] [--device] [--noreport] [--dirsfirst] [--version] [--help] [--filelimit <span class="comment">#] [directory ...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -a 列出所有文件,默认情况下,不显示隐藏文件,还有当前目录(.)和上级目录(..)</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d 仅列出文件夹</span></span><br><span class="line">$ tree <span class="operator">-d</span> /tmp</span><br><span class="line">--&gt; ├── Desktop</span><br><span class="line">	├── Documents</span><br><span class="line">	├── Downloads</span><br><span class="line">	├── Music</span><br><span class="line">	├── Pictures</span><br><span class="line">	├── Public</span><br><span class="line">	├── Templates</span><br><span class="line">	└── Videos</span><br><span class="line"></span><br><span class="line"><span class="comment">## -f 在每个文件或目录之前，显示完整的相对路径名称。</span></span><br><span class="line">$ tree <span class="operator">-f</span></span><br><span class="line">--&gt; .</span><br><span class="line">	├── ./a123b</span><br><span class="line">	├── ./a3b</span><br><span class="line">	├── ./aab</span><br><span class="line">	├── ./ab</span><br><span class="line">	├── ./aMb</span><br><span class="line">	├── ./x</span><br><span class="line">	│   ├── ./x/m</span><br><span class="line">	│   └── ./x/n</span><br><span class="line">	└── ./y</span><br><span class="line">	    ├── ./y/m</span><br><span class="line">	    └── ./y/n</span><br><span class="line"></span><br><span class="line"><span class="comment">## -i   不以阶梯状列出文件或目录名称。</span></span><br><span class="line">$ tree -fi</span><br><span class="line">--&gt; .</span><br><span class="line">	./a123b</span><br><span class="line">	./a3b</span><br><span class="line">	./aab</span><br><span class="line">	./ab</span><br><span class="line">	./aMb</span><br><span class="line">	./x</span><br><span class="line">	./x/m</span><br><span class="line">	./x/n</span><br><span class="line">	./y</span><br><span class="line">	./y/m</span><br><span class="line">	./y/n</span><br><span class="line"></span><br><span class="line"><span class="comment">## -l 如遇到性质为符号连接的目录，直接列出该连接所指向的原始目录。</span></span><br><span class="line">$ ls <span class="operator">-l</span></span><br><span class="line">--&gt; -rw-r--r-- <span class="number">1</span> root root    <span class="number">0</span> Nov <span class="number">23</span> <span class="number">15</span>:<span class="number">18</span> a123b</span><br><span class="line">	-rw-r--r-- <span class="number">1</span> root root    <span class="number">0</span> Nov <span class="number">23</span> <span class="number">15</span>:<span class="number">18</span> a3b</span><br><span class="line">	-rw-r--r-- <span class="number">1</span> root root    <span class="number">0</span> Nov <span class="number">23</span> <span class="number">15</span>:<span class="number">18</span> aab</span><br><span class="line">	-rw-r--r-- <span class="number">1</span> root root    <span class="number">0</span> Nov <span class="number">23</span> <span class="number">15</span>:<span class="number">18</span> ab</span><br><span class="line">	-rw-r--r-- <span class="number">1</span> root root    <span class="number">0</span> Nov <span class="number">23</span> <span class="number">15</span>:<span class="number">18</span> aMb</span><br><span class="line">	lrwxrwxrwx <span class="number">1</span> root root    <span class="number">7</span> Nov <span class="number">24</span> <span class="number">13</span>:<span class="number">42</span> ls -&gt; /bin/ls</span><br><span class="line">	lrwxrwxrwx <span class="number">1</span> root root    <span class="number">3</span> Nov <span class="number">24</span> <span class="number">13</span>:<span class="number">43</span> lx -&gt; ./x</span><br><span class="line">	drwxr-xr-x <span class="number">4</span> root root <span class="number">4096</span> Nov <span class="number">24</span> <span class="number">13</span>:<span class="number">44</span> x</span><br><span class="line">	drwxr-xr-x <span class="number">4</span> root root <span class="number">4096</span> Nov <span class="number">23</span> <span class="number">14</span>:<span class="number">40</span> y</span><br><span class="line"></span><br><span class="line">$ tree <span class="operator">-l</span></span><br><span class="line">--&gt; .</span><br><span class="line">	├── a123b</span><br><span class="line">	├── a3b</span><br><span class="line">	├── aab</span><br><span class="line">	├── ab</span><br><span class="line">	├── aMb</span><br><span class="line">	├── ls -&gt; /bin/ls</span><br><span class="line">	├── lx -&gt; ./x</span><br><span class="line">	│   ├── m</span><br><span class="line">	│   └── n</span><br><span class="line">	├── x</span><br><span class="line">	│   ├── m</span><br><span class="line">	│   └── n</span><br><span class="line">	└── y</span><br><span class="line">	    ├── m</span><br><span class="line">	    └── n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## -P pattern 支持正则表达式过滤</span></span><br><span class="line">$ tree -p ?</span><br><span class="line">--&gt; x</span><br><span class="line">	├── [drwxr-xr-x]  m</span><br><span class="line">	└── [drwxr-xr-x]  n</span><br><span class="line">	y</span><br><span class="line">	├── [drwxr-xr-x]  m</span><br><span class="line">	└── [drwxr-xr-x]  n</span><br><span class="line"></span><br><span class="line"><span class="comment">## -I 不列出匹配到的.</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s 打印出每个文件的大小(byte)</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -h 打印出每个文件的大小,可读的(K,M,G,T,P,E)</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u 打印每一个文件的属主</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -g 打印每一个文件的属组</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -D 打印每一个文件的最后一次修改时间</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L 1显示几层目录</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## --dirsfirst 文件夹显示在前面</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="more"><a class="header-anchor" href="#more"></a>more</h2>
<p><strong>more - 类似 cat ，不过会以一页一页的显示方便使用者逐页阅读</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">more [-dlfpcsu] [-num] [+/pattern] [+linenum] [file ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d 有退出提示</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## Space: 向后一屏；</span></span><br><span class="line"><span class="comment">## Enter: 向后一行；</span></span><br><span class="line"><span class="comment">## b: 向前一屏；</span></span><br></pre></td></tr></table></figure>
<h2 id="less"><a class="header-anchor" href="#less"></a>less</h2>
<p><strong>less - 支持前后翻屏</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    /字符串：向下搜索“字符串”的功能</span></span><br><span class="line"><span class="comment">#    ?字符串：向上搜索“字符串”的功能</span></span><br><span class="line"><span class="comment">#    n：重复前一个搜索（与 / 或 ? 有关）</span></span><br><span class="line"><span class="comment">#    N：反向重复前一个搜索（与 / 或 ? 有关）</span></span><br><span class="line"><span class="comment">#    b  向后翻一页</span></span><br><span class="line"><span class="comment">#    d  向后翻半页</span></span><br><span class="line"><span class="comment">#    h  显示帮助界面</span></span><br><span class="line"><span class="comment">#    Q  退出less 命令</span></span><br><span class="line"><span class="comment">#    u  向前滚动半页</span></span><br><span class="line"><span class="comment">#    y,k  向前滚动一行</span></span><br><span class="line"><span class="comment">#    空格键 滚动一页</span></span><br><span class="line"><span class="comment">#    回车键,j 滚动一行</span></span><br><span class="line"><span class="comment">#    [pagedown]： 向下翻动一页</span></span><br><span class="line"><span class="comment">#    [pageup]：   向上翻动一页</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="tail"><a class="header-anchor" href="#tail"></a>tail</h2>
<p><strong>tail - 输出文件的最后一部分到标准输出.使用tail命令的-f选项可以方便的查阅正在改变的日志文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">tail [OPTION]... FILE</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n # 显示#行,默认是10行</span></span><br><span class="line">$ tail -n <span class="number">4</span> /etc/passwd</span><br><span class="line">--&gt; pulse:x:<span class="number">497</span>:<span class="number">496</span>:PulseAudio System Daemon:/var/run/pulse:/sbin/nologin</span><br><span class="line">	sshd:x:<span class="number">74</span>:<span class="number">74</span>:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">	tcpdump:x:<span class="number">72</span>:<span class="number">72</span>::/:/sbin/nologin</span><br><span class="line">	centos:x:<span class="number">500</span>:<span class="number">500</span>::/home/centos:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">## -f follow 可用来监控日志</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="head"><a class="header-anchor" href="#head"></a>head</h2>
<p><strong>head - 输出文件的前一部分</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">head [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n 显示文件的前多少行,默认是10行</span></span><br><span class="line">$ head -n <span class="number">4</span> /etc/passwd</span><br><span class="line">--&gt; root:x:<span class="number">0</span>:<span class="number">0</span>:root:/root:/bin/bash</span><br><span class="line">	bin:x:<span class="number">1</span>:<span class="number">1</span>:bin:/bin:/sbin/nologin</span><br><span class="line">	daemon:x:<span class="number">2</span>:<span class="number">2</span>:daemon:/sbin:/sbin/nologin</span><br><span class="line">	adm:x:<span class="number">3</span>:<span class="number">4</span>:adm:/var/adm:/sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment">## 其他选项不常用,略过.</span></span><br></pre></td></tr></table></figure>
<h2 id="touch"><a class="header-anchor" href="#touch"></a>touch</h2>
<p><strong>touch - 改变文件时间戳的工具</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">touch [OPTION]... FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">## 什么参数也不加,更新atime,mtime,ctime</span></span><br><span class="line"><span class="comment">##			-m: 只更新mtime</span></span><br><span class="line"><span class="comment">## 			-a: 只更新atime</span></span><br><span class="line"><span class="comment">## 			-t STAMP: [[CC]YY]MMDDhhmm[.ss] 此处只会更改atime,mtime,(ctime更新为当前时间,而不是指定的时间).</span></span><br><span class="line"><span class="comment">##			-c: 不创建空文件</span></span><br><span class="line"></span><br><span class="line">$ touch -t <span class="number">201403031122.33</span> <span class="built_in">test</span></span><br><span class="line">--&gt; File: <span class="string">'test'</span></span><br><span class="line">	  Size: <span class="number">61</span>        	Blocks: <span class="number">8</span>          IO Block: <span class="number">4096</span>   regular file</span><br><span class="line">	Device: fd00h/<span class="number">64768</span>d	Inode: <span class="number">262146</span>      Links: <span class="number">1</span></span><br><span class="line">	Access: (<span class="number">0644</span>/-rw-r--r--)  Uid: (    <span class="number">0</span>/    root)   Gid: (    <span class="number">0</span>/    root)</span><br><span class="line">	Access: <span class="number">2014</span>-<span class="number">03</span>-<span class="number">03</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">33.000000000</span> +<span class="number">0800</span></span><br><span class="line">	Modify: <span class="number">2014</span>-<span class="number">03</span>-<span class="number">03</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">33.000000000</span> +<span class="number">0800</span></span><br><span class="line">	Change: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">21</span>:<span class="number">22</span>:<span class="number">51.350499033</span> +<span class="number">0800</span>(此处为系统当前的时间)</span><br></pre></td></tr></table></figure>
<h2 id="cp"><a class="header-anchor" href="#cp"></a>cp</h2>
<p><strong>cp - 复制文件或文件夹</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">cp [OPTION]... [-T] SOURCE DEST</span><br><span class="line">cp [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">cp [OPTION]... -t DIRECTORY SOURCE...</span><br><span class="line"></span><br><span class="line">cp SRC DEST:</span><br><span class="line">	SRC是文件：</span><br><span class="line">		如果DEST不存在：新建目标文件，并将SRC复制到目标文件；</span><br><span class="line">		如果DEST存在：</span><br><span class="line">			如果DEST是文件：用SRC的内容覆盖至DEST文件中；</span><br><span class="line">			如果DEST是目录：在DEST目录中新一个与原文件同名的文件，将将SRC内容复制到新建的同名的目标文件中；</span><br><span class="line"></span><br><span class="line">cp SRC... DEST:</span><br><span class="line">	如果DEST不存在：</span><br><span class="line">		是错误的；</span><br><span class="line">	如果DEST存在：</span><br><span class="line">		如果DEST是文件：错误；</span><br><span class="line">		如果DEST是目录：</span><br><span class="line"></span><br><span class="line">常用选项：</span><br><span class="line">	-r, -R: 递归复制；</span><br><span class="line">	<span class="operator">-d</span>: 不跟踪符号链接；</span><br><span class="line">	--preserve[=ATTR_LIST]：</span><br><span class="line">		mode, ownership, timestamps</span><br><span class="line">		context, links, xattr, all</span><br><span class="line">	<span class="operator">-a</span>: <span class="operator">-d</span>R --preseve=all</span><br><span class="line">	-i: interactive</span><br><span class="line">	<span class="operator">-f</span>: force</span><br><span class="line">	-v: 显示过程</span><br><span class="line"></span><br><span class="line"><span class="comment">## 下面演示加 -d 与不加的区别, 加-d会把符号链接复制过来,不加-d直接拷贝实际路径</span></span><br><span class="line">$ ll ls</span><br><span class="line">--&gt;　lrwxrwxrwx <span class="number">1</span> root root <span class="number">7</span> Aug <span class="number">24</span> <span class="number">21</span>:<span class="number">42</span> ls -&gt; /bin/ls</span><br><span class="line"></span><br><span class="line">$ cp ls&#123;,_bak&#125;</span><br><span class="line">--&gt; lrwxrwxrwx <span class="number">1</span> root root      <span class="number">7</span> Aug <span class="number">24</span> <span class="number">21</span>:<span class="number">42</span> ls -&gt; /bin/ls</span><br><span class="line">	-rwxr-xr-x <span class="number">1</span> root root <span class="number">117024</span> Aug <span class="number">24</span> <span class="number">22</span>:<span class="number">33</span> ls_bak</span><br><span class="line"></span><br><span class="line">$ cp <span class="operator">-d</span> ls&#123;,_bak_a&#125;</span><br><span class="line">--&gt; lrwxrwxrwx <span class="number">1</span> root root      <span class="number">7</span> Aug <span class="number">24</span> <span class="number">21</span>:<span class="number">42</span> ls -&gt; /bin/ls</span><br><span class="line">	-rwxr-xr-x <span class="number">1</span> root root <span class="number">117024</span> Aug <span class="number">24</span> <span class="number">22</span>:<span class="number">33</span> ls_bak</span><br><span class="line">	lrwxrwxrwx <span class="number">1</span> root root      <span class="number">7</span> Aug <span class="number">24</span> <span class="number">22</span>:<span class="number">35</span> ls_bak_a -&gt; /bin/ls</span><br></pre></td></tr></table></figure>
<h2 id="mv"><a class="header-anchor" href="#mv"></a>mv</h2>
<p><strong>mv - 移动或重命名文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">mv [OPTION]... [-T] SOURCE DEST</span><br><span class="line">mv [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">mv [OPTION]... -t DIRECTORY SOURCE...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -i 交互的方式</span></span><br><span class="line"><span class="comment">## -f 强制移动</span></span><br></pre></td></tr></table></figure>
<h2 id="rm"><a class="header-anchor" href="#rm"></a>rm</h2>
<p><strong>rm - 删除文件和目录,默认情况下,它是不会删除目录的.</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">rm [OPTION]... FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -r -R 递归删除</span></span><br><span class="line"><span class="comment">## -f 强制删除</span></span><br><span class="line"><span class="comment">## -i 交互式删除</span></span><br></pre></td></tr></table></figure>
<h2 id="tr"><a class="header-anchor" href="#tr"></a>tr</h2>
<p><strong>tr - 转换,压缩,删除字符从标准输入,并输出到标准输出.</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">tr [OPTION]... SET1 [SET2]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 用字符串1中字符集的补集替换此字符集，要求字符集为ASCII. 没明白?</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d, --delete 删除字符串1中所有输入字符。</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"aaaabbccvc"</span> | tr <span class="operator">-d</span> <span class="string">"a"</span></span><br><span class="line">--&gt; bbccvc</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --squeeze-repeats 删除所有连续重复出现字符序列，只保留第一个；即将重复出现字符串压缩为一个字符串。</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"aaaabbccvc"</span> | tr <span class="operator">-s</span> <span class="string">'[a-z]'</span></span><br><span class="line">--&gt; abcvc</span><br><span class="line"></span><br><span class="line"><span class="comment">## -t, --truncate-set1 将set1的字符依次替换成set2中的字符,如果set1的长度超过了set2的长度,则超出的部分不做转换.</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'This is your new life.'</span> | tr -t <span class="string">'your'</span> <span class="string">'my'</span></span><br><span class="line">--&gt; This is myur new life.</span><br><span class="line"></span><br><span class="line"><span class="comment">## 区别-t</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'This is your new life.'</span> | tr <span class="string">'your'</span> <span class="string">'my'</span></span><br><span class="line">--&gt; This is myyy new life.</span><br></pre></td></tr></table></figure>
<h2 id="tee"><a class="header-anchor" href="#tee"></a>tee</h2>
<p><strong>tee - 读取标准输入的数据，并将其内容输x到标准输出或文件。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">tee [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## 不加任何参数是覆盖</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -a, --append 追加到给定文件的末尾,并非覆盖</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'new line'</span> | tee <span class="operator">-a</span> a b <span class="comment">#把newline追加到a文件,b文件.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -i, --ignore-interrupts 忽略中断信号。</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="wc"><a class="header-anchor" href="#wc"></a>wc</h2>
<p><strong>wc - 统计指定文件中的字节数、字数、行数，并将统计结果显示输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">wc [OPTION]... [FILE]...</span><br><span class="line">wc [OPTION]... --files0-from=F</span><br><span class="line"></span><br><span class="line"><span class="comment">## -w 统计字数。一个字被定义为由空白、跳格或换行字符分隔的字符串。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -l 统计行数</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 统计字节数。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 统计字符数。这个标志不能与 -c 标志一起使用。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L 打印最长行的长度。</span></span><br></pre></td></tr></table></figure>
<h2 id="cut"><a class="header-anchor" href="#cut"></a>cut</h2>
<p><strong>cut - 命令从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。如果不指定 File 参数，cut 命令将读取标准输入。必须指定 -b、-c 或 -f 标志之一.</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">cut OPTION... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b ：以字节为单位进行分割。这些字节位置将忽略多字节字符边界，除非也指定了 -n 标志。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -c ：以字符为单位进行分割。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -d ：自定义分隔符，默认为制表符。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -f ：与-d一起使用，指定显示哪个区域。</span></span><br><span class="line">	<span class="comment">#:</span></span><br><span class="line">	<span class="comment">#-#：1-3</span></span><br><span class="line">	<span class="comment">#,#: 1,3,7</span></span><br></pre></td></tr></table></figure>
<h2 id="sort"><a class="header-anchor" href="#sort"></a>sort</h2>
<p><strong>sort - 排序指定文件中的行.</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">sort [OPTION]... [FILE]...</span><br><span class="line">sort [OPTION]... --files0-from=F</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b: 忽略每行前面开始出的空格字符。</span></span><br><span class="line"><span class="comment">## -c: 检查文件是否已经按照顺序排序。</span></span><br><span class="line"><span class="comment">## -r: 逆序</span></span><br><span class="line"><span class="comment">## -f: 忽略字符大小写</span></span><br><span class="line"><span class="comment">## -u: 排序后去重</span></span><br><span class="line"><span class="comment">## -t CHAR: 指明分隔符</span></span><br><span class="line"><span class="comment">## -k #: 字段,选择那个区间进行排序</span></span><br><span class="line"><span class="comment">## -n: 表示以数值大小排序</span></span><br><span class="line"><span class="comment">## -o &lt;输出文件&gt; 将排序后的结果存入指定的文件。</span></span><br></pre></td></tr></table></figure>
<h2 id="uniq"><a class="header-anchor" href="#uniq"></a>uniq</h2>
<p><strong>uniq - 报告或删除文件中重复的行。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">uniq [OPTION]... [INPUT [OUTPUT]]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c: 显示每行重复的次数；</span></span><br><span class="line"><span class="comment">## -d: 只显示重复过的行；</span></span><br><span class="line"><span class="comment">## -u: 只显示不曾重复的行；</span></span><br><span class="line"><span class="comment">## -i: 忽略大小写;</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>涉及到的命令有,cat, tac, file, history, tree, more, less, tail, head, touch, cp, mv, rm, glob(7),tr,tee, wc, cut, sort, uniq</em></p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ZY-2015.08.20]]></title>
    <link href="http://molloc.me/2015/08/20/ZY-2015-08-20/"/>
    <id>http://molloc.me/2015/08/20/ZY-2015-08-20/</id>
    <published>2015-08-20T14:32:07.000Z</published>
    <updated>2015-09-11T15:22:07.901Z</updated>
    <content type="html"><![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>涉及到的命令有,date,clock,hwclock,cal,ls,cd,pwd,tty,whereis,which,stat,echo,shutdown,halt,reboot,poweroff,who,w,whoami</em></p>
<a id="more"></a>
<h2 id="date"><a class="header-anchor" href="#date"></a>date</h2>
<p><strong>date - print or set the system date and time</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SYNOPSIS</span></span><br><span class="line">date [OPTION]... [+FORMAT]</span><br><span class="line">date [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#OPTION</span></span><br><span class="line"><span class="comment">#-d DATESTR, --date=DATESTR 显示时间描述的字符串,而不是“现在”</span></span><br><span class="line"> $ date <span class="operator">-d</span> <span class="string">"2015-05-04"</span></span><br><span class="line"> --&gt; Mon May  <span class="number">4</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> CST <span class="number">2015</span></span><br><span class="line"> $ date --date=<span class="string">"2015-05-04"</span></span><br><span class="line"> --&gt; Mon May  <span class="number">4</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> CST <span class="number">2015</span></span><br><span class="line"> $ date <span class="operator">-d</span> <span class="string">"2 days ago"</span></span><br><span class="line"> --&gt; Wed Aug <span class="number">19</span> <span class="number">21</span>:<span class="number">09</span>:<span class="number">18</span> CST <span class="number">2015</span></span><br><span class="line"><span class="comment">#-s DATESTR, --set=DATESTR 设置时间描述的字符串</span></span><br><span class="line"> $ date <span class="operator">-s</span> <span class="string">"2015-05-04"</span></span><br><span class="line"> $ date --set=<span class="string">"2015-05-04"</span></span><br><span class="line"> $ date <span class="operator">-s</span> <span class="string">"2 days ago"</span></span><br><span class="line"><span class="comment">#-u, --utc, --universal 输出或者设置协调的通用时间</span></span><br><span class="line"> $ date -u</span><br><span class="line"> --&gt; Fri Aug <span class="number">21</span> <span class="number">13</span>:<span class="number">09</span>:<span class="number">38</span> UTC <span class="number">2015</span></span><br><span class="line"> $ date --utc</span><br><span class="line"> $ date --universal</span><br><span class="line"><span class="comment">#FORMAT</span></span><br><span class="line"><span class="comment"># '%a' //简短的星期名</span></span><br><span class="line">$ date <span class="string">'+%a'</span> // Sun</span><br><span class="line"><span class="comment"># '%A' 星期的全称</span></span><br><span class="line">$ date <span class="string">'+%A'</span> // Sunday</span><br><span class="line"><span class="comment"># '%b' 月份的简称</span></span><br><span class="line">$ date <span class="string">'+%b'</span> // Jan</span><br><span class="line"><span class="comment"># '%B' 月份的全称</span></span><br><span class="line">$ date <span class="string">'+%B'</span> // January</span><br><span class="line"><span class="comment"># '%c' 显示时间和日期</span></span><br><span class="line">$ date <span class="string">'+%c'</span> // Thu <span class="number">20</span> Aug <span class="number">2015</span> <span class="number">11</span>:<span class="number">43</span>:<span class="number">39</span> PM CST</span><br><span class="line"><span class="comment"># '%C' 显示世纪,像%Y省略了后两位数字</span></span><br><span class="line">$ date <span class="string">'+%C'</span> // <span class="number">20</span></span><br><span class="line"><span class="comment"># '%d' 每月的第几天(</span></span><br><span class="line">$ date <span class="string">'+%d'</span> // <span class="number">20</span></span><br><span class="line"><span class="comment"># '%D' 显示日期,想'%m/%d/%y'</span></span><br><span class="line">$ date <span class="string">'+%d'</span> // <span class="number">08</span>/<span class="number">20</span>/<span class="number">15</span></span><br><span class="line"><span class="comment"># '%e' 月份中的天数,用空格填充</span></span><br><span class="line">$ date <span class="string">'+%e'</span> // <span class="string">' 5'</span></span><br><span class="line"><span class="comment"># '%F' 年月日,像%Y-%m-%d</span></span><br><span class="line">$ date <span class="string">'+%F'</span> // <span class="number">2015</span>-<span class="number">08</span>-<span class="number">20</span></span><br><span class="line"><span class="comment"># '%g' 年份的后两位</span></span><br><span class="line">$ date <span class="string">'+%g'</span> // <span class="number">15</span></span><br><span class="line"><span class="comment"># '%G' 使用基于周的年</span></span><br><span class="line">$ date <span class="string">'+%G'</span> // <span class="number">2015</span></span><br><span class="line"><span class="comment"># '%h' 参考 %b</span></span><br><span class="line"><span class="comment"># '%H' 24小时制(0..23)</span></span><br><span class="line">$ date <span class="string">'+%G'</span> // <span class="number">23</span></span><br><span class="line"><span class="comment"># '%I' 12小时制(1..12)</span></span><br><span class="line">$ date <span class="string">'+%I'</span> // <span class="number">12</span></span><br><span class="line"><span class="comment"># '%j' 一年中的天数(001..366)</span></span><br><span class="line">$ date <span class="string">'+%j'</span> // <span class="number">233</span></span><br><span class="line"><span class="comment"># '%k' 参考%H</span></span><br><span class="line"><span class="comment"># '%l' 参考%I</span></span><br><span class="line"><span class="comment"># '%m' 显示月份(01..12)</span></span><br><span class="line">$ date <span class="string">'+%m'</span> // <span class="number">08</span></span><br><span class="line"><span class="comment"># '%M' 显示分钟数(00-59)</span></span><br><span class="line">$ date <span class="string">'+%M'</span> // <span class="number">04</span></span><br><span class="line"><span class="comment"># '%n' 换行</span></span><br><span class="line"><span class="comment"># '%N' 纳秒(000000000..999999999)</span></span><br><span class="line">$ date <span class="string">'+%N'</span> // <span class="number">236423051</span></span><br><span class="line"><span class="comment"># '%p' AM或PM</span></span><br><span class="line">$ date <span class="string">'+p'</span> // PM</span><br><span class="line"><span class="comment"># '%P' am或pm(小写)</span></span><br><span class="line">$ date <span class="string">'+p'</span> // pm</span><br><span class="line"><span class="comment"># '%r' 时间(含时分秒，小时以12小时AM/PM来表示)</span></span><br><span class="line">$ date <span class="string">'+r'</span> // <span class="number">09</span>:<span class="number">21</span>:<span class="number">53</span> PM</span><br><span class="line"><span class="comment"># '%R' 24小时加上分解,想%H:%M</span></span><br><span class="line">$ date <span class="string">'+R'</span> // <span class="number">21</span>:<span class="number">23</span></span><br><span class="line"><span class="comment"># '%s' 从1970-01-01 00:00:00 UTC开始的秒数</span></span><br><span class="line">$ date <span class="string">'+s'</span> // <span class="number">1440163456</span></span><br><span class="line"><span class="comment"># '%S' 显示秒数(0-60)</span></span><br><span class="line">$ date <span class="string">'+S'</span> // <span class="number">31</span></span><br><span class="line"><span class="comment"># '%T' 时间 像 %H:%M:%S</span></span><br><span class="line">$ date <span class="string">'+T'</span> // <span class="number">21</span>:<span class="number">26</span>:<span class="number">28</span></span><br><span class="line"><span class="comment"># '%u' 星期(1-7),1代表星期一</span></span><br><span class="line">$ date <span class="string">'+u'</span> // <span class="number">5</span></span><br><span class="line"><span class="comment"># '%U' 一年中的周数(01-53)</span></span><br><span class="line">$ date <span class="string">'+U'</span> // <span class="number">33</span></span><br><span class="line"><span class="comment"># '%w' 一周的星期几(0-6)0是星期日</span></span><br><span class="line">$ date <span class="string">'+w'</span> // <span class="number">5</span></span><br><span class="line"><span class="comment"># '%x' 按本地日期格式显示</span></span><br><span class="line">$ date <span class="string">'+x'</span> // <span class="number">08</span>/<span class="number">23</span>/<span class="number">2015</span></span><br><span class="line"><span class="comment"># '%X' 按本地时间格式显示</span></span><br><span class="line">$ date <span class="string">'+X'</span> // <span class="number">12</span>:<span class="number">03</span>:<span class="number">05</span> AM</span><br><span class="line"><span class="comment"># '%y' 显示年份的后两位</span></span><br><span class="line">$ date <span class="string">'+y'</span> // <span class="number">15</span></span><br><span class="line"><span class="comment"># '%Y' 四位数的年份</span></span><br><span class="line">$ date <span class="string">'+Y'</span> // <span class="number">2015</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##date [-u|--utc|--universal] [MMDDhhmm[[CC]YY][.ss]]</span></span><br><span class="line"><span class="comment">## -u|--utc|--universal 选项一般不常用</span></span><br><span class="line"><span class="comment">## [MMDDhhmm[[CC]YY][.ss]] 主要设置时间的格式.</span></span><br><span class="line">$ date <span class="number">112311222014.33</span></span><br><span class="line">--&gt; Sun Nov <span class="number">23</span> <span class="number">11</span>:<span class="number">22</span>:<span class="number">33</span> CST <span class="number">2014</span></span><br></pre></td></tr></table></figure>
<h2 id="hwclock-clock"><a class="header-anchor" href="#hwclock-clock"></a>hwclock&amp;clock</h2>
<p><strong>hwclock - query and set the hardware clock (RTC) 查询或设置硬件时间</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">hwclock [<span class="built_in">functions</span>] [options]</span><br><span class="line"></span><br><span class="line"><span class="comment">## functions</span></span><br><span class="line"><span class="comment">## -r,--show 阅读硬件时钟和在标准输出打印时间。显示的时间总是在当地时间.</span></span><br><span class="line">$ hwclock -r</span><br><span class="line">--&gt; Fri <span class="number">21</span> Aug <span class="number">2015</span> <span class="number">09</span>:<span class="number">51</span>:<span class="number">06</span> PM CST  -<span class="number">0.378045</span> seconds</span><br><span class="line">$ hwclock --show</span><br><span class="line">--&gt; Fri <span class="number">21</span> Aug <span class="number">2015</span> <span class="number">09</span>:<span class="number">51</span>:<span class="number">55</span> PM CST  -<span class="number">0.329897</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="comment">## --set 用给定的时间(--date 选项)设置硬件时间</span></span><br><span class="line">$ hwclock --set --date=<span class="string">'2015-08-21'</span> // 修改后的时间</span><br><span class="line">--&gt; Fri <span class="number">21</span> Aug <span class="number">2015</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">09</span> AM CST  -<span class="number">1.036660</span> seconds</span><br><span class="line">$ hwclock --set --date=<span class="string">'-4 days'</span> // 修改后的时间</span><br><span class="line">--&gt; Wed <span class="number">19</span> Aug <span class="number">2015</span> <span class="number">12</span>:<span class="number">24</span>:<span class="number">32</span> AM CST  -<span class="number">0.469782</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --hctosys 将系统时钟调整为与目前的硬件时钟一致, htc override sys</span></span><br><span class="line">$ hwclock <span class="operator">-s</span></span><br><span class="line">--&gt; Wed Aug <span class="number">19</span> <span class="number">00</span>:<span class="number">28</span>:<span class="number">23</span> CST <span class="number">2015</span></span><br><span class="line">$ hwclock --hctosys</span><br><span class="line">--&gt; Wed Aug <span class="number">19</span> <span class="number">00</span>:<span class="number">28</span>:<span class="number">23</span> CST <span class="number">2015</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -w, --systohc 将系统时钟写入硬件时钟 sys to hc</span></span><br><span class="line">$ hwclock -w</span><br><span class="line">--&gt; Thu <span class="number">20</span> Aug <span class="number">2015</span> <span class="number">12</span>:<span class="number">00</span>:<span class="number">19</span> AM CST  -<span class="number">0.298877</span> seconds</span><br><span class="line">$ hwclock --systohc</span><br><span class="line">--&gt; Fri <span class="number">21</span> Aug <span class="number">2015</span> <span class="number">10</span>:<span class="number">03</span>:<span class="number">10</span> PM CST  -<span class="number">1.235380</span> seconds</span><br><span class="line"></span><br><span class="line"><span class="comment">## --adjust hwclock每次更改硬件时钟时，都会记录在/etc/adjtime文件中,</span></span><br><span class="line"><span class="comment">## 可使hwclock根据先前的记录来估算硬件时钟的偏差，并用来校正目前的硬件时钟.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## options</span></span><br><span class="line">//待补充</span><br></pre></td></tr></table></figure>
<h2 id="cal"><a class="header-anchor" href="#cal"></a>cal</h2>
<p><strong>cal - 显示日历</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">cal [-smjy13] [[[day] month] year]</span><br><span class="line"></span><br><span class="line"><span class="comment">## cal 如果没有指定参数,则显示当前月份.</span></span><br><span class="line">$ cal</span><br><span class="line"></span><br><span class="line"><span class="comment">## -l 显示一个月的日历,这是默认的选项.</span></span><br><span class="line">$ cal <span class="operator">-l</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -3 显示上月/当月/下月的日历.</span></span><br><span class="line">$ cal -<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -s 显示星期日为一个星期的第一天.</span></span><br><span class="line">$ cal <span class="operator">-s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 显示星期一为一个星期的第一天.</span></span><br><span class="line">$ cal -m</span><br><span class="line"></span><br><span class="line"><span class="comment">## -j  显示在当年中的第几天（一年日期按天算，从1月1号算起，默认显示当前月在一年中的天数）</span></span><br><span class="line">$ cal -j</span><br><span class="line"></span><br><span class="line"><span class="comment">## -y 显示当年的日历</span></span><br><span class="line">$ cal -y</span><br></pre></td></tr></table></figure>
<h2 id="ls"><a class="header-anchor" href="#ls"></a>ls</h2>
<p><strong>显示目录中的内容,默认显示当前目录,并安装字母顺序排列</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">ls [OPTION]... [FILE]...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -a, --all 列出目录下的所有文件，包括以 . 开头的隐含文件</span></span><br><span class="line">$ ls <span class="operator">-a</span></span><br><span class="line">--&gt; .  ..  .esd-<span class="number">0</span>  .ICE-unix</span><br><span class="line"></span><br><span class="line"><span class="comment">## -A, --almost-all 列出目录下的所有文件，但不包括(.当前目录)(..父目录)</span></span><br><span class="line">$ ls <span class="operator">-a</span></span><br><span class="line">--&gt; .esd<span class="operator">-a</span> .ICE-unix</span><br><span class="line"></span><br><span class="line"><span class="comment">## --author 与-l参数一起使用,显示作者.</span></span><br><span class="line">$ ls <span class="operator">-l</span> --author</span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm  gdm  gdm   <span class="number">4096</span> Aug <span class="number">21</span> <span class="number">21</span>:<span class="number">06</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b, --escape 把文件名中不可输出的字符用反斜杠加字符编号(就象在C语言里一样)的形式列出。</span></span><br><span class="line">$ ls -b</span><br><span class="line"></span><br><span class="line"><span class="comment">## --block-size=SIZE =1K,以 k 字节的形式表示文件的大小。</span></span><br><span class="line">$ ls --block-size=<span class="number">1</span>M</span><br><span class="line">--&gt; dr-xr-xr-x.   <span class="number">2</span> root root <span class="number">36</span>(k) Aug <span class="number">21</span> <span class="number">05</span>:<span class="number">41</span> bin</span><br><span class="line"></span><br><span class="line"><span class="comment">## -B, --ignore-backups 忽略以~结尾的备份目录</span></span><br><span class="line">$ ls</span><br><span class="line">--&gt; bak~  lcyan.root.history-timestamp  orbit-gdm</span><br><span class="line">$ ls -B</span><br><span class="line">--&gt; lcyan.root.history-timestamp  orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 配合 -lt：根据 ctime 排序及显示 ctime (文件状态最后更改的时间)配合</span></span><br><span class="line"><span class="comment">## -c -l：显示 ctime 但根据名称排序否则：根据 ctime 排序</span></span><br><span class="line">$ ls <span class="operator">-lt</span> -c</span><br><span class="line">$ ls <span class="operator">-l</span> -c</span><br><span class="line"></span><br><span class="line"><span class="comment">## –color[=WHEN] 控制是否使用色彩分辨文件。WHEN 可以是'never'、'always'或'auto'其中之一</span></span><br><span class="line">$ ls --color=auto</span><br><span class="line"></span><br><span class="line"><span class="comment">## -d, --directory显示指定的目录,不要解除引用的符号连接.</span></span><br><span class="line">$ ls <span class="operator">-d</span> /tmp</span><br><span class="line">--&gt; /tmp</span><br><span class="line">$ ls --directory /tmp</span><br><span class="line">--&gt; /tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">## -f 对结果不排序, 激活 -aU, 禁止 -ls --color</span></span><br><span class="line">$ ls <span class="operator">-f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -F, --classify 在每个文件后面加上指示符号</span></span><br><span class="line">$ ls -F</span><br><span class="line">--&gt; bak~/  lcyan.root.history-timestamp  orbit-gdm/</span><br><span class="line"></span><br><span class="line"><span class="comment">## --file-type 同-F,除了不添加' *'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## --format=WORD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## --full-time 参考-l</span></span><br><span class="line">$ ls --full-time</span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> <span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">21</span>:<span class="number">06</span>:<span class="number">13.856371827</span> +<span class="number">0800</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -g参考-l, 不常用.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -h, --human-readable 人类可读的.配合-l使用</span></span><br><span class="line">$ ls -lh</span><br><span class="line"></span><br><span class="line"><span class="comment">## --si 用1000作为换算单位,而不是1024</span></span><br><span class="line">$ ls --si</span><br><span class="line">--&gt; drwxr-xr-x. <span class="number">2</span> root root <span class="number">4.1</span>k Aug <span class="number">21</span> <span class="number">23</span>:<span class="number">26</span> bak~</span><br><span class="line"></span><br><span class="line"><span class="comment">## -H, --dereference-command-line 使用命令列中的符号链接指示的真正目的地</span></span><br><span class="line">$ ls -H</span><br><span class="line">--&gt; traceroute6 -&gt; traceroute 显示为 traceroute</span><br><span class="line"></span><br><span class="line"><span class="comment">## --hide=PATTERN 不列出匹配到正则表达式的文件</span></span><br><span class="line">$ ls <span class="operator">-l</span> --hide=*.log</span><br><span class="line">--&gt; 不显示后缀为.log的文件</span><br><span class="line"></span><br><span class="line"><span class="comment">## -i,--inode 显示文件的inode号</span></span><br><span class="line">$ ls -i</span><br><span class="line">--&gt; <span class="number">266215</span> drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line">$ ls --inode</span><br><span class="line">--&gt; <span class="number">266215</span> drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -I, --ignore=PATTERN 参考 --hide</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -k 参考 --block-size=1K</span></span><br><span class="line">$ ls -lk</span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4</span>[此处单位为K] Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -l 显示为长列表格式</span></span><br><span class="line">$ ls <span class="operator">-l</span></span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L, --dereference 符号链接显示为链接的引用,而不是链接本身</span></span><br><span class="line">$ ls <span class="operator">-l</span></span><br><span class="line">--&gt; lrwxrwxrwx. <span class="number">1</span> root root     <span class="number">9</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">11</span> <span class="built_in">echo</span> -&gt; /bin/<span class="built_in">echo</span></span><br><span class="line">$ ls <span class="operator">-l</span>L</span><br><span class="line">--&gt; -rwxr-xr-x. <span class="number">1</span> root root <span class="number">28176</span> Oct <span class="number">15</span>  <span class="number">2014</span> <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 用逗号填充列表的分隔符</span></span><br><span class="line">$ ls -m</span><br><span class="line">--&gt; pulse-vS2MflCGjzHN, virtual-root.GJeaJi, yum.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n, --numeric-uid-gid 像-l, 但显示的数字是用户和组的ID.</span></span><br><span class="line">$ ls -n</span><br><span class="line">--&gt; drwx------. <span class="number">2</span> <span class="number">42</span> <span class="number">42</span>  <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm (多了一个组ID)</span><br><span class="line"></span><br><span class="line"><span class="comment">## -N, --literal 显示原生的名字,不会对控制字符做特殊处理</span></span><br><span class="line">$ ls -N</span><br><span class="line">--&gt; pulse-vS2MflCGjzHN  virtual-root.GJeaJi  yum.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## -o 类似于 -l, 但不显示组的信息.</span></span><br><span class="line">$ ls <span class="operator">-l</span></span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line">$ ls -o</span><br><span class="line">--&gt; drwx------. <span class="number">2</span> gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## -p, --indicator-style=slash, 制定分隔符,默认文件夹后面是/</span></span><br><span class="line">$ ls --indicator-style=none</span><br><span class="line"></span><br><span class="line"><span class="comment">## -q, --hide-control-chars 用?代替非图形字符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -Q, --quote-name 条目名称加上双引号</span></span><br><span class="line">$ ls -Q</span><br><span class="line">--&gt; <span class="string">"bak~"</span>  <span class="string">"echo"</span>  <span class="string">"hackt"</span>  <span class="string">"lcyan.root.history-timestamp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -r, --reverse 反序,当原列表是排序的情况下</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -R, --recursive 递归显示文件子目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --size 以块大小为单位列出所有文件的大小</span></span><br><span class="line">$ ls -si</span><br><span class="line">--&gt; <span class="number">4</span> drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm (前<span class="number">2</span>位)</span><br><span class="line"></span><br><span class="line"><span class="comment">## -S 按文件大小排序</span></span><br><span class="line">$ ls <span class="operator">-l</span>S</span><br><span class="line">--&gt; 	-rw-r--r--. <span class="number">1</span> root root <span class="number">39384</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">33</span> lcyan.root.history-timestamp</span><br><span class="line">--&gt; 	drwxr-xr-x. <span class="number">2</span> root root  <span class="number">4096</span> Aug <span class="number">21</span> <span class="number">23</span>:<span class="number">26</span> bak~</span><br><span class="line">--&gt; 	drwx------. <span class="number">2</span> gdm  gdm   <span class="number">4096</span> Aug <span class="number">22</span> <span class="number">07</span>:<span class="number">44</span> orbit-gdm</span><br><span class="line"></span><br><span class="line"><span class="comment">## --sort=WORD 用指定的规则排,none -U, extension -X, size -S, time -t, version -v</span></span><br><span class="line"><span class="variable">$ls</span> <span class="operator">-l</span> --sort=extension</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">37</span> b.dmg</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">20</span> <span class="number">07</span>:<span class="number">51</span> yum.log</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> read.md</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> a.tgz</span><br><span class="line"></span><br><span class="line"><span class="variable">$ls</span> <span class="operator">-l</span> --sort=time</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">37</span> b.dmg</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> a.tgz</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> read.md</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">20</span> <span class="number">07</span>:<span class="number">51</span> yum.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## --time=WORD 配合 -l with  -l,  show  time  as WORD instead of modification time:</span></span><br><span class="line"><span class="comment">## atime -u, access -u, use -u, ctime -c, or status -c; use specified</span></span><br><span class="line"><span class="comment">## time as sort key if --sort=time</span></span><br><span class="line">$ ls <span class="operator">-l</span> --sort=time --time=ctime</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">38</span> read.md</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">38</span> yum.log</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">38</span> a.tgz</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">38</span> b.dmg</span><br><span class="line"></span><br><span class="line"><span class="comment">## -t 按修改时间倒序</span></span><br><span class="line">$ ls -tl --full-time</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">37</span>:<span class="number">32.922959000</span> +<span class="number">0800</span> b.dmg</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">36</span>:<span class="number">59.016959045</span> +<span class="number">0800</span> a.tgz</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">36</span>:<span class="number">17.796955491</span> +<span class="number">0800</span> read.md</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> <span class="number">2015</span>-<span class="number">08</span>-<span class="number">20</span> <span class="number">07</span>:<span class="number">51</span>:<span class="number">23.161999794</span> +<span class="number">0800</span> yum.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u  配合 -lt:显示访问时间而且依访问时间排序</span></span><br><span class="line"><span class="comment">##     配合 -l:显示访问时间但根据名称排序</span></span><br><span class="line"><span class="comment">##     否则：根据访问时间排序</span></span><br><span class="line">$ ls -ut</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">37</span> b.dmg</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> a.tgz</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> read.md</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">20</span> <span class="number">07</span>:<span class="number">51</span> yum.log</span><br><span class="line"></span><br><span class="line">$ ls -lu</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> a.tgz</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">37</span> b.dmg</span><br><span class="line">--&gt; -rw-r--r--. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">36</span> read.md</span><br><span class="line">--&gt; -rw-------. <span class="number">1</span> root root <span class="number">0</span> Aug <span class="number">20</span> <span class="number">07</span>:<span class="number">51</span> yum.log</span><br><span class="line"></span><br><span class="line"><span class="comment">## -U 不进行排序;依文件系统原有的次序列出项目</span></span><br><span class="line">$ ls <span class="operator">-l</span>U</span><br><span class="line"></span><br><span class="line"><span class="comment">## -v 根据版本进行排序</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -X 根据扩展名排</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## 还有一些关于selinux的选项,不常用</span></span><br></pre></td></tr></table></figure>
<h2 id="cd"><a class="header-anchor" href="#cd"></a>cd</h2>
<p><strong>改变shell的工作目录</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"><span class="built_in">cd</span>: <span class="built_in">cd</span> [-L|-P] [dir]</span><br><span class="line"></span><br><span class="line"><span class="comment">## cd 改变当前工作目录到DIR,如果不指定DIR,则默认的DIR是shell变量$HOME的值</span></span><br><span class="line">$ <span class="built_in">cd</span></span><br><span class="line">--&gt; /root</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$HOME</span></span><br><span class="line">--&gt; /root</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L 强制进去符号链接目录</span></span><br><span class="line">$ ls -ld /proc/self</span><br><span class="line">--&gt; lrwxrwxrwx <span class="number">1</span> root root <span class="number">64</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">57</span> self -&gt; <span class="number">3521</span></span><br><span class="line">$ <span class="built_in">cd</span> -L self</span><br><span class="line">--&gt; /proc/self</span><br><span class="line"></span><br><span class="line"><span class="comment">## -P 使用物理目录结构,而不是符号目录</span></span><br><span class="line">$ ls -ld /proc/self</span><br><span class="line">--&gt; lrwxrwxrwx <span class="number">1</span> root root <span class="number">64</span> Aug <span class="number">22</span> <span class="number">08</span>:<span class="number">57</span> self -&gt; <span class="number">3521</span></span><br><span class="line">$ <span class="built_in">cd</span> -P self</span><br><span class="line">--&gt;  /proc/<span class="number">3521</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## cd的默认行为是 cd -L</span></span><br></pre></td></tr></table></figure>
<h2 id="pwd"><a class="header-anchor" href="#pwd"></a>pwd</h2>
<p><strong>pwd是一个内建命令,打印当前工作目录的名字</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"><span class="built_in">pwd</span> [-LP]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L 打印shell变量$PWD的值,如果它的值是当前工作目录</span></span><br><span class="line">$ <span class="built_in">pwd</span> -L</span><br><span class="line">--&gt; /etc/ssh</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$PWD</span></span><br><span class="line">--&gt; /etc/ssh</span><br><span class="line"></span><br><span class="line"><span class="comment">## -P 参考cd的-P选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## pwd的默认行为是 pwd -L</span></span><br></pre></td></tr></table></figure>
<h2 id="tty"><a class="header-anchor" href="#tty"></a>tty</h2>
<p><strong>打印连接到标准输入的终端的文件名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">tty [OPTION]...</span><br><span class="line"></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">$ tty</span><br><span class="line">--&gt; /dev/pts/<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -s, --silent, --quiet 什么也不返还,值返回一个退出状态</span></span><br><span class="line">$ tty <span class="operator">-s</span></span><br></pre></td></tr></table></figure>
<h2 id="whereis"><a class="header-anchor" href="#whereis"></a>whereis</h2>
<p><strong>定位一个命令的二进制文件,源码,手册的位置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">whereis [-bmsu] [-BMS directory...  <span class="operator">-f</span>] filename...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -b 仅搜索二进制文件的位置</span></span><br><span class="line">$ whereis -b ls</span><br><span class="line">--&gt; ls: /bin/ls</span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 仅搜索手册章节文件的位置</span></span><br><span class="line">$ whereis -m ls</span><br><span class="line">--&gt; ls: /usr/share/man/man1p/ls.<span class="number">1</span>p.gz /usr/share/man/man1/ls.<span class="number">1</span>.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">## -m 仅搜索源码文件的位置</span></span><br><span class="line">$ whereis <span class="operator">-s</span> ls</span><br><span class="line">--&gt; ls:</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u 索默认路径下除可执行文件、源代码文件、帮助文件以外的其它文件。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -B 指定搜索可执行文件的路径。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -M 指定搜索帮助文件的路径。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -S 指定搜索源代码文件的路径</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## 在使用了-B ， -M ， -S  任意一个参数时，必须加上 -f  参数， 然后指定要搜索的文件名.</span></span><br><span class="line">$ whereis -B /bin <span class="operator">-f</span> ls gcc</span><br></pre></td></tr></table></figure>
<h2 id="which"><a class="header-anchor" href="#which"></a>which</h2>
<p><strong>显示shell命令的全路径,注意只能找到PATH路径下的命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"><span class="built_in">which</span> [options] [--] programname [...]</span><br><span class="line"></span><br><span class="line"><span class="comment">## --all, -a 打印所有匹配的可执行文件的路径在PATH，而不是仅仅是第一.</span></span><br><span class="line">$ <span class="built_in">which</span> <span class="operator">-a</span> tty</span><br><span class="line">--&gt; /usr/bin/tty</span><br><span class="line"></span><br><span class="line"><span class="comment">## --read-alias, -i</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## --skip-alias 跳过别名</span></span><br><span class="line">$ <span class="built_in">which</span> --skip-alias ls</span><br><span class="line">--&gt; /bin/ls</span><br></pre></td></tr></table></figure>
<h2 id="stat"><a class="header-anchor" href="#stat"></a>stat</h2>
<p><strong>显示文件或文件系统的状态</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"><span class="built_in">stat</span> [OPTION]... FILE...</span><br><span class="line"></span><br><span class="line"><span class="comment">## -L, --dereference 如果是链接文件，则获取原文件信息</span></span><br><span class="line">$ <span class="built_in">stat</span> <span class="built_in">echo</span> File:</span><br><span class="line">--&gt; `<span class="built_in">echo</span>` -&gt; `/bin/<span class="built_in">echo</span>`</span><br><span class="line">--&gt;   Size: <span class="number">9</span>         	Blocks: <span class="number">0</span>          IO Block: <span class="number">4096</span>   symbolic link</span><br><span class="line">--&gt; Device: fd00h/<span class="number">64768</span>d	Inode: <span class="number">266232</span>      Links: <span class="number">1</span></span><br><span class="line">--&gt; Access: (<span class="number">0777</span>/lrwxrwxrwx)  Uid: (    <span class="number">0</span>/    root)   Gid: (    <span class="number">0</span>/    root)</span><br><span class="line">--&gt; Access: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">11</span>:<span class="number">08.364959865</span> +<span class="number">0800</span></span><br><span class="line">--&gt; Modify: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">11</span>:<span class="number">05.354951390</span> +<span class="number">0800</span></span><br><span class="line">--&gt; Change: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">11</span>:<span class="number">05.354951390</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">stat</span> -L <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">--&gt;   File: `<span class="built_in">echo</span>`</span><br><span class="line">--&gt;   Size: <span class="number">28176</span>     	Blocks: <span class="number">56</span>         IO Block: <span class="number">4096</span>   regular file</span><br><span class="line">--&gt; Device: fd00h/<span class="number">64768</span>d	Inode: <span class="number">393280</span>      Links: <span class="number">1</span></span><br><span class="line">--&gt; Access: (<span class="number">0755</span>/-rwxr-xr-x)  Uid: (    <span class="number">0</span>/    root)   Gid: (    <span class="number">0</span>/    root)</span><br><span class="line">--&gt; Access: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">05</span>:<span class="number">41</span>:<span class="number">48.000000000</span> +<span class="number">0800</span></span><br><span class="line">--&gt; Modify: <span class="number">2014</span>-<span class="number">10</span>-<span class="number">15</span> <span class="number">12</span>:<span class="number">51</span>:<span class="number">07.000000000</span> +<span class="number">0800</span></span><br><span class="line">--&gt; Change: <span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">05</span>:<span class="number">41</span>:<span class="number">48.910998268</span> +<span class="number">0800</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## -Z, --context 打印selinux安全上下文 不常用</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -f, --file-system 显示文件所在的文件系统的状态</span></span><br><span class="line">$ <span class="built_in">stat</span> --file-system <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">			  File: <span class="string">"echo"</span></span><br><span class="line">		    	ID: <span class="number">967</span>e9fcacf39b33a Namelen: <span class="number">255</span>     Type: ext2/ext3</span><br><span class="line">		Block size: <span class="number">4096</span>       Fundamental block size: <span class="number">4096</span></span><br><span class="line">		Blocks: Total: <span class="number">12371645</span>   Free: <span class="number">11518437</span>   Available: <span class="number">10888319</span></span><br><span class="line">		Inodes: Total: <span class="number">3153920</span>    Free: <span class="number">3055295</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -c  --format=FORMAT 自定义输出格式，结尾有换行</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## --printf=FORMAT 自定义输出格式，结尾无换行符，需手动添加</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -t, --terse  以简洁的形式打印输出信息（在没有改变输出格式的情况下）</span></span><br><span class="line">$ <span class="built_in">stat</span> -t <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">--&gt; <span class="built_in">echo</span> <span class="number">9</span> <span class="number">0</span> a1ff <span class="number">0</span> <span class="number">0</span> fd00 <span class="number">266232</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1440202268</span> <span class="number">1440202265</span> <span class="number">1440202265</span> <span class="number">4096</span></span><br><span class="line"></span><br><span class="line">@@ FORMAT</span><br><span class="line"><span class="comment">## %a 八进制格式的文件访问权限</span></span><br><span class="line">$ <span class="built_in">stat</span> -c <span class="string">'%a'</span> <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">--&gt; <span class="number">777</span></span><br><span class="line"><span class="comment">## %A 可读形式访问权限</span></span><br><span class="line">$ <span class="built_in">stat</span> -c <span class="string">'%A'</span> <span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line">--&gt; lrwxrwxrwx</span><br><span class="line"><span class="comment">## ...</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="echo"><a class="header-anchor" href="#echo"></a>echo</h2>
<p><strong>echo是一个内建命令,将参数显示到标准输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"><span class="built_in">echo</span>: <span class="built_in">echo</span> [<span class="operator">-ne</span>E] [arg ...]</span><br><span class="line"></span><br><span class="line">@@Options:</span><br><span class="line"><span class="comment">## -n 输出文字后不换行</span></span><br><span class="line">$ <span class="built_in">echo</span> -n <span class="string">'this is my new life.'</span></span><br><span class="line">--&gt; this is my new life.(此处没有换行)[root@lcyan tmp]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -e 允许对转义字符的解析</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">'\t this my \n new life.'</span></span><br><span class="line">--&gt;  	 this my</span><br><span class="line">--&gt;  new life.</span><br><span class="line"><span class="comment">## -E 显式地抑制反斜杠转义的解释</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="operator">-e</span> <span class="string">'\t this my \n new life.'</span></span><br><span class="line">--&gt;  \t this my \n new life.</span><br><span class="line"></span><br><span class="line">@@ backslash-escaped characters</span><br><span class="line">\a 发出警告声；</span><br><span class="line">\b 删除前一个字符；</span><br><span class="line">\c 最后不加上换行符号；</span><br><span class="line">\f 换行但光标仍旧停留在原来的位置；</span><br><span class="line">\n 换行且光标移至行首；</span><br><span class="line">\r 光标移至行首，但不换行；</span><br><span class="line">\t 插入tab；</span><br><span class="line">\v 与\f相同；</span><br><span class="line">\\ 插入 \ 字符；</span><br><span class="line">\nnn 插入nnn（八进制）所代表的ASCII字符；</span><br></pre></td></tr></table></figure>
<h2 id="shutdown"><a class="header-anchor" href="#shutdown"></a>shutdown</h2>
<p><strong>shutdown是一个管理员命令,该命令可以安全关闭或者重新启动系统。在最后五分钟时间内，新的登录被阻止。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">shutdown [OPTION]...  TIME [MESSAGE]</span><br><span class="line"></span><br><span class="line">@@ Options</span><br><span class="line"><span class="comment">## -r 关闭系统然后重新启动，类似于Windows平台restart</span></span><br><span class="line">$ shutdown -r</span><br><span class="line"></span><br><span class="line"><span class="comment">## -h 关闭电源</span></span><br><span class="line">$ shutdown -h</span><br><span class="line"></span><br><span class="line"><span class="comment">## -c 中断关机：当执行"shutdown -h 12:00"指令时，只要按+键就可以中断关机的指令</span></span><br><span class="line">$ shutdown -c</span><br><span class="line">--&gt; shutdown: Shutdown cancelled</span><br><span class="line">--&gt; [<span class="number">1</span>]+  Done                    shutdown -h <span class="number">15</span>:<span class="number">33</span></span><br><span class="line"><span class="comment">## -k 只有发出警告信息，并禁止登录，实际上不关闭系统。</span></span><br><span class="line">$  shutdown -k <span class="string">"14:22"</span> <span class="string">'I will be closed.'</span></span><br></pre></td></tr></table></figure>
<h2 id="halt"><a class="header-anchor" href="#halt"></a>halt</h2>
<p><strong>halt是一个管理员命令,其实halt就是调用shutdown -h。halt执行时﹐杀死应用进程﹐执行sync系统调用﹐文件系统写操作完成后就会停止内核</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">reboot [OPTION]...</span><br><span class="line">halt [OPTION]...</span><br><span class="line">poweroff [OPTION]...</span><br><span class="line"></span><br><span class="line">@@OPTIONS</span><br><span class="line"><span class="comment">## -f, --force 没有调用shutdown而强制关机或重启。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -p, --poweroff 该选项为缺省选项。就是关机时调用poweroff。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -w, --wtmp-only 并不是真正的重启或关机﹐只是写wtmp〔/var/log/wtmp〕纪录。</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## --verbose 重新启动系统时输出稍微更详细的消息，对于调试问题停机是有用的。</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<h2 id="reboot"><a class="header-anchor" href="#reboot"></a>reboot</h2>
<p><strong>reboot,重启系统,参数参见halt</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br></pre></td></tr></table></figure>
<h2 id="poweroff"><a class="header-anchor" href="#poweroff"></a>poweroff</h2>
<p><strong>poweroff,重启系统,参数参见halt</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br></pre></td></tr></table></figure>
<h2 id="who"><a class="header-anchor" href="#who"></a>who</h2>
<p><strong>who,显示目前登入系统的用户信息。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">who [OPTION]... [ FILE | ARG1 ARG2 ]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -a, --all same as -b -d --login -p -r -t -T -u</span></span><br><span class="line">$ who a</span><br><span class="line">--&gt;            system boot  <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">57</span></span><br><span class="line">--&gt;            run-level <span class="number">5</span>  <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">57</span></span><br><span class="line">--&gt; LOGIN      tty3         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2160</span> id=<span class="number">3</span></span><br><span class="line">--&gt; LOGIN      tty2         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2158</span> id=<span class="number">2</span></span><br><span class="line">--&gt; LOGIN      tty4         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2166</span> id=<span class="number">4</span></span><br><span class="line">--&gt; LOGIN      tty5         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2168</span> id=<span class="number">5</span></span><br><span class="line">--&gt; LOGIN      tty6         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2170</span> id=<span class="number">6</span></span><br><span class="line">--&gt; root     + pts/<span class="number">0</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">59</span> <span class="number">00</span>:<span class="number">05</span>        <span class="number">2363</span> (<span class="number">192.168</span>.<span class="number">1.104</span>)</span><br><span class="line">--&gt; root     + pts/<span class="number">1</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">59</span>   .          <span class="number">2403</span> (<span class="number">192.168</span>.<span class="number">1.104</span>)</span><br><span class="line">--&gt;            pts/<span class="number">2</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">12</span>:<span class="number">51</span>              <span class="number">6135</span> id=ts/<span class="number">2</span>  term=<span class="number">0</span> <span class="built_in">exit</span>=<span class="number">0</span></span><br><span class="line">--&gt;            pts/<span class="number">3</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">12</span>:<span class="number">51</span>              <span class="number">6175</span> id=ts/<span class="number">3</span>  term=<span class="number">0</span> <span class="built_in">exit</span>=<span class="number">0</span></span><br><span class="line"><span class="comment">## -b, --boot 上次系统启动时间</span></span><br><span class="line">$ who -b</span><br><span class="line">--&gt;           system boot  <span class="number">2015</span>-<span class="number">08</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">06</span></span><br><span class="line"><span class="comment">## -d --deal 打印死亡进程</span></span><br><span class="line">$ who <span class="operator">-d</span></span><br><span class="line">--&gt;           pts/<span class="number">1</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">21</span> <span class="number">12</span>:<span class="number">57</span>              <span class="number">3545</span> id=ts/<span class="number">1</span>  term=<span class="number">0</span> <span class="built_in">exit</span>=<span class="number">0</span></span><br><span class="line"><span class="comment">## -H, --heading 打印列标题</span></span><br><span class="line">$ who -H</span><br><span class="line">--&gt;  NAME     LINE         TIME             COMMENT</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">59</span> (<span class="number">192.168</span>.<span class="number">1.104</span>)</span><br><span class="line">--&gt;  root     pts/<span class="number">1</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">59</span> (<span class="number">192.168</span>.<span class="number">1.104</span>)</span><br><span class="line">--&gt;  root     pts/<span class="number">2</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">13</span>:<span class="number">19</span> (<span class="number">192.168</span>.<span class="number">1.104</span>)</span><br><span class="line"><span class="comment">## -l --login 打印系统登陆进程</span></span><br><span class="line">$ who <span class="operator">-l</span>H</span><br><span class="line">--&gt;  NAME     LINE         TIME             IDLE          PID COMMENT</span><br><span class="line">--&gt;  LOGIN    tty3         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2160</span> id=<span class="number">3</span></span><br><span class="line">--&gt;  LOGIN    tty2         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2158</span> id=<span class="number">2</span></span><br><span class="line">--&gt;  LOGIN    tty4         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2166</span> id=<span class="number">4</span></span><br><span class="line">--&gt;  LOGIN    tty5         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2168</span> id=<span class="number">5</span></span><br><span class="line">--&gt;  LOGIN    tty6         <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">08</span>:<span class="number">58</span>              <span class="number">2170</span> id=<span class="number">6</span></span><br><span class="line"><span class="comment">## --lookup 试图通过规范化的DNS主机名</span></span><br><span class="line">$ who --lookup</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">07</span>:<span class="number">53</span> (<span class="number">114.241</span>.<span class="number">25.195</span>)</span><br><span class="line"><span class="comment">## -m 只与标准输入相关的主机名和用户</span></span><br><span class="line">$</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">07</span>:<span class="number">53</span> (<span class="number">114.241</span>.<span class="number">25.195</span>)</span><br><span class="line"><span class="comment">## -p, --process 打印由init启动，活动进程</span></span><br><span class="line">$ who -p</span><br><span class="line"></span><br><span class="line"><span class="comment">## -q, --count 统计登陆的个数</span></span><br><span class="line">$ who -q</span><br><span class="line">--&gt;  root root root</span><br><span class="line">--&gt;  <span class="comment"># users=3</span></span><br><span class="line"><span class="comment">## -r, --runlevel 打印当前的运行级别</span></span><br><span class="line">$ who -r</span><br><span class="line">--&gt;  run-level <span class="number">3</span>  <span class="number">2015</span>-<span class="number">08</span>-<span class="number">08</span> <span class="number">22</span>:<span class="number">06</span></span><br><span class="line"><span class="comment">## -s, --short 打印简短的格式(默认的选项)</span></span><br><span class="line">$ who <span class="operator">-s</span></span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>        <span class="number">2015</span>-<span class="number">08</span>-<span class="number">22</span> <span class="number">07</span>:<span class="number">53</span> (<span class="number">114.241</span>.<span class="number">25.195</span>)</span><br><span class="line"><span class="comment">##-t, --time 打印最后一次时间的变化</span></span><br><span class="line">$ who -t</span><br><span class="line"></span><br><span class="line"><span class="comment">## -T, -w, --mesg</span></span><br><span class="line">$</span><br><span class="line"></span><br><span class="line"><span class="comment">## -u, --users</span></span><br><span class="line"><span class="comment">## --message</span></span><br><span class="line"><span class="comment">## --writable</span></span><br></pre></td></tr></table></figure>
<h2 id="w"><a class="header-anchor" href="#w"></a>w</h2>
<p><strong>w,显示目前谁登陆到系统以及它们在做什么。</strong></p>
<p>*** w命令的显示项目按以下顺序排列：当前时间，系统启动到现在的时间，登录用户的数目，系统在最 近1秒、5秒和15分钟的平均负载。然后是每个用户的各项数据，项目显示顺序如下：登录帐号、终端名称、远 程主机名、登录时间、空闲时间、JCPU、PCPU、当前正在运行进程的命令行。***</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line">w - [husfiV] [user]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -h 不显示标题</span></span><br><span class="line">$ w -h</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>    <span class="number">114.241</span>.<span class="number">25.195</span>   <span class="number">13</span>:<span class="number">42</span>    <span class="number">0.00</span>s  <span class="number">0.18</span>s  <span class="number">0.00</span>s w -h</span><br><span class="line"><span class="comment">## -u 当列出当前进程和CPU时间时忽略用户名。这主要是用于执行su命令后的情况</span></span><br><span class="line">$ w -u</span><br><span class="line">--&gt;   <span class="number">13</span>:<span class="number">46</span>:<span class="number">00</span> up <span class="number">52</span> days, <span class="number">49</span> min,  <span class="number">1</span> user,  load average: <span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.00</span></span><br><span class="line">--&gt;  USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>    <span class="number">114.241</span>.<span class="number">25.195</span>   <span class="number">13</span>:<span class="number">42</span>    <span class="number">0.00</span>s  <span class="number">0.19</span>s  <span class="number">0.00</span>s w -u</span><br><span class="line"></span><br><span class="line"><span class="comment">## -f 切换显示FROM项，也就是远程主机名项。默认值是不显示远程主机名，</span></span><br><span class="line"><span class="comment">## 当然系统管理员可以对源文件 ##作一些修改使得显示该项成为默认值。</span></span><br><span class="line">$ w <span class="operator">-f</span></span><br><span class="line">--&gt;   <span class="number">13</span>:<span class="number">47</span>:<span class="number">53</span> up <span class="number">52</span> days, <span class="number">51</span> min,  <span class="number">1</span> user,  load average: <span class="number">0.00</span>, <span class="number">0.00</span>, <span class="number">0.00</span></span><br><span class="line">--&gt;  USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>     <span class="number">13</span>:<span class="number">42</span>    <span class="number">0.00</span>s  <span class="number">0.21</span>s  <span class="number">0.00</span>s w <span class="operator">-f</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## -i显示IP地址代替主机名(如果可能)</span></span><br><span class="line">$ w -i</span><br><span class="line">--&gt;   <span class="number">13</span>:<span class="number">51</span>:<span class="number">27</span> up  <span class="number">4</span>:<span class="number">53</span>,  <span class="number">3</span> users,  load average: <span class="number">0.02</span>, <span class="number">0.01</span>, <span class="number">0.00</span></span><br><span class="line">--&gt;  USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">--&gt;  root     pts/<span class="number">0</span>    <span class="number">192.168</span>.<span class="number">1.104</span>    <span class="number">08</span>:<span class="number">59</span>   <span class="number">13</span>:<span class="number">07</span>   <span class="number">0.65</span>s  <span class="number">0.00</span>s man w</span><br><span class="line">--&gt;  root     pts/<span class="number">1</span>    <span class="number">192.168</span>.<span class="number">1.104</span>    <span class="number">08</span>:<span class="number">59</span>    <span class="number">0.00</span>s  <span class="number">1.67</span>s  <span class="number">0.00</span>s w -i</span><br><span class="line">--&gt;  root     pts/<span class="number">2</span>    <span class="number">192.168</span>.<span class="number">1.104</span>    <span class="number">13</span>:<span class="number">19</span>   <span class="number">15</span>:<span class="number">08</span>   <span class="number">0.14</span>s  <span class="number">0.14</span>s -bash</span><br></pre></td></tr></table></figure>
<h2 id="whoami"><a class="header-anchor" href="#whoami"></a>whoami</h2>
<p><strong>whoami,打印与当前的有效用户ID相关联的用户名。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## SYNOPSIS</span></span><br><span class="line"></span><br><span class="line">$ whoami</span><br><span class="line">--&gt; root</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>文中 <code>--&gt;</code> 为开头的为命令行的输出.</em></p>
<p><em>涉及到的命令有,date,clock,hwclock,cal,ls,cd,pwd,tty,whereis,which,stat,echo,shutdown,halt,reboot,poweroff,who,w,whoami</em></p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="Task" scheme="http://molloc.me/categories/Task/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello Hexo]]></title>
    <link href="http://molloc.me/2015/06/29/hello-hexo/"/>
    <id>http://molloc.me/2015/06/29/hello-hexo/</id>
    <published>2015-06-29T10:14:22.403Z</published>
    <updated>2015-06-28T07:42:34.000Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="quick-start"><a class="header-anchor" href="#quick-start"></a>Quick Start</h2>
<h3 id="create-a-new-post"><a class="header-anchor" href="#create-a-new-post"></a>Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<a id="more"></a>
### Run server
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="generate-static-files"><a class="header-anchor" href="#generate-static-files"></a>Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="deploy-to-remote-sites"><a class="header-anchor" href="#deploy-to-remote-sites"></a>Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="quick-start"><a class="header-anchor" href="#quick-start"></a>Quick Start</h2>
<h3 id="create-a-new-post"><a class="header-anchor" href="#create-a-new-post"></a>Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html">Writing</a></p>]]>
    
    </summary>
    
      <category term="探索发现" scheme="http://molloc.me/categories/%E6%8E%A2%E7%B4%A2%E5%8F%91%E7%8E%B0/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Cars]]></title>
    <link href="http://molloc.me/2015/06/29/Cars/"/>
    <id>http://molloc.me/2015/06/29/Cars/</id>
    <published>2015-06-29T10:14:22.049Z</published>
    <updated>2015-06-28T07:42:34.000Z</updated>
    <content type="html"><![CDATA[<p>Founded in 1963, Automobili Lamborghini is headquartered in Sant’Agata Bolognese, in Northeastern Italy. There it manufactures some of the world’s most sought-after super sports cars. With the presentation of the Huracán LP 610-4, Lamborghini offers a new dimension in luxury super sports cars.
With 122 dealerships worldwide, Automobili Lamborghini is building on a succession of dynamic and elegant super sports cars including the 350GT, Miura, Espada, Countach, Diablo, Murciélago, Reventón Coupe, Reventón Roadster, Aventador and Gallardo.</p>
<p><img src="http://static.molloc.com/cars/1363048919SWhAHn.jpg" alt="Wallbase - dgnfly (wallbase.cc/wallpaper/1384450)" title="Car002"></p>
<a id="more"></a>
<p>At the  Beijing Motorshow 2014 Automobili Lamborghini is also going to present the Aventador in a highly exclusive and appealing configuration called Nazionale, realized  by Lamborghini Ad Personam, the personalization program that allows clients to create their own made-to-order Lamborghini.</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Founded in 1963, Automobili Lamborghini is headquartered in Sant’Agata Bolognese, in Northeastern Italy. There it manufactures some of the world’s most sought-after super sports cars. With the presentation of the Huracán LP 610-4, Lamborghini offers a new dimension in luxury super sports cars.
With 122 dealerships worldwide, Automobili Lamborghini is building on a succession of dynamic and elegant super sports cars including the 350GT, Miura, Espada, Countach, Diablo, Murciélago, Reventón Coupe, Reventón Roadster, Aventador and Gallardo.</p>
<p><img src="http://static.molloc.com/cars/1363048919SWhAHn.jpg" alt="Wallbase - dgnfly (wallbase.cc/wallpaper/1384450)" title="Car002"></p>]]>
    
    </summary>
    
      <category term="Cars" scheme="http://molloc.me/tags/Cars/"/>
    
      <category term="美图世界" scheme="http://molloc.me/categories/%E7%BE%8E%E5%9B%BE%E4%B8%96%E7%95%8C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[awk基础]]></title>
    <link href="http://molloc.me/2015/06/29/awk%E5%9F%BA%E7%A1%80/"/>
    <id>http://molloc.me/2015/06/29/awk基础/</id>
    <published>2015-06-29T10:14:14.000Z</published>
    <updated>2015-06-29T13:52:34.500Z</updated>
    <content type="html"><![CDATA[<h2 id="awk简介"><a class="header-anchor" href="#awk简介"></a>awk简介</h2>
<p><code>awk</code> : 中文意思是报告生成器 能够根据我们输入的信息，将信息格式化以后显示，将定义好的信息以比较美观（直观）的方式显示出来出现比较早，继而出现了new awk（nawk）在windows上实现，gawk, awk实现在linux上。awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk的处理文本和数据的方式是这样的，它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。awk分别代表其作者姓氏的第一个字母，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面就对awk进行介绍。</p>
<a id="more"></a>
<h2 id="awk使用的基本格式"><a class="header-anchor" href="#awk使用的基本格式"></a>awk使用的基本格式</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">awk [options] <span class="string">'script'</span> file1 file2, …</span><br><span class="line"></span><br><span class="line">awk [options] <span class="string">'PATTERN &#123; action &#125;'</span> file1 file2, <span class="comment"># 细化了上面的组合</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="comment">#输出</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span> <span class="comment">#打印</span></span><br></pre></td></tr></table></figure>
<h2 id="awk工作过程"><a class="header-anchor" href="#awk工作过程"></a>awk工作过程</h2>
<p>根据我们所定义的模式，一次从文件中读取一行文本，awk会对取出的文本做相应的切片，将每一行按照分隔符进行切割，假如我们有一行文本:this is a test.它会使用空白字符当做分隔符，将它们各个分开，切割成了四个片，分别为： this is a test.这四个片，可以使用变量，分别对应为$1,$2,$3,$4代表四个切割片，下面就做一个演示，看如何实现awk的强大功能</p>
<h2 id="awk的输出-print"><a class="header-anchor" href="#awk的输出-print"></a>awk的输出: print</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> item1, item2, …	<span class="comment">#print的使用格式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出要点：</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#1、各项目之间使用逗号隔开，而输出时则以空白字符分隔；</span></span><br><span class="line"><span class="comment">#2、输出的item可以为字符串或数值、当前记录的字段(如$1)、变量或awk的表达式；数值会先转换为字符串，而后再输出；</span></span><br><span class="line"><span class="comment">#3、print命令后面的item可以省略，此时其功能相当于print $0, 因此，如果想输出空白行，则需要使用print ""；</span></span><br></pre></td></tr></table></figure>
<h3 id="实例分析："><a class="header-anchor" href="#实例分析："></a>实例分析：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -&gt; 符号后面的是命令</span></span><br><span class="line"><span class="comment"># 显示整个文本（注意，这里只是测试，所以只有一行）</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $N&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this is a test.</span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $0&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this is a test.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的一行中的第一个参数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $1&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的一行中的第二个参数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">is</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的一行中的第四个参数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $4&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">test.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的一行中的第一与第二个个参数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $1,$2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this is</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的一行中的第一个与第二个参数，中间可以加#号</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'BEGIN&#123;OFS="#"&#125;&#123;print $1,$2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this<span class="comment">#is</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本中的各个参数，还可以加修饰符</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'BEGIN&#123;OFS=":"&#125;&#123;print $1,$2,$3,$4&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this:is:a:test.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本中的参数，还可以加修饰符，还可以加字符串</span></span><br><span class="line"></span><br><span class="line">-&gt;  awk <span class="string">'BEGIN&#123;OFS=":"&#125;&#123;print $1,"hello",$2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this:hello:is</span><br><span class="line"></span><br><span class="line">输出三行，注意换行需要加\n</span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'BEGIN &#123; print "line one\nline two\nline three" &#125;'</span></span><br><span class="line"></span><br><span class="line">line one</span><br><span class="line">line two</span><br><span class="line">line three</span><br></pre></td></tr></table></figure>
<h2 id="awk变量"><a class="header-anchor" href="#awk变量"></a>awk变量</h2>
<h3 id="awk内置变量之记录变量"><a class="header-anchor" href="#awk内置变量之记录变量"></a>awk内置变量之记录变量</h3>
<ul>
<li>FS: field separator，读取文本时所使用的字段分隔符</li>
<li>RS: Record separator，读取文本信息所使用的换行符</li>
<li>OFS: Output Filed Separator: 输出文本时使用的字段分隔符</li>
<li>ORS：Output Row Separator：输出文本时使用的行分隔符</li>
</ul>
<h3 id="awk内置变量之数据变量"><a class="header-anchor" href="#awk内置变量之数据变量"></a>awk内置变量之数据变量</h3>
<ul>
<li>NR: The number of input records，awk命令所处理的记录数；如果有多个文件，这个数目会把处理的多个文件中行统一计数；</li>
<li>NF：Number of Field，当前记录的field个数；</li>
<li>FNR: 与NR不同的是，FNR用于记录正处理的行是当前这一文件中被总共处理的行数；</li>
<li>ARGV: 数组，保存命令行本身这个字符串，如awk '{print $0}' a.txt b.txt这个命令中，ARGV[0]保存awk，ARGV[1]保存a.txt；</li>
<li>ARGC: awk命令的参数的个数；</li>
<li>FILENAME: awk命令所处理的文件的名称;</li>
<li>ENVIRON：当前shell环境变量及其值的关联数组；</li>
</ul>
<h3 id="实例分析"><a class="header-anchor" href="#实例分析"></a>实例分析</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示文本的行数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;print NR&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示一行总共有几个参数</span></span><br><span class="line">-&gt; awk <span class="string">'&#123;print NF&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line"><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示文本的最后一个参数</span></span><br><span class="line">-&gt; awk <span class="string">'&#123;print $NF&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">test.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时查看多个文本</span></span><br><span class="line">-&gt; awk <span class="string">'&#123;print FNR&#125;'</span> test.txt /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>  显示的是第一个文本的行数</span><br><span class="line"><span class="number">1</span>  显示的是第二个文本的第一行数，以此类推</span><br><span class="line"><span class="number">2</span>  显示的是第二个文本的第二行数</span><br><span class="line"><span class="number">3</span>  显示的是第二个文本的第三行数</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看环境变量</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'BEGIN&#123;print ENVIRON["PATH"]&#125;'</span></span><br><span class="line"></span><br><span class="line">/usr/kerberos/sbin:/usr/kerberos/bin:/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/sbin:/ \</span><br><span class="line">bin:/usr/sbin:/usr/bin:/usr/<span class="built_in">local</span>/apache/bin:/usr/<span class="built_in">local</span>/mysql/bin:/root/bin</span><br></pre></td></tr></table></figure>
<h2 id="用户自定义变量"><a class="header-anchor" href="#用户自定义变量"></a>用户自定义变量</h2>
<p>gawk允许用户自定义自己的变量以便在程序代码中使用，变量名命名规则与大多数编程语言相同，只能使用字母、数字和下划线，且不能以数字开头。gawk变量名称区分字符大小写。</p>
<h3 id="在脚本中赋值变量"><a class="header-anchor" href="#在脚本中赋值变量"></a>在脚本中赋值变量</h3>
<p>在gawk中给变量赋值使用赋值语句进行</p>
<h3 id="在命令行中使用赋值变量"><a class="header-anchor" href="#在命令行中使用赋值变量"></a>在命令行中使用赋值变量</h3>
<p>gawk命令也可以在“脚本”外为变量赋值，并在脚本中进行引用。</p>
<h3 id="实例分析-v2"><a class="header-anchor" href="#实例分析-v2"></a>实例分析</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出一个变量，并赋值</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'BEGIN&#123;var="variable testing";print var&#125;'</span></span><br><span class="line"></span><br><span class="line">variable testing</span><br><span class="line"></span><br><span class="line">-&gt; awk -v var=<span class="string">"variable testing"</span> <span class="string">'BEGIN&#123;print var&#125;'</span></span><br><span class="line"></span><br><span class="line">variable testing</span><br></pre></td></tr></table></figure>
<h2 id="awk打印工具：printf"><a class="header-anchor" href="#awk打印工具：printf"></a>awk打印工具：printf</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> format, item1, item2, …</span><br></pre></td></tr></table></figure>
<h3 id="printf要点："><a class="header-anchor" href="#printf要点："></a>printf要点：</h3>
<ol>
<li>其与print命令的最大不同是，printf需要指定format；</li>
<li>format用于指定后面的每个item的输出格式；</li>
<li>printf语句不会自动打印换行符；需要添加\n</li>
</ol>
<p>format格式的指示符都以%开头，后跟一个字符；如下：</p>
<ul>
<li>%c: 显示第一个参数的第一个字符</li>
<li>%d, %i：十进制整数；</li>
<li>%e, %E：科学计数法显示数值；</li>
<li>%f: 显示浮点数；</li>
<li>%g, %G: 以科学计数法的格式或浮点数的格式显示数值；</li>
<li>%s: 显示字符串；</li>
<li>%u: 无符号整数；</li>
<li>%%: 显示%自身；</li>
</ul>
<p>修饰符：</p>
<ul>
<li>N: 显示宽度；</li>
<li>-: 左对齐；</li>
<li>+：显示数值符号；</li>
</ul>
<p>示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-&gt; awk <span class="string">'&#123;printf "%c\n”,$1&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">t <span class="comment"># 显示第一个参数的第一个字母</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;printf "%s\n",$1&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this  <span class="comment"># 显示第一个参数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;printf "%10s\n",$1&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this <span class="comment"># 显示时用了10个字符串，默认是右对齐</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;printf "%-10s\n",$1&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this  <span class="comment"># 显示时左对齐，后面有6个空字符串</span></span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;printf "%-10s,%-10s\n",$1,$2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this      ,is</span><br><span class="line"></span><br><span class="line">-&gt; awk <span class="string">'&#123;printf "%-10s%-10s\n",$1,$2&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this      is</span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;printf "%5d",$3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>    <span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span>    <span class="number">4</span>    <span class="number">5</span>    <span class="number">6</span>    <span class="number">7</span>    <span class="number">8</span>    <span class="number">9</span>   <span class="number">10</span>   <span class="number">11</span>   <span class="number">12</span>   <span class="number">13</span>   <span class="number">14</span>   <span class="number">99</span>   <span class="number">81</span>   <span class="number">28</span>  <span class="number">69</span> \</span><br><span class="line">    <span class="number">77</span>   <span class="number">38</span>   <span class="number">70</span>   <span class="number">32</span>   <span class="number">47</span>   <span class="number">51</span>   <span class="number">74</span>   <span class="number">16</span>   <span class="number">68</span>  <span class="number">100</span>   <span class="number">2965534</span>   <span class="number">43</span>   <span class="number">42</span>  <span class="number">500</span>  <span class="number">501</span>  <span class="number">502</span>  <span class="number">5032002</span> \</span><br><span class="line">    <span class="number">2003</span> <span class="number">2004</span> <span class="number">4004</span> <span class="number">2033</span> <span class="number">2034</span> <span class="number">4005</span> <span class="number">4006</span> <span class="number">4007</span> <span class="number">4011</span> <span class="number">4017</span> <span class="number">4018</span> <span class="number">4019</span> <span class="number">4026</span> <span class="number">4027</span> <span class="number">4028</span>   <span class="number">48</span>   <span class="number">25</span>  <span class="number">101</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;printf "%-5d\n",$3&#125;'</span> /etc/passwd   <span class="comment"># 左对齐</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;printf "%+5d\n",$3&#125;'</span> /etc/passwd   <span class="comment"># 右对齐</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;printf "%-15s %i\n",$1,$3&#125;'</span> test.txt</span><br><span class="line"></span><br><span class="line">this is a test. <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="输出重定向"><a class="header-anchor" href="#输出重定向"></a>输出重定向</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> items &gt; output-file</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> items &gt;&gt; output-file</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> items | <span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 特殊文件描述符：</span></span><br><span class="line"></span><br><span class="line">/dev/stdin: <span class="comment">#标准输入</span></span><br><span class="line"></span><br><span class="line">/dev/sdtout: <span class="comment">#标准输出</span></span><br><span class="line"></span><br><span class="line">/dev/stderr: <span class="comment">#错误输出</span></span><br><span class="line"></span><br><span class="line">/dev/fd/N: <span class="comment"># 某特定文件描述符，如/dev/stdin就相当于/dev/fd/0；</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例子：</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;printf "%-15s %i\n",$1,$3 &gt; "/dev/stderr" &#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root            <span class="number">0</span></span><br><span class="line">bin             <span class="number">1</span></span><br><span class="line">daemon          <span class="number">2</span></span><br><span class="line">adm             <span class="number">3</span></span><br><span class="line">lp              <span class="number">4</span></span><br><span class="line">sync            <span class="number">5</span></span><br><span class="line">shutdown        <span class="number">6</span></span><br><span class="line">halt            <span class="number">7</span></span><br></pre></td></tr></table></figure>
<h2 id="awk的操作符"><a class="header-anchor" href="#awk的操作符"></a>awk的操作符</h2>
<h3 id="算术操作符"><a class="header-anchor" href="#算术操作符"></a>算术操作符</h3>
<ul>
<li>-x: 负值</li>
<li>+x: 转换为数值；</li>
<li>x^y:</li>
<li>x**y: 次方</li>
<li>x*y: 乘法</li>
<li>x/y：除法</li>
<li>x+y: 加法</li>
<li>x-y: 减法</li>
<li>x%y: 取模</li>
</ul>
<h3 id="字符串操作符"><a class="header-anchor" href="#字符串操作符"></a>字符串操作符</h3>
<p>只有一个，而且不用写出来，用于实现字符串连接；</p>
<h3 id="赋值操作符"><a class="header-anchor" href="#赋值操作符"></a>赋值操作符</h3>
<p><code>=、+=、-=、*=、/=、%=、^=、**=、++、–</code></p>
<p>需要注意的是，如果某模式为=号，此时使用/=/可能会有语法错误，应以/[=]/替代；</p>
<h3 id="布尔值"><a class="header-anchor" href="#布尔值"></a>布尔值</h3>
<p>awk中，任何非0值或非空字符串都为真，反之就为假；</p>
<h3 id="比较操作符"><a class="header-anchor" href="#比较操作符"></a>比较操作符</h3>
<ul>
<li>x &lt; y      x小于y为真，反之为假</li>
<li>x &lt;= y     x小于等于y为真，反之为假</li>
<li>x &gt; y      x大于y为真，反之为假</li>
<li>x &gt;= y     x大于等于y为真，反之为假</li>
<li>x == y    x恒等于y为真，反之为假</li>
<li>x != y    x不等于y为真，反之为假</li>
<li>x ~ y   True if the string x matches the regexp denoted by y.</li>
<li>x !~ y  True if the string x does not match the regexp denoted by y.</li>
<li>subscript in array    True if the array array has an element with the subscript subscript.</li>
</ul>
<h3 id="表达式间的逻辑关系符"><a class="header-anchor" href="#表达式间的逻辑关系符"></a>表达式间的逻辑关系符</h3>
<ul>
<li>&amp;&amp;： 逻辑与</li>
<li>||：逻辑或</li>
</ul>
<h3 id="条件表达式"><a class="header-anchor" href="#条件表达式"></a>条件表达式</h3>
<p><code>a&gt;b?a is max:b is max</code></p>
<h2 id="函数调用function-name-para1-para2"><a class="header-anchor" href="#函数调用function-name-para1-para2"></a>函数调用<code>function_name (para1,para2)</code></h2>
<h2 id="awk的模式"><a class="header-anchor" href="#awk的模式"></a>awk的模式</h2>
<p><code>awk ‘program’ input-file1 input-file2 …</code></p>
<p>其中的program为<code>pattern { action }</code></p>
<h3 id="常见的模式类型"><a class="header-anchor" href="#常见的模式类型"></a>常见的模式类型</h3>
<h4 id="regexp"><a class="header-anchor" href="#regexp"></a>Regexp</h4>
<p>正则表达式，格式为/regular expression/</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例如：显示以r开头的行</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'/^r/&#123;print $1&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root</span><br><span class="line">rpc</span><br><span class="line">rtkit</span><br><span class="line">rpcuser</span><br></pre></td></tr></table></figure>
<h4 id="expresssion"><a class="header-anchor" href="#expresssion"></a>expresssion</h4>
<p>表达式，其值非0或为非空字符时满足条件，</p>
<p>如：\$1 ~ /foo/ 或 \$1 == &quot;magedu&quot;，用运算符~(匹配)和~!(不匹配)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示id号小于等于2的用户和id号</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'$3-1&lt;5&#123;print $1,$3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root /bin/bash</span><br><span class="line">nexus /bin/bash</span><br><span class="line">user1 /bin/bash</span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'$3&lt;=5&#123;print $1,$3&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root <span class="number">0</span></span><br><span class="line">bin <span class="number">1</span></span><br><span class="line">daemon <span class="number">2</span></span><br><span class="line">adm <span class="number">3</span></span><br><span class="line">lp <span class="number">4</span></span><br><span class="line">sync <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出默认shell为bash的用户</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'$7~"bash$"&#123;print $1,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root /bin/bash</span><br><span class="line">nexus /bin/bash</span><br><span class="line">user1 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示默认shell不是bash的用户</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'$7!~"bash"&#123;print $1,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">haldaemon /sbin/nologin</span><br><span class="line">gdm /sbin/nologin</span><br><span class="line">ntp /sbin/nologin</span><br><span class="line">apache /sbin/nologin</span><br><span class="line">saslauth /sbin/nologin</span><br><span class="line">postfix /sbin/nologin</span><br><span class="line">pulse /sbin/nologin</span><br><span class="line">sshd /sbin/nologin</span><br></pre></td></tr></table></figure>
<h4 id="ranges"><a class="header-anchor" href="#ranges"></a>Ranges</h4>
<p>指定的匹配范围，格式为pat1,pat2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示id号为0或者shell为/sbin/nologin的用户</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'$3==0,$7~"nologin"&#123;print $1,$3,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root <span class="number">0</span> /bin/bash</span><br><span class="line">bin <span class="number">1</span> /sbin/nologin</span><br></pre></td></tr></table></figure>
<h4 id="begin-end"><a class="header-anchor" href="#begin-end"></a>BEGIN/END</h4>
<p>特殊模式，仅在awk命令执行前运行一次或结束前运行一次</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-&gt; awk -F: <span class="string">'$3==0,$7~"nologin"&#123;printf "%-10s%-20s\n",$1,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root      /bin/bash</span><br><span class="line">bin       /sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以在显示时显示表头</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'BEGIN&#123;printf "%-20s%-20s\n","Username","shell"&#125;&#123;printf "%-20s%-20s\n",$1,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">Username            shell</span><br><span class="line">root                /bin/bash</span><br><span class="line">bin                 /sbin/nologin</span><br><span class="line">daemon              /sbin/nologin</span><br><span class="line">adm                 /sbin/nologin</span><br><span class="line">lp                  /sbin/nologin</span><br><span class="line">sync                /bin/sync</span><br><span class="line">shutdown            /sbin/shutdown</span><br><span class="line">halt                /sbin/halt</span><br><span class="line">mail                /sbin/nologin</span><br><span class="line">uucp                /sbin/nologin</span><br><span class="line">operator            /sbin/nologin</span><br><span class="line">games               /sbin/nologin</span><br><span class="line">gopher              /sbin/nologin</span><br><span class="line">ftp                 /sbin/nologin</span><br><span class="line">nobody              /sbin/nologin</span><br><span class="line">dbus                /sbin/nologin</span><br><span class="line">usbmuxd             /sbin/nologin</span><br><span class="line">vcsa                /sbin/nologin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示表头和表尾</span></span><br><span class="line"></span><br><span class="line">-&gt;  awk -F: <span class="string">'BEGIN&#123;print "Username  shell"&#125; &#123;printf "%-10s%-20s\n",$1,$7&#125;END &#123;print "END OF report"&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">Username  shell</span><br><span class="line">root      /bin/bash</span><br><span class="line">bin       /sbin/nologin</span><br><span class="line">END OF report</span><br></pre></td></tr></table></figure>
<h4 id="empty-空模式"><a class="header-anchor" href="#empty-空模式"></a>Empty(空模式)</h4>
<p>匹配任意输入行，对文件中的每一行做匹配</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-&gt; awk -F:  <span class="string">'&#123;printf "%-10s%-20s\n",$1,$7&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root      /bin/bash</span><br><span class="line">bin       /sbin/nologin</span><br><span class="line">daemon    /sbin/nologin</span><br><span class="line">adm       /sbin/nologin</span><br></pre></td></tr></table></figure>
<h2 id="常见的action-动作"><a class="header-anchor" href="#常见的action-动作"></a>常见的Action（动作）</h2>
<h3 id="expressions-表达式"><a class="header-anchor" href="#expressions-表达式"></a>Expressions:表达式</h3>
<h3 id="control-statements"><a class="header-anchor" href="#control-statements"></a>Control statements</h3>
<p>控制语句（if、while…do、for….)</p>
<h4 id="if-else"><a class="header-anchor" href="#if-else"></a>if-else</h4>
<p>语法: <code>if (condition) {then-body} else {[ else-body ]}</code></p>
<p>示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 若用户是root则显示"admin"否则显示为"Common user"</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;if ($1=="root") print $1,"admin"; else print $1, "Common user"&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root admin</span><br><span class="line">bin Common user</span><br><span class="line">daemon Common user</span><br><span class="line">adm Common user</span><br><span class="line">lp Common user</span><br><span class="line">sync Common user</span><br><span class="line">shutdown Common user</span><br><span class="line">halt Common user</span><br><span class="line">mail Common user</span><br><span class="line">uucp Common user</span><br><span class="line">operator Common user</span><br><span class="line">games Common user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是对上面的语法格式化了，看起来更美观</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;if ($1=="root") printf "%-15s: %s\n", $1,"Admin"; else printf "%-15s: %s\n", $1, "Common User"&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">root           : admin</span><br><span class="line">bin            : Common User</span><br><span class="line">daemon         : Common User</span><br><span class="line">adm            : Common User</span><br><span class="line">lp             : Common User</span><br><span class="line">sync           : Common User</span><br><span class="line">shutdown       : Common User</span><br><span class="line">halt           : Common User</span><br><span class="line">mail           : Common User</span><br><span class="line">uucp           : Common User</span><br><span class="line">operator       : Common User</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计id号大于等于500的用户个数</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: -v sum=<span class="number">0</span> <span class="string">'&#123;if ($3&gt;=500) sum++&#125;END&#123;print sum&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>
<h4 id="while"><a class="header-anchor" href="#while"></a>while</h4>
<p>语法： while (condition){statement1; statment2; …}</p>
<p>示例:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示字符串大于等于8的（每一个字符串都要做一下判断）</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;i=1;while (i&lt;=NF) &#123;if (length($i)&gt;=8) &#123;print $i&#125;; i++ &#125;&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br><span class="line">/sbin/nologin</span><br><span class="line">/sbin/nologin</span><br><span class="line">/var/adm</span><br><span class="line">/sbin/nologin</span><br><span class="line">/var/spool/lpd</span><br><span class="line">/sbin/nologin</span><br><span class="line">/bin/sync</span><br><span class="line">shutdown</span><br><span class="line">shutdown</span><br><span class="line">/sbin/shutdown</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示字符串大于等于4的</span></span><br><span class="line"></span><br><span class="line">-&gt; awk -F: <span class="string">'&#123;i=1;while (i&lt;=NF)&#123;if (length($i)&gt;=4) &#123;print $i&#125;; i++&#125;&#125;'</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">bin/sh</span><br><span class="line">mailnull</span><br><span class="line">/var/spool/mqueue</span><br><span class="line">/sbin/nologin</span><br><span class="line">smmsp</span><br><span class="line">/var/spool/mqueue</span><br><span class="line">/sbin/nologin</span><br><span class="line">mysql</span><br><span class="line">/home/mysql</span><br><span class="line">/sbin/nologin</span><br><span class="line">/home/www</span><br><span class="line">/sbin/nologin</span><br></pre></td></tr></table></figure>
<h3 id="compound-statements-复合语句"><a class="header-anchor" href="#compound-statements-复合语句"></a>Compound statements:复合语句</h3>
<h3 id="input-statements：输入语句"><a class="header-anchor" href="#input-statements：输入语句"></a>Input statements：输入语句</h3>
<h3 id="output-statements：输出语句"><a class="header-anchor" href="#output-statements：输出语句"></a>Output statements：输出语句</h3>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="awk简介"><a class="header-anchor" href="#awk简介"></a>awk简介</h2>
<p><code>awk</code> : 中文意思是报告生成器 能够根据我们输入的信息，将信息格式化以后显示，将定义好的信息以比较美观（直观）的方式显示出来出现比较早，继而出现了new awk（nawk）在windows上实现，gawk, awk实现在linux上。awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。数据可以来自标准输入、一个或多个文件，或其它命令的输出。它支持用户自定义函数和动态正则表达式等先进功能，是linux/unix下的一个强大编程工具。它在命令行中使用，但更多是作为脚本来使用。awk的处理文本和数据的方式是这样的，它逐行扫描文件，从第一行到最后一行，寻找匹配的特定模式的行，并在这些行上进行你想要的操作。如果没有指定处理动作，则把匹配的行显示到标准输出(屏幕)，如果没有指定模式，则所有被操作所指定的行都被处理。awk分别代表其作者姓氏的第一个字母，分别是Alfred Aho、Brian Kernighan、Peter Weinberger。gawk是awk的GNU版本，它提供了Bell实验室和GNU的一些扩展。下面就对awk进行介绍。</p>]]>
    
    </summary>
    
      <category term="linux" scheme="http://molloc.me/tags/linux/"/>
    
      <category term="学习笔记" scheme="http://molloc.me/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>